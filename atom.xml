<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>清风</title>
  
  <subtitle>虽不能至，心向往之</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-05-01T01:25:00.000Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>ZHANG</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>域控管理常用脚本</title>
    <link href="http://example.com/2024/05/01/%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2024/05/01/%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86/</id>
    <published>2024-05-01T01:25:00.000Z</published>
    <updated>2024-05-01T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="域控管理常用脚本"><a href="#域控管理常用脚本" class="headerlink" title="域控管理常用脚本"></a>域控管理常用脚本</h2><h3 id="1-批量创建用户-永不过期版"><a href="#1-批量创建用户-永不过期版" class="headerlink" title="1.批量创建用户(永不过期版)"></a>1.批量创建用户(永不过期版)</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入 CSV 文件，注意csv文件的编码和多余行，这个版本的账户默认为永不过期</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\user.csv&quot;</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置域控信息</span></span><br><span class="line"><span class="variable">$domainController</span> = <span class="string">&quot;testad.com&quot;</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=IT部门,OU=强盛集团,DC=testad,DC=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历 CSV 文件中的每一行</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 从 CSV 中获取用户信息</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$user</span>.Username</span><br><span class="line">    <span class="variable">$firstname</span> = <span class="variable">$user</span>.FirstName</span><br><span class="line">    <span class="variable">$lastname</span> = <span class="variable">$user</span>.LastName</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$user</span>.Password</span><br><span class="line">    <span class="variable">$pager</span> = <span class="variable">$user</span>.Pager  <span class="comment"># 假设 CSV 有一个名为 Pager 的列</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将密码转换为安全字符串</span></span><br><span class="line">    <span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拼接姓名得到显示名称</span></span><br><span class="line">    <span class="variable">$displayName</span> = <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置邮箱地址</span></span><br><span class="line">    <span class="variable">$emailAddress</span> = <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建用户，添加显示名称和邮箱</span></span><br><span class="line">    <span class="built_in">New-ADUser</span> <span class="literal">-SamAccountName</span> <span class="variable">$username</span> `</span><br><span class="line">               <span class="literal">-UserPrincipalName</span> <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-Name</span> <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-GivenName</span> <span class="variable">$firstname</span> `</span><br><span class="line">               <span class="literal">-Surname</span> <span class="variable">$lastname</span> `</span><br><span class="line">               <span class="literal">-DisplayName</span> <span class="variable">$displayName</span> `</span><br><span class="line">               <span class="literal">-EmailAddress</span> <span class="variable">$emailAddress</span> `</span><br><span class="line">               <span class="literal">-AccountPassword</span> <span class="variable">$securePassword</span> `</span><br><span class="line">               <span class="literal">-CannotChangePassword</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-PasswordNeverExpires</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-Enabled</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-OtherAttributes</span> <span class="selector-tag">@</span>&#123;<span class="string">&#x27;pager&#x27;</span>=<span class="variable">$pager</span>&#125; `</span><br><span class="line">               <span class="literal">-Path</span> <span class="variable">$ou</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="对应CSV文件结构"><a href="#对应CSV文件结构" class="headerlink" title="对应CSV文件结构"></a>对应CSV文件结构</h4><table><thead><tr><th align="center">Username</th><th align="center">LastName</th><th align="center">FirstName</th><th align="center">Password</th><th align="center">Pager</th></tr></thead></table><h3 id="2-批量创建用户-指定过期时间"><a href="#2-批量创建用户-指定过期时间" class="headerlink" title="2.批量创建用户(指定过期时间)"></a>2.批量创建用户(指定过期时间)</h3><ul><li>注意修改自己的OU等信息</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下面是可以指定账户过期时间的版本</span></span><br><span class="line"><span class="comment"># 导入 CSV 文件</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\user.csv&quot;</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置域控信息</span></span><br><span class="line"><span class="variable">$domainController</span> = <span class="string">&quot;testad.com&quot;</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=testad,DC=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历 CSV 文件中的每一行</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 从 CSV 中获取用户信息</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$user</span>.Username</span><br><span class="line">    <span class="variable">$firstname</span> = <span class="variable">$user</span>.FirstName</span><br><span class="line">    <span class="variable">$lastname</span> = <span class="variable">$user</span>.LastName</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$user</span>.Password</span><br><span class="line">    <span class="variable">$pager</span> = <span class="variable">$user</span>.Pager <span class="comment"># 假设 CSV 有一个名为 Pager 的列</span></span><br><span class="line">    <span class="variable">$accountExpirationDate</span> = <span class="variable">$user</span>.ExpirationDate <span class="comment"># 从 CSV 读取账户过期时间</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将密码转换为安全字符串</span></span><br><span class="line">    <span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拼接姓名得到显示名称</span></span><br><span class="line">    <span class="variable">$displayName</span> = <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置邮箱地址</span></span><br><span class="line">    <span class="variable">$emailAddress</span> = <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$accountExpirationDate</span> = <span class="variable">$user</span>.ExpirationDate</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (![<span class="built_in">string</span>]::IsNullOrEmpty(<span class="variable">$accountExpirationDate</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 转换为 DateTime 对象</span></span><br><span class="line">        <span class="variable">$expirationDate</span> = [<span class="built_in">datetime</span>]::ParseExact(<span class="variable">$accountExpirationDate</span>, <span class="string">&#x27;yyyy-MM-dd&#x27;</span>, <span class="variable">$null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添一天确保在指定时区的次日结束过期</span></span><br><span class="line">        <span class="variable">$expirationDate</span> = <span class="variable">$expirationDate</span>.AddDays(<span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Warning</span> <span class="string">&quot;无法解析用户 <span class="variable">$username</span> 的过期日期: &#x27;<span class="variable">$accountExpirationDate</span>&#x27;&quot;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建用户，添加显示名称、邮箱和账户过期时间</span></span><br><span class="line">    <span class="built_in">New-ADUser</span> <span class="literal">-SamAccountName</span> <span class="variable">$username</span> `</span><br><span class="line">               <span class="literal">-UserPrincipalName</span> <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-Name</span> <span class="string">&quot;<span class="variable">$displayName</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-GivenName</span> <span class="variable">$firstname</span> `</span><br><span class="line">               <span class="literal">-Surname</span> <span class="variable">$lastname</span> `</span><br><span class="line">               <span class="literal">-DisplayName</span> <span class="variable">$displayName</span> `</span><br><span class="line">               <span class="literal">-EmailAddress</span> <span class="variable">$emailAddress</span> `</span><br><span class="line">               <span class="literal">-AccountPassword</span> <span class="variable">$securePassword</span> `</span><br><span class="line">               <span class="literal">-PasswordNeverExpires</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-CannotChangePassword</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-AccountExpirationDate</span> <span class="variable">$expirationDate</span> `</span><br><span class="line">               <span class="literal">-Enabled</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-OtherAttributes</span> <span class="selector-tag">@</span>&#123;<span class="string">&#x27;pager&#x27;</span>=<span class="variable">$pager</span>&#125; `</span><br><span class="line">               <span class="literal">-Path</span> <span class="variable">$ou</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="对应CSV文件结构-1"><a href="#对应CSV文件结构-1" class="headerlink" title="对应CSV文件结构"></a>对应CSV文件结构</h4><table><thead><tr><th align="center">Username</th><th align="center">LastName</th><th align="center">FirstName</th><th align="center">Password</th><th align="center">Pager</th><th align="center">ExpirationDate</th></tr></thead></table><h3 id="3-批量修改账户过期时间"><a href="#3-批量修改账户过期时间" class="headerlink" title="3.批量修改账户过期时间"></a>3.批量修改账户过期时间</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\modify.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 解析日期并加上一天</span></span><br><span class="line">    <span class="variable">$expiredate</span> = [<span class="built_in">DateTime</span>]::ParseExact(<span class="variable">$_</span>.expiredate, <span class="string">&quot;yyyy-MM-dd&quot;</span>, <span class="variable">$null</span>).AddDays(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">Set-ADUser</span> <span class="variable">$_</span>.username <span class="literal">-AccountExpirationDate</span> <span class="variable">$expiredate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="对应CSV文件结构-2"><a href="#对应CSV文件结构-2" class="headerlink" title="对应CSV文件结构"></a>对应CSV文件结构</h4><table><thead><tr><th align="center">username</th><th align="center">expiredate</th></tr></thead></table><h3 id="4-指定账户永不过期"><a href="#4-指定账户永不过期" class="headerlink" title="4.指定账户永不过期"></a>4.指定账户永不过期</h3><ul><li>有一个username列</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\modify.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 设置用户账户为永不过期</span></span><br><span class="line">    <span class="built_in">Set-ADUser</span> <span class="variable">$_</span>.username <span class="literal">-AccountExpirationDate</span> <span class="variable">$null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-批量修改密码"><a href="#5-批量修改密码" class="headerlink" title="5.批量修改密码"></a>5.批量修改密码</h3><ul><li>csv要有一个sAMAccountName和password列</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userlist</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;C:\user.csv&quot;</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$userlist</span>) &#123;</span><br><span class="line">    dsmod user (dsquery user <span class="literal">-samid</span> <span class="variable">$user</span>.sAMAccountName) <span class="literal">-pwd</span> <span class="variable">$user</span>.password</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-批量删除用户"><a href="#6-批量删除用户" class="headerlink" title="6.批量删除用户"></a>6.批量删除用户</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\deleteusers.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 删除用户账户</span></span><br><span class="line">    <span class="built_in">Remove-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$_</span>.username <span class="literal">-Confirm</span>:<span class="variable">$False</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-批量修改用户登录名"><a href="#7-批量修改用户登录名" class="headerlink" title="7.批量修改用户登录名"></a>7.批量修改用户登录名</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\username.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 获取当前用户的详细信息</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&quot;SamAccountName -eq &#x27;<span class="variable">$</span>(<span class="variable">$_</span>.OldUsername)&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="comment"># 如果用户存在，则同时更新其 sAMAccountName、UserPrincipalName 和 mail</span></span><br><span class="line">        <span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span> <span class="literal">-SamAccountName</span> <span class="variable">$_</span>.NewSamAccountName <span class="literal">-UserPrincipalName</span> <span class="variable">$_</span>.NewUserPrincipalName <span class="literal">-EmailAddress</span> <span class="variable">$_</span>.NewUserPrincipalName</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Updated usernames and email for <span class="variable">$</span>(<span class="variable">$user</span>.Name): sAMAccountName to <span class="variable">$</span>(<span class="variable">$_</span>.NewSamAccountName), UserPrincipalName and EmailAddress to <span class="variable">$</span>(<span class="variable">$_</span>.NewUserPrincipalName)&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$_</span>.OldUsername) not found.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>结构如下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OldUsername,NewSamAccountName,NewUserPrincipalName</span><br><span class="line">zhangdaniu,lierniu,lierniu@domain.com</span><br></pre></td></tr></table></figure><h3 id="8-批量允许用户可修改密码"><a href="#8-批量允许用户可修改密码" class="headerlink" title="8.批量允许用户可修改密码"></a>8.批量允许用户可修改密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置成true,原来状态是不允许的，就可以变成允许，因为域控写的是，“用户不能更改密码”</span></span><br><span class="line">Username,CanChangePassword</span><br><span class="line">pjt_zhanglinyan,<span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定CSV文件路径</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\passwd.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从CSV文件读取用户数据</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 获取AD用户对象</span></span><br><span class="line">        <span class="variable">$adUser</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span>.Username <span class="literal">-Properties</span> CannotChangePassword</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据CSV文件设置&#x27;CannotChangePassword&#x27;属性</span></span><br><span class="line">        <span class="variable">$canChangePassword</span> = <span class="keyword">if</span> (<span class="variable">$user</span>.CanChangePassword <span class="operator">-eq</span> <span class="string">&#x27;true&#x27;</span>) &#123;<span class="variable">$false</span>&#125; <span class="keyword">else</span> &#123;<span class="variable">$true</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新AD用户对象的属性</span></span><br><span class="line">        <span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span>.Username <span class="literal">-CannotChangePassword</span> <span class="variable">$canChangePassword</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;已更新用户 <span class="variable">$</span>(<span class="variable">$user</span>.Username) 的密码修改设置。&quot;</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;无法更新用户 <span class="variable">$</span>(<span class="variable">$user</span>.Username) 的设置。错误: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-批量禁用域账户"><a href="#9-批量禁用域账户" class="headerlink" title="9.批量禁用域账户"></a>9.批量禁用域账户</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Active Directory模块，如果未安装可能需要先安装RSAT工具</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定CSV文件路径</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\aban.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从CSV文件中读取用户名</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每一个用户名，并尝试禁用对应的AD账户</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 获取AD用户对象</span></span><br><span class="line">    <span class="variable">$adUser</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&quot;SamAccountName -eq &#x27;<span class="variable">$</span>(<span class="variable">$user</span>.Username)&#x27;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果用户存在，则禁用账户</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$adUser</span>) &#123;</span><br><span class="line">        <span class="built_in">Disable-ADAccount</span> <span class="literal">-Identity</span> <span class="variable">$adUser</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$user</span>.Username) has been disabled.&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$user</span>.Username) not found.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">域控的一些常见场景的管理脚本</summary>
    
    
    
    <category term="WinServer" scheme="http://example.com/categories/WinServer/"/>
    
    <category term="域控" scheme="http://example.com/categories/WinServer/%E5%9F%9F%E6%8E%A7/"/>
    
    
    <category term="域控" scheme="http://example.com/tags/%E5%9F%9F%E6%8E%A7/"/>
    
    <category term="powershell" scheme="http://example.com/tags/powershell/"/>
    
    <category term="AD" scheme="http://example.com/tags/AD/"/>
    
  </entry>
  
  <entry>
    <title>LVM服务器根目录扩容</title>
    <link href="http://example.com/2024/01/18/lvm%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%89%A9%E5%AE%B9/"/>
    <id>http://example.com/2024/01/18/lvm%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%89%A9%E5%AE%B9/</id>
    <published>2024-01-18T01:25:00.000Z</published>
    <updated>2024-01-18T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LVM服务器根目录扩容"><a href="#LVM服务器根目录扩容" class="headerlink" title="LVM服务器根目录扩容"></a>LVM服务器根目录扩容</h1><h2 id="新增加一块硬盘的情况"><a href="#新增加一块硬盘的情况" class="headerlink" title="新增加一块硬盘的情况"></a>新增加一块硬盘的情况</h2><h3 id="1-给根分区扩展容量"><a href="#1-给根分区扩展容量" class="headerlink" title="1.给根分区扩展容量"></a>1.给根分区扩展容量</h3><ul><li>使用<code>fdisk-l</code> 查看磁盘分区路径<br>先在虚拟机里增加一块磁盘</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000a0ffa</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    41943039    19921920   8e  Linux LVM</span><br><span class="line"></span><br><span class="line"><span class="comment">#这一个是新加的</span></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个是原来的/目录</span></span><br><span class="line">磁盘 /dev/mapper/centos-root：18.2 GB, 18249416704 字节，35643392 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-swap：2147 MB, 2147483648 字节，4194304 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br></pre></td></tr></table></figure><h3 id="2-使用fdisk-dev-sdb-给新增硬盘进行分区"><a href="#2-使用fdisk-dev-sdb-给新增硬盘进行分区" class="headerlink" title="2.使用fdisk &#x2F;dev&#x2F;sdb 给新增硬盘进行分区"></a>2.使用fdisk &#x2F;dev&#x2F;sdb 给新增硬盘进行分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">使用磁盘标识符 0x5371ec78 创建新的 DOS 磁盘标签。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (1-4，默认 1)：</span><br><span class="line">起始 扇区 (2048-41943039，默认为 2048)：</span><br><span class="line">将使用默认值 2048</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-41943039，默认为 41943039)：</span><br><span class="line">将使用默认值 41943039</span><br><span class="line">分区 1 已设置为 Linux 类型，大小设为 20 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x5371ec78</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    41943039    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br></pre></td></tr></table></figure><h3 id="3-确定新增成功"><a href="#3-确定新增成功" class="headerlink" title="3.确定新增成功"></a>3.确定新增成功</h3><p><code>fdisk -l</code> 确定&#x2F;dev&#x2F;sdb&#x2F;新增分区成功 新分区为&#x2F;dev&#x2F;sdb1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000a0ffa</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    41943039    19921920   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x5371ec78</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    41943039    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-root：18.2 GB, 18249416704 字节，35643392 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br></pre></td></tr></table></figure><h3 id="4-使用LVM-给根分区扩展空间"><a href="#4-使用LVM-给根分区扩展空间" class="headerlink" title="4.使用LVM 给根分区扩展空间"></a>4.使用LVM 给根分区扩展空间</h3><ul><li>使用vgdisplay 命令查看VG 组名</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               centos</span><br></pre></td></tr></table></figure><h3 id="5-使用vgextend-命令把新增磁盘追加到centos-VG组"><a href="#5-使用vgextend-命令把新增磁盘追加到centos-VG组" class="headerlink" title="5.使用vgextend 命令把新增磁盘追加到centos VG组"></a>5.使用vgextend 命令把新增磁盘追加到centos VG组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgextend centos /dev/sdb1</span></span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb1&quot;</span> successfully created.</span><br><span class="line">  Volume group <span class="string">&quot;centos&quot;</span> successfully extended</span><br></pre></td></tr></table></figure><h3 id="6-添加完成之后使用vgdisplay-查看是否扩容成功"><a href="#6-添加完成之后使用vgdisplay-查看是否扩容成功" class="headerlink" title="6.添加完成之后使用vgdisplay 查看是否扩容成功"></a>6.添加完成之后使用vgdisplay 查看是否扩容成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               centos</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        2</span><br><span class="line">  Metadata Sequence No  4</span><br><span class="line">  VG Access             <span class="built_in">read</span>/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                2</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                2</span><br><span class="line">  Act PV                2</span><br><span class="line">  VG Size               38.99 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              9982</span><br><span class="line">  Alloc PE / Size       4863 / &lt;19.00 GiB</span><br><span class="line">  Free  PE / Size       5119 / &lt;20.00 GiB   <span class="comment">#看这个</span></span><br><span class="line">  VG UUID               uIB4kO-ywhz-ee5U-DzS7-Kja6-sPvZ-rbi3Bl</span><br></pre></td></tr></table></figure><h3 id="7-使用lvdisplay确定根分区路径"><a href="#7-使用lvdisplay确定根分区路径" class="headerlink" title="7.使用lvdisplay确定根分区路径"></a>7.使用lvdisplay确定根分区路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/centos/root  <span class="comment">#这里</span></span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                centos</span><br><span class="line">  LV UUID                VrUURF-GOCQ-TvkL-Yd4O-OYJk-ZMBo-gqMEaI</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time localhost, 2023-09-14 13:18:10 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                &lt;17.00 GiB</span><br><span class="line">  Current LE             4351</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure><h3 id="8-使用lvresize-给根分区扩展空间"><a href="#8-使用lvresize-给根分区扩展空间" class="headerlink" title="8.使用lvresize 给根分区扩展空间"></a>8.使用lvresize 给根分区扩展空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lvresize  -L +20G  /dev/centos/root</span></span><br><span class="line"><span class="comment">#分区增加必须得加-L +20G,如果不写+号会改变原磁盘空间</span></span><br><span class="line">  Size of logical volume centos/root changed from &lt;17.00 GiB (4351 extents) to &lt;36.00 GiB (9215 extents).</span><br><span class="line">  Logical volume centos/root successfully resized.</span><br></pre></td></tr></table></figure><h3 id="9-根分区磁盘增加成功之后使用xfs-growfs-dev-centos-root-格式化磁盘空间"><a href="#9-根分区磁盘增加成功之后使用xfs-growfs-dev-centos-root-格式化磁盘空间" class="headerlink" title="9.根分区磁盘增加成功之后使用xfs_growfs &#x2F;dev&#x2F;centos&#x2F;root 格式化磁盘空间"></a>9.根分区磁盘增加成功之后使用xfs_growfs &#x2F;dev&#x2F;centos&#x2F;root 格式化磁盘空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># xfs_growfs /dev/centos/root</span></span><br><span class="line">meta-data=/dev/mapper/centos-root isize=512    agcount=4, agsize=1113856 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=4455424, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =bash                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 4455424 to 9436160</span><br></pre></td></tr></table></figure><h3 id="10-确认一下"><a href="#10-确认一下" class="headerlink" title="10.确认一下"></a>10.确认一下</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                 898M     0  898M    0% /dev</span><br><span class="line">tmpfs                    910M     0  910M    0% /dev/shm</span><br><span class="line">tmpfs                    910M  9.6M  901M    2% /run</span><br><span class="line">tmpfs                    910M     0  910M    0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   36G  1.3G   35G    4% /  <span class="comment">#增加了</span></span><br><span class="line">/dev/sda1               1014M  151M  864M   15% /boot</span><br><span class="line">tmpfs                    182M     0  182M    0% /run/user/0</span><br></pre></td></tr></table></figure><h2 id="在原有空间上修改磁盘大小的情况"><a href="#在原有空间上修改磁盘大小的情况" class="headerlink" title="在原有空间上修改磁盘大小的情况"></a>在原有空间上修改磁盘大小的情况</h2><p><img data-src="https://cdn.nlark.com/yuque/0/2024/png/44392316/1715394977723-2b1bec51-765f-4f94-a18b-99c39fcfbc2a.png?x-oss-process=image/format,webp" alt="xunihua.png"></p><ul><li>比如从50G,直接修改成100G，新增加的磁盘是不识别的</li></ul><h3 id="1-新建分区"><a href="#1-新建分区" class="headerlink" title="1.新建分区"></a>1.新建分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w</span><br><span class="line"><span class="comment">#使用lvm方式的话，是下面的操作，上面是基于传统的分区</span></span><br><span class="line">fdisk /dev/sda</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t</span><br><span class="line"></span><br><span class="line">L</span><br><span class="line">8e</span><br><span class="line">w</span><br></pre></td></tr></table></figure><h3 id="2-对新增的磁盘处理"><a href="#2-对新增的磁盘处理" class="headerlink" title="2.对新增的磁盘处理"></a>2.对新增的磁盘处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">partprobe <span class="comment">#识别新增分区</span></span><br><span class="line"></span><br><span class="line">pvcreate /dev/sda3  <span class="comment">#使用 pvcreate 创建物理卷</span></span><br><span class="line"></span><br><span class="line">pvdisplay <span class="comment">#显示物理卷的属性 查看卷组信息</span></span><br><span class="line"></span><br><span class="line">vgextend centos /dev/sda3  <span class="comment">#使用vgextend命令动态扩展</span></span><br><span class="line"></span><br><span class="line">lvresize -L +100%FREE /dev/mapper/centos-root  <span class="comment">#扩招到/目录</span></span><br><span class="line"></span><br><span class="line">xfs_growfs /dev/mapper/centos-root <span class="comment">#重新识别/分区</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">服务器根目录扩容，两种情况</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="运维" scheme="http://example.com/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="LVM" scheme="http://example.com/tags/LVM/"/>
    
  </entry>
  
  <entry>
    <title>Clash配置负载</title>
    <link href="http://example.com/2024/01/16/clash%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD/"/>
    <id>http://example.com/2024/01/16/clash%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD/</id>
    <published>2024-01-16T01:25:00.000Z</published>
    <updated>2024-01-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Clash配置负载"><a href="#Clash配置负载" class="headerlink" title="Clash配置负载"></a>Clash配置负载</h1><h2 id="实现负载，下载拉满带宽"><a href="#实现负载，下载拉满带宽" class="headerlink" title="实现负载，下载拉满带宽"></a>实现负载，下载拉满带宽</h2><ul><li>找到settings—–&gt;Profiles——-&gt;Parsers——&gt;Edit，然后添加下面代码</li></ul><p><img data-src="https://cdn.nlark.com/yuque/0/2024/png/44392316/1715394977690-301524ad-84c5-4be1-8982-251476fabfb3.png?x-oss-process=image/format,webp" alt="clash.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">parsers:</span><br><span class="line">  - reg: &#x27;slbable$&#x27;</span><br><span class="line">    yaml:</span><br><span class="line">      append-proxy-groups:</span><br><span class="line">        - name:  负载均衡-散列</span><br><span class="line">          type: load-balance</span><br><span class="line">          url: &#x27;http://www.google.com/generate_204&#x27;</span><br><span class="line">          interval: 300</span><br><span class="line">          strategy: consistent-hashing</span><br><span class="line">        - name:  负载均衡-轮询</span><br><span class="line">          type: load-balance</span><br><span class="line">          url: &#x27;http://www.google.com/generate_204&#x27;</span><br><span class="line">          interval: 300</span><br><span class="line">          strategy: round-robin</span><br><span class="line">      commands:</span><br><span class="line">        - proxy-groups. 负载均衡-散列.proxies=[]proxyNames</span><br><span class="line">        - proxy-groups.0.proxies.0+ 负载均衡-散列</span><br><span class="line">        - proxy-groups. 负载均衡-轮询.proxies=[]proxyNames</span><br><span class="line">        - proxy-groups.0.proxies.0+ 负载均衡-轮询</span><br></pre></td></tr></table></figure><ul><li>然后在订阅链接后面添加触发条件，点击更新</li><li>会出现一个轮询，一个散列，下载建议用轮询，正常用就用散列</li></ul>]]></content>
    
    
    <summary type="html">Clash设置负载的脚本，可以让节点满速下载</summary>
    
    
    
    <category term="教程" scheme="http://example.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Clash" scheme="http://example.com/tags/Clash/"/>
    
    <category term="小教程" scheme="http://example.com/tags/%E5%B0%8F%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>监控Mysql脚本</title>
    <link href="http://example.com/2024/01/15/%E7%9B%91%E6%8E%A7mysql%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/01/15/%E7%9B%91%E6%8E%A7mysql%E8%84%9A%E6%9C%AC/</id>
    <published>2024-01-15T01:25:00.000Z</published>
    <updated>2024-01-15T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="监控Mysql脚本"><a href="#监控Mysql脚本" class="headerlink" title="监控Mysql脚本"></a>监控Mysql脚本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义MySQL用户名、密码和主机</span></span><br><span class="line">MYSQL_USER=<span class="string">&quot;root&quot;</span></span><br><span class="line">MYSQL_PASSWORD=<span class="string">&quot;123456&quot;</span></span><br><span class="line">MYSQL_HOST=<span class="string">&quot;localhost&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测MySQL服务是否运行</span></span><br><span class="line"><span class="keyword">if</span> ! pgrep mysqld &gt;/dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果MySQL服务未运行，则尝试启动服务</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MySQL is not running, attempting to start...&quot;</span></span><br><span class="line">    systemctl start mysqld</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="comment"># 再次检查MySQL服务是否已经运行</span></span><br><span class="line">    <span class="keyword">if</span> ! pgrep mysqld &gt;/dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Failed to start MySQL.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;MySQL started successfully.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查能否连接到MySQL服务器</span></span><br><span class="line"><span class="keyword">if</span> ! mysqladmin ping -h <span class="string">&quot;<span class="variable">$MYSQL_HOST</span>&quot;</span> -u <span class="string">&quot;<span class="variable">$MYSQL_USER</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$MYSQL_PASSWORD</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Could not connect to MySQL server. Attempting to restart MySQL.&quot;</span></span><br><span class="line">    /etc/init.d/mysql restart</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="keyword">if</span> ! mysqladmin ping -h <span class="string">&quot;<span class="variable">$MYSQL_HOST</span>&quot;</span> -u <span class="string">&quot;<span class="variable">$MYSQL_USER</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$MYSQL_PASSWORD</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Failed to restart MySQL.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;MySQL restarted successfully.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MySQL is running.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以配合Zabbix使用的Mysql监控脚本</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="Mysql" scheme="http://example.com/categories/Linux/Mysql/"/>
    
    
    <category term="监控" scheme="http://example.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Mysql" scheme="http://example.com/tags/Mysql/"/>
    
    <category term="shell" scheme="http://example.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>team绑定双网卡</title>
    <link href="http://example.com/2024/01/13/team%E7%BB%91%E5%AE%9A%E5%8F%8C%E7%BD%91%E5%8D%A1/"/>
    <id>http://example.com/2024/01/13/team%E7%BB%91%E5%AE%9A%E5%8F%8C%E7%BD%91%E5%8D%A1/</id>
    <published>2024-01-13T01:25:00.000Z</published>
    <updated>2024-01-13T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="team绑定双网卡"><a href="#team绑定双网卡" class="headerlink" title="team绑定双网卡"></a>team绑定双网卡</h1><p>注意：虚拟机里做，一定要额外添加两块网卡才行，总共三块网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有的网络连接</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection show</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建接口team，连接名team0，接口agg-eth0，工作模式为activebackup</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection add type team con-name team0 ifname agg-eth0 config &#x27;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为team0接口配置IP信息</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection modify team0 ipv4.addresses &quot;192.168.80.100/24&quot;</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection modify team0 ipv4.gateway &quot;192.168.80.2&quot;</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection modify team0 ipv4.dns &quot;192.168.80.2&quot;</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection modify team0 ipv4.method manual</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 ens38、ens37 加入agg-eth0</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection add type team-slave con-name team0-port1 ifname ens38 master agg-eth0</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection add type team-slave con-name team0-port2 ifname ens37 master agg-eth0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活 team0、team0-port1、team0-port2</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection up team0  </span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection up team0-port1</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection up team0-port2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 agg-eth0 网卡绑定的信息</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># teamdctl agg-eth0 state</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行此命令，并使用ping测试网络连通性，停掉一个，看会不会断，再启用，停掉另外一个测试。再复制一个窗口，一直ping自己的DNS，再用上面的命令看看是哪个网卡在工作</span></span><br><span class="line">[root@rhel7 ~]<span class="comment"># nmcli connection down team0-port1  </span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">服务器绑定双网卡，做负载</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="team" scheme="http://example.com/categories/Linux/team/"/>
    
    
    <category term="双网卡绑定" scheme="http://example.com/tags/%E5%8F%8C%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9A/"/>
    
    <category term="team" scheme="http://example.com/tags/team/"/>
    
  </entry>
  
  <entry>
    <title>mount镜像挂载</title>
    <link href="http://example.com/2024/01/12/mount%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F/"/>
    <id>http://example.com/2024/01/12/mount%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F/</id>
    <published>2024-01-12T01:25:00.000Z</published>
    <updated>2024-01-12T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mount小知识：挂载镜像"><a href="#mount小知识：挂载镜像" class="headerlink" title="mount小知识：挂载镜像"></a>mount小知识：挂载镜像</h1><h2 id="简单挂载"><a href="#简单挂载" class="headerlink" title="简单挂载"></a>简单挂载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看一下镜像有没有连接，这里是sr0</span></span><br><span class="line">[root@server2 ~]<span class="comment"># lsblk -l</span></span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda           8:0    0   20G  0 disk </span><br><span class="line">sda1          8:1    0    1G  0 part /boot</span><br><span class="line">sda2          8:2    0   19G  0 part </span><br><span class="line">centos-root 253:0    0   17G  0 lvm  /</span><br><span class="line">centos-swap 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sr0          11:0    1  988M  0 rom  </span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个挂载目录</span></span><br><span class="line">[root@server2 ~]<span class="comment"># mkdir /mnt/centos7.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将镜像文件挂载到目录里，-t指定一下文件系统</span></span><br><span class="line">[root@server2 ~]<span class="comment"># mount -t iso9660 /dev/sr0 /mnt/centos7.9</span></span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以将配置写进配置文件，开机自动挂载</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/sr0  /mnt/centos7.9  iso9660 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果开机有错误，将配置文件里自己添加的删除了就行</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">mount挂载本地镜像</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="mount" scheme="http://example.com/categories/Linux/mount/"/>
    
    
    <category term="挂载" scheme="http://example.com/tags/%E6%8C%82%E8%BD%BD/"/>
    
    <category term="mount" scheme="http://example.com/tags/mount/"/>
    
  </entry>
  
  <entry>
    <title>iops查看</title>
    <link href="http://example.com/2024/01/11/iops%E6%9F%A5%E7%9C%8B/"/>
    <id>http://example.com/2024/01/11/iops%E6%9F%A5%E7%9C%8B/</id>
    <published>2024-01-11T01:25:00.000Z</published>
    <updated>2024-01-11T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IOPS查看"><a href="#IOPS查看" class="headerlink" title="IOPS查看"></a>IOPS查看</h1><h3 id="iostat命令"><a href="#iostat命令" class="headerlink" title="iostat命令"></a>iostat命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#每隔5秒执行一次iostat，连续执行3次</span></span><br><span class="line">iostat -xmtc 5 3</span><br><span class="line">Linux 3.10.0-1160.92.1.el7.x86_64 (zhang)       10/17/2023      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">10/17/2023 08:19:03 PM</span><br><span class="line">avg-cpu:  %user   %<span class="built_in">nice</span> %system %iowait  %steal   %idle</span><br><span class="line">           0.62    0.00    0.24    0.05    0.00   99.09</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">vda               0.00     1.65    0.10    4.11     0.00     0.04    19.24     0.00    0.61    2.36    0.57   0.63   0.27</span><br><span class="line"></span><br><span class="line">– 设备（设备的名称）</span><br><span class="line">– rrqm/s（每秒钟进行的读操作的合并请求数）</span><br><span class="line">– wrqm/s（每秒钟进行的写操作的合并请求数）</span><br><span class="line">– r/s（每秒钟的读请求次数）</span><br><span class="line">– w/s（每秒钟的写请求次数）</span><br><span class="line">– rkB/s（每秒钟的读取数据量，单位KB）</span><br><span class="line">– wkB/s（每秒钟的写入数据量，单位KB）</span><br><span class="line">– avgrq-sz（每个请求的平均扇区数）</span><br><span class="line">– avgqu-sz（平均I / O请求数量）</span><br><span class="line">– awt（平均处理时间）</span><br><span class="line">– svctm（平均服务时间）</span><br><span class="line">– %util（每秒已使用磁盘时间的百分比）</span><br></pre></td></tr></table></figure><h3 id="dstat命令"><a href="#dstat命令" class="headerlink" title="dstat命令"></a>dstat命令</h3><p>dstat是一个系统资源统计工具，它能轻松监视系统的IOPS。它还可以报告CPU使用率、内存和磁盘使用率等更多指标。想要使用dstat，请使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@zhang ~]<span class="comment"># dstat -cdD total --disk-util --disk-tps --top-io-adv</span></span><br><span class="line">Module dstat_disk_util failed to load. (No counter objects to monitor)</span><br><span class="line">----total-cpu-usage---- -dsk/total- -dsk/total- -------most-expensive-i/o-process-------</span><br><span class="line">usr sys idl wai hiq siq| <span class="built_in">read</span>  writ|reads writs|process              pid  <span class="built_in">read</span> write cpu</span><br><span class="line">  1   0  99   0   0   0|2341B   38k|   0     4 |php-fpm: master proce31398  69k 199B0.0%</span><br><span class="line">  1   1  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0    12k|   0     3 |postgres: zabbix zabb18747   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    32k|   0     4 |postgres: zabbix zabb18736   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0    12k|   0     3 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    24k|   0     4 |postgres: zabbix zabb18735   0   16k  0%</span><br><span class="line">  1   1  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18736   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    16k|   0     3 |postgres: zabbix zabb18747   0 8192B  0%</span><br><span class="line">  1   0  98   0   0   0|   0    56k|   0     4 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   1  98   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18735   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18671   0 8192B  0%</span><br><span class="line">  2   1  98   0   0   0|   0   396k|   0     7 |postmaster           1314  550k   0   0%</span><br><span class="line">  1   1  99   0   0   0|   0    76k|   0    15 |node                 4925   11k  24k1.0%</span><br><span class="line">  2   0  98   0   0   0|   0    84k|   0     2 |zabbix_agentd: collec130521258B   0   0%</span><br><span class="line"> 15   2  82   2   0   0|7280k  144k| 223     8 |containerd-shim-runc-4875  105k  47k  0%^C</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">查看磁盘的性能的一些命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="iops" scheme="http://example.com/categories/Linux/iops/"/>
    
    
    <category term="磁盘读写" scheme="http://example.com/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99/"/>
    
    <category term="iops" scheme="http://example.com/tags/iops/"/>
    
  </entry>
  
</feed>
