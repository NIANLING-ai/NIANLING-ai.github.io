<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>清风</title>
  
  <subtitle>虽不能至，心向往之</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-11-20T01:25:00.000Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>ZHANG</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nginx全详解</title>
    <link href="http://example.com/2024/10/31/Nginx%E5%85%A8%E8%AF%A6%E8%A7%A3/"/>
    <id>http://example.com/2024/10/31/Nginx%E5%85%A8%E8%AF%A6%E8%A7%A3/</id>
    <published>2024-10-31T01:25:00.000Z</published>
    <updated>2024-11-20T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-介绍"><a href="#Nginx-介绍" class="headerlink" title="Nginx 介绍"></a>Nginx 介绍</h2><p>Nginx 是免费的、开源的、高性能的 HTTP 和反向代理服务器、邮件代理服务器、以及 TCP&#x2F;UDP 代理服务器，最开始是为了解决 C10K问题的。<br>Nginx 官 ⽹：<a href="https://nginx.org/">https://nginx.org</a></p><h3 id="Nginx-功能介绍"><a href="#Nginx-功能介绍" class="headerlink" title="Nginx 功能介绍"></a>Nginx 功能介绍</h3><ul><li>静态的 web 资源服务器 html，图片，js，css，txt 等静态资源</li><li>结合 FastCGI&#x2F;uWSGI&#x2F;SCGI 等协议反向代理动态资源请求</li><li>http&#x2F;https 协议的反向代理</li><li>imap4&#x2F;pop3 协议的反向代理</li><li>tcp&#x2F;udp 协议的请求转发（反向代理）</li></ul><h3 id="基础特性"><a href="#基础特性" class="headerlink" title="基础特性"></a>基础特性</h3><ul><li><strong>模块化设计、较好的扩展性；</strong></li><li><strong>高可靠性</strong><blockquote><p>其高可靠性依赖于主控进程与工作进程或工作线程的架构来实现的。Nginx 的组成部分实际上是由一个主控进程 master 加多个子进程 worker 共同组成的，它有一个 <strong>主控进程 master</strong>，主控进程并不负责接收并响应任何用户请求，主控进程负责生成多个 <strong>工作进程</strong> worker。</p></blockquote></li><li><strong>低内存消耗</strong><br> 由于 Nginx 是使用一个内存响应 n 个请求的，所以它对内存的消耗非常低，<strong>1w 个保持连接 keep-alive 状态或模式下的 connection，Nginx 只需要消耗 2.5M 内存来维护</strong>；<br> -   <strong>支持热部署</strong></li></ul><h2 id="Nginx-架构和进程"><a href="#Nginx-架构和进程" class="headerlink" title="Nginx 架构和进程"></a>Nginx 架构和进程</h2><h3 id="Nginx-架构"><a href="#Nginx-架构" class="headerlink" title="Nginx 架构"></a>Nginx 架构</h3><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20241030222410.png" style="zoom:80%;" /><h3 id="Nginx-进程结构"><a href="#Nginx-进程结构" class="headerlink" title="Nginx 进程结构"></a>Nginx 进程结构</h3><ul><li><p><span style="color:#FF0000;"> <strong>web 请求处理机制</strong> </span></p><ul><li><strong>多进程方式:</strong> 服务器每接收到一个客户端请求就有服务器的主进程生成一个子进程响应客户端，直到用户关闭连接，这样的优势是处理速度快。子进程之间相互独立，但是如果访问过大会导致服务器资源耗尽而无法提供请求。</li><li><strong>多线程方式:</strong> 与多进程方式类似，但是每收到一个客户端请求会有服务进程派生出一个线程来个客户方进行交互，一个线程的开销远远小于一个进程，因此多线程方式在很大程度减轻了 web 服务器对系统资源的要求，但是多线程也有自己的缺点。即当多个线程位于同一个进程内工作的时候，可以相互访问同样的内存地址空间，所以他们相互影响，一旦主进程挂掉则所有子线程都不能工作了，IIS 服务器使用了多线程的方式，需要间隔一段时间就重启一次才能稳定。</li></ul></li><li><p>Nginx <strong>是多进程组织模型</strong>，而且是一个 <strong>由 Master 主进程和 Worker 工作进程</strong> 组成。但是其实 <strong>Nginx 里也有线程</strong>。<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20241030220827.png"></p></li><li><p><strong>主进程(master process)的功能:</strong></p><ul><li>对外接口: 接收外部的操作(信号)</li><li>对内转发: 根据外部的操作的不同，通过信号管理 worker</li><li>监控: 监控 worker 进程的运行状态，worker 进程异常终止后，自动重启 worker 进程</li><li>读取 Nginx 配置文件并验证其有效性和正确性</li><li>建立、绑定和关闭 socket 连接</li><li>按照配置生成、管理和结束工作进程</li><li>接受外界指令，比如重启、升级及退出服务器等指令</li><li>不中断服务，实现平滑升级，重启服务并应用新的配置</li><li>开启日志文件，获取文件描述符</li><li>不中断服务，实现平滑升级，升级失败进行回滚处理</li><li>编译和处理 perl 脚本</li></ul></li><li><p><strong>工作进程(worker process)的功能:</strong></p><ul><li>所有 Worker 进程都是平等的</li><li>实际处理: 网络请求，由 Worker 进程处理</li><li>Worker 进程数量: 在 nginx.conf 中配置，一般设置为核心数，充分利用 CPU 资源，同时，避免进程数量过多，避免进程竞争 CPU 资源，增加上下文切换的损耗</li><li>接受处理客户的请求</li><li>将请求依次送入各个功能模块进行处理</li><li>I&#x2F;O 调用，获取响应数据</li><li>与后端服务器通信，接收后端服务器的处理结果</li><li>缓存数据，访问缓存索引，查询和调用缓存数据</li><li>发送请求结果，响应客户的请求</li><li>接收主程序指令，比如重启、升级和退出等</li></ul></li></ul><img data-src="https://cdn.img2ipfs.com/ipfs/QmXFdxKLwkgZBzoQwh5gs7eAUywj7R5iT16CdoK7WCUyyi?filename=image.png" style="zoom:80%;" /><img data-src="https://cdn.img2ipfs.com/ipfs/QmVmqy4qyiGy4CSrsbZLmkE8ZiJYKTQCw2tS31sSKDM9kL?filename=image.png" style="zoom: 80%;" /><h3 id="Nginx-进程间通信"><a href="#Nginx-进程间通信" class="headerlink" title="Nginx 进程间通信"></a>Nginx 进程间通信</h3><p>​⼯ 作进程是有主进程 ⽣ 成的，主进程由 root 启用，<strong>主进程使 ⽤ <code>fork()函数</code><strong>，在 Nginx 服务器启动过程中主进程 <strong>根据配置 ⽂ 件决定</strong> 启动 ⼯ 作进程的数量，然后建 ⽴⼀ 张全局的 ⼯ 作表 ⽤ 于存放当前未退出的所有的 ⼯ 作进程，主进程 ⽣ 成 ⼯ 作进程后会将新 ⽣ 成的 ⼯ 作进程加 ⼊ 到 ⼯ 作进程表中，并建 ⽴⼀ 个单向的管道并将其传递给 ⼯ 作进程，该管道与普通的管道不同，它是 <strong>由主进程指向 ⼯ 作进程的单向通道</strong>，包含了主进程向 ⼯ 作进程发出的指令、⼯ 作进程 ID、⼯ 作进程在 ⼯ 作进程表中的索引和必要的 ⽂ 件描述符等信息，</strong>单向管道</strong>，工作进程只能监听内容之后读取指令。 主进程与外界通过信号机制进 ⾏ 通信，当接收到需要处理的信号时，它通过管道向相关的 ⼯ 作进程发送正确的指令，每个 ⼯ 作进程都有能 ⼒ 捕获管道中的可读事件，当管道中有可读事件的时候，⼯ 作进程就会从管道中读取并解析指令，然后采取相应的执 ⾏ 动作，这样就完成了主进程与 ⼯ 作进程的交互。</p><p>​⼯ 作进程之间的通信原理基本上和主进程与 ⼯ 作进程之间的通信是 ⼀ 样的，只要 ⼯ 作进程之间能够取得彼此的信息，建 ⽴ 管道即可通信，但是由于 ⼯ 作进程之间是完全隔离的，因此 <strong>⼀ 个进程想要知道另外 ⼀ 个进程的状态信息就只能通过主进程来设置了</strong>。</p><p>​为了实现 ⼯ 作进程之间的交互，主进程在 ⽣ 成 ⼯ 作进程之后，在 ⼯ 作进程表中进 ⾏ 遍历，<strong>将该新进程的 ID 以及针对该进程建 ⽴ 的管道句柄传递给 ⼯ 作进程中的其他进程</strong>，为 ⼯ 作进程之间的通信做准备，当 ⼯ 作进程 1 向 ⼯ 作进程 2 发送指令的时候，⾸ 先在主进程给它的其他 ⼯ 作进程 ⼯ 作信息中找到 2 的进程 ID，然后将正确的指令写 ⼊ 指向进程 2 的管道，⼯ 作进程 2 捕获到管道中的事件后，解析指令并进 ⾏ 相关操作，这样就完成了 ⼯ 作进程之间的通信。<br><img data-src="https://cdn.img2ipfs.com/ipfs/QmRSEjnH1eFecgpbja9Vwqq5Wz1XE2ndjwbvKjMKkrJDae?filename=image.png"></p><p>既然是单向管道通信，那么主进程怎么知道自己的子进程是不是工作结束，需要的文件是否就绪？那就是可以通过多路复用机制去监视</p><h3 id="IO-多路复用机制"><a href="#IO-多路复用机制" class="headerlink" title="IO 多路复用机制"></a>IO 多路复用机制</h3><p><strong>利用 IO 多路复用机制，一个进程可以监视多个描述符</strong>，一旦某个描述符就绪（一般是读就绪或者写就绪），能够通知程序进行相应的读写操作</p><h2 id="Nginx-安装"><a href="#Nginx-安装" class="headerlink" title="Nginx 安装"></a>Nginx 安装</h2><p>Nginx 版本分为 Mainline version(主要开发版本)、Stable version(当前最新稳定版)和 Legacy<br>versions(旧的稳定版)<br><a href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a></p><h3 id="基于-yum-安装-nginx"><a href="#基于-yum-安装-nginx" class="headerlink" title="基于 yum 安装 nginx"></a>基于 yum 安装 nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看系统和EPEL的nginx版本</span></span><br><span class="line">[root@server1 ~]# yum info nginx</span><br><span class="line">[root@server1 ~]# yum install -y epel-release</span><br><span class="line">[root@server1 ~]# yum -y install nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过 rpm -ql nginx 命令查看nginx安装目录</span></span><br><span class="line">[root@server1 ~]# rpm -ql nginx</span><br><span class="line">[root@server1 ~]# systemctl start nginx</span><br><span class="line">[root@server1 ~]# systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="官方包源码安装-nginx"><a href="#官方包源码安装-nginx" class="headerlink" title="官方包源码安装 nginx"></a>官方包源码安装 nginx</h3><h4 id="tar-解压命令"><a href="#tar-解压命令" class="headerlink" title="tar 解压命令"></a>tar 解压命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tar</span><br><span class="line">格式： tar [选项] [文件目录列表]</span><br><span class="line">功能： 对文件目录进行打包备份</span><br><span class="line">选项：</span><br><span class="line">-c 建立新的归档文件</span><br><span class="line">-r 向归档文件末尾追加文件</span><br><span class="line">-x 从归档文件中解出文件</span><br><span class="line">-O 将文件解开到标准输出</span><br><span class="line">-v 处理过程中输出相关信息</span><br><span class="line">-f 对普通文件操作</span><br><span class="line">-z 调用gzip来压缩归档文件，与-x联用时调用gzip完成解压缩</span><br><span class="line">-Z 调用compress来压缩归档文件，与-x联用时调用compress完成解压缩</span><br></pre></td></tr></table></figure><p>源码安装需要提前准备标准的编译器，GCC 的全称是(GNU Compiler collection)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以1.24版本为例，其余版本同理，先下载源码</span></span><br><span class="line">[root@server1 ~]# wget https://nginx.org/download/nginx-1.24.0.tar.gz -P /usr/local/src/</span><br><span class="line">[root@server1 ~]# cd /usr/local/src/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压一下</span></span><br><span class="line">[root@server1 src]# tar xzvf nginx-1.24.0.tar.gz</span><br><span class="line">[root@server1 src]# cd nginx-1.24.0</span><br><span class="line"></span><br><span class="line">[root@server1 nginx-1.24.0]# ./configure --help</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以查看到编译的一些参数配置的帮助</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装编译器</span></span><br><span class="line">[root@server1 nginx-1.24.0]# yum -y install gcc pcre-devel openssl-devel zlib-devel</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个系统不登陆的nginx用户，-r指系统用户，-s指定shell</span></span><br><span class="line">[root@server1 nginx-1.24.0]# useradd -r -s /sbin/nologin nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编译检查，将之保存到/apps/nginx，并指定要添加的模块</span></span><br><span class="line">[root@server1 nginx-1.24.0]# ./configure --prefix=/apps/nginx \</span><br><span class="line"> --user=nginx \</span><br><span class="line"> --group=nginx \</span><br><span class="line"> --with-http_ssl_module \</span><br><span class="line"> --with-http_v2_module \</span><br><span class="line"> --with-http_realip_module \</span><br><span class="line"> --with-http_stub_status_module \</span><br><span class="line"> --with-http_gzip_static_module \</span><br><span class="line"> --with-pcre \</span><br><span class="line"> --with-stream \</span><br><span class="line"> --with-stream_ssl_module \</span><br><span class="line"> --with-stream_realip_module</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">make编译操作，-j指定几个核去编译，根据自己的配置定</span></span><br><span class="line">[root@server1 nginx-1.24.0]# make -j 4 &amp;&amp; make install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改属主与属组为nginx,-R为递归</span></span><br><span class="line">[root@server1 nginx-1.24.0]# cd /apps/nginx</span><br><span class="line">[root@server1 nginx]# chown -R nginx.nginx /apps/nginx</span><br><span class="line">[root@server1 nginx]# ll</span><br><span class="line">总用量 4</span><br><span class="line">drwxr-xr-x. 2 nginx nginx 4096 1月  31 21:28 conf</span><br><span class="line">drwxr-xr-x. 2 nginx nginx   40 1月  31 21:28 html</span><br><span class="line">drwxr-xr-x. 2 nginx nginx    6 1月  31 21:28 logs</span><br><span class="line">drwxr-xr-x. 2 nginx nginx   19 1月  31 21:28 sbin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查一下nginx在不在环境变量里面，发现不在</span></span><br><span class="line">[root@server1 nginx]# which nginx</span><br><span class="line">/usr/bin/which: no nginx in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将nginx创建一个软链接到环境变量里，不创建只能在/sbin目录下使用./nginx登录</span></span><br><span class="line">[root@server1 nginx]# ln -s /apps/nginx/sbin/nginx /usr/bin/nginx</span><br><span class="line">[root@server1 nginx]# nginx    #这样无论在哪里都可以使用nginx命令</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.img2ipfs.com/ipfs/QmbfyLp46DqfLEbb2jheNvnnSpRCv9htFj161KQd7Z8DqG?filename=image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop #关闭nginx</span><br></pre></td></tr></table></figure><h3 id="四个主要的目录"><a href="#四个主要的目录" class="headerlink" title="四个主要的目录"></a>四个主要的目录</h3><ul><li>**1.conf:**保存nginx所有的配置文件，其中nginx.conf是nginx服务器的最核心最主要的配置文件，其他的.conf则是用来配置nginx相关的功能的，例如fastcgi功能使用的是fastcgi.conf和fastcgi.params两个文件，配置文件一般都有个样板配置文件，是文件名. default结尾，使用的时候将其复制并将default去掉即可。</li><li>**2.html:**目录中保存了nginx服务器的web文件，但是可以更改为其他目录保存web文件，另外还有一个50x的web文件是默认的错误页面提示页面。</li><li>**3.logs:**用来保存ngi nx服务器的访问日志错误日志等日志，logs目录可以放在其他路径，比如&#x2F;var&#x2F;logs&#x2F;nginx里面。</li><li>**4.sbin:**保存nginx二进制启动脚本，可以接受不同的参数以实现不同的功能。</li></ul><h3 id="创建-nginx-自启动文件"><a href="#创建-nginx-自启动文件" class="headerlink" title="创建 nginx 自启动文件"></a>创建 nginx 自启动文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑配置文件</span></span><br><span class="line">[root@server1 ~]# vim /usr/lib/systemd/system/nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=The nginx HTTP and reverse proxy server</span><br><span class="line">Documentation=http://nginx.org/en/docs/</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pid文件，系统放在logs/目录下面，我们可自定义</span></span><br><span class="line">PIDFile=/apps/nginx/run/nginx.pid  </span><br><span class="line">ExecStart=/apps/nginx/sbin/nginx -c /apps/nginx/conf/nginx.conf  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据后面的配置文件指定开启命令</span></span><br><span class="line"></span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID #重载进程</span><br><span class="line">ExecStop=/bin/kill -s TERM $MAINPID #终止进程</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">------------------------------------------------------</span><br><span class="line">[root@server1 ~]# mkdir -p /apps/nginx/run/  #创建一个run目录</span><br><span class="line">[root@server1 ~]# vim /apps/nginx/conf/nginx.conf  #修改配置文件里pid的位置</span><br><span class="line">pid        /apps/nginx/run/nginx.pid;  #最好写个绝对路径</span><br><span class="line"></span><br><span class="line">[root@server1 nginx]# ps -aux|grep nginx  #杀死这个进程，80端口就没了，不然可能关闭时报错</span><br><span class="line">root      19375  0.0  0.0  46208  1156 ?        Ss   21:36   0:00 nginx: master process nginx</span><br><span class="line">[root@server1 nginx]# kill 19375</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>注意点：</strong><br><strong>用 systemctl 管理和 nginx自身命令管理不可混用，混用不生效</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br><span class="line">systemctl stop nginx</span><br></pre></td></tr></table></figure><h3 id="验证-Nginx-自启动文件"><a href="#验证-Nginx-自启动文件" class="headerlink" title="验证 Nginx 自启动文件"></a>验证 Nginx 自启动文件</h3><p>补充：&#x2F;etc&#x2F;rc.local 文件，添加开机自启命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# systemctl daemon-reload</span><br><span class="line">[root@server1 ~]# systemctl enable --now nginx</span><br></pre></td></tr></table></figure><h4 id="附件：shell一键安装脚本"><a href="#附件：shell一键安装脚本" class="headerlink" title="附件：shell一键安装脚本"></a>附件：shell一键安装脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置Nginx版本和安装目录</span></span><br><span class="line">NGINX_VERSION=<span class="string">&quot;1.24.0&quot;</span></span><br><span class="line">INSTALL_DIR=<span class="string">&quot;/opt/app/nginx-<span class="variable">$NGINX_VERSION</span>/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析OS ID</span></span><br><span class="line">OS_ID=$(awk -F= <span class="string">&#x27;/^ID=/&#123;gsub(&quot;\&quot;&quot;, &quot;&quot;, $2); print tolower($2)&#125;&#x27;</span> /etc/os-release)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测并创建文件夹</span></span><br><span class="line"><span class="function"><span class="title">check_and_create_directory</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建文件夹 <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;文件夹 <span class="variable">$1</span> 已存在&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命令是否存在的函数</span></span><br><span class="line"><span class="function"><span class="title">command_exists</span></span>() &#123;</span><br><span class="line">    [ -x <span class="string">&quot;<span class="subst">$(command -v <span class="string">&quot;<span class="variable">$1</span>&quot;</span>)</span>&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装必要的软件</span></span><br><span class="line"><span class="function"><span class="title">install_dependencies</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;centos&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;rocky&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;rhel&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        command_exists wget || yum -y install wget</span><br><span class="line">        command_exists tar || yum -y install tar</span><br><span class="line">        yum install -y gcc pcre-devel openssl-devel zlib-devel make</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;ubuntu&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;debian&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        command_exists wget || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install wget &amp;&gt; /dev/null)</span><br><span class="line">        command_exists tar || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install tar &amp;&gt; /dev/null)</span><br><span class="line">        apt-get install -y gcc libpcre3 libpcre3-dev zlib1g-dev libssl-dev make</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;不支持的操作系统: <span class="variable">$OS_ID</span>&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查解析的 OS_ID</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;解析的操作系统 ID 是: <span class="variable">$OS_ID</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Nginx用户</span></span><br><span class="line"><span class="function"><span class="title">create_nginx_user</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span> -u nginx &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx用户已经存在.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建Nginx用户...&quot;</span></span><br><span class="line">        useradd -r -s /sbin/nologin nginx</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建Nginx用户成功.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载并编译安装Nginx</span></span><br><span class="line"><span class="function"><span class="title">compile_nginx</span></span>() &#123;</span><br><span class="line">    check_and_create_directory <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>&quot;</span></span><br><span class="line">    check_and_create_directory <span class="string">&quot;/opt/src&quot;</span></span><br><span class="line">    wget http://nginx.org/download/nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz -P /opt/src</span><br><span class="line">    <span class="built_in">cd</span> /opt/src</span><br><span class="line">    tar -zxvf nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz</span><br><span class="line">    <span class="built_in">cd</span> nginx-<span class="variable">$NGINX_VERSION</span></span><br><span class="line">    </span><br><span class="line">    ./configure --prefix=<span class="variable">$INSTALL_DIR</span> \</span><br><span class="line">                --user=nginx \</span><br><span class="line">                --group=nginx \</span><br><span class="line">                --with-http_ssl_module \</span><br><span class="line">                --with-http_v2_module \</span><br><span class="line">                --with-http_realip_module \</span><br><span class="line">                --with-http_stub_status_module \</span><br><span class="line">                --with-http_gzip_static_module \</span><br><span class="line">                --with-pcre \</span><br><span class="line">                --with-stream \</span><br><span class="line">                --with-stream_ssl_module \</span><br><span class="line">                --with-stream_realip_module</span><br><span class="line"></span><br><span class="line">    make</span><br><span class="line">    make install</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清理安装过程中的临时文件</span></span><br><span class="line">    <span class="built_in">cd</span> ..</span><br><span class="line">    <span class="built_in">rm</span> -rf nginx-<span class="variable">$NGINX_VERSION</span></span><br><span class="line">    <span class="built_in">rm</span> nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz</span><br><span class="line"></span><br><span class="line">    <span class="built_in">chown</span> -R nginx:nginx <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Nginx服务启动脚本</span></span><br><span class="line"><span class="function"><span class="title">create_systemd_service</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/systemd/system/nginx.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Nginx HTTP Server</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">ExecStart=$INSTALL_DIR/sbin/nginx</span></span><br><span class="line"><span class="string">ExecReload=$INSTALL_DIR/sbin/nginx -s reload</span></span><br><span class="line"><span class="string">ExecStop=$INSTALL_DIR/sbin/nginx -s stop</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$INSTALL_DIR</span>/sbin/nginx /usr/bin/nginx</span><br><span class="line"></span><br><span class="line">    systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">    systemctl start nginx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证Nginx安装</span></span><br><span class="line"><span class="function"><span class="title">verify_nginx_install</span></span>() &#123;</span><br><span class="line">    nginx -v</span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$INSTALL_DIR</span> /opt/app/nginx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里定义脚本的 main 函数</span></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment"># 临时输出系统路径信息用于调试</span></span><br><span class="line">    <span class="comment">#echo &quot;System PATH: $PATH&quot;</span></span><br><span class="line">    <span class="comment">#which nginx</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改检查逻辑以更可靠地识别 nginx 是否存在</span></span><br><span class="line">    <span class="keyword">if</span> command_exists nginx; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx已经安装，跳过安装步骤&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx未安装，继续安装步骤&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    install_dependencies</span><br><span class="line">    create_nginx_user</span><br><span class="line">    compile_nginx</span><br><span class="line">    create_systemd_service</span><br><span class="line">    verify_nginx_install</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><h2 id="Nginx核心配置详解"><a href="#Nginx核心配置详解" class="headerlink" title="Nginx核心配置详解"></a>Nginx核心配置详解</h2><ul><li>nginx官方帮助文档<br><a href="https://nginx.org/en/docs/">https://nginx.org/en/docs/</a></li><li>tengine帮助文档<br><a href="https://tengine.taobao.org/documentation_cn.html">文档 - The Tengine Web Server</a></li></ul><h3 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h3><ul><li><p><strong>Nginx的配置文件的组成部分</strong></p><ul><li><strong>主配置文件：</strong><code>nginx.conf</code></li><li><strong>子配置文件：</strong><code>include conf.d/*.conf</code></li><li>**<code>fastcgi, uwsgi, scgi</code>**等协议相关的配置文件</li><li><strong><code>mime.types</code>：</strong>支持的<code>mime</code>类型，<code>MIME(Multipurpose Internet Mail Extensions)</code>多用途互联网邮件扩展类型，MIME消息能包含文本、图像、音频、视频以及其他应用程序专用的数据，是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。<blockquote><p>MIME参考文档:<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types</a></p></blockquote></li></ul></li><li><p>Nginx主配置文件的配置指令方式</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">directive value [value2 ...];</span><br><span class="line">注意</span><br><span class="line">(1) 指令必须以分号结尾</span><br><span class="line">(2) 支持使用配置变量</span><br><span class="line">    内建变量：由Nginx模块引入，可直接应用</span><br><span class="line">    自定义变量：由用户使用<span class="built_in">set</span>命令定义，格式：<span class="built_in">set</span> variable_name value;</span><br><span class="line">    引用变量：<span class="variable">$variable_name</span></span><br></pre></td></tr></table></figure><h4 id="主配置文件结构：四部分"><a href="#主配置文件结构：四部分" class="headerlink" title="主配置文件结构：四部分"></a>主配置文件结构：四部分</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">main block：主配置段，既全局配置段，对http,mail都有效</span><br><span class="line"></span><br><span class="line"><span class="comment"># 事件驱动相关的配置</span></span><br><span class="line">event &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># http/https协议相关配置段</span></span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认配置文件不包括下面两个块</span></span><br><span class="line"><span class="comment"># mail协议相关配置段</span></span><br><span class="line">mail &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># stream服务器相关配置段</span></span><br><span class="line">stream &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 导入其他路径的配置文件</span></span><br><span class="line">include /apps/nginx/conf.d/*.conf</span><br></pre></td></tr></table></figure><h4 id="默认的nginx-conf配置文件格式说明"><a href="#默认的nginx-conf配置文件格式说明" class="headerlink" title="默认的nginx.conf配置文件格式说明"></a>默认的nginx.conf配置文件格式说明</h4><p><img data-src="https://cdn.img2ipfs.com/ipfs/QmcpziRFx1bkBnA4TqMfR6BJ2b4LxFt8y6k4oLUx2ZK2gy?filename=image.png"><br><img data-src="https://cdn.img2ipfs.com/ipfs/QmaEiJ3uzaXkVDST4Z8oqywSp9N969ieK8W1gNPJr55AoQ?filename=image.png"></p><h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h3><p><strong>Main全局配置段常见的配置指令分类</strong></p><ul><li>正常运行必备的配置</li><li>优化性能相关的配置</li><li>用于调试及定位问题相关的配置</li><li>时间驱动相关的配置</li></ul><h4 id="CPU性能优化"><a href="#CPU性能优化" class="headerlink" title="CPU性能优化"></a>CPU性能优化</h4><ul><li>在配置文件里面修改</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">user nginx nginx; <span class="comment">#启动Nginx工作进程的用户和组</span></span><br><span class="line">worker_processes 4    <span class="comment">#启动Nginx工作进程的数量，一般设为和CPU核心数相同</span></span><br><span class="line"></span><br><span class="line">worker_cpu_affinity 1000 0100 0010 0001; </span><br><span class="line"><span class="comment">#将Nginx工作进程绑定到指定的CPU核心，默认Nginx是不进行进程绑定的，绑定并不是意味着当前nginx进程独占一核心CPU，但是可以保障此进程不会运行在其他核心上，这就极大减少了nginx的工作进程在不同的cpu核心上的来回跳转，减少了cpu对进程的资源分配与回收以及内存管理等，因此可以有效的提升nginx服务器的性能。有两核的话就写10 01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看nginx进程对应的CPU</span></span><br><span class="line">6834 nginx: master process /apps 2</span><br><span class="line">47621 nginx: worker process 0</span><br><span class="line">47622 nginx: worker process 1</span><br><span class="line">47623 nginx: worker process 2</span><br><span class="line">47624 nginx: worker process 3</span><br><span class="line">[root@server1 ~]<span class="comment"># yum install httpd-tools -y</span></span><br><span class="line">[root@server1 ~]<span class="comment"># while true;do ab -c 1000 -n 2000 http://127.0.0.1/;done    </span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># watch -n.5 &#x27;ps axo pid,cmd,psr |grep nginx&#x27;  #上面压力测试，这里观察一下会不会跳动</span></span><br></pre></td></tr></table></figure><h4 id="错误日志记录配置"><a href="#错误日志记录配置" class="headerlink" title="错误日志记录配置"></a>错误日志记录配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误日志记录配置，一共七个等级，可以设置</span></span><br><span class="line">语法：error_log file [debug | info | notice | warn | error | crit | alert |emerg]</span><br><span class="line"></span><br><span class="line"><span class="comment"># error_log logs/error.log;</span></span><br><span class="line"><span class="comment"># error_log logs/error.log notice;</span></span><br><span class="line">[root@server1 conf]<span class="comment"># vim /apps/nginx/conf/nginx.conf</span></span><br><span class="line">error_log /apps/nginx/logs/error.log error;</span><br></pre></td></tr></table></figure><h4 id="工作优先级与文件并发数"><a href="#工作优先级与文件并发数" class="headerlink" title="工作优先级与文件并发数"></a>工作优先级与文件并发数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 conf]<span class="comment"># vim /apps/nginx/conf/nginx.conf</span></span><br><span class="line">worker_priority 0; <span class="comment">#工作进程优先级(-20~19)</span></span><br><span class="line">worker_rlimit_nofile 65536; <span class="comment">#所有worker进程能打开的文件数量上限，包括：Nginx的所有连接(例如与代理服务器的连接等)，而不仅仅是与客户端的连接，另一个考虑因素是实际的并发连接数不能超过系统级别的最大打开文件数的限制，最好与ulimit -n的值保持一致</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># ulimit -n 102400   #这是系统能限制的最多的</span></span><br><span class="line">[root@server1 ~]<span class="comment"># vim /etc/security/limits.conf</span></span><br><span class="line">* soft nofile 102400</span><br><span class="line">* hard nofile 102400</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看优先级</span></span><br><span class="line">[root@server1 ~]<span class="comment"># watch -n.5 &#x27;ps axo pid,cmd,psr,nice |grep nginx&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="其他优化配置"><a href="#其他优化配置" class="headerlink" title="其他优化配置"></a>其他优化配置</h4><ul><li>也是在全局配置里，根据自己的需求开启或者关闭</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">daemon off;  <span class="comment">#前台运行nginx服务，用于测试、docker等环境</span></span><br><span class="line">master_process off|on; <span class="comment"># 是否开启Nginx的master-worker工作模式，仅用于开发调试场景，默认为on</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">worker_connections 65536;  <span class="comment">#设置单个工作进程的最大并发连接数</span></span><br><span class="line">use epoll; <span class="comment"># 使用epoll事件驱动，Nginx支持众多的事件驱动，比如：select、poll、epoll,只能设置在events模块中</span></span><br><span class="line">accept_mutex on;  <span class="comment">#on为同一时刻一个请求轮流由work进程处理，而防止被同时唤醒所有worker，避免多个睡眠进程被唤醒的设置，默认为off,新请求会唤醒所有worker进程，此过程也被称为&quot;惊群&quot;,因此nginx刚安装完以后要进行适当的优化，建议设置为on</span></span><br><span class="line">multi_accept on; <span class="comment"># on时Nginx服务器的每个工作进程可以同时接受多个新的网络连接，此指令默认为off，即默认为一个工作进程只能一次接受一个新的网络连接，打开后几个同时接受多个，建议设置为on</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="http配置块"><a href="#http配置块" class="headerlink" title="http配置块"></a>http配置块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">... <span class="comment">#各server的公共配置</span></span><br><span class="line">server &#123; <span class="comment"># 每个server用于定义一个虚拟主机，第一个server为默认虚拟服务器</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">...</span><br><span class="line">server_name <span class="comment"># 虚拟主机名</span></span><br><span class="line">root <span class="comment"># 主目录</span></span><br><span class="line"><span class="built_in">alias</span> <span class="comment"># 路径别名</span></span><br><span class="line">location [OPERATOR] URL &#123; <span class="comment"># 指定URL的特性</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> CONDOTION &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>http块配置说明</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">include mime.types; <span class="comment"># 导入支持的文件类型，是相对于/apps/nginx/conf的目录default_type application/octet-stream; # 除mime.types中文件类型外，设置其他文件默认类型，访问其他类型时会提示下载不匹配的类型文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志配置部分</span></span><br><span class="line"><span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义优化参数</span></span><br><span class="line">sendfile on;   <span class="comment">#允许sendfile方式传输文件 ，sendfile系统调用在两个文件描述符之间直接传递数据(完全在内核中操作)，从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝，操作效率很高，被称之为零拷贝。# 允许sendfile方式传输文件 ，sendfile系统调用在两个文件描述符之间直接传递数据(完全在内核中操作)，从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝，操作效率很高，被称之为零拷贝。</span></span><br><span class="line"></span><br><span class="line">tcp_nopush on;   <span class="comment">#在开启了sendfile的情况下，合并请求后统一发送给客户端</span></span><br><span class="line">tcp_nodelay off;   <span class="comment">#在开启了keeplived模式下的连接是否启用TCP_NODELAY选项，当为off时，延迟0.2s发送，默认on时，不延迟</span></span><br><span class="line">keepalive_timeout 0;</span><br><span class="line">keepalive_timeout 65 65;   <span class="comment">#设置会话保持时间，第二个值为响应首部:keepalived:timeout=65,可以和第一个值不同</span></span><br><span class="line">gzip on;  <span class="comment">#开启文件压缩</span></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;<span class="comment"># 设置监听端口</span></span><br><span class="line">server_name server1;   <span class="comment">#设置server name,可以空格隔开写多个，并支持正则表达式，如：*.iproute.cn（泛域名）</span></span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="指定响应报文server首部"><a href="#指定响应报文server首部" class="headerlink" title="指定响应报文server首部"></a>指定响应报文server首部</h3><ul><li>正常我们访问本机的报文如下，是会出现状态码和Nginx版本，可以不让Nginx版本出现，更加安全</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># curl -I 127.0.0.1</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.26.0</span><br><span class="line">Date: Mon, 18 Nov 2024 12:25:53 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 615</span><br><span class="line">Last-Modified: Tue, 20 Aug 2024 14:47:38 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: <span class="string">&quot;66c4ac8a-267&quot;</span></span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure><ul><li>范例：修改Server头部信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#是到放源码的那个目录里面去修改nginx.h文件</span></span><br><span class="line">[root@server1 ~]<span class="comment"># vim /usr/local/src/nginx-1.26.0/src/core/nginx.h</span></span><br><span class="line"><span class="comment"># define NGINX_VERSION &quot;1.68.9&quot;</span></span><br><span class="line"><span class="comment"># define NGINX_VER &quot;mynginx/&quot; NGINX_VERSION</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># vim /usr/local/src/nginx-</span></span><br><span class="line">1.18.0/src/http/ngx_http_header_filter_module.c</span><br><span class="line">static u_char ngx_http_server_string[] = <span class="string">&quot;Server: mynginx&quot;</span> CRLF;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改完成后重新编译</span></span><br><span class="line">[root@server1 ~]<span class="comment"># cd /usr/local/src/nginx-1.26.0</span></span><br><span class="line">[root@server1 nginx-1.18.0]<span class="comment"># ./configure --prefix=/opt/app/nginx \</span></span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-pcre \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_module \</span><br><span class="line">--with-stream_realip_module</span><br><span class="line">[root@server1 nginx-1.18.0]<span class="comment"># make -j 2 &amp;&amp; make install</span></span><br><span class="line">[root@server1 nginx-1.18.0]<span class="comment"># systemctl restart nginx</span></span><br><span class="line">[root@server1 nginx-1.18.0]<span class="comment"># curl -I 127.0.0.1</span></span><br></pre></td></tr></table></figure><h2 id="Nginx配置示例"><a href="#Nginx配置示例" class="headerlink" title="Nginx配置示例"></a>Nginx配置示例</h2><p>基于不同的IP、不同的端口以及不同域名实现不同的虚拟主机，依赖于核心模块ngx_http_core_module实现</p><h3 id="模拟PC站与手机站"><a href="#模拟PC站与手机站" class="headerlink" title="模拟PC站与手机站"></a>模拟PC站与手机站</h3><ul><li><p>虚拟主机，基于域名来区分</p></li><li><p>定义子配置文件路径，在主配置文件的http块中添加导入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mkdir -p /opt/app/nginx/conf.d</span><br><span class="line">[root@server1 ~]# cd /opt/app/nginx/conf.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.写pc的配置文件，注意空白字符</span></span><br><span class="line">[root@server1 conf.d]# vim pc.conf</span><br><span class="line">server &#123;</span><br><span class="line"> listen 80;</span><br><span class="line"> server_name www.pc.com;</span><br><span class="line"> location / &#123;</span><br><span class="line">   root /opt/app/nginx/html/pc;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@server1 conf.d]# mkdir -p /opt/app/nginx/html/pc #创建它所在的目录</span><br><span class="line">[root@server1 conf.d]# echo &quot;hello pc&quot; &gt; /opt/app/nginx/html/pc/index.html</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.写手机端配置文件</span></span><br><span class="line">[root@server1 conf.d]# vim mobile.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"> listen 80;</span><br><span class="line"> server_name www.mobile.com;</span><br><span class="line"> location / &#123;</span><br><span class="line">  root /opt/app/nginx/html/mobile;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@server1 conf.d]# mkdir -p /opt/app/nginx/html/mobile</span><br><span class="line">[root@server1 conf.d]# echo &quot;hello mobile&quot; &gt; /opt/app/nginx/html/mobile/index.html</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3.在主配置文件里导入子配置文件</span></span><br><span class="line">include /opt/app/nginx/conf.d/*.conf;                    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4.重新加载服务</span></span><br><span class="line">[root@server1 conf.d]# systemctl reload nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">5.可以在自己电脑上编辑host文件，然后访问不同的域名即可；注意selinux和防火墙</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20241118220318.png"></p></li></ul><h3 id="root与alias的用法"><a href="#root与alias的用法" class="headerlink" title="root与alias的用法"></a>root与alias的用法</h3><ul><li><strong>root：指定web的家目录，在定义location的时候，文件的绝对路径等于root+location</strong><br>范例：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 nginx]# cd conf.d/</span><br><span class="line">[root@server1 conf.d]# vim test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name b.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location /about &#123;</span><br><span class="line"> root /opt/app/nginx/html; #这样访问的就是/opt/app/nginx/html/about</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">root /opt/app/nginx/html/about;这样写其实访问的是/opt/app/nginx/html/下的about的about</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@server1 conf.d]# cd /opt/app/nginx/html/</span><br><span class="line">[root@server1 html]# mkdir -p WWW &amp;&amp; cd WWW</span><br><span class="line">[root@server1 WWW]# vim index.html</span><br><span class="line">hello WWW</span><br><span class="line"></span><br><span class="line">[root@server1 html]# mkdir -p about &amp;&amp; cd about</span><br><span class="line">[root@server1 about]# vim index.html</span><br><span class="line">hello about</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">接着设置一下host文件，电脑访问b.test.com，默认出现的是hello WWW，路径加上about，就会出现hello about</span></span><br></pre></td></tr></table></figure></li><li><strong>实验时的坑：写了配置文件以后，一直报错，排查后发现有隐藏乱码（如果有时候表面没错，但是一直报错可以检查一下，特别是复制粘贴的时候）：</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 nginx]# nginx -t</span><br><span class="line">nginx: [emerg] unknown directive &quot; root&quot; in /opt/app/nginx/conf.d/test.conf:5</span><br><span class="line">nginx: configuration file /apps/nginx/conf/nginx.conf test failed</span><br><span class="line">[root@server1 nginx]# cat conf.d/test.conf -A #排查一下，有隐藏乱码导致的</span><br><span class="line">server &#123;$</span><br><span class="line">listen 80;$</span><br><span class="line">server_name a.test.com;$</span><br><span class="line">location / &#123;$</span><br><span class="line">M-BM- root /opt/app/nginx/html/www;$  #root前面有乱码</span><br><span class="line">&#125;$</span><br><span class="line">location /about &#123;$</span><br><span class="line">M-BM- root /opt/app/nginx/html/about;$</span><br><span class="line">  &#125;$</span><br><span class="line">&#125;$</span><br></pre></td></tr></table></figure><ul><li><strong>alias：定义路径别名，会把访问的路径重新定义到其指定的路径，文档映射的另一种机制；仅能用于location上下文，此指令使用较少,如果想隐藏自己真实的路径，可以定义一个别名</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 conf.d]# vim test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location /about &#123;    #注意about后不要加/，使用alias的时候uri后面加了斜杠，下面的路径也必须加，不然403错误</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">root /apps/nginx/html;</span></span><br><span class="line"> alias /opt/app/nginx/html/about;  #直接定义一个别名，直接访问这个路径，不会加上location，所以访问的直接是/opt/app/nginx/html/about，而不是/opt/app/nginx/html/about/about</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="location的详细使用"><a href="#location的详细使用" class="headerlink" title="location的详细使用"></a>location的详细使用</h3><p>在一个server中<strong>location配置段可存在多个</strong>，用于实现从uri到文件系统的路径映射; ngnix会根据<strong>用户请求的URI来检查定义的所有location</strong>,按一定的优化级找出一 个最佳匹配，而后应用其配置。在没有使用正则表达式的时候，nginx会先在server中的多个location选取匹配度最高的一个uri, uri是用户请求的字符串，即域名后面的web文件路径，然后使用该location模块中的正则uri和字符串，如果匹配成功就结束搜索，并使用此location处理此请求。</p><ul><li>location官方帮助:<a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location">https://nginx.org/en/docs/http/ngx_http_core_module.html#location</a></li></ul><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125; </span><br></pre></td></tr></table></figure><table><thead><tr><th>匹配正则</th><th>解释</th></tr></thead><tbody><tr><td>&#x3D;</td><td>用于标准uri前，需要请求字串与uri精确匹配，大小敏感,如果匹配成功就停止向下匹配并立即处理请求</td></tr><tr><td>^~</td><td>用于标准uri前，表示包含正则表达式，并且适配以指定的正则表达式开头,对URI的最左边部分做匹配检查，不区分字符大小写</td></tr><tr><td>~</td><td>用于标准uri前，表示包含正则表达式，并且区分大小写</td></tr><tr><td>~*</td><td>用于标准uri前，表示包含正则表达式， 并且不区分大写</td></tr><tr><td>不带符号</td><td>匹配起始于此uri的所有的uri</td></tr><tr><td>|</td><td>用于标准uri前，表示包含正则表达式并且转义字符。可以将.*等转义为普通符号</td></tr></tbody></table><ul><li><span style="color:#FF3333;"><strong>匹配优先级从高到低：</strong></span><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=  ^~  ~/~*  不带符号</span><br></pre></td></tr></table></figure></li></ul><h4 id="精确匹配"><a href="#精确匹配" class="headerlink" title="精确匹配"></a>精确匹配</h4><ul><li>精确匹配一张图片<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 conf.d]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location = /logo.jpg &#123;</span><br><span class="line"> root /opt/app/nginx/html/images;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@server1 conf.d]# mkdir /opt/app/nginx/html/images</span><br><span class="line">[root@server1 conf.d]# cd /opt/app/nginx/html/images</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">传一张图片进去，重启服务</span></span><br><span class="line">然后访问a.test.com/logo.jpg就可以看到一张图片</span><br></pre></td></tr></table></figure><strong>注意：当同时写<code>location = /logo.jpg</code>和<code>location /logo.jpg</code>时，在不同的目录放名字相同的图片，匹配肯定是匹配等于号的那个目录底下的图片，因为优先级比较高，不以代码写入的前后顺序为准</strong></li></ul><h4 id="区分大小写"><a href="#区分大小写" class="headerlink" title="区分大小写"></a>区分大小写</h4><p>~ 实现区分大小写的模糊匹配，以下范例中,如果访问uri中包含大写字母的JPG，则以下location匹配Ax.jpg条件不成功，因为~区分大小写，那么当用户的请求被执行匹配时发现location中定义的是小写的jpg则匹配失败，即要么继续往下匹配其他的location (如果有) ,要么报错给客户端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 images]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location ~ /A.?\.jpg &#123;  #.在正则里表示任意字符，?表示可出现0或者1次，\表示转义</span><br><span class="line"> root /opt/app/nginx/html/images;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@server1 images]# systemctl restart nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">准备一张图片叫Aa.jpg，然后去访问a.test.com/Aa.jpg就可以看到，但是由于是区分大小写的，把图片名字改成aa.jpg就访问不了了</span></span><br></pre></td></tr></table></figure><h4 id="不区分大小写"><a href="#不区分大小写" class="headerlink" title="不区分大小写"></a>不区分大小写</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 images]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location ~* /A.?\.jpg &#123;  # .在正则里表示任意字符，?表示可出现0或者1次，\表示转义</span><br><span class="line"> root /opt/app/nginx/html/images;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：此方式中，对Linux文件系统上的文件仍然是区分大小写的，如果磁盘文件不存在，仍会提示404。比如磁盘上只有一张图片aa.jpg，是可以匹配到的，但是去访问Aa.jpg的时候，就会提示404，再去传入一张Aa.jpg，那么也可以找到，是因为防止有两张名字相同的图片在同一目录下。</span></span><br></pre></td></tr></table></figure><h4 id="以URI开头"><a href="#以URI开头" class="headerlink" title="以URI开头"></a>以URI开头</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 images]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location ^~ /images &#123;  #以images开头的路径下面的文件</span><br><span class="line"> root /apps/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问http://a.test.com/images/Aa.jpg即可看到</span></span><br></pre></td></tr></table></figure><h4 id="文件名后缀"><a href="#文件名后缀" class="headerlink" title="文件名后缀"></a>文件名后缀</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 images]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line">location ~* \.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ &#123;</span><br><span class="line"> root /opt/app/nginx/html/images;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">直接http://a.test.com/xxx.后缀 去访问</span></span><br></pre></td></tr></table></figure><h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 conf.d]# mkdir - p /opt/app/nginx/html/static&#123;1,2,3&#125; #准备三个文件夹</span><br><span class="line">[root@server1 conf.d]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">location / &#123;</span><br><span class="line"> root /opt/app/nginx/html/WWW;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /1.jpg &#123;  #等于号的</span><br><span class="line">index index.html;</span><br><span class="line">root /opt/app/nginx/html/static1;</span><br><span class="line">&#125;</span><br><span class="line">location /1.jpg &#123;  #什么都不加的</span><br><span class="line">index index.html;</span><br><span class="line">root /opt/app/nginx/html/static2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~* \.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ &#123; #忽略大小写</span><br><span class="line">index index.html;</span><br><span class="line">root /opt/app/nginx/html/static3;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在三个不同的文件夹里放入相同名字但是内容不同的图片，用域名去访问a.test.com/1.jpg，最先访问到的是=里的，然后是~，最后是什么都不加的</span></span><br></pre></td></tr></table></figure><ul><li>匹配优先级<br><code>location = </code>&gt; <code>location ^~ 路径</code> &gt; <code>location ~,~* 正则</code> &gt; <code>location 完整路径</code> &gt; <code>location部分起始路径</code> &gt; <code>/</code></li></ul><h3 id="Nginx四层访问控制（传输层）"><a href="#Nginx四层访问控制（传输层）" class="headerlink" title="Nginx四层访问控制（传输层）"></a>Nginx四层访问控制（传输层）</h3><p>访问控制基于模块<strong>ngx_http_access_module</strong>实现，可以通过匹配客户端源IP地址进行限制</p><ul><li><p><strong>注意:如果能在防火墙设备控制最好就不要在nginx上配置,可以更好的节约资源</strong></p></li><li><p>官方帮助：<a href="https://nginx.org/en/docs/http/ngx_http_access_module.html">https://nginx.org/en/docs/http/ngx_http_access_module.html</a></p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 conf.d]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name a.test.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /opt/app/nginx/html/WWW;  # 指定根路径</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /1.jpg &#123;  # 定义一个匹配/1.jpg路径的location块</span><br><span class="line">        root /opt/app/nginx/html/static1;  # 指定/1.jpg路径的根路径</span><br><span class="line">        allow 192.168.190.10;  # 白名单，只允许这个ip进行访问1.jpg</span><br><span class="line">        deny all;  # 拒绝其他所有的客户端访问</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当用域名去访问，直接禁止，可以在本机上用curl --output - 192.168.190.10/1.jpg去试试</span></span><br></pre></td></tr></table></figure><h3 id="Nginx账户认证功能"><a href="#Nginx账户认证功能" class="headerlink" title="Nginx账户认证功能"></a>Nginx账户认证功能</h3><p><strong>由<code>ngx_http_auth_basic_module</code>模块提供此功能</strong></p><ul><li>官方帮助：<a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</a></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成用户和密码</span></span><br><span class="line">[root@server1 static1]# yum install httpd-tools -y</span><br><span class="line">[root@server1 static1]# htpasswd -cb /apps/nginx/conf/.htpasswd user1 123456</span><br><span class="line">Adding password for user user1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意创建第二个及以上用户的时候，取消c参数，不然会覆盖上一个</span></span><br><span class="line">[root@server1 static1]# htpasswd -b /apps/nginx/conf/.htpasswd user2 123456</span><br><span class="line">Adding password for user user2</span><br><span class="line"></span><br><span class="line">[root@server1 static1]# tail /apps/nginx/conf/.htpasswd</span><br><span class="line">user1:$apr1$0FcJ8xr9$.3wIkQJcFv1deuKHD4jdH0</span><br><span class="line">user2:$apr1$BU5ZhWtb$T37n.kv64Ci1n9JsHcbuy/</span><br><span class="line"></span><br><span class="line">[root@server1 static1]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">auth_basic &quot;login password&quot;;  #认证提示要输入密码</span><br><span class="line">auth_basic_user_file /apps/nginx/conf/.htpasswd;  #密码文件所在地</span><br><span class="line">location = /1.jpg &#123;</span><br><span class="line">index index.html;</span><br><span class="line">root /opt/app/nginx/html/static1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用a.test.com/1.jpg去访问，会弹出登录框，输入设置好的账号密码就可查看到</span></span><br></pre></td></tr></table></figure><h3 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 static1]# vim /opt/app/nginx/conf.d/test.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name a.test.com;</span><br><span class="line">auth_basic &quot;login password&quot;;  #认证提示要输入密码</span><br><span class="line">auth_basic_user_file /apps/nginx/conf/.htpasswd;  #密码文件所在地</span><br><span class="line">error_page 404 /40x.html;</span><br><span class="line">location = /1.jpg &#123;</span><br><span class="line">index index.html;</span><br><span class="line">root /opt/app/nginx/html/static1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@server1 html]# vim 40x.html #写个40x网页</span><br><span class="line">a.test.com/2.jpg，访问一个不存在的，登陆进去后显示404</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>![[Pasted image 20230202222818.png]]</p><h3 id="自定义错误日志"><a href="#自定义错误日志" class="headerlink" title="自定义错误日志"></a>自定义错误日志</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# vim /apps/nginx/conf/nginx.conf</span><br><span class="line">server&#123;</span><br><span class="line">...</span><br><span class="line">error_page 500 502 503 504 404 /error.html;</span><br><span class="line">access_log /apps/nginx/logs/a_test_access.log; #成功日志放一个地方</span><br><span class="line">error_log /apps/nginx/logs/a_test_error.log; #错误日志放一个地方</span><br><span class="line">location = /error.html &#123;</span><br><span class="line">root html;</span><br><span class="line">&#125;</span><br><span class="line">可以根据不同的业务，单独设置日志文件，方便分类统计</span><br></pre></td></tr></table></figure><h3 id="长连接配置"><a href="#长连接配置" class="headerlink" title="长连接配置"></a>长连接配置</h3><p>如果数据只传输一下，没有必要设置长连接，如果数据要持续传输，设置长连接后面可以复用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在一次长连接上所允许请求的资源的最大数量，默认为100次，建议适当调大，比如：500</span></span><br><span class="line">keepalive_requests 500;#最大请求数</span><br><span class="line"> keepalive_timeout  65 60;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">开启长连接后，返回客户端的会话保持时间为60s，单次长连接累计请求达到指定次数请求或65秒就会被断开，后面的60为发送给客户端应答报文头部中显示的超时时间设置为60s，如不设置客户端将不显示超时时间。</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用命令测试</span></span><br><span class="line">[root@server1 html]# vim /etc/hosts </span><br><span class="line">[root@server1 html]# yum install whatprovides telnet -y</span><br><span class="line">[root@server1 html]# telnet a.test.com 80</span><br><span class="line">Trying 192.168.190.10...</span><br><span class="line">Connected to a.test.com.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下面为手动输入</span></span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">HOST:a.test.com</span><br></pre></td></tr></table></figure><h3 id="作为下载服务器"><a href="#作为下载服务器" class="headerlink" title="作为下载服务器"></a>作为下载服务器</h3><p>ngx_http_autoindex_module模块处理以斜杠字符”&#x2F;“结尾的请求，并生成目录列表可以做为下载服务配置使用<br>官方文档：<br><a href="https://nginx.org/en/docs/http/ngx_http_autoindex_module.html">https://nginx.org/en/docs/http/ngx_http_autoindex_module.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">autoindex on|off;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动文件索引功能，默认off</span></span><br><span class="line">autoindex_exact_size on|off;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算文件确切大小(单位bytes),off显示大概大小(单位K、M),默认on</span></span><br><span class="line">autoindex_localtime on|off;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示本机时间而非GMT(格林威治)时间,默认off</span></span><br><span class="line">autoindex_format html|xml|json|jsonp;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示索引的页面分割，默认html</span></span><br><span class="line">limit_rate rate;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">限制响应客户端传输速率(除GET和HEAD以外的所有方法),单位B/s,既bytes/second,默认值0，表示无限制，此指令由ngx_http_core_module提供</span></span><br></pre></td></tr></table></figure><h4 id="案例：实现下载站点"><a href="#案例：实现下载站点" class="headerlink" title="案例：实现下载站点"></a>案例：实现下载站点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mkdir -p /opt/app/nginx/html/download</span><br><span class="line">[root@server1 ~]# cd /opt/app/nginx/html/download</span><br><span class="line">[root@server1 download]# vim /apps/nginx/conf.d/download.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name file.test.com;</span><br><span class="line">location /download &#123;</span><br><span class="line">autoindex on;   #自动索引功能,开启才会展示出文件列表</span><br><span class="line">autoindex_exact_size off;   #关闭详细文件大小统计，让文件大小显示MB，GB单位，默认为b</span><br><span class="line">autoindex_localtime on;   #on表示显示本机时间</span><br><span class="line">limit_rate 1024k;    #限速，默认不限速</span><br><span class="line">root /opt/app/nginx/html/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">修改host,如下访问：file.test.com/download</span><br></pre></td></tr></table></figure><p>![[Pasted image 20230203210119.png]]</p><h3 id="作为上传服务器"><a href="#作为上传服务器" class="headerlink" title="作为上传服务器"></a>作为上传服务器</h3><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><ul><li>限制客户端使用除了指定的请求方法之外的其他方法<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">limit_except method ... &#123; ... &#125;；  <span class="comment"># 仅用于location</span></span><br><span class="line">method: GET, HEAD, POST, PUT, DELETE, MKCOL, COPY, MOVE, OPTIONS, PROPFIND,</span><br><span class="line">PROPPATCH, LOCK, UNLOCK, PATCH</span><br><span class="line"></span><br><span class="line"><span class="comment">#小例子</span></span><br><span class="line">[root@www conf.d]<span class="comment"># vim /apps/nginx/conf.d/www.conf</span></span><br><span class="line">location /download &#123;</span><br><span class="line"> root /opt/app/nginx/html/www;</span><br><span class="line"> autoindex on;</span><br><span class="line"> autoindex_exact_size off;</span><br><span class="line"> autoindex_localtime on;</span><br><span class="line"> limit_except POST &#123; <span class="comment">#相当于只允许底下允许列表里的使用除了post外的其他方法</span></span><br><span class="line"><span class="comment">#只有IP地址为192.168.175.1的浏览器可以使用除了POST方法之外的其他方法，而其他人只能使用POST方法。</span></span><br><span class="line"> allow 192.168.175.1;</span><br><span class="line"> deny all;  <span class="comment">#&quot;deny all&quot;指令禁止了所有其他IP地址的访问</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@www conf.d]<span class="comment"># systemctl restart nginx</span></span><br><span class="line">浏览器测试http://file.test.com/download/</span><br></pre></td></tr></table></figure></li><li>是否启用asynchronous file I&#x2F;O(AIO)功能，需要编译开启 –with-file-aio<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">异步文件I/O（AIO）是一种处理文件读写的方式，它允许程序在进行文件I/O操作时不需要阻塞等待操作完成，而是可以继续执行其他任务。</span><br><span class="line">aio on | off;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">Nginx全详解，会不断更新直至常用方法都整理完毕</summary>
    
    
    
    <category term="中间件" scheme="http://example.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="Nginx" scheme="http://example.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>等保要求Linux优化脚本</title>
    <link href="http://example.com/2024/10/01/%E7%AD%89%E4%BF%9D%E5%B0%8F%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/10/01/%E7%AD%89%E4%BF%9D%E5%B0%8F%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC/</id>
    <published>2024-10-01T01:25:00.000Z</published>
    <updated>2024-10-01T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="等保要求Linux优化脚本"><a href="#等保要求Linux优化脚本" class="headerlink" title="等保要求Linux优化脚本"></a>等保要求Linux优化脚本</h2><ul><li>适合多机器批量推送执行，ansible推送等</li></ul><h3 id="1-禁用history"><a href="#1-禁用history" class="headerlink" title="1.禁用history"></a>1.禁用history</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义要修改的文件</span></span><br><span class="line">FILE=<span class="string">&quot;/etc/profile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 HISTSIZE 的当前值</span></span><br><span class="line">CURRENT_HISTSIZE=$(grep <span class="string">&#x27;^HISTSIZE=&#x27;</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;=&#x27;</span> -f2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 HISTSIZE 已经为 0，则跳过修改</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$CURRENT_HISTSIZE</span>&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;HISTSIZE is already set to 0 in <span class="variable">$FILE</span>. No changes made.&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment"># 使用 sed 命令替换 HISTSIZE 的值</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/^HISTSIZE=.*/HISTSIZE=0/&#x27;</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;HISTSIZE has been set to 0 in <span class="variable">$FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="2-ssh登录失败锁定和无活动退出会话"><a href="#2-ssh登录失败锁定和无活动退出会话" class="headerlink" title="2.ssh登录失败锁定和无活动退出会话"></a>2.ssh登录失败锁定和无活动退出会话</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置要插入的行</span></span><br><span class="line">insert_line=<span class="string">&quot;auth required pam_tally2.so onerr=fail deny=5 unlock_time=600 even_deny_root root_unlock_time=600&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化insert_line，将多个空格压缩为一个</span></span><br><span class="line">formatted_insert_line=$(<span class="built_in">echo</span> <span class="variable">$insert_line</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件中读取并格式化每一行，然后检查是否已存在配置</span></span><br><span class="line">found=0</span><br><span class="line"><span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 压缩行中的空格</span></span><br><span class="line">    formatted_line=$(<span class="built_in">echo</span> <span class="variable">$line</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$formatted_line</span>&quot;</span> == <span class="string">&quot;<span class="variable">$formatted_insert_line</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        found=1</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/pam.d/sshd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$found</span> -eq 1 ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;配置已存在，无需添加。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment"># 检查是否有#%PAM-1.0行</span></span><br><span class="line">    <span class="keyword">if</span> grep -q <span class="string">&quot;#%PAM-1.0&quot;</span> /etc/pam.d/sshd; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># 使用awk命令在#%PAM-1.0后添加新行</span></span><br><span class="line">        awk -v line=<span class="string">&quot;<span class="variable">$insert_line</span>&quot;</span> <span class="string">&#x27;/#%PAM-1.0/ &#123; print; print line; next &#125;1&#x27;</span> /etc/pam.d/sshd &gt; /tmp/sshd.tmp &amp;&amp; <span class="built_in">mv</span> /tmp/sshd.tmp /etc/pam.d/sshd</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;配置已添加。&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;#%PAM-1.0 未找到，无法添加配置。&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启sshd服务</span></span><br><span class="line">systemctl restart sshd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sshd服务已重启。&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-允许appuser使用sudo"><a href="#3-允许appuser使用sudo" class="headerlink" title="3.允许appuser使用sudo"></a>3.允许appuser使用sudo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组 appuser 并指定gid 1002</span></span><br><span class="line"><span class="keyword">if</span> ! getent group appuser &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">    groupadd -g 1002 appuser</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;组 appuser 创建成功。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;组 appuser 已存在。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户 appuser 并指定uid 1002，指定其组为 appuser</span></span><br><span class="line"><span class="keyword">if</span> ! getent passwd appuser &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">    useradd -u 1002 -g appuser -m appuser</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用户 appuser 创建成功。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用户 appuser 已存在。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制/root/.ssh到/home/appuser/.ssh，并更改所有权</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;/root/.ssh&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">cp</span> -R /root/.ssh /home/appuser/.ssh</span><br><span class="line">    <span class="built_in">chown</span> -R appuser:appuser /home/appuser/.ssh</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;SSH密钥已复制并更改所有权。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;/root/.ssh不存在，未复制SSH密钥。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为 appuser 添加免密码sudo权限</span></span><br><span class="line"><span class="keyword">if</span> ! grep -q <span class="string">&quot;appuser ALL=(ALL) NOPASSWD: ALL&quot;</span> /etc/sudoers; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;appuser ALL=(ALL) NOPASSWD: ALL&#x27;</span> &gt;&gt; /etc/sudoers</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;appuser已添加至sudoers文件，允许无密码sudo。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;appuser sudo权限已设置，无需重复添加。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="4-禁用Root登录"><a href="#4-禁用Root登录" class="headerlink" title="4.禁用Root登录"></a>4.禁用Root登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Modify /etc/ssh/sshd_config to set PermitRootLogin to no</span></span><br><span class="line">sed -i <span class="string">&#x27;s/^PermitRootLogin yes/PermitRootLogin no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">&#x27;s/^PasswordAuthentication yes/PasswordAuthentication no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># Restart the sshd service for CentOS 7</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(cat /etc/os-release | grep &#x27;VERSION_ID=7&#x27;)</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    systemctl restart sshd || <span class="literal">true</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;修改完成&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Restart the sshd service for CentOS 6</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(cat /etc/os-release | grep &#x27;VERSION_ID=6&#x27;)</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    service sshd restart || <span class="literal">true</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;修改完成&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="5-密码策略调整"><a href="#5-密码策略调整" class="headerlink" title="5.密码策略调整"></a>5.密码策略调整</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份 /etc/login.defs</span></span><br><span class="line"><span class="built_in">cp</span> /etc/login.defs /etc/login.defs.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改密码策略</span></span><br><span class="line">sed -i <span class="string">&#x27;s/^PASS_MAX_DAYS\s*[0-9]\+/PASS_MAX_DAYS   90/&#x27;</span> /etc/login.defs</span><br><span class="line">sed -i <span class="string">&#x27;s/^PASS_MIN_DAYS\s*[0-9]\+/PASS_MIN_DAYS   1/&#x27;</span> /etc/login.defs</span><br><span class="line">sed -i <span class="string">&#x27;s/^PASS_MIN_LEN\s*[0-9]\+/PASS_MIN_LEN    8/&#x27;</span> /etc/login.defs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启sshd服务</span></span><br><span class="line">systemctl restart sshd</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密码策略已更新，并已重启sshd服务。&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux等保优化，只在Centos7和Rocky试过，其余的自行尝试</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Keepalived 高可用</title>
    <link href="http://example.com/2024/09/25/77.Keepalived%20%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    <id>http://example.com/2024/09/25/77.Keepalived%20%E9%AB%98%E5%8F%AF%E7%94%A8/</id>
    <published>2024-09-25T01:25:00.000Z</published>
    <updated>2024-09-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Keepalived-高可用概述"><a href="#Keepalived-高可用概述" class="headerlink" title="Keepalived 高可用概述"></a>Keepalived 高可用概述</h2><p>一般是指2台机器启动着完全相同的业务系统，当有一台机器down机了，另外一台服务器就能快速的接管，对于访问的用户是无感知的。</p><ul><li>硬件通常使用 F5，比较贵</li><li>软件通常使用 keepalived<br>keepalived软件是基于VRRP协议实现的，VRRP虚拟路由冗余协议，主要用于解决单点故障问题</li></ul><h3 id="VRRP原理"><a href="#VRRP原理" class="headerlink" title="VRRP原理"></a>VRRP原理</h3><p>Virtual Router Redundancy Protocol，也即虚拟路由器冗余协议。VRRP协议是一种<strong>容错的主备模式</strong>的协议，保证当主机的下一跳路由出现故障时，由另一台路由器来代替出现故障的路由器进行工作，通过VRRP可以在网络发生故障时透明的进行设备切换而不影响主机之间的数据通信。</p><ul><li><strong>虚拟路由器</strong>：VRRP组中所有的路由器，拥有虚拟的IP+MAC(00-00-5e-00-01-VRID)地址</li><li><strong>主路由器</strong>：虚拟路由器内部通常只有一台物理路由器对外提供服务，主路由器是由选举算法产生，对外提供各种网络功能。</li><li><strong>备份路由器</strong>：VRRP组中除主路由器之外的所有路由器，<strong>不对外提供任何服务，只接受主路由的通告</strong>，当主路由器挂掉之后，重新进行选举算法接替master路由器。<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20241022150804596.png"></li><li>选举机制<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">优先级</span><br><span class="line">抢占模式下，一旦有优先级高的路由器加入，即成为Master</span><br><span class="line">非抢占模式下，只要Master不挂掉，优先级高的路由器只能等待</span><br></pre></td></tr></table></figure></li><li>三种状态<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Initialize状态：系统启动后进入initialize状态</span><br><span class="line">Master状态</span><br><span class="line">Backup状态</span><br></pre></td></tr></table></figure></li></ul><h3 id="Keepalived高可用安装配置"><a href="#Keepalived高可用安装配置" class="headerlink" title="Keepalived高可用安装配置"></a>Keepalived高可用安装配置</h3><h4 id="安装keepalived"><a href="#安装keepalived" class="headerlink" title="安装keepalived"></a>安装keepalived</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 ~]# yum install -y keepalived</span><br><span class="line">[root@lb2 ~]# yum install -y keepalived</span><br></pre></td></tr></table></figure><h4 id="配置master"><a href="#配置master" class="headerlink" title="配置master"></a>配置master</h4><ul><li>找到配置文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 ~]# rpm -qc keepalived</span><br><span class="line">/etc/keepalived/keepalived.conf</span><br><span class="line">/etc/sysconfig/keepalived</span><br></pre></td></tr></table></figure></li><li>这是官方配置，备份一下，自己写一份新的<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;      #全局配置</span><br><span class="line">   notification_email &#123;  </span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.200.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL     #标识身份-&gt;名称</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER      #标识角色状态</span><br><span class="line">    interface eth0     #网卡绑定接口</span><br><span class="line">    virtual_router_id 51 #虚拟路由id</span><br><span class="line">    priority 100      #优先级</span><br><span class="line">    advert_int 1     #监测间隔时间</span><br><span class="line">    authentication &#123; #认证</span><br><span class="line">        auth_type PASS  #认证方式</span><br><span class="line">        auth_pass 1111  #认证密码</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;  #虚拟的VIP地址</span><br><span class="line">        192.168.200.16</span><br><span class="line">        192.168.200.17</span><br><span class="line">        192.168.200.18</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>自己的master配置<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 keepalived]# mv keepalived.conf keepalived.conf.bak</span><br><span class="line">[root@lb1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">global_defs &#123;</span><br><span class="line"> router_id lb01</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"> state MASTER</span><br><span class="line"> interface ens33</span><br><span class="line"> virtual_router_id 50</span><br><span class="line"> priority 150</span><br><span class="line"> advert_int 1</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">use_vmac   <span class="comment">#使用虚拟mac地址，因为虚拟机问题，可能导致原本的IP不可用</span></span></span><br><span class="line"> authentication &#123;</span><br><span class="line">   auth_type PASS</span><br><span class="line">   auth_pass 1111</span><br><span class="line"> &#125;</span><br><span class="line"> virtual_ipaddress &#123;    </span><br><span class="line">   192.168.153.100</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@lb1 ~]# systemctl start keepalived</span><br><span class="line">[root@lb1 ~]# ip a</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">虚拟ip就绑定到主机器上了，备用机器没有</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="配置自己的BACKUP"><a href="#配置自己的BACKUP" class="headerlink" title="配置自己的BACKUP"></a>配置自己的BACKUP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@lb2 ~]# cd /etc/keepalived/</span><br><span class="line">[root@lb2 keepalived]# mv keepalived.conf keepalived.conf.bak</span><br><span class="line">[root@lb2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">global_defs &#123;</span><br><span class="line"> router_id lb02</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"> state BACKUP</span><br><span class="line"> interface ens33</span><br><span class="line"> virtual_router_id 50</span><br><span class="line"> priority 100</span><br><span class="line"> advert_int 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">use_vmac   <span class="comment">#使用虚拟mac地址，因为虚拟机问题，可能导致原本的IP不可用</span></span></span><br><span class="line"> authentication &#123;</span><br><span class="line">   auth_type PASS</span><br><span class="line">   auth_pass 1111</span><br><span class="line"> &#125;</span><br><span class="line"> virtual_ipaddress &#123;</span><br><span class="line">   192.168.153.100</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@lb2 keepalived]# systemctl start keepalived</span><br></pre></td></tr></table></figure><h4 id="master与Backup的keepalived配置区别"><a href="#master与Backup的keepalived配置区别" class="headerlink" title="master与Backup的keepalived配置区别"></a>master与Backup的keepalived配置区别</h4><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20241022151237.png"></p><h4 id="启动Master和Backup节点的keepalived"><a href="#启动Master和Backup节点的keepalived" class="headerlink" title="启动Master和Backup节点的keepalived"></a>启动Master和Backup节点的keepalived</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 keepalived]# systemctl start keepalived</span><br><span class="line">[root@lb1 keepalived]# systemctl enable keepalived</span><br><span class="line"></span><br><span class="line">[root@lb2 keepalived]# systemctl start keepalived</span><br><span class="line">[root@lb2 keepalived]# systemctl enable keepalived</span><br></pre></td></tr></table></figure><h3 id="keepalived抢占式与非抢占式"><a href="#keepalived抢占式与非抢占式" class="headerlink" title="keepalived抢占式与非抢占式"></a>keepalived抢占式与非抢占式</h3><h4 id="配置抢占式"><a href="#配置抢占式" class="headerlink" title="配置抢占式"></a>配置抢占式</h4><p>默认就是抢占式的，优先级高的会抢。由于节点1的优先级高于节点2，所以VIP在节点1上面,记得关闭防火墙selinux，否则会发现两个上都有vip。</p><h5 id="测试VIP抢夺"><a href="#测试VIP抢夺" class="headerlink" title="测试VIP抢夺"></a>测试VIP抢夺</h5><ul><li>关闭节点1的keepalived<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 keepalived]# systemctl stop keepalived </span><br></pre></td></tr></table></figure></li><li>节点2联系不上节点1，主动接管VIP<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lb2 keepalived]# ip addr |grep 192.168.153.100</span><br><span class="line">    inet 192.168.153.100/32 scope global ens33</span><br></pre></td></tr></table></figure></li><li>此时重新启动Master上的keepalived，会发现VIP被强行抢占<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lb1 keepalived]# systemctl start keepalived</span><br><span class="line">[root@lb1 keepalived]# ip addr |grep 192.168.153.100</span><br><span class="line">    inet 192.168.153.100/32 scope global ens33</span><br></pre></td></tr></table></figure></li></ul><h4 id="配置非抢占式"><a href="#配置非抢占式" class="headerlink" title="配置非抢占式"></a>配置非抢占式</h4><ul><li>非抢占的条件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.两个节点的state都必须配置为BACKUP</span><br><span class="line">2.两个节点都必须加上配置 nopreempt</span><br><span class="line">3.其中一个节点的优先级必须要高于另外一个节点的优先级。</span><br><span class="line">4.两台服务器都角色状态启用nopreempt后，必须修改角色状态统一为BACKUP，唯一的区分就是优先级。</span><br></pre></td></tr></table></figure></li><li>两个机器都配置非抢占<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">两个机器都设置成BACKUP，并添加nopreempt，只有优先级不同</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master：</span></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"> state BACKUP</span><br><span class="line"> interface ens33</span><br><span class="line"> virtual_router_id 50</span><br><span class="line"> priority 150</span><br><span class="line"> advert_int 1</span><br><span class="line"> nopreempt</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">backup：</span></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"> state BACKUP</span><br><span class="line"> interface ens33</span><br><span class="line">virtual_router_id 50</span><br><span class="line"> priority 100</span><br><span class="line"> advert_int 1</span><br><span class="line"> nopreempt</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">systemctl restart keepalived</span><br></pre></td></tr></table></figure></li><li>通过windows的arp去验证，是否会切换MAC地址<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当前在节点1上</span></span><br><span class="line">[root@lb1 keepalived]# ip addr |grep 192.168.153.100</span><br><span class="line">    inet 192.168.153.100/32 scope global ens33</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">断开节点1</span></span><br><span class="line">[root@lb1 keepalived]# systemctl stop keepalived</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">节点2接管</span></span><br><span class="line">[root@lb2 keepalived]# ip addr |grep 192.168.153.100</span><br><span class="line">    inet 192.168.153.100/32 scope global ens33</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再开启节点1，VIP还是在节点2上</span></span><br><span class="line">[root@lb1 keepalived]# systemctl start keepalived</span><br><span class="line">[root@lb2 keepalived]# ip addr |grep 192.168.153.100</span><br><span class="line">    inet 192.168.153.100/32 scope global ens33</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\&gt;arp -a |findstr 192.168.153.100</span><br><span class="line">  192.168.153.100       00-0c-29-8c-cb-06     dynamic</span><br></pre></td></tr></table></figure></li></ul><h3 id="高可用keepalived故障脑裂"><a href="#高可用keepalived故障脑裂" class="headerlink" title="高可用keepalived故障脑裂"></a>高可用keepalived故障脑裂</h3><p>由于某些原因，导致两台keepalived高可用服务器在指定时间内，无法检测到对方的心跳，各自取得资源及服务的所有权，而此时的两台高可用服务器又都还活着。这样相互都认为自己是主，就会发生脑裂故障。</p><h4 id="脑裂故障原因"><a href="#脑裂故障原因" class="headerlink" title="脑裂故障原因"></a>脑裂故障原因</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.服务器网线松动等网络故障</span><br><span class="line">2.服务器硬件故障发生损坏现象而崩溃</span><br><span class="line">3.主备都开启firewalld防火墙</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">两台都有VIP</span></span><br><span class="line">[root@lb1 ~]# ip a |grep 192.168.153.100</span><br><span class="line"> inet 192.168.153.100/24 scope global secondary ens33</span><br><span class="line"> </span><br><span class="line">[root@lb2 ~]# ip a |grep 192.168.175.100</span><br><span class="line"> inet 192.168.153.100/24 scope global secondary ens33</span><br></pre></td></tr></table></figure><h4 id="解决脑裂故障方案"><a href="#解决脑裂故障方案" class="headerlink" title="解决脑裂故障方案"></a>解决脑裂故障方案</h4><ul><li>如果发生脑裂，则随机kill掉一台即可</li><li>在backup上编写检测脚本, 测试如果能ping通master并且backup节点还有VIP的话则认为产生了脑裂<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将两台机器都开启防火墙，这时已经产生脑裂</span></span><br><span class="line">[root@lb1 ~]# systemctl start firewalld</span><br><span class="line">[root@lb2 ~]# systemctl start firewalld</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在挑选backup机器上编写脚本，这里以30为例</span></span><br><span class="line">[root@lb2 ~]# vim check_split_brain.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">vip=192.168.153.100</span><br><span class="line">lb01_ip=192.168.153.20</span><br><span class="line">while true;do</span><br><span class="line">      ping -c 2 $lb01_ip &amp;&gt;/dev/null</span><br><span class="line">      if [ $? -eq 0 -a `ip add|grep &quot;$vip&quot;|wc -l` -eq 1 ];then</span><br><span class="line">            echo &quot;device is split brain.warning.&quot;</span><br><span class="line">            systemctl stop keepalived</span><br><span class="line">            echo &quot;stop keepalived&quot;</span><br><span class="line">      else</span><br><span class="line">            echo &quot;device is ok&quot;</span><br><span class="line">      fi</span><br><span class="line">sleep 5</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">[root@lb2 ~]# sh check_split_brain.sh</span><br><span class="line">device is split brain.warning.</span><br><span class="line">stop keepalived</span><br><span class="line">device is ok</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这时候节点2的keepalive已经关了，恢复了正常，关闭防火墙，再重新开启keepalived</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="高可用keepalived与nginx"><a href="#高可用keepalived与nginx" class="headerlink" title="高可用keepalived与nginx"></a>高可用keepalived与nginx</h3><p>Nginx默认监听在所有的IP地址上，VIP会飘到一台节点上，相当于那台nginx多了VIP这么一个网卡，所以可以访问到nginx所在机器。<br>但是如果nginx宕机，会导致用户请求失败，但是keepalived没有挂掉不会进行切换，所以需要编写一个脚本检测Nginx的存活状态，如果不存活则kill掉keepalived。</p><ul><li>先给两台机器都装上nginx<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y nginx</span><br><span class="line">systemctl enable nginx --now</span><br><span class="line"></span><br><span class="line">[root@lb1 ~]# echo &quot;in lb01&quot; &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@lb2 ~]# echo &quot;in lb02&quot; &gt; /usr/share/nginx/html/index.html</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">因为当前VIP是挂在节点1上的，访问192.168.153.100的效果就是<span class="keyword">in</span> lb01，但是如果关闭lb01的keepalived，就变成<span class="keyword">in</span> lb02，但是如果nginx挂了，网页将会无法正常访问，因为keepalived只监控自己的进程</span></span><br></pre></td></tr></table></figure></li><li>用脚本解决nginx挂了vip没有切换的问题<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在主节点上写脚本</span></span><br><span class="line">[root@lb2 ~]# vim check_web.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.判断Nginx是否存活,如果不存活则尝试启动Nginx</span></span><br><span class="line">nginxpid=$(ps -C nginx --no-header|wc -l)</span><br><span class="line">   if [ $nginxpid -eq 0 ];then</span><br><span class="line">   systemctl start nginx</span><br><span class="line">   sleep 3</span><br><span class="line">    #2.等待3秒后再次获取一次Nginx状态</span><br><span class="line">   nginxpid=$(ps -C nginx --no-header|wc -l)</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">3.再次进行判断, 如Nginx还不存活则停止Keepalived,让地址进行漂移,并退出脚本</span></span><br><span class="line">   if [ $nginxpid -eq 0 ];then</span><br><span class="line">      systemctl stop keepalived</span><br><span class="line">      echo &quot;keepalived has been killd&quot;</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关掉主节点nginx，这时候就看不了了，因为没有飘移，用脚本，nginx恢复，还是<span class="keyword">in</span> lb02</span></span><br><span class="line">[root@lb2 ~]# systemctl stop nginx</span><br><span class="line">[root@lb2 ~]# sh check_web.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">给nginx配置文件弄坏，让它彻底起不来以后，再用脚本，就会杀死keepalived,ip发生漂移，再刷网页，就会显示<span class="keyword">in</span> lb01</span></span><br><span class="line">[root@lb2 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">[root@lb2 ~]# systemctl stop nginx</span><br><span class="line">[root@lb2 ~]# sh check_web.sh</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">Keepalived 高可用概述</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Centos7编译升级glibc</title>
    <link href="http://example.com/2024/09/24/Centos7.9%E5%8D%87%E7%BA%A7glibc2.31/"/>
    <id>http://example.com/2024/09/24/Centos7.9%E5%8D%87%E7%BA%A7glibc2.31/</id>
    <published>2024-09-24T01:25:00.000Z</published>
    <updated>2024-09-24T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Centos7编译升级glibc"><a href="#Centos7编译升级glibc" class="headerlink" title="Centos7编译升级glibc"></a>Centos7编译升级glibc</h2><h4 id="0）基本依赖"><a href="#0）基本依赖" class="headerlink" title="0）基本依赖"></a>0）基本依赖</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install m4-1.4.16-10.el7.x86_64 -y</span><br><span class="line">yum install python3 -y</span><br><span class="line">yum install epel-release -y</span><br><span class="line">yum <span class="built_in">groups</span> mark install <span class="string">&quot;Development Tools&quot;</span> -y</span><br><span class="line">yum install lbzip2 -y</span><br><span class="line"><span class="comment">#yum install -y gmp-devel mpfr-devel libmpc-devel gcc gcc-c++ gcc-gfortran.x86_64 make</span></span><br></pre></td></tr></table></figure><h4 id="1）编译升级gcc9-3"><a href="#1）编译升级gcc9-3" class="headerlink" title="1）编译升级gcc9.3"></a>1）编译升级gcc9.3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/gnu/gcc/gcc-9.3.0/gcc-9.3.0.tar.gz</span><br><span class="line">tar -zxf gcc-9.3.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> gcc-9.3.0/</span><br><span class="line"><span class="built_in">cat</span> ./contrib/download_prerequisites | grep -E <span class="string">&#x27;\.(bz2|gz)|^base_url&#x27;</span>   <span class="comment">#里面有需要的包的需求,去下载下来</span></span><br><span class="line">./contrib/download_prerequisites <span class="comment">#用这一步的话，就不用手动编译下面的四个包了，不过貌似失效了</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure --enable-checking=release --enable-language=c,c++ --disable-multilib --prefix=/usr</span><br><span class="line">make -j4 &amp;&amp; make install</span><br></pre></td></tr></table></figure><h5 id="四包手动安装"><a href="#四包手动安装" class="headerlink" title="四包手动安装"></a>四包手动安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#也可以全部手动编译所需四个包</span></span><br><span class="line"><span class="comment">#1.GMP编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz</span><br><span class="line">tar xvf gmp-6.3.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> gmp-6.3.0</span><br><span class="line">./configure --prefix=/usr/local/gmp-6.3</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.MPFR编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/mpfr/mpfr-4.2.1.tar.gz</span><br><span class="line">tar xzvf mpfr-4.2.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mpfr-4.2.1</span><br><span class="line">./configure --prefix=/usr/local/mpfr-4.2.1 --with-gmp=/usr/local/gmp-6.3</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.MPC编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz</span><br><span class="line">tar xzvf mpc-1.3.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mpc-1.3.1</span><br><span class="line">./configure --prefix=/usr/local/mpc-1.3.1 --with-gmp=/usr/local/gmp-6.3 --with-mpfr=/usr/local/mpfr-4.2.1</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">export LD_LIBRARY_PATH=/usr/local/mpc-1.3.1/lib:/usr/local/gmp-6.3/lib:/usr/local/mpfr-4.2.1/lib</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.ISL编译安装</span></span><br><span class="line">wget https://sources.buildroot.net/isl/isl-0.18.tar.xz</span><br><span class="line">tar -xf isl-0.18.tar.xz</span><br><span class="line"><span class="built_in">cd</span> isl-0.18</span><br><span class="line">./configure --prefix=/usr/local/isl-0.18  --with-gmp=/usr/local/gmp-6.3.0</span><br><span class="line">make -j4  &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加动态链接库,编辑如下</span></span><br><span class="line">vim /etc/ld.so.conf</span><br><span class="line">include ld.so.conf.d/*.conf</span><br><span class="line">/lib</span><br><span class="line">/lib64</span><br><span class="line">/usr/lib</span><br><span class="line">/usr/lib64</span><br><span class="line">/usr/local/lib</span><br><span class="line">/usr/local/lib64</span><br><span class="line">/usr/local/gmp-6.1.0/lib</span><br><span class="line">/usr/local/mpc-1.0.3/lib</span><br><span class="line">/usr/local/mpfr-3.1.4/lib</span><br><span class="line"></span><br><span class="line"><span class="comment">#备注： 重新搜索当前系统上所有库文件搜索路径下的库文件,并生成缓存</span></span><br><span class="line">ldconfig -v</span><br></pre></td></tr></table></figure><h4 id="2）编译升级make4-3"><a href="#2）编译升级make4-3" class="headerlink" title="2）编译升级make4.3"></a>2）编译升级make4.3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/gnu/make/make-4.3.tar.gz</span><br><span class="line">tar -zxf make-4.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> make-4.3/</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure --prefix=/usr &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="3）编译升级bison"><a href="#3）编译升级bison" class="headerlink" title="3）编译升级bison"></a>3）编译升级bison</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://ftp.gnu.org/gnu/bison/bison-3.8.2.tar.gz</span><br><span class="line">tar xvf bison-3.8.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> bison-3.8.2</span><br><span class="line">./configure --prefix=/usr/local/bison</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">export PATH=/usr/local/bison/bin:$PATH</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">. /etc/profile</span><br></pre></td></tr></table></figure><h4 id="4）编译升级glibc2-31"><a href="#4）编译升级glibc2-31" class="headerlink" title="4）编译升级glibc2.31"></a>4）编译升级glibc2.31</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/gnu/glibc/glibc-2.31.tar.gz</span><br><span class="line">tar -zxf glibc-2.31.tar.gz</span><br><span class="line"><span class="built_in">cd</span> glibc-2.31/</span><br><span class="line"><span class="built_in">cat</span> INSTALL | grep -E <span class="string">&quot;newer|later&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure  --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin --disable-sanity-checks --disable-werror</span><br><span class="line">make -j2</span><br><span class="line">make install</span><br><span class="line">strings /lib64/libc.so.6 | grep ^GLIBC</span><br><span class="line">make localedata/install-locales</span><br></pre></td></tr></table></figure><h4 id="5）修复rpm数据库"><a href="#5）修复rpm数据库" class="headerlink" title="5）修复rpm数据库"></a>5）修复rpm数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /var/lib/rpm/__db*</span><br><span class="line">rpm --rebuilddb</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">ln</span> -s /lib64/libtinfo.so.5 /lib64/libtinfo.so.6</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Centos7编译升级glibc</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Ansible自动化运维工具</title>
    <link href="http://example.com/2024/09/13/10001.Ansible%E8%AF%A6%E8%A7%A3/"/>
    <id>http://example.com/2024/09/13/10001.Ansible%E8%AF%A6%E8%A7%A3/</id>
    <published>2024-09-13T01:25:00.000Z</published>
    <updated>2024-09-13T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible自动化运维工具"><a href="#Ansible自动化运维工具" class="headerlink" title="Ansible自动化运维工具"></a>Ansible自动化运维工具</h2><h3 id="Ansible简介"><a href="#Ansible简介" class="headerlink" title="Ansible简介"></a>Ansible简介</h3><p>ansible是新出现的自动化运维工具，由python开发，集合了众多自动化运维工具的优点，实现了批量系统部署、批量程序部署，批量运行命令等功能。ansible是基于模块工作的，本身没有批量部署的能力，真正具有批量部署能力的是ansible运行的模块，ansible只是提供一个框架。<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20240908212456.png"></p><h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><p>① Ansible： ansible的核心模块<br>② Host Inventory：主机清单，也就是被管理的主机列表<br>③ Playbooks：ansible的剧本，可想象为将多个任务放置在一起，一块执行<br>④ Core Modules：ansible的核心模块<br>⑤ Custom Modules：自定义模块<br>⑥ Connection Plugins：连接插件，用于与被管控主机之间基于SSH建立连接关系<br>⑦ Plugins：其他插件，包括记录日志等</p><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul><li>不需要在被监控端上安装任何服务程序</li><li>无服务器端，使用时直接运行命令即可</li><li>基于模块工作，可以使用任意语言开发</li><li>使用yaml语言编写playbook</li><li>基于ssh工作</li><li>可实现多级指挥</li><li>具有幂等性，一种操作重复多次执行结果相同</li><li>执行过程<ul><li>加载自己的配置文件，默认为&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</li><li>加载自己对应的模块文件</li><li>通过ansible将模块或命令生成对应的临时py文件，并将该文件传输至远程服务器</li><li>对应执行用户的家目录的.ansible&#x2F;tmp&#x2F;xx.py文件</li><li>给文件+x执行</li><li>执行并将返回结果，删除临时py文件，sleep 0 退出</li></ul></li></ul><h3 id="Asible的安装"><a href="#Asible的安装" class="headerlink" title="Asible的安装"></a>Asible的安装</h3><ul><li>设置EPEL仓库<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#- Ansible仓库默认不在yum仓库中，因此我们需要使用下面的命令启用epel仓库</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum install epel-release -y</span></span><br></pre></td></tr></table></figure></li><li>使用yum安装Ansible<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install ansible -y</span></span><br></pre></td></tr></table></figure></li><li>查看ansible的版本，验证安装正确<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible --version</span></span><br><span class="line">ansible 2.9.27</span><br><span class="line">  config file = /etc/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [u<span class="string">&#x27;/root/.ansible/plugins/modules&#x27;</span>, u<span class="string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]</span><br><span class="line">  ansible python module location = /usr/lib/python2.7/site-packages/ansible</span><br><span class="line">  executable location = /usr/bin/ansible</span><br><span class="line">  python version = 2.7.5 (default, Oct 14 2020, 14:45:30) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</span><br></pre></td></tr></table></figure></li></ul><h3 id="创建-SSH-免交互登录"><a href="#创建-SSH-免交互登录" class="headerlink" title="创建 SSH 免交互登录"></a><strong>创建 SSH 免交互登录</strong></h3><p>Ansible 通过 SSH 对设备进行管理，而 SSH 包含两种认证方式：一种是通过密码认证，另一种是通过密钥对验证。前者必须和系统交互，而后者是免交互登录。如果希望通过 Ansible 自动管理设备，应该配置为免交互登录被管理设备。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一共四台机器，localhost为装ansible的，s1-3为被管理的</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ssh-keygen -t rsa  #不想改就默认一路回车</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">&#x27;/root/.ssh&#x27;</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:wPPpLe1zCIlnLqybzXUf5E6E+<span class="built_in">df</span>+fewAeFSTojB/X3c root@localhost.localdomain</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|              o. |</span></span><br><span class="line"><span class="string">|     .  o   .... |</span></span><br><span class="line"><span class="string">|      +  + ...   |</span></span><br><span class="line"><span class="string">|       + .o=.   E|</span></span><br><span class="line"><span class="string">|       .S.+.=. .o|</span></span><br><span class="line"><span class="string">|      ..=o * ... |</span></span><br><span class="line"><span class="string">|     . ++.+.= o..|</span></span><br><span class="line"><span class="string">|     +o..+o+.o o+|</span></span><br><span class="line"><span class="string">|    +oo.  .oo  .B|</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@localhost ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.10.135</span></span><br><span class="line"><span class="string">[root@localhost ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.10.136</span></span><br><span class="line"><span class="string">[root@localhost ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.10.137</span></span><br></pre></td></tr></table></figure><h3 id="ansible的命令参数"><a href="#ansible的命令参数" class="headerlink" title="ansible的命令参数"></a>ansible的命令参数</h3><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入ansible，然后敲两下Tab，会显示所有的ansible命令</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible</span></span><br><span class="line">ansible               ansible-connection    ansible-doc           ansible-galaxy-2      ansible-playbook-2    ansible-pull-2.7</span><br><span class="line">ansible-2             ansible-console       ansible-doc-2         ansible-galaxy-2.7    ansible-playbook-2.7  ansible-vault</span><br><span class="line">ansible-2.7           ansible-console-2     ansible-doc-2.7       ansible-inventory     ansible-pull          ansible-vault-2</span><br><span class="line">ansible-config        ansible-console-2.7   ansible-galaxy        ansible-playbook      ansible-pull-2        ansible-vault-2.7</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible：临时命令执行工具，常用于执行临时命令</span><br><span class="line">ansible-doc：常用于模块功能的查询</span><br><span class="line">ansible-playbook：用于执行剧本</span><br></pre></td></tr></table></figure><h5 id="ansible命令"><a href="#ansible命令" class="headerlink" title="ansible命令"></a><strong>ansible</strong>命令</h5><p><code>非固化需求；临时一次性操作；二次开发接口调用：非固化需求是指临时性的维护，如查看web服务器组磁盘使用情况、复制一个文件到其他机器等。类似这些没有规律的、临时需要做的任务，我们成为非固化需求，临时一次性操作</code></p><table><thead><tr><th align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; font-weight: 700; text-align: center; background-color: rgb(239, 243, 245);">参数</span></th><th align="center"><strong>功能</strong></th></tr></thead><tbody><tr><td align="center">-v</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">详细模式，如果执行成功，输出详细结果</span></td></tr><tr><td align="center">-i</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">指定host文件路径，默认在&#x2F;etc&#x2F;ansible&#x2F;hosts</span></td></tr><tr><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">-f,-forks&#x3D;NUM</span></td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">NUM默认是整数5，指定fork开启同步进程的个数</span></td></tr><tr><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">-m</span></td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">指定使用的module名称，默认command模块</span></td></tr><tr><td align="center">-a</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">指定模块的参数</span></td></tr><tr><td align="center">-k</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">提示输入SSH密码，而不是使用基于ssh密钥认证</span></td></tr><tr><td align="center">-sudo</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">指定使用sudo获取root权限</span></td></tr><tr><td align="center">-K</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">提示输入sudo密码</span></td></tr><tr><td align="center">-u</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures;">指定移动端的执行用户</span></td></tr><tr><td align="center">-C</td><td align="center"><span style="color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; font-variant-ligatures: no-common-ligatures; background-color: rgb(247, 247, 247);">测试命令执行会改变什么内容，不会真正的去执行</span></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- -v（—verbose）：输出详细的执行过程信息，可以得到执行过程所有信息；</span><br><span class="line">- -i PATH（—inventory=PATH）：指定inventory信息，默认为/etc/ansible/hosts；</span><br><span class="line">- -f NUM（—forks=NUM）：并发线程数，默认为5个线程；</span><br><span class="line">- —private-key=PRIVATE_KEY_FILE：指定密钥文件；</span><br><span class="line">- -m NAME，—module-name=NAME：指定执行使用的模块；</span><br><span class="line">- -M DIRECTORY（—module-path=DIRECTORY） ：指定模块存放路径，默认为/usr/share/ansible；</span><br><span class="line">- -a ARGUMENTS（—args=ARGUMENTS）：指定模块参数；</span><br><span class="line">- -u USERNAME（—user=USERNAME）：指定远程主机以USERNAME运行命令；</span><br><span class="line">- -l subset（—<span class="built_in">limit</span>=SUBSET）：限制运行主机；</span><br></pre></td></tr></table></figure><p>①检查所有主机是否存活，执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -f 5 -m ping</span><br></pre></td></tr></table></figure><p>②列出web组所有的主机列表，执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web --list</span><br></pre></td></tr></table></figure><p>③批量显示web组中的磁盘使用空间，执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m <span class="built_in">command</span> -a <span class="string">&quot;df -hT&quot;</span></span><br></pre></td></tr></table></figure><ul><li>红色：表示执行过程出现异常；</li><li>橘黄颜色：表示命令执行后目标有状态变化；</li><li>绿色：表示执行成功且没有目标机器做修改；</li></ul><h5 id="ansible-doc命令"><a href="#ansible-doc命令" class="headerlink" title="ansible-doc命令"></a><strong>ansible-doc</strong>命令</h5><p>Ansible-doc用来查询ansible模块文档的说明，类似于man命令，针对每个模块都有详细的用法说明及应用案例介绍，语法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc [options] [module……]</span><br></pre></td></tr></table></figure><ul><li>查询所有支持的模块<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-doc -l</span></span><br></pre></td></tr></table></figure></li><li>查询ping模块的说明信息：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-doc ping</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="ansible-playbook命令"><a href="#ansible-playbook命令" class="headerlink" title="ansible-playbook命令"></a><strong>ansible-playbook</strong>命令</h5><p>Ansible-playbook是日常应用中使用频率最高的命令，类似于Linux中的sh或source命令，用来执行系列任务。其工作机制：通过读取预先编写好的playbook文件实现集中处理任务。Ansible-playbook命令后跟yml格式的playbook文件，playbook文件存放了要执行的任务代码，命令使用方式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ansible-playbook playbook.yml</span><br><span class="line">&lt;!--playbook.yml文件要提前编写好，建议使用绝对路径--&gt;</span><br></pre></td></tr></table></figure><h5 id="Ansible-console命令"><a href="#Ansible-console命令" class="headerlink" title="Ansible-console命令"></a><strong>Ansible-console</strong>命令</h5><p>Ansible-console是Ansible为用户提供的一款交互式工具，类似于Windows的cmd或者是Linux中shell。用户可以在ansible-console虚拟出来的终端上像shell一样使用Ansible内置的各种命令，这为习惯于使用shell交互式方式的用户提供了良好的使用体验。在终端输入ansible-console命令后，显示如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-console</span></span><br><span class="line">Welcome to the ansible console.</span><br><span class="line">Type <span class="built_in">help</span> or ? to list commands.</span><br><span class="line">      &lt;!--输入<span class="built_in">help</span>或？获取帮助--&gt;</span><br><span class="line">root@all (3)[f:5]$ <span class="built_in">cd</span> web    &lt;!--使用<span class="built_in">cd</span>命令切换主机或分组--&gt;</span><br><span class="line">root@web (3)[f:5]$ list                  &lt;!--列出当前的设备--&gt;</span><br><span class="line">192.168.10.135</span><br><span class="line">192.168.10.136</span><br><span class="line">192.168.10.137</span><br><span class="line">&lt;!--支持Tab键补全，快捷键Ctrl+D或Ctrl+C即可退出当前的虚拟终端--&gt;</span><br></pre></td></tr></table></figure><h3 id="Ansible-常见配置文件"><a href="#Ansible-常见配置文件" class="headerlink" title="Ansible 常见配置文件"></a>Ansible 常见配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/ansible/ansible.cfg：主配置文件</span><br><span class="line">/etc/ansible/hosts：主机清单文件</span><br><span class="line">/etc/ansible/roles：角色目录</span><br></pre></td></tr></table></figure><h4 id="hosts文件配置（主机与组）"><a href="#hosts文件配置（主机与组）" class="headerlink" title="hosts文件配置（主机与组）"></a>hosts文件配置（主机与组）</h4><h2 id="Inventory-是-Ansible-管理主机信息的配置文件，相当于系统-Hosts-文件的功能，默认存放在-etc-ansible-hosts。在-hosts-文件中，通过分组来组织设备，Ansible-通过-Inventory-来定义主机和分组，通过在-ansible-命令中使用选项-i或—inventory-file来指定-Inventory-Ansible-通过设备列表以分组的方式添加到-etc-ansible-hosts-文件来实现对设备的管理，所以在正式管理之前，首先要编写好-hosts-文件。hosts-文件中，以-包含的部分代表组名，设备列表支持主机名和IP地址。默认情况下，通过访问22端口（SSH）来管理设备。若目标主机使用了非默认的SSH端口，还可以在主机名称之后使用冒号加端口标明，以行为单位分隔配置。另外，hosts文件还支持通配符。-可以将一个主机同时归置在不同的组中。配置完成之后，可以针对hosts定义的组进行远程操作，也可以针对组中的某一个或多个主机操作。例如："><a href="#Inventory-是-Ansible-管理主机信息的配置文件，相当于系统-Hosts-文件的功能，默认存放在-etc-ansible-hosts。在-hosts-文件中，通过分组来组织设备，Ansible-通过-Inventory-来定义主机和分组，通过在-ansible-命令中使用选项-i或—inventory-file来指定-Inventory-Ansible-通过设备列表以分组的方式添加到-etc-ansible-hosts-文件来实现对设备的管理，所以在正式管理之前，首先要编写好-hosts-文件。hosts-文件中，以-包含的部分代表组名，设备列表支持主机名和IP地址。默认情况下，通过访问22端口（SSH）来管理设备。若目标主机使用了非默认的SSH端口，还可以在主机名称之后使用冒号加端口标明，以行为单位分隔配置。另外，hosts文件还支持通配符。-可以将一个主机同时归置在不同的组中。配置完成之后，可以针对hosts定义的组进行远程操作，也可以针对组中的某一个或多个主机操作。例如：" class="headerlink" title="Inventory 是 Ansible 管理主机信息的配置文件，相当于系统 Hosts 文件的功能，默认存放在 &#x2F;etc&#x2F;ansible&#x2F;hosts。在 hosts 文件中，通过分组来组织设备，Ansible 通过 Inventory 来定义主机和分组，通过在 ansible 命令中使用选项-i或—inventory-file来指定 Inventory- Ansible 通过设备列表以分组的方式添加到 &#x2F;etc&#x2F;ansible&#x2F;hosts 文件来实现对设备的管理，所以在正式管理之前，首先要编写好 hosts 文件。hosts 文件中，以[ ]包含的部分代表组名，设备列表支持主机名和IP地址。默认情况下，通过访问22端口（SSH）来管理设备。若目标主机使用了非默认的SSH端口，还可以在主机名称之后使用冒号加端口标明，以行为单位分隔配置。另外，hosts文件还支持通配符。- 可以将一个主机同时归置在不同的组中。配置完成之后，可以针对hosts定义的组进行远程操作，也可以针对组中的某一个或多个主机操作。例如："></a>Inventory 是 Ansible 管理主机信息的配置文件，相当于系统 Hosts 文件的功能，默认存放在 &#x2F;etc&#x2F;ansible&#x2F;hosts。在 hosts 文件中，通过分组来组织设备，Ansible 通过 Inventory 来定义主机和分组，通过在 ansible 命令中使用选项<code>-i</code>或<code>—inventory-file</code>来指定 Inventory<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible -i /etc/ansible/hosts web -m ping</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或者不指定，就会默认使用/etc/ansible/hosts</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible web -m ping</span></span><br></pre></td></tr></table></figure><br>- Ansible 通过设备列表以分组的方式添加到 &#x2F;etc&#x2F;ansible&#x2F;hosts 文件来实现对设备的管理，所以在正式管理之前，首先要编写好 hosts 文件。hosts 文件中，以[ ]包含的部分代表组名，设备列表支持主机名和IP地址。默认情况下，通过访问22端口（SSH）来管理设备。若目标主机使用了非默认的SSH端口，还可以在主机名称之后使用冒号加端口标明，以行为单位分隔配置。另外，hosts文件还支持通配符。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/ansible/hosts</span></span><br><span class="line">[web]</span><br><span class="line">192.168.10.135</span><br><span class="line">192.168.10.136</span><br><span class="line">192.168.10.137</span><br><span class="line"></span><br><span class="line"><span class="comment">#然后去ping测试</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible web -m ping</span></span><br><span class="line">192.168.10.135 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.10.136 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.10.137 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>- 可以将一个主机同时归置在不同的组中。配置完成之后，可以针对hosts定义的组进行远程操作，也可以针对组中的某一个或多个主机操作。例如：</h2><p>1)只对web组中192.168.10.136主机操作，通–limit参数限定主机的变更。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible web -m ping --limit &quot;192.168.10.136&quot;</span></span><br><span class="line">192.168.10.136 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#也可以追加执行命令</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible web -m command -a &quot;systemctl status nginx&quot; --limit &quot;192.168.10.136&quot;</span></span><br><span class="line">192.168.10.136 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">● nginx.service - Nginx Web Server</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/nginx.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 日 2023-10-08 13:48:59 CST; 1h 13min ago</span><br><span class="line">  Process: 900 ExecStart=/usr/local/nginx/sbin/nginx (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 907 (nginx)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─907 nginx: master process /usr/local/nginx/sbin/ngin</span><br><span class="line">           └─909 nginx: worker process</span><br><span class="line"></span><br><span class="line">10月 08 13:48:59 s2 systemd[1]: Starting Nginx Web Server...</span><br><span class="line">10月 08 13:48:59 s2 systemd[1]: Started Nginx Web Server.</span><br></pre></td></tr></table></figure><p>2)只对192.168.100.20主机操作。通过IP限定主机的变更</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible 192.168.10.136 -m command -a &quot;systemctl status nginx&quot;</span></span><br><span class="line">192.168.10.136 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><p>3)只对192.168.10.0网段主机操作，这就需要使用到通配符来限定主机的变更</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible 192.168.10.* -m command -a &quot;systemctl status httpd&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Ansible常用模块"><a href="#Ansible常用模块" class="headerlink" title="Ansible常用模块"></a>Ansible常用模块</h3><p><a href="https://docs.ansible.com/ansible/latest/index.html">https://docs.ansible.com/ansible/latest/index.html</a>    #官方文档</p><h4 id="ansible的执行状态"><a href="#ansible的执行状态" class="headerlink" title="ansible的执行状态"></a>ansible的执行状态</h4><ul><li>绿色：执行成功并且不需要做改变的操作 </li><li>黄色：执行成功并且对目标主机做变更 </li><li>红色：执行失败</li><li>粉色：警告信息</li><li>蓝色：显示ansible命令执行的过程</li></ul><h4 id="ping模块"><a href="#ping模块" class="headerlink" title="ping模块"></a>ping模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m ping node1</span></span><br></pre></td></tr></table></figure><h4 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-doc -l|wc -l</span></span><br><span class="line">7736 <span class="comment">#共有7736个模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible‐doc ‐s user #查看模块的参数</span></span><br><span class="line">comment <span class="comment"># 用户的描述信息</span></span><br><span class="line">createhom <span class="comment"># 是否创建家目录</span></span><br><span class="line">force <span class="comment"># 在使用`state=absent&#x27;是, 行为与`userdel ‐‐force&#x27;一致.</span></span><br><span class="line">group <span class="comment"># 指定基本组</span></span><br><span class="line"><span class="built_in">groups</span> <span class="comment"># 指定附加组，如果指定为(&#x27;groups=&#x27;)表示删除所有组</span></span><br><span class="line">home <span class="comment"># 指定用户家目录</span></span><br><span class="line">name <span class="comment"># 指定用户名</span></span><br><span class="line">password <span class="comment"># 指定用户密码</span></span><br><span class="line">remove <span class="comment"># 在使用 `state=absent&#x27;时, 行为是与 `userdel ‐‐remove&#x27;一致.</span></span><br><span class="line">shell <span class="comment"># 指定默认shell</span></span><br><span class="line">state <span class="comment">#设置帐号状态，不指定为创建，指定值为absent表示删除</span></span><br><span class="line">system <span class="comment"># 当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户</span></span><br><span class="line">uid <span class="comment">#指定用户的uid</span></span><br><span class="line">update_password <span class="comment"># 更新用户密码</span></span><br><span class="line">expires <span class="comment">#指明密码的过期时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">1.添加系统用户，指定uid、家目录、主组及注释</span><br><span class="line">ansible -m user -a <span class="string">&quot;system=yes name=zhangsan home=/home/zhangsan uid=111</span></span><br><span class="line"><span class="string">group=zhangsan comment=&#x27;hello zhangsan&#x27;&quot;</span> node1</span><br><span class="line">2.删除用户及家目录</span><br><span class="line">ansible -m user -a <span class="string">&quot;name=zhangsan state=absent remove=yes&quot;</span> node1</span><br></pre></td></tr></table></figure><h4 id="command模块"><a href="#command模块" class="headerlink" title="command模块"></a>command模块</h4><p>1.默认使用的模块<br>2.不支持管道，变量及重定向等 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-doc -s command</span></span><br><span class="line">- name: Execute commands on targets</span><br><span class="line">  <span class="built_in">command</span>:</span><br><span class="line">      argv:                  <span class="comment"># Passes the command as a list rather than a string. Use `argv&#x27; to avoid quoting values that would otherwise be interpreted incorrectly (for example &quot;user name&quot;). Only the string (free form) or the list (argv) form can be provided, not both.  One or the</span></span><br><span class="line">      </span><br><span class="line">                             <span class="comment"># other must be provided.</span></span><br><span class="line">      <span class="built_in">chdir</span>:                 <span class="comment"># Change into this directory before running the command.</span></span><br><span class="line">      cmd:                   <span class="comment"># The command to run.</span></span><br><span class="line">      creates:               <span class="comment"># A filename or (since 2.0) glob pattern. If a matching file already exists, this step *will not* be run. This is checked before `removes&#x27; is checked.</span></span><br><span class="line">      free_form:             <span class="comment"># The command module takes a free form string as a command to run. There is no actual parameter named &#x27;free form&#x27;.</span></span><br><span class="line">      removes:               <span class="comment"># A filename or (since 2.0) glob pattern. If a matching file exists, this step *will* be run. This is checked after `creates&#x27; is checked.</span></span><br><span class="line">      stdin:                 <span class="comment"># Set the stdin of the command directly to the specified value.</span></span><br><span class="line">      stdin_add_newline:     <span class="comment"># If set to `true&#x27;, append a newline to stdin data.</span></span><br><span class="line">      strip_empty_ends:      <span class="comment"># Strip empty lines from the end of stdout/stderr in result.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible -a &quot;touch /root/ansible.txt&quot; all-servers</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible -a &quot;find / -name ansible.txt&quot; all-servers</span></span><br></pre></td></tr></table></figure><h4 id="shell模块"><a href="#shell模块" class="headerlink" title="shell模块"></a>shell模块</h4><p>1.调用bash执行命令<br>2.但是某些复杂的操作即使使用shell也可能会失败 </p><ul><li>解决方法：将操作写到脚本中，通过script模块</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible -m shell -a &quot;find / -name ansible.txt&quot; all-servers</span></span><br></pre></td></tr></table></figure><h4 id="script模块"><a href="#script模块" class="headerlink" title="script模块"></a>script模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- free_form参数: 必须参数，指定需要执行的脚本，脚本位于 ansible 管理主机本地，并没有具体的一个参数名叫 free_form，具体解释请参考 <span class="built_in">command</span> 模块。</span><br><span class="line">- <span class="built_in">chdir</span>参数: 此参数的作用就是指定一个远程主机中的目录，在执行对应的脚本之前，会先进入到<span class="built_in">chdir</span> 参数指定的目录中。</span><br><span class="line">- creates参数: 使用此参数指定一个远程主机中的文件，当指定的文件存在时，就不执行对应脚本，可参考 <span class="built_in">command</span> 模块中的解释。</span><br><span class="line">- removes参数: 使用此参数指定一个远程主机中的文件，当指定的文件不存在时，就不执行对应脚本，可参考 <span class="built_in">command</span> 模块中的解释。</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vim test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 5`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">mkdir</span> -v /root/test_<span class="variable">$&#123;i&#125;</span>.txt</span><br><span class="line"><span class="built_in">rmdir</span> -v /root/test_<span class="variable">$&#123;i&#125;</span>.txt</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible -m script -a &#x27;/root/test.sh chdir=/tmp creates=test2&#x27; node2</span></span><br></pre></td></tr></table></figure><h4 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible-doc -s copy</span></span><br><span class="line">- backup：在覆盖之前，将源文件备份，备份文件包含时间信息。</span><br><span class="line">- content：用于替代“src”，可以直接设定指定文件的值</span><br><span class="line">- dest：必选项。要将源文件复制到的远程主机的绝对路径</span><br><span class="line">- directory_mode：递归设定目录的权限，默认为系统默认权限</span><br><span class="line">- force：强制覆盖目的文件内容，默认为<span class="built_in">yes</span></span><br><span class="line">- others：所有的file模块里的选项都可以在这里使用</span><br><span class="line">- src：被复制到远程主机的本地文件，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ansible -m copy -a &quot;src=/本地文件 dest=/远程文件&quot; nodes</span></span><br></pre></td></tr></table></figure><ul><li>在创建文件时修改文件的属主和属组信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible -m copy -a &quot;src=/root/test.sh dest=/root/test1 owner=zhangsan group=eagles&quot; node1</span></span><br></pre></td></tr></table></figure><ul><li>在传输文件时修改文件的权限信息，并且备份远程主机文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible -m copy -a &quot;src=/root/test.sh dest=/root/test1 backup=yes mode=777&quot; node1</span></span><br></pre></td></tr></table></figure><ul><li>创建一个文件并直接编辑文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible -m copy -a &quot;content=&#x27;hello eagles\n&#x27; dest=/root/test1&quot; node1</span></span><br></pre></td></tr></table></figure><h4 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ansible‐doc ‐s file</span></span><br><span class="line">‐ name: Manage files and file properties</span><br><span class="line">  <span class="comment">#access_time: 设置文件的访问时间。可以设置为 preserve（不修改）、YYYYMMDDHHMM.SS（默认时间格式）或 now（当前时间）。默认值为 None，表示 state 为 file、directory、link 或 hard 时使用 preserve，而 state 为 touch 时使用 now。</span></span><br><span class="line">  <span class="comment">#access_time_format: 与 access_time 一起使用时，指定时间格式，基于默认的 Python 格式。</span></span><br><span class="line">  <span class="comment">#attributes: 指定文件系统对象应具有的属性。可以参考目标系统上 chattr 的手册页获取支持的标志。</span></span><br><span class="line">  <span class="comment">#follow: 指示是否跟随文件系统链接。follow=yes 和 state=link 可以在与其他参数（如 mode）结合时修改 src。</span></span><br><span class="line">  <span class="comment">#force: 强制创建符号链接的条件：源文件不存在（但将来会出现）或目标存在且是文件（需要解除链接并创建符号链接）。</span></span><br><span class="line">  <span class="comment">#group: 指定应拥有文件系统对象的组名，类似于 chown 命令。如果未指定，则使用当前用户的组，除非是 root 用户。</span></span><br><span class="line">  <span class="comment">#mode: 指定文件系统对象的权限。可以使用八进制数字表示，需加前导零或用引号括起来。未指定时，使用系统的默认 umask。</span></span><br><span class="line">  <span class="comment">#modification_time: 设置文件的修改时间，参数和 access_time 类似。</span></span><br><span class="line">  <span class="comment">#modification_time_format: 与 modification_time 一起使用时，指定时间格式。</span></span><br><span class="line">  <span class="comment">#owner: 指定应拥有文件系统对象的用户名，类似于 chown。未指定时使用当前用户。</span></span><br><span class="line">  <span class="comment">#path: （必需）要管理的文件路径。</span></span><br><span class="line">  <span class="comment">#recurse: 递归设置目录内容的指定文件属性，仅在 state 设置为 directory 时适用。</span></span><br><span class="line">  <span class="comment">#selevel: SELinux 文件系统对象上下文的级别部分。</span></span><br><span class="line">  <span class="comment">#serole: SELinux 文件系统对象上下文的角色部分。</span></span><br><span class="line">  <span class="comment">#setype: SELinux 文件系统对象上下文的类型部分。</span></span><br><span class="line">  <span class="comment">#seuser: SELinux 文件系统对象上下文的用户部分。</span></span><br><span class="line">  <span class="comment">#src: 要链接的文件路径，仅适用于 state=link 和 state=hard。</span></span><br><span class="line">  <span class="comment">#unsafe_writes: 影响何时使用原子操作以防止数据损坏或不一致的读取。默认情况下，模块使用原子操作，但在某些情况下可能会失败，此时可以选择不安全的写入方式。</span></span><br><span class="line">  <span class="comment">#state,指定文件的状态，如:</span></span><br><span class="line">    absent: 删除文件</span><br><span class="line">    directory：如果目录不存在，就创建目录</span><br><span class="line">    file：验证文件是否存在，即使文件不存在，也不会被创建</span><br><span class="line">    <span class="built_in">link</span>：创建软链接</span><br><span class="line">    hard：创建硬链接</span><br><span class="line">  <span class="comment">#touch：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其后修改时间</span></span><br></pre></td></tr></table></figure><ul><li>创建目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m file -a &quot;name=test1 owner=root group=root mode=644 state=directory&quot; node1</span></span><br></pre></td></tr></table></figure></li><li>创建文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m file -a &quot;path=/root/test2 owner=root group=root mode=644 state=touch&quot; node1</span></span><br></pre></td></tr></table></figure></li><li>删除文件&#x2F;目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m file -a &quot;path=/root/test2 state=absent&quot; node1</span></span><br></pre></td></tr></table></figure></li><li>创建软链接文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m file -a &quot;src=/root/test1 dest=/root/test2 state=link&quot; node2</span></span><br></pre></td></tr></table></figure></li><li>创建硬链接文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m file -a &quot;src=/root/test.txt dest=/root/test2 state=hard&quot; node2</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a>yum模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible-doc -s yum</span></span><br><span class="line">conf_file            <span class="comment">#设定远程yum安装时所依赖的配置文件。如配置文件没有在默认的位置。</span></span><br><span class="line">disable_gpg_check    <span class="comment">#是否禁止GPG checking，只用于`present&#x27; or `latest&#x27;。</span></span><br><span class="line">disablerepo          <span class="comment">#临时禁止使用yum库。 只用于安装或更新时。</span></span><br><span class="line">enablerepo           <span class="comment">#临时使用的yum库。只用于安装或更新时。</span></span><br><span class="line">name=                <span class="comment">#所安装的包的名称</span></span><br><span class="line">state                <span class="comment">#present安装， latest安装新的, absent 卸载软件。</span></span><br><span class="line">update_cache         <span class="comment">#强制更新yum的缓存</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m yum -a &quot;name=httpd state=latest&quot; all</span></span><br><span class="line"></span><br><span class="line">192.168.190.20 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Installed: apr-util-openssl-1.6.1-23.el9.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: apr-util-bdb-1.6.1-23.el9.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: apr-util-1.6.1-23.el9.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: mailcap-2.1.49-5.el9.noarch&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: mod_lua-2.4.57-11.el9_4.1.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: httpd-tools-2.4.57-11.el9_4.1.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: httpd-2.4.57-11.el9_4.1.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: mod_http2-2.0.26-2.el9_4.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: httpd-filesystem-2.4.57-11.el9_4.1.noarch&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: httpd-core-2.4.57-11.el9_4.1.x86_64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: rocky-logos-httpd-90.15-2.el9.noarch&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Installed: apr-1.7.0-12.el9_3.x86_64&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a>service模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible-doc -s service</span></span><br><span class="line">arguments <span class="comment">#命令行提供额外的参数</span></span><br><span class="line">enabled   <span class="comment">#设置开机启动，可以设置为yes或者no。</span></span><br><span class="line">name=     <span class="comment">#服务名称</span></span><br><span class="line">runlevel  <span class="comment">#开机启动的级别，一般不用指定。</span></span><br><span class="line"><span class="built_in">sleep</span>     <span class="comment">#在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。</span></span><br><span class="line">state     <span class="comment">#started启动服务， stopped停止服务， restarted重启服务， reloaded重载配置</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m service -a &quot;name=httpd state=restarted&quot; all</span></span><br><span class="line">192.168.190.20 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;httpd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;started&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ActiveEnterTimestampMonotonic&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ActiveExitTimestampMonotonic&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ActiveState&quot;</span>: <span class="string">&quot;failed&quot;</span>,</span><br><span class="line">        <span class="string">&quot;After&quot;</span>: <span class="string">&quot;nss-lookup.target httpd-init.service network.target -.mount tmp.mount systemd-journald.socket remote-fs.target systemd-tmpfiles-setup.service sysinit.target basic.target system.slice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AllowIsolate&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AssertResult&quot;</span>: <span class="string">&quot;yes&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AssertTimestamp&quot;</span>: <span class="string">&quot;Wed 2024-09-11 21:38:04 CST&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AssertTimestampMonotonic&quot;</span>: <span class="string">&quot;1363630539&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Before&quot;</span>: <span class="string">&quot;shutdown.target&quot;</span>,</span><br><span class="line">        <span class="string">&quot;BlockIOAccounting&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">        <span class="string">&quot;BlockIOWeight&quot;</span>: <span class="string">&quot;[not set]&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CPUAccounting&quot;</span>: <span class="string">&quot;yes&quot;</span>,</span><br><span class="line">        ........</span><br></pre></td></tr></table></figure><h4 id="selinux模块"><a href="#selinux模块" class="headerlink" title="selinux模块"></a>selinux模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># selinux模块针对selinux的修改操作是针对配置文件进行修改的</span></span><br><span class="line">‐ name: Change policy and state of SELinux</span><br><span class="line"></span><br><span class="line">selinux:</span><br><span class="line">configfile: <span class="comment"># path to the SELinux configuration file, if non‐standard</span></span><br><span class="line">policy: <span class="comment"># name of the SELinux policy to use</span></span><br><span class="line">state: <span class="comment"># (required) The SELinux mode</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m selinux -a &quot;state=disabled policy=targeted&quot; all</span></span><br><span class="line">192.168.190.20 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;configfile&quot;</span>: <span class="string">&quot;/etc/selinux/config&quot;</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Config SELinux state changed from &#x27;enforcing&#x27; to &#x27;disabled&#x27;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;policy&quot;</span>: <span class="string">&quot;targeted&quot;</span>,</span><br><span class="line">    <span class="string">&quot;reboot_required&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="setup模块"><a href="#setup模块" class="headerlink" title="setup模块"></a>setup模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ansible -m setup all   #获取远程主机的详细信息,很长一般没必要</span></span><br><span class="line">192.168.190.20 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ansible_all_ipv4_addresses&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;192.168.190.20&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;ansible_all_ipv6_addresses&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;fe80::20c:29ff:fe7d:14d9&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;ansible_apparmor&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;status&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">.............</span><br></pre></td></tr></table></figure><h2 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a>Playbook</h2><p>playbook是由一个或者多个play组成的列表，可以让这些列表按事先编排的机制执行；所谓task是调用ansible的具体模块，在模块参数中可以使用变量。模块执行是幂等性的，意味着多次执行结果相同。使用yaml语言编写playbook，后缀名一般为.yml</p><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><p>yaml语言的参考博客：<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">http://www.ruanyifeng.com/blog/2016/07/yaml.html</a></p><ul><li>yaml的可读性好</li><li>yaml和脚本语言的交互性好</li><li>yaml使用实现语言的数据类型</li><li>yaml有一个一致性的信息模型</li><li>yaml易于实现</li><li>yaml可以基于流来处理</li></ul><h3 id="核心字段"><a href="#核心字段" class="headerlink" title="核心字段"></a>核心字段</h3><ul><li>hosts：执行的远程主机列表</li><li>tasks：任务，由模块定义操作列表</li><li>variables：内置变量或者自定义变量</li><li>templates：模板，定义模板文件，模板文件一般是由jinja2语言编写的</li><li>handlers：和nogity结合使用，为条件触发操作，满足条件则执行</li><li>roles：角色</li></ul><h3 id="案例说明"><a href="#案例说明" class="headerlink" title="案例说明"></a>案例说明</h3><h4 id="案例1：安装软件"><a href="#案例1：安装软件" class="headerlink" title="案例1：安装软件"></a>案例1：安装软件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装nginx</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">使用yum安装nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure><ul><li>或者用shell模块</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装nginx</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">使用shell安装nginx</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&quot;yum install nginx -y&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-安装nginx并且修改配置文件"><a href="#2-安装nginx并且修改配置文件" class="headerlink" title="2.安装nginx并且修改配置文件"></a>2.安装nginx并且修改配置文件</h4><ul><li>第一步，准备文件存放目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /root/playbook/file</span><br></pre></td></tr></table></figure><ul><li>第二步，书写YAML文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/playbook</span><br><span class="line">vim install_nginx.yaml</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Update</span> <span class="string">web</span> <span class="string">servers</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">epel</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">epel-release.noarch</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">nginx</span> <span class="string">configure</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/root/playbook/file/site.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/site.conf</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">index.html</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">echo</span> <span class="string">&quot;nginx1&quot;</span> <span class="string">&gt;</span> <span class="string">/usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure><ul><li>第三步，准备配置文件site.conf</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/playbook/file</span><br><span class="line">vim site.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name 192.168.190.20:80;</span><br><span class="line">location / &#123;</span><br><span class="line">index index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>第四步，检查语法错误，没有错误则继续执行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 playbook]<span class="comment"># ansible-playbook install_nginx.yaml --syntax-check</span></span><br><span class="line">playbook: install_nginx.yaml</span><br><span class="line"></span><br><span class="line">[root@server1 playbook]<span class="comment"># ansible-playbook install_nginx.yaml</span></span><br></pre></td></tr></table></figure><ul><li>第五步，curl看一下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 playbook]<span class="comment"># curl 192.168.190.20:80</span></span><br><span class="line">nginx1</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Ansible自动化运维工具</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Rsync备份服务实战</title>
    <link href="http://example.com/2024/09/11/3.rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/"/>
    <id>http://example.com/2024/09/11/3.rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/</id>
    <published>2024-09-11T01:25:00.000Z</published>
    <updated>2024-09-11T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Rsync备份服务实战"><a href="#Rsync备份服务实战" class="headerlink" title="Rsync备份服务实战"></a>Rsync备份服务实战</h1><h2 id="1-Rsync基本概述"><a href="#1-Rsync基本概述" class="headerlink" title="1.Rsync基本概述"></a>1.Rsync基本概述</h2><ul><li>rsync是一款开源的备份工具，可以在不同主机之间进行同步，可实现全量备份与增量备份，因此非常适合用于架构集中式备份或异地备份等应用  </li><li>rsync官方地址：传送门<a href="http://rsync.samba.org/">http://rsync.samba.org/</a>  </li><li>rsync监听端口：873  </li><li>rsync运行模式：C&#x2F;S</li></ul><p><strong>既然需要备份，那么我们应该了解备份的方式</strong><br>假设客户端上有file1 file2 file3文件，服务端上有file1文件，现要将客户端上的数据备份至服务端</p><ul><li>完全备份，将客户端所有的数据内容file1 file2 file3全部备份至服务端 (效率低下, 占用空间)</li></ul><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240911171815.png"></p><ul><li>增量备份，将客户端的file2 file3增量备份至服务端 (提高备份效率,节省空间, 适合异地备份 )</li></ul><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/1700126348476.png"></p><h2 id="2-Rsync应用场景"><a href="#2-Rsync应用场景" class="headerlink" title="2.Rsync应用场景"></a>2.Rsync应用场景</h2><p>前面我们了解过备份的方式，下面我们需要了解Rsync的数据同步模式<br><strong>1、</strong> 推:所有主机推送本地数据至Rsync备份服务器，会导致数据同步缓慢(适合少量数据备份)；<br>  <img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/1700126349384.png"><br><strong>2、</strong> 拉:Rsync备份服务端拉取所有主机上的数据，会导致备份服务器开销大；<br>  <img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/1700126350836.png"><br><strong>3、</strong> 大量服务器备份场景；<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/1700126352081.png" style="zoom: 67%;" /><br><strong>4、</strong> 异地备份实现思路；<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/1700126355210.png" style="zoom:67%;" /></p><h2 id="3-Rsync传输模式"><a href="#3-Rsync传输模式" class="headerlink" title="3.Rsync传输模式"></a>3.Rsync传输模式</h2><p>Rsync使用三种主要的数据传输方式 </p><ul><li>本地方式 </li><li>远程方式 </li><li>守护进程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、Local: rsync [OPTION...] SRC... [DEST]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2、Access via remote shell:</span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]</span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、Access via rsync daemon:</span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]</span><br><span class="line">rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]</span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST::DEST</span><br><span class="line">rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST</span><br></pre></td></tr></table></figure><h3 id="3-1-本地传输方式"><a href="#3-1-本地传输方式" class="headerlink" title="3.1.本地传输方式"></a>3.1.本地传输方式</h3><p><strong>本地拷贝数据命令：单个主机本地之间的数据传输(此时类似于cp命令)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Local:  rsync [OPTION] [SRC] [DEST]</span><br><span class="line"><span class="comment">#命令解析</span></span><br><span class="line">rsync      备份命令(<span class="built_in">cp</span>)</span><br><span class="line">[options]  选项</span><br><span class="line">[SRC]     本地源文件</span><br><span class="line">[DEST]     本地目标文件</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#本地拷贝数据示例</span></span><br><span class="line">[root@backup ~]<span class="comment"># rsync  -avz  /etc/passwd  /tmp/</span></span><br></pre></td></tr></table></figure><ul><li>说明</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz /tmp1/ /mnt/</span><br><span class="line"><span class="comment"># 若/tmp1后边不加斜线，则会将tmp1目录给及目录内容拷贝过去</span></span><br><span class="line"><span class="comment"># 若/tmp1/ 后边加了斜线，则会将tmp1目录下的内容给拷贝过去，而不会拷贝tmp1目录</span></span><br></pre></td></tr></table></figure><h3 id="3-2-远程通道传输方式"><a href="#3-2-远程通道传输方式" class="headerlink" title="3.2.远程通道传输方式"></a>3.2.远程通道传输方式</h3><p><strong>通过ssh通道传输数据,类似scp命令</strong></p><h4 id="pull拉取数据命令"><a href="#pull拉取数据命令" class="headerlink" title="pull拉取数据命令"></a>pull拉取数据命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pull拉取数据命令</span></span><br><span class="line">Pull: rsync [OPTION] [USER@]HOST:SRC [DEST]</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令解析</span></span><br><span class="line">Pull       拉取, 下载</span><br><span class="line">rsync      备份命令</span><br><span class="line">[options]  选项</span><br><span class="line">[USER@]    目标主机的系统用户</span><br><span class="line">HOST       目主机IP地址或域名</span><br><span class="line">SRC        目标主机源文件</span><br><span class="line">[DEST]     下载至本地哪个位置</span><br></pre></td></tr></table></figure><ul><li>pull拉取数据示例</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pull拉取数据示例</span></span><br><span class="line">[root@backup ~]<span class="comment"># rsync -avz root@192.168.47.20:/etc/hostname ./  拉取远程文件</span></span><br><span class="line">[root@backup ~]<span class="comment"># rsync -avz root@192.168.47.20:/root/ /backup/  拉取远程目录下的所有文件</span></span><br><span class="line">[root@backup ~]<span class="comment"># rsync -avz root@192.168.47.20:/root /backup/   拉取远程目录以及目录下的所有文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="push推送数据命令"><a href="#push推送数据命令" class="headerlink" title="push推送数据命令"></a>push推送数据命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#push推送数据命令</span></span><br><span class="line">Push: rsync [OPTION] SRC [USER@]HOST:DEST</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令解析</span></span><br><span class="line">Push       推送, 上传</span><br><span class="line">rsync      备份命令</span><br><span class="line">[options]  选项</span><br><span class="line">SRC        本地源文件</span><br><span class="line">[USER@]    目标主机的系统用户</span><br><span class="line">HOST       目主机IP地址或域名</span><br><span class="line">[DEST]     目标对应位置</span><br></pre></td></tr></table></figure><ul><li>push推送数据示例</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#push推送数据示例</span></span><br><span class="line">rsync -avz ./ root@192.168.47.20:/tmp/</span><br></pre></td></tr></table></figure><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>Rsync借助SSH协议同步数据存在的缺陷</p><ul><li>1.使用系统用户（不安全）</li><li>2.使用普通用户（会导致权限不足情况）</li></ul><h3 id="3-3-守护进程传输方式"><a href="#3-3-守护进程传输方式" class="headerlink" title="3.3.守护进程传输方式"></a>3.3.守护进程传输方式</h3><p><strong>rsync自身非常重要的功能(不使用系统用户，更加安全)；daemon模式是以守护进程（socket）的方式传输数据（熟练掌握部署服务） ；把daemon搭载备份服务器上，客户端直接推送到备份服务器上就行</strong></p><ul><li><strong>详细设置见下面的实验过程，要设置十分详细</strong></li></ul><h4 id="pull拉取数据命令-1"><a href="#pull拉取数据命令-1" class="headerlink" title="pull拉取数据命令"></a>pull拉取数据命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pull拉取数据命令</span></span><br><span class="line">Pull: rsync [OPTION] [USER@]HOST::SRC [DEST]</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令解析</span></span><br><span class="line">rsync          命令</span><br><span class="line">[OPTION]       选项</span><br><span class="line">[USER@]        远程主机用户(虚拟用户)</span><br><span class="line">HOST::         远程主机地址  </span><br><span class="line">SRC            远程主机模块(不是目录)</span><br><span class="line">[DEST]         将远程主机数据备份至本地什么位置</span><br></pre></td></tr></table></figure><ul><li>拉取rsync备份服务的”backup模块”数据至本地&#x2F;mnt目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.拉取rsync备份服务的&quot;backup模块&quot;数据至本地/mnt目录</span></span><br><span class="line">[root@master ~]<span class="comment"># rsync -avz rsync_backup@192.192.168.47.20::backup/ /mnt/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><h4 id="push推送数据命令-1"><a href="#push推送数据命令-1" class="headerlink" title="push推送数据命令"></a>push推送数据命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#push推送数据命令</span></span><br><span class="line">Push: rsync [OPTION] SRC [USER@]HOST::DEST</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令解析</span></span><br><span class="line">rsync          命令</span><br><span class="line">[OPTION]       选项</span><br><span class="line">SRC            远程主机模块(不是目录)</span><br><span class="line">[USER@]        远程主机用户(虚拟用户)</span><br><span class="line">HOST::         远程主机地址</span><br><span class="line">[DEST]         将远程主机模块备份至本地什么位置</span><br></pre></td></tr></table></figure><ul><li>将本地&#x2F;mnt目录推送至rsync备份服务器的backup模块</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2.将本地/mnt目录推送至rsync备份服务器的backup模块</span></span><br><span class="line">[root@master ~]<span class="comment"># rsync -avz /mnt/ rsync_backup@192.192.168.47.20::backup/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><h3 id="3-4-Rsync命令对应选项"><a href="#3-4-Rsync命令对应选项" class="headerlink" title="3.4.Rsync命令对应选项"></a>3.4.Rsync命令对应选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">-a          归档模式传输, 等于-tropgDl</span><br><span class="line">-v          详细模式输出, 打印速率, 文件数量等</span><br><span class="line">-z          传输时进行压缩以提高效率</span><br><span class="line">-r          递归传输目录及子目录，即目录下得所有目录都同样传输</span><br><span class="line">-t          保持文件时间信息</span><br><span class="line">-o          保持文件属主信息</span><br><span class="line">-p          保持文件权限</span><br><span class="line">-g          保持文件属组信息</span><br><span class="line">-l          保留软连接</span><br><span class="line">-P          显示同步的过程及传输时的进度等信息</span><br><span class="line">-D          保持设备文件信息</span><br><span class="line">-L          保留软连接指向的目标文件</span><br><span class="line">-e          使用的信道协议,指定替代rsh的shell程序</span><br><span class="line">--exclude=PATTERN   指定排除不需要传输的文件模式</span><br><span class="line">--exclude-from=file 文件名在file文件中的</span><br><span class="line">--bwlimit=100       限速传输</span><br><span class="line">--partial           断点续传</span><br><span class="line">--delete            让目标目录和源目录数据保持一致</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#详细如下：</span></span><br><span class="line">1.rsync source_dir destination_dir       <span class="comment">#将源目录下的文件和文件夹同步到目标目录</span></span><br><span class="line">2.rsync -a source_dir destination_dir    <span class="comment">#以归档模式同步目录，保留文件属性和权限</span></span><br><span class="line">3.rsync -v source_dir destination_dir    <span class="comment">#输出详细的同步过程信息</span></span><br><span class="line">4.rsync -r source_dir destination_dir    <span class="comment">#递归同步目录及其子目录</span></span><br><span class="line">5.rsync -z source_dir destination_dir    <span class="comment">#启用压缩功能，减少数据传输量</span></span><br><span class="line">6.rsync -c source_dir destination_dir    <span class="comment">#通过比较校验和来检测文件是否已更改</span></span><br><span class="line">7.rsync --delete source_dir destination_dir  <span class="comment">#在目标目录中删除那些源目录中不存在的文件</span></span><br><span class="line">8.rsync --exclude=<span class="string">&#x27;pattern&#x27;</span> source_dir destination_dir <span class="comment">#排除与指定模式匹配的文件或文件夹</span></span><br><span class="line">9.rsync --exclude-from=<span class="string">&#x27;file&#x27;</span> source_dir destination_dir  <span class="comment">#从指定文件中读取排除模式，并进行同步</span></span><br><span class="line">10.rsync --include=<span class="string">&#x27;pattern&#x27;</span> source_dir destination_dir  <span class="comment">#只包括与指定模式匹配的文件或文件夹</span></span><br><span class="line">11.rsync --include-from=<span class="string">&#x27;file&#x27;</span> source_dir destination_dir  <span class="comment">#从指定文件中读取包含模式，并进行同步</span></span><br><span class="line">12.rsync --progress source_dir destination_dir  <span class="comment">#显示同步进度和速度信息</span></span><br><span class="line">13.rsync --dry-run source_dir destination_dir   <span class="comment">#模拟同步操作，显示将要发生的更改，但不实际执行</span></span><br><span class="line">14.rsync --bwlimit=KBPS source_dir destination_dir  <span class="comment">#限制带宽使用率，以 KB/s 为单位</span></span><br><span class="line">15.rsync --size-only source_dir destination_dir    <span class="comment">#仅通过文件大小来判断是否需要同步</span></span><br><span class="line">16.rsync --checksum source_dir destination_dir     <span class="comment">#通过强制进行完整校验和判断是否需要同步</span></span><br><span class="line">17.rsync --delete-excluded source_dir destination_dir <span class="comment">#在同时使用 --exclude 和 --delete 时，删除被排除的文件</span></span><br><span class="line">18.rsync --backup source_dir destination_dir   <span class="comment">#备份目标目录中已存在的文件</span></span><br><span class="line">19.rsync --backup-dir=DIR source_dir destination_dir  <span class="comment">#将目标目录中的已存在的文件备份到指定目录</span></span><br><span class="line">20.rsync --link-dest=DIR source_dir destination_dir   <span class="comment">#创建硬链接到已存在的文件，减少空间占用</span></span><br><span class="line">21.rsync --ignore-existing source_dir destination_dir <span class="comment">#忽略目标目录中已存在的文件</span></span><br><span class="line">22.rsync --<span class="built_in">timeout</span>=TIME source_dir destination_dir    <span class="comment">#设置连接超时时间</span></span><br><span class="line">23.rsync --progress --partial source_dir destination_dir  <span class="comment">#允许在中断后重新传输，同时显示实时进度</span></span><br><span class="line">24.rsync -n --itemize-changes source_dir destination_dir  <span class="comment">#显示将要发生的更改的详细列表，但不实际执行操作</span></span><br><span class="line">25.rsync -a --exclude=<span class="string">&#x27;pattern1&#x27;</span> --exclude=<span class="string">&#x27;pattern2&#x27;</span> source_dir destination_dir<span class="comment">#排除多个模式的文件或文件夹</span></span><br><span class="line">26.rsync -avzP source_dir remote_server:destination_dir  <span class="comment">#将源目录同步到远程服务器上的目标目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将源目录同步到远程服务器上的目标目录，并删除远程目录中不存在的文件</span></span><br><span class="line">27.rsync -a --delete source_dir remote_server:destination_dir </span><br><span class="line"></span><br><span class="line">28.rsync -a --dry-run --delete source_dir destination_dir  <span class="comment">#模拟同步操作，在目标目录中显示将要被删除的文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从指定文件中读取排除模式，并将源目录同步到远程服务器上的目标目录</span></span><br><span class="line">29rsync -a --exclude-from=<span class="string">&#x27;file&#x27;</span> source_dir remote_server:destination_dir  </span><br><span class="line"></span><br><span class="line">30.rsync -rltDv source_dir remote_server:destination_dir  <span class="comment">#同步目录，并保持目录结构和权限，但不同步文件的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#只同步指定类型的文件，排除其他所有文件</span></span><br><span class="line">31.rsync -avz --include=<span class="string">&#x27;*.txt&#x27;</span> --include=<span class="string">&#x27;*.doc&#x27;</span> --exclude=<span class="string">&#x27;*&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 .gitignore 文件中定义的过滤规则进行同步</span></span><br><span class="line">32.rsync -a --filter=<span class="string">&#x27;:- .gitignore&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#将已存在的文件创建硬链接，并备份到指定目录</span></span><br><span class="line">33.rsync -a --link-dest=DIR --backup-dir=DIR source_dir destination_dir</span><br><span class="line"></span><br><span class="line">34.rsync -a --exclude=<span class="string">&#x27;.git/&#x27;</span> source_dir destination_dir  <span class="comment">#排除 .git 文件夹及其内容</span></span><br><span class="line">35.rsync -a --max-size=<span class="string">&#x27;100K&#x27;</span> source_dir destination_dir  <span class="comment">#仅同步小于 100KB 的文件</span></span><br><span class="line">36.rsync -a --min-size=<span class="string">&#x27;1M&#x27;</span> source_dir destination_dir    <span class="comment">#仅同步大于 1MB 的文件</span></span><br><span class="line">37.rsync -av --bwlimit=500 source_dir destination_dir     <span class="comment">#在同步过程中限制带宽使用率为 500 KB/s</span></span><br><span class="line">38.rsync -a --include=<span class="string">&#x27;*/&#x27;</span> --exclude=<span class="string">&#x27;*&#x27;</span> source_dir destination_dir   <span class="comment">#只同步文件夹，忽略文件</span></span><br><span class="line">39.rsync -a --prune-empty-dirs source_dir destination_dir    <span class="comment">#忽略空文件夹</span></span><br><span class="line">40.rsync -avzP --log-file=<span class="string">&#x27;log.txt&#x27;</span> source_dir destination_dir   <span class="comment">#将同步过程信息记录到指定的日志文件中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排除所有的 .txt 文件，并在目标目录中删除已排除的文件</span></span><br><span class="line">41.rsync -a --exclude=<span class="string">&#x27;*.txt&#x27;</span> --delete-excluded source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#将源目录同步到远程服务器上的目标目录，并创建硬链接到已存在的文件，但排除所有的.txt 文件</span></span><br><span class="line">42.rsync -a --link-dest=DIR --exclude=<span class="string">&#x27;*.txt&#x27;</span> source_dir remote_server:destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#只同步 .txt 文件，排除 .doc 文件，并将源目录同步到远程服务器上的目标目录</span></span><br><span class="line">43.rsync -a --include=<span class="string">&#x27;*.txt&#x27;</span> --exclude=<span class="string">&#x27;*.doc&#x27;</span> source_dir remote_server:destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#排除所有的 .txt 文件和 exclude_folder/ 文件夹，并将源目录同步到远程服务器上的目标目录</span></span><br><span class="line">44.rsync -a --exclude=<span class="string">&#x27;*.txt&#x27;</span> --exclude=<span class="string">&#x27;exclude_folder/&#x27;</span> source_dir remote_server:destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#从指定文件中读取排除模式，并模拟同步操作，但不实际执行</span></span><br><span class="line">45.rsync -n --exclude-from=<span class="string">&#x27;exclude.txt&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#排除与指定模式匹配的文件或文件夹，并在远程服务器上的目标目录中删除已排除的文件</span></span><br><span class="line">46.rsync -a --exclude=<span class="string">&#x27;pattern&#x27;</span> --delete-excluded source_dir remote_server:destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#忽略目标目录中已存在的文件，并仅通过文件大小来判断是否需要同步</span></span><br><span class="line">47.rsync -a --ignore-existing --size-only source_dir destination_dir</span><br><span class="line"></span><br><span class="line">48.rsync -a --remove-source-files source_dir destination_dir    <span class="comment">#在同步后将源目录中已同步的文件删除</span></span><br><span class="line"></span><br><span class="line">49.rsync -a --filter=<span class="string">&#x27;P /pattern/&#x27;</span> source_dir destination_dir<span class="comment">#使用自定义过滤规则进行同步，其中包含正则表达式模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用自定义过滤规则进行同步，其中包含扩展的正则表达式模式</span></span><br><span class="line">50.rsync -a --filter=<span class="string">&#x27;R /pattern/&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line">51.rsync -a --filter=<span class="string">&#x27;S /from/to/&#x27;</span> source_dir destination_dir<span class="comment">#使用自定义过滤规则进行同步，其中包含字符串替换规则</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用自定义过滤规则进行同步，其中包含全局字符串替换规则</span></span><br><span class="line">52.rsync -a --filter=<span class="string">&#x27;A /from/to/&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line">53.rsync -a --<span class="built_in">chmod</span>=MODE source_dir destination_dir  <span class="comment">#按照指定的权限模式设置同步后目标文件的权限</span></span><br><span class="line">54.rsync -a --<span class="built_in">chown</span>=USER:GROUP source_dir destination_dir  <span class="comment">#按照指定的用户和组设置同步后目标文件的所有者</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排除多个模式的文件或文件夹，并从指定文件中读取排除模式，并在目标目录中删除已排除的文件</span></span><br><span class="line">55.rsync -a --exclude=<span class="string">&#x27;pattern&#x27;</span> --exclude-from=<span class="string">&#x27;file&#x27;</span> --delete-excluded source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#只包括与指定模式匹配的文件或文件夹，并从指定文件中读取包含模式，同时排除其他所有文件</span></span><br><span class="line">56.rsync -a --include=<span class="string">&#x27;pattern&#x27;</span> --include-from=<span class="string">&#x27;file&#x27;</span> --exclude=<span class="string">&#x27;*&#x27;</span> source_dir destination_dir</span><br><span class="line"></span><br><span class="line">57.rsync -a --skip-compress=EXT source_dir destination_dir   <span class="comment">#跳过指定扩展名的文件压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改时间窗口大小，用于处理 FAT 文件系统的时间戳问题</span></span><br><span class="line">58.rsync -a --modify-window=SECONDS source_dir destination_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#将已存在的文件备份到指定目录，并添加自定义后缀</span></span><br><span class="line">59.rsync -a --backup-dir=backup --suffix=.old source_dir/ destination_dir/</span><br><span class="line"></span><br><span class="line">60.rsync --version：显示 rsync 的版本信息</span><br></pre></td></tr></table></figure><h2 id="4-Rsync服务实践"><a href="#4-Rsync服务实践" class="headerlink" title="4.Rsync服务实践"></a>4.Rsync服务实践</h2><table><thead><tr><th align="center">主机角色</th><th align="center">主机名称</th><th align="center">内网IP(LAN)</th></tr></thead><tbody><tr><td align="center">Rsync服务端</td><td align="center">slave</td><td align="center">192.168.47.20</td></tr><tr><td align="center">Rsync客户端</td><td align="center">master主机</td><td align="center">192.168.47.10</td></tr></tbody></table><h3 id="服务端（备份机）设置"><a href="#服务端（备份机）设置" class="headerlink" title="服务端（备份机）设置"></a>服务端（备份机）设置</h3><ul><li><strong>(1)在Slave服务器上安装Rsync</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># yum -y install rsync</span></span><br></pre></td></tr></table></figure><ul><li><strong>(2)在Slave服务器上配置rsync</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># vim /etc/rsyncd.conf</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line">max connections = 36000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file =/var/run/rsyncd.pid</span><br><span class="line">lock file =/var/run/rsync.lock</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors = no</span><br><span class="line"><span class="built_in">read</span> only = no</span><br><span class="line">list = no</span><br><span class="line">hosts allow = 192.168.1.175</span><br><span class="line">hosts deny = *</span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file =/etc/rsync.password</span><br><span class="line">[backup]</span><br><span class="line">path = /backup/sersync/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置注解:</span></span><br><span class="line"><span class="comment"># uid:指定传输文件时的用户</span></span><br><span class="line"><span class="comment"># gid:指定传输文件时的组</span></span><br><span class="line"><span class="comment"># use chroot true|falsD:表示在传输文件前首先chroot到path参数所指定的目录下,可以实现安全防护,但缺点是需要以root权限,并且不能备份指向外部的符号连接所指向的目录文件,默认情况下chroot值为true</span></span><br><span class="line"><span class="comment"># max connections:指定最大的连接数,默认是0,即没有限制</span></span><br><span class="line"><span class="comment"># read only ture|falsD:如果为true,则不能上传到该模块指定的路径下</span></span><br><span class="line"><span class="comment"># list:表示当用户查询该服务器上的可用模块时,该模块是否被列出,true为列出,false为隐藏</span></span><br><span class="line"><span class="comment"># auth users:指定传输时要使用的用户名</span></span><br><span class="line"><span class="comment"># secrets filD:指定密码文件,注意该密码文件的权限一定要是600,格式:用户名:密码</span></span><br><span class="line"><span class="comment"># hosts allow:是允许同步的主机,可以是IP或者网段,如果是多个中间用空格隔开</span></span><br><span class="line"><span class="comment"># hosts deny:拒绝同步的主机,可以是IP或者网段,如果是多个中间用空格隔开</span></span><br><span class="line"><span class="comment"># [backup]:同步的模块名</span></span><br><span class="line"><span class="comment"># path:同步的路径</span></span><br></pre></td></tr></table></figure><ul><li><strong>(3)创建同步的用户与密码的文件</strong></li></ul><p>即rsyncd.conf中secrets file这个配置选项中的文件&#x2F;etc&#x2F;rsync.passwd,同进要设置rsync.password的权限为600</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># echo &quot;rsync_backup:123456&quot; &gt;/etc/rsync.password</span></span><br><span class="line">[root@slave ~]<span class="comment"># chmod 600 /etc/rsync.password</span></span><br></pre></td></tr></table></figure><ul><li><strong>(4)创建同步的目录</strong></li></ul><p>即rsyncd.conf中path配置选项中的目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># mkdir -p /backup/sersync</span></span><br></pre></td></tr></table></figure><ul><li><strong>(5)启动守护进程,并写入开机自启动</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># rsync --daemon --config=/etc/rsyncd.conf </span></span><br><span class="line">[root@slave ~]<span class="comment"># echo &quot;rsync --daemon --config=/etc/rsyncd.conf&quot; &gt;&gt;/etc/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># tail -1 /etc/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># reboot</span></span><br><span class="line">[root@slave ~]<span class="comment"># systemctl status rc-local.service</span></span><br><span class="line">[root@slave ~]<span class="comment"># netstat -ntlp | grep rsync</span></span><br></pre></td></tr></table></figure><h3 id="客户端（需备份的机器）设置"><a href="#客户端（需备份的机器）设置" class="headerlink" title="客户端（需备份的机器）设置"></a>客户端（需备份的机器）设置</h3><ul><li><strong>(1)在Master安装rsync</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># yum -y install rsync</span></span><br></pre></td></tr></table></figure><ul><li><strong>(2)首先创建<code>master</code>端的密码验证文件,同进要设置<code>rsync.password</code>的权限为600</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># echo 50000000 &gt;/proc/sys/fs/inotify/max_user_watches</span></span><br><span class="line">[root@master ~]<span class="comment"># echo 327679 &gt;/proc/sys/fs/inotify/max_queued_events</span></span><br><span class="line">[root@master ~]<span class="comment"># echo &quot;123456&quot; &gt;/etc/rsync.password</span></span><br><span class="line">[root@master ~]<span class="comment"># chmod 600 /etc/rsync.password</span></span><br></pre></td></tr></table></figure><ul><li><strong>(3)测试rsync</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># rsync -avzP /var/ftp/pub/sersync/ rsync_backup@192.168.47.20::backup --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><h3 id="实战："><a href="#实战：" class="headerlink" title="实战："></a>实战：</h3><ul><li><strong>实战一: 客户端推送backup目录下所有内容至Rsync服务端</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># rsync -avz /backup/ rsync_backup@192.168.147.20::backup/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><ul><li><strong>实战二: 客户端拉取Rsync服务端 backup模块数据至本地客户端的 &#x2F;backup目录</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment">#rsync -avz rsync_backup@192.168.47.20::backup /backup/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><ul><li><strong>实战三: Rsync实现数据无差异同步</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拉取远端数据：远端与本地保持一致,远端没有本地有会被删除, 造成客户端数据丢失</span></span><br><span class="line">[root@master ~]<span class="comment"># export RSYNC_PASSWORD=bgx</span></span><br><span class="line">[root@master ~]<span class="comment"># rsync -avz --delete rsync_backup@192.168.47.20::backup/ /data/ --password-file=/etc/rsync.password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#推送数据至远端：本地与远端保持一致, 本地没有远端会被删除, 造成服务器端数据丢失</span></span><br><span class="line">[root@master ~]<span class="comment"># rsync -avz --delete /data/ rsync_backup@192.168.47.20::backup/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><ul><li><strong>实战四: Rsync的Limit限速</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#企业案例: 某DBA使用rsync拉取备份数据时，由于文件过大导致内部交换机带宽被沾满，导致用户的请求无法响应</span></span><br><span class="line">[root@master ~]<span class="comment"># rsync -avz --bwlimit=1 rsync_backup@192.168.47.20::backup/ /data/ --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><h2 id="5-Rsync全网备份案例"><a href="#5-Rsync全网备份案例" class="headerlink" title="5.Rsync全网备份案例"></a>5.Rsync全网备份案例</h2><h3 id="前提要求"><a href="#前提要求" class="headerlink" title="前提要求"></a>前提要求</h3><ul><li>前提是机器的环境也得提前布置好，环境部署看目录4，服务实践</li></ul><p>已知2台服务器主机名分别为master,slave主机信息见下表:</p><table><thead><tr><th align="center">主机角色</th><th align="center">主机名称</th><th align="center">内网IP(LAN)</th></tr></thead><tbody><tr><td align="center">Rsync客户端</td><td align="center">master</td><td align="center">192.168.47.10</td></tr><tr><td align="center">Rsync服务端</td><td align="center">slave</td><td align="center">192.168.47.20</td></tr></tbody></table><p>需求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">客户端需求</span><br><span class="line">1.客户端提前准备存放的备份的目录，目录规则如下:/backup/master_192.168.47.10_2024-04-02</span><br><span class="line">2.客户端在本地打包备份(系统配置文件、应用配置等)拷贝至/backup/master_192.168.47.10_2024-04-02</span><br><span class="line">3.客户端最后将备份的数据进行推送至备份服务器</span><br><span class="line">4.客户端每天凌晨1点定时执行该脚本</span><br><span class="line">5.客户端服务器本地保留最近7天的数据, 避免浪费磁盘空间</span><br><span class="line"></span><br><span class="line">服务端需求</span><br><span class="line">1.服务端部署rsync，用于接收客户端推送过来的备份数据</span><br><span class="line">2.服务端需要每天校验客户端推送过来的数据是否完整</span><br><span class="line">3.服务端需要每天校验的结果通知给管理员</span><br><span class="line">4.服务端仅保留6个月的备份数据,其余的全部删除</span><br><span class="line">注意：所有服务器的备份目录必须都为/backup</span><br></pre></td></tr></table></figure><p>建议备份的数据内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.开机自启动配置文件  设备挂载配置文件  本地内网配置文件    (系统配置文件)</span></span><br><span class="line">/etc/rc.local       /etc/fstab      /etc/hosts              </span><br><span class="line"></span><br><span class="line"><span class="comment">#2.cron定时任务        firewalld防火墙       脚本目录      (重要目录)</span></span><br><span class="line">/var/spool/cron/    /etc/firewalld     /server/scripts</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.系统日志文件</span></span><br><span class="line">/var/log/   //系统安全日志、sudo日志、内核日志、rsyslog日志</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.应用程序服务配置文件 nginx、PHP、mysql、redis.....</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="客户端设置"><a href="#客户端设置" class="headerlink" title="客户端设置"></a>客户端设置</h3><h4 id="1-编写脚本"><a href="#1-编写脚本" class="headerlink" title="(1)编写脚本"></a>(1)编写脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.master客户端备份实现思路,脚本每天凌晨01点定时执行一次（打包-&gt;标记-&gt;推送-&gt;保留最近7天的文件）</span><br><span class="line">[root@master scripts]<span class="comment"># cat /server/scripts/client_rsync_backup.sh </span></span><br><span class="line"><span class="comment">#!/usr/bin/bash</span></span><br><span class="line"><span class="comment">#1.定义变量</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">Host=$(hostname)</span><br><span class="line">Addr=$(ifconfig ens33|awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">Date=$(<span class="built_in">date</span> +%F)</span><br><span class="line">Dest=<span class="variable">$&#123;Host&#125;</span>_<span class="variable">$&#123;Addr&#125;</span>_<span class="variable">$&#123;Date&#125;</span></span><br><span class="line">Path=/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.创建备份目录</span></span><br><span class="line">[ -d <span class="variable">$Path</span>/<span class="variable">$Dest</span> ] || <span class="built_in">mkdir</span> -p <span class="variable">$Path</span>/<span class="variable">$Dest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.备份对应的文件</span></span><br><span class="line"><span class="built_in">cd</span> / &amp;&amp; \</span><br><span class="line">[ -f <span class="variable">$Path</span>/<span class="variable">$Dest</span>/system.tar.gz ] || tar czf <span class="variable">$Path</span>/<span class="variable">$Dest</span>/system.tar.gz etc/fstab etc/rsyncd.conf &amp;&amp; \</span><br><span class="line">[ -f <span class="variable">$Path</span>/<span class="variable">$Dest</span>/log.tar.gz ] || tar czf <span class="variable">$Path</span>/<span class="variable">$Dest</span>/log.tar.gz  var/log/messages var/log/secure &amp;&amp; \</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.携带md5验证信息</span></span><br><span class="line">[ -f <span class="variable">$Path</span>/<span class="variable">$Dest</span>/flag_<span class="variable">$Date</span> ] || <span class="built_in">md5sum</span> <span class="variable">$Path</span>/<span class="variable">$Dest</span>/*.tar.gz &gt;<span class="variable">$Path</span>/<span class="variable">$Dest</span>/flag_<span class="variable">$Date</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.推送本地数据至备份服务器</span></span><br><span class="line">rsync -avz <span class="variable">$Path</span>/ rsync_backup@192.168.47.20::backup --password-file=/etc/rsync.password</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.本地保留最近7天的数据</span></span><br><span class="line">find <span class="variable">$Path</span>/ -<span class="built_in">type</span> d -mtime +7|xargs <span class="built_in">rm</span> -rf</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cd /backup/</span></span><br><span class="line">[root@master backup]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 root root 68 Apr 10 15:52 master_192.168.47.10_2024-04-10</span><br><span class="line">[root@master backup]<span class="comment"># cd master_192.168.47.10_2024-04-10</span></span><br><span class="line">[root@master master_192.168.47.10_2024-04-10]<span class="comment"># ll</span></span><br><span class="line">total 96</span><br><span class="line">-rw-r--r-- 1 root root   175 Apr 10 15:52 flag_2024-04-10</span><br><span class="line">-rw-r--r-- 1 root root 88449 Apr 10 15:52 log.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root   644 Apr 10 15:52 system.tar.gz</span><br><span class="line"></span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">server1_192.168.47.10_2024-04-10/</span><br><span class="line">server1_192.168.47.10_2024-04-10/flag_2024-04-10</span><br><span class="line">server1_192.168.47.10_2024-04-10/log.tar.gz</span><br><span class="line">server1_192.168.47.10_2024-04-10/system.tar.gz</span><br><span class="line"></span><br><span class="line">sent 85,339 bytes  received 92 bytes  4,167.37 bytes/sec</span><br><span class="line">total size is 89,268  speedup is 1.04</span><br></pre></td></tr></table></figure><h4 id="2-客户端编写定时任务-让备份每天凌晨1点执行；"><a href="#2-客户端编写定时任务-让备份每天凌晨1点执行；" class="headerlink" title="(2) 客户端编写定时任务,让备份每天凌晨1点执行；"></a>(2) 客户端编写定时任务,让备份每天凌晨1点执行；</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># crontab -l</span></span><br><span class="line">00 01 * * * /bin/bash /server/scripts/backup_rsync.sh &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure><h3 id="服务端设置"><a href="#服务端设置" class="headerlink" title="服务端设置"></a>服务端设置</h3><h4 id="1-slave服务端校验客户端推送数据的完整性-校验-存储校验结果-将保存的结果通过邮件发送给管理员-保留最近180天的数据-；"><a href="#1-slave服务端校验客户端推送数据的完整性-校验-存储校验结果-将保存的结果通过邮件发送给管理员-保留最近180天的数据-；" class="headerlink" title="(1)slave服务端校验客户端推送数据的完整性,(校验-&gt;存储校验结果-&gt;将保存的结果通过邮件发送给管理员-&gt;保留最近180天的数据)；"></a>(1)slave服务端校验客户端推送数据的完整性,(校验-&gt;存储校验结果-&gt;将保存的结果通过邮件发送给管理员-&gt;保留最近180天的数据)；</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.服务端配置邮件功能</span></span><br><span class="line">[root@backup /]<span class="comment"># yum install mailx -y</span></span><br><span class="line">[root@backup /]<span class="comment"># vim /etc/mail.rc</span></span><br><span class="line"><span class="built_in">set</span> from=552408925@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp=smtps://smtp.qq.com:465</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=xxxxxxxxxxxx@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=<span class="comment">#客户端授权码</span></span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br><span class="line"><span class="built_in">set</span> ssl-verify=ignore</span><br><span class="line"><span class="built_in">set</span> nss-config-dir=/etc/pki/nssdb/</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.服务端校验、以及邮件通知脚本</span></span><br><span class="line">[root@backup ~]<span class="comment"># mkdir /server/scripts -p</span></span><br><span class="line"></span><br><span class="line">[root@backup ~]<span class="comment"># vim /server/scripts/check_backup.sh</span></span><br><span class="line"><span class="comment">#!/usr/bin/bash</span></span><br><span class="line"><span class="comment">#1.定义全局的变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="comment">#2.定义局部变量</span></span><br><span class="line">Path=/backup</span><br><span class="line">Date=$(<span class="built_in">date</span> +%F)</span><br><span class="line"><span class="comment">#3.查看flag文件,并对该文件进行校验, 然后将校验的结果保存至result_时间</span></span><br><span class="line">find <span class="variable">$Path</span>/ -<span class="built_in">type</span> f -name <span class="string">&quot;flag_<span class="variable">$Date</span>&quot;</span>|xargs <span class="built_in">md5sum</span> -c &gt;<span class="variable">$Path</span>/result_<span class="variable">$&#123;Date&#125;</span></span><br><span class="line"><span class="comment">#4.将校验的结果发送邮件给管理员</span></span><br><span class="line">mail -s <span class="string">&quot;Rsync Backup <span class="variable">$Date</span>&quot;</span> 123@qq.com &lt;<span class="variable">$Path</span>/result_<span class="variable">$&#123;Date&#125;</span></span><br><span class="line"><span class="comment">#5.删除超过7天的校验结果文件, 删除超过180天的备份数据文件</span></span><br><span class="line">find <span class="variable">$Path</span>/ -<span class="built_in">type</span> f -name <span class="string">&quot;result*&quot;</span> -mtime +7|xargs <span class="built_in">rm</span> -f</span><br><span class="line">find <span class="variable">$Path</span>/ -<span class="built_in">type</span> d -mtime +180|xargs <span class="built_in">rm</span> -rf</span><br><span class="line"></span><br><span class="line">4.服务端编写定时任务脚本</span><br><span class="line">[root@backup backup]<span class="comment"># crontab -l</span></span><br><span class="line">00 05 * * * /bin/bash /server/scripts/check_backup.sh &amp;&gt;/dev/null</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-全网备份图解流程"><a href="#2-全网备份图解流程" class="headerlink" title="(2)全网备份图解流程"></a>(2)全网备份图解流程</h4><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240911171956462.png" alt="image-20240911171956462"></p><h2 id="6-数据实时同步（sersync-rsync）"><a href="#6-数据实时同步（sersync-rsync）" class="headerlink" title="6.数据实时同步（sersync+rsync）"></a>6.数据实时同步（sersync+rsync）</h2><ul><li>前面的步骤还是和目录4是一样的</li></ul><table><thead><tr><th align="center">主机角色</th><th align="center">主机名称</th><th align="center">内网IP(LAN)</th></tr></thead><tbody><tr><td align="center">Rsync服务端</td><td align="center">slave</td><td align="center">192.168.47.20</td></tr><tr><td align="center">Rsync客户端</td><td align="center">master主机</td><td align="center">192.168.47.10</td></tr></tbody></table><h3 id="服务端（备份机）设置-1"><a href="#服务端（备份机）设置-1" class="headerlink" title="服务端（备份机）设置"></a>服务端（备份机）设置</h3><h4 id="1-在Slave服务器上安装Rsync"><a href="#1-在Slave服务器上安装Rsync" class="headerlink" title="(1)在Slave服务器上安装Rsync"></a>(1)在Slave服务器上安装Rsync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># yum -y install rsync</span></span><br></pre></td></tr></table></figure><h4 id="2-在Slave服务器上配置rsync"><a href="#2-在Slave服务器上配置rsync" class="headerlink" title="(2)在Slave服务器上配置rsync"></a>(2)在Slave服务器上配置rsync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># vim /etc/rsyncd.conf</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line">max connections = 36000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file =/var/run/rsyncd.pid</span><br><span class="line">lock file =/var/run/rsync.lock</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors = no</span><br><span class="line"><span class="built_in">read</span> only = no</span><br><span class="line">list = no</span><br><span class="line">hosts allow = 192.168.1.175</span><br><span class="line">hosts deny = *</span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file =/etc/rsync.password</span><br><span class="line">[backup]</span><br><span class="line">path = /backup/sersync/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置注解:</span></span><br><span class="line"><span class="comment"># uid:指定传输文件时的用户</span></span><br><span class="line"><span class="comment"># gid:指定传输文件时的组</span></span><br><span class="line"><span class="comment"># use chroot true|falsD:表示在传输文件前首先chroot到path参数所指定的目录下,可以实现安全防护,但缺点是需要以root权限,并且不能备份指向外部的符号连接所指向的目录文件,默认情况下chroot值为true</span></span><br><span class="line"><span class="comment"># max connections:指定最大的连接数,默认是0,即没有限制</span></span><br><span class="line"><span class="comment"># read only ture|falsD:如果为true,则不能上传到该模块指定的路径下</span></span><br><span class="line"><span class="comment"># list:表示当用户查询该服务器上的可用模块时,该模块是否被列出,true为列出,false为隐藏</span></span><br><span class="line"><span class="comment"># auth users:指定传输时要使用的用户名</span></span><br><span class="line"><span class="comment"># secrets filD:指定密码文件,注意该密码文件的权限一定要是600,格式:用户名:密码</span></span><br><span class="line"><span class="comment"># hosts allow:是允许同步的主机,可以是IP或者网段,如果是多个中间用空格隔开</span></span><br><span class="line"><span class="comment"># hosts deny:拒绝同步的主机,可以是IP或者网段,如果是多个中间用空格隔开</span></span><br><span class="line"><span class="comment"># [backup]:同步的模块名</span></span><br><span class="line"><span class="comment"># path:同步的路径</span></span><br></pre></td></tr></table></figure><h4 id="3-创建同步的用户与密码的文件"><a href="#3-创建同步的用户与密码的文件" class="headerlink" title="(3)创建同步的用户与密码的文件"></a>(3)创建同步的用户与密码的文件</h4><p>即rsyncd.conf中secrets file这个配置选项中的文件&#x2F;etc&#x2F;rsync.passwd,同进要设置rsync.password的权限为600</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># echo &quot;rsync_backup:123456&quot; &gt;/etc/rsync.password</span></span><br><span class="line">[root@slave ~]<span class="comment"># chmod 600 /etc/rsync.password</span></span><br></pre></td></tr></table></figure><h4 id="4-创建同步的目录"><a href="#4-创建同步的目录" class="headerlink" title="(4)创建同步的目录"></a>(4)创建同步的目录</h4><p>即rsyncd.conf中path配置选项中的目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># mkdir -p /backup/sersync</span></span><br></pre></td></tr></table></figure><h4 id="5-启动守护进程-并写入开机自启动"><a href="#5-启动守护进程-并写入开机自启动" class="headerlink" title="(5)启动守护进程,并写入开机自启动"></a>(5)启动守护进程,并写入开机自启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># rsync --daemon --config=/etc/rsyncd.conf </span></span><br><span class="line">[root@slave ~]<span class="comment"># echo &quot;rsync --daemon --config=/etc/rsyncd.conf&quot; &gt;&gt;/etc/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># tail -1 /etc/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># reboot</span></span><br><span class="line">[root@slave ~]<span class="comment"># systemctl status rc-local.service</span></span><br><span class="line">[root@slave ~]<span class="comment"># netstat -ntlp | grep rsync</span></span><br></pre></td></tr></table></figure><h3 id="客户端（需备份的机器）设置-1"><a href="#客户端（需备份的机器）设置-1" class="headerlink" title="客户端（需备份的机器）设置"></a>客户端（需备份的机器）设置</h3><h4 id="1-在Master安装rsync"><a href="#1-在Master安装rsync" class="headerlink" title="(1)在Master安装rsync"></a>(1)在Master安装rsync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># yum -y install rsync</span></span><br></pre></td></tr></table></figure><h4 id="2-首先创建master端的密码验证文件-同进要设置rsync-password的权限为600"><a href="#2-首先创建master端的密码验证文件-同进要设置rsync-password的权限为600" class="headerlink" title="(2)首先创建master端的密码验证文件,同进要设置rsync.password的权限为600"></a>(2)首先创建master端的密码验证文件,同进要设置rsync.password的权限为600</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># echo 50000000 &gt;/proc/sys/fs/inotify/max_user_watches</span></span><br><span class="line">[root@master ~]<span class="comment"># echo 327679 &gt;/proc/sys/fs/inotify/max_queued_events</span></span><br><span class="line">[root@master ~]<span class="comment"># echo &quot;123456&quot; &gt;/etc/rsync.password</span></span><br><span class="line">[root@master ~]<span class="comment"># chmod 600 /etc/rsync.password</span></span><br></pre></td></tr></table></figure><h4 id="3-测试rsync"><a href="#3-测试rsync" class="headerlink" title="(3)测试rsync"></a><strong>(3)测试rsync</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># rsync -avzP /var/ftp/pub/sersync/ rsync_backup@192.168.47.20::backup --password-file=/etc/rsync.password</span></span><br></pre></td></tr></table></figure><h4 id="4-部署sersync"><a href="#4-部署sersync" class="headerlink" title="(4)部署sersync"></a>(4)部署sersync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># mkdir /usr/local/sersync/</span></span><br><span class="line">[root@master ~]<span class="comment"># mkdir /usr/local/sersync/bin</span></span><br><span class="line">[root@master ~]<span class="comment"># mkdir /usr/local/sersync/conf</span></span><br><span class="line">[root@master ~]<span class="comment"># mkdir /usr/local/sersync/logs</span></span><br><span class="line">[root@master ~]<span class="comment"># cd /usr/local/sersync</span></span><br><span class="line">[root@master sersync]<span class="comment"># wget https://raw.githubusercontent.com/orangle/sersync/master/release/sersync2.5.4_64bit_binary_stable_final.tar.gz</span></span><br><span class="line">[root@master sersync]<span class="comment"># tar xvf sersync2.5.4_64bit_binary_stable_final.tar.gz</span></span><br><span class="line">[root@master sersync]<span class="comment"># mv GNU-Linux-x86/sersync2 ./bin/sersync</span></span><br><span class="line">[root@master sersync]<span class="comment"># mv GNU-Linux-x86/confxml.xml ./conf/</span></span><br><span class="line">[root@master sersync]<span class="comment"># cd conf</span></span><br><span class="line">[root@master conf]<span class="comment"># cp confxml.xml confxml.xml.bak</span></span><br><span class="line">[root@server1 <span class="built_in">local</span>]<span class="comment"># tree sersync</span></span><br><span class="line">sersync</span><br><span class="line">├── bin</span><br><span class="line">│   └── sersync</span><br><span class="line">├── conf</span><br><span class="line">│   ├── confxml.xml</span><br><span class="line">│   └── confxml.xml.bak</span><br><span class="line">├── GNU-Linux-x86</span><br><span class="line">├── logs</span><br><span class="line">└── sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"></span><br><span class="line">4 directories, 4 files</span><br></pre></td></tr></table></figure><h4 id="5-修改config-xml文件-建议拷贝一份在修改-需要把监控的目录数据同步到master指定的模块下-前面写了slave的模块名是backup对应的目录是-backup"><a href="#5-修改config-xml文件-建议拷贝一份在修改-需要把监控的目录数据同步到master指定的模块下-前面写了slave的模块名是backup对应的目录是-backup" class="headerlink" title="(5)修改config.xml文件,建议拷贝一份在修改,需要把监控的目录数据同步到master指定的模块下,前面写了slave的模块名是backup对应的目录是:&#x2F;backup&#x2F;"></a>(5)修改config.xml文件,建议拷贝一份在修改,需要把监控的目录数据同步到master指定的模块下,前面写了slave的模块名是backup对应的目录是:&#x2F;backup&#x2F;</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master sersync]<span class="comment"># vim conf/confxml.xml</span></span><br><span class="line"><span class="comment"># 如果系统linux7以上，需要将xfs=&quot;false&quot;修改成xfs=&quot;true&quot;,否则sersync无法递归监控</span></span><br><span class="line">&lt;fileSystem xfs=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;localpath watch=<span class="string">&quot;/var/ftp/pub/sersync&quot;</span>&gt;</span><br><span class="line">&lt;remote ip=<span class="string">&quot;192.168.47.20&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;</span><br><span class="line">&lt;/localpath&gt;</span><br><span class="line"><span class="comment"># 指定rsync的虚拟用户和密码文件路径</span></span><br><span class="line">&lt;rsync&gt;</span><br><span class="line">&lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;</span><br><span class="line">&lt;auth start=<span class="string">&quot;true&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;rsync_backup&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.password&quot;</span>/&gt;</span><br><span class="line">&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line">&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line">&lt;ssh start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">&lt;/rsync&gt;</span><br><span class="line">[root@master sersync]<span class="comment"># echo &quot;export PATH=$PATH:/usr/local/sersync/bin/&quot; &gt;&gt;/etc/profile</span></span><br><span class="line">[root@master sersync]<span class="comment"># source /etc/profile</span></span><br><span class="line">[root@master sersync]<span class="comment"># which sersync</span></span><br></pre></td></tr></table></figure><h4 id="6-启动sersync"><a href="#6-启动sersync" class="headerlink" title="(6)启动sersync"></a>(6)启动sersync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master sersync]<span class="comment"># sersync -d -r -o /usr/local/sersync/conf/confxml.xml</span></span><br><span class="line"><span class="comment"># 参数注解:</span></span><br><span class="line"><span class="comment"># -d:启用守护进程模式</span></span><br><span class="line"><span class="comment"># -r:在监控前,将监控目录与远程主机用rsync命令推送一遍</span></span><br><span class="line"><span class="comment"># -o:指定配置文件,默认使用confxml.xml文件</span></span><br></pre></td></tr></table></figure><h4 id="7-测试同步-在master服务器需要同步的目录下创建文件及目录"><a href="#7-测试同步-在master服务器需要同步的目录下创建文件及目录" class="headerlink" title="(7)测试同步,在master服务器需要同步的目录下创建文件及目录"></a>(7)测试同步,在master服务器需要同步的目录下创建文件及目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master sersync]<span class="comment"># cd /var/ftp/pub/sersync/</span></span><br><span class="line">[root@master sersync]<span class="comment"># touch &#123;1..100&#125;</span></span><br><span class="line">[root@master sersync]<span class="comment"># mkdir note</span></span><br><span class="line">[root@slave backup]<span class="comment"># ls</span></span><br></pre></td></tr></table></figure><h4 id="8-加入开机启动项-重启服务器查看"><a href="#8-加入开机启动项-重启服务器查看" class="headerlink" title="(8)加入开机启动项,重启服务器查看"></a>(8)加入开机启动项,重启服务器查看</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ln -s  /usr/local/sersync/bin/sersync /usr/local/bin/sersync</span></span><br><span class="line">[root@master ~]<span class="comment"># echo &quot;sersync -d -r -o /usr/local/sersync/conf/confxml.xml&quot; &gt;&gt;/etc/rc.local</span></span><br><span class="line">[root@master ~]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line">[root@master ~]<span class="comment"># systemctl status rc-local.service</span></span><br><span class="line">[root@master ~]<span class="comment"># tail -1 /etc/rc.local</span></span><br><span class="line">[root@slave ~]<span class="comment"># reboot</span></span><br></pre></td></tr></table></figure><h4 id="9-加入开机启动后测试同步-在master增加、删除、修改文件及目录-查看slave是否实时同步"><a href="#9-加入开机启动后测试同步-在master增加、删除、修改文件及目录-查看slave是否实时同步" class="headerlink" title="(9)加入开机启动后测试同步,在master增加、删除、修改文件及目录,查看slave是否实时同步"></a>(9)加入开机启动后测试同步,在master增加、删除、修改文件及目录,查看slave是否实时同步</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master sersync]<span class="comment"># cd /var/ftp/pub/sersync/</span></span><br><span class="line">[root@master sersync]<span class="comment"># touch &#123;1..100&#125;</span></span><br><span class="line">[root@master sersync]<span class="comment"># mkdir note</span></span><br><span class="line">[root@master sersync]<span class="comment"># rm -rf ./*</span></span><br><span class="line">[root@slave backup]<span class="comment"># ls</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Rsync备份服务实战</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux定时任务Cron</title>
    <link href="http://example.com/2024/09/01/linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1cron/"/>
    <id>http://example.com/2024/09/01/linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1cron/</id>
    <published>2024-09-01T01:25:00.000Z</published>
    <updated>2024-09-01T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux定时任务Cron"><a href="#Linux定时任务Cron" class="headerlink" title="Linux定时任务Cron"></a>Linux定时任务Cron</h1><p>Cron是Linux和Unix系统中的任务调度程序，用于在指定的时间或间隔自动执行脚本或命令。它的主要作用是帮助系统管理员和用户自动化一些重复性的任务，从而节省时间和避免人为错误。无论是定时备份数据、定期清理日志文件，还是自动发送报告，Cron都能胜任。</p><p>在Linux系统中，自动化是提高效率的关键，而Cron作为最常用的自动化工具之一，对于每个Linux用户来说都至关重要。掌握Cron，不仅能让你轻松处理日常任务，还能让你在系统管理和维护中游刃有余，减少手动操作的负担。</p><p><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6OibpDQ66VYTpib7HmAWnZFJVLvKDN1iccL0C9qB7JZFjq6MGvM7EoSBKuwUKYxytJAGCdwjnldHWe54TAtm1Iabw/640?wx_fmt=jpeg&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p><h2 id="Cron基础知识"><a href="#Cron基础知识" class="headerlink" title="Cron基础知识"></a>Cron基础知识</h2><p>Cron是由Ken Thompson在20世纪70年代为Unix系统开发的，最初的目的是简化系统管理任务。随着时间的推移，Cron逐渐演变成了现代Linux系统中不可或缺的定时任务工具。它以crond守护进程的形式运行在后台，定期检查和执行预定义的任务。</p><p>Cron的最早版本出现在Unix V7中，由于其简单有效的设计，很快被其他Unix系统采纳。随着Linux的发展，Cron也得到了广泛应用。现代Linux发行版几乎都内置了Cron，并且经过多次优化，功能和性能都得到了显著提升。</p><p>Cron的工作原理非常简单：它通过解析用户或系统定义的Crontab文件，确定任务的执行时间和频率。当当前时间与Crontab文件中的时间条件匹配时，Cron便会启动相应的命令或脚本。Cron的整个过程都是自动化的，用户只需定义好任务和时间规则，剩下的工作交给Cron即可。</p><h2 id="Cron的核心组件"><a href="#Cron的核心组件" class="headerlink" title="Cron的核心组件"></a>Cron的核心组件</h2><h3 id="Cron守护进程（crond）"><a href="#Cron守护进程（crond）" class="headerlink" title="Cron守护进程（crond）"></a>Cron守护进程（crond）</h3><p>crond是一个后台运行的守护进程，负责执行所有由Cron安排的任务。它会定期检查系统和用户的Crontab文件，并根据文件中的时间表执行任务。crond通常在系统启动时自动启动，并一直运行，确保所有定时任务能够按时执行。</p><h3 id="Crontab文件"><a href="#Crontab文件" class="headerlink" title="Crontab文件"></a>Crontab文件</h3><p>Crontab文件是Cron调度任务的核心配置文件。它包含了用户或系统定义的任务和时间表。Crontab文件分为用户Crontab和系统Crontab。</p><ul><li><p><strong>用户Crontab</strong>：每个用户都可以拥有自己的Crontab文件，存放在<code>/var/spool/cron/crontabs/</code>目录下。用户可以通过<code>crontab -e</code>命令来编辑自己的Crontab文件。<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902165903.png"></p></li><li><p><strong>系统Crontab</strong>：系统级Crontab文件通常位于<code>/etc/crontab</code>，由系统管理员管理，主要用于安排系统级任务。</p></li></ul><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902170005.png"></p><h3 id="Cron的目录结构"><a href="#Cron的目录结构" class="headerlink" title="Cron的目录结构"></a>Cron的目录结构</h3><p>Cron的目录结构是其灵活性和可扩展性的体现。除了用户和系统Crontab文件外，Cron还支持其他几种配置方式。</p><ul><li><p>**<code>/etc/crontab</code>**：系统级Crontab文件，通常由系统管理员配置，用于安排与系统维护相关的任务。</p></li><li><p>**<code>/etc/cron.d/</code>**：该目录下可以存放多个独立的Crontab文件，每个文件都可以定义自己的任务和时间表。适用于需要多个独立任务配置的场景。</p></li><li><p>**<code>/var/spool/cron/</code>**：这是用户Crontab文件的存放目录。每个用户的Crontab文件都会存储在这里，文件名与用户名对应。</p></li></ul><h2 id="Cron语法"><a href="#Cron语法" class="headerlink" title="Cron语法"></a>Cron语法</h2><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902170926.png"></p><p>Cron语法由五个时间字段和一个命令字段组成。每个时间字段表示一个特定的时间单位，用户可以通过这些字段精确定义任务的执行时间。</p><ul><li><strong>分钟</strong>（0-59）：指定任务在某分钟执行。例如，<code>0</code>表示整点执行。</li><li><strong>小时</strong>（0-23）：指定任务在某小时执行。例如，<code>14</code>表示下午2点执行。</li><li><strong>日期</strong>（1-31）：指定任务在某天执行。例如，<code>15</code>表示每月15日执行。</li><li><strong>月份</strong>（1-12）：指定任务在某月执行。例如，<code>7</code>表示7月份执行。</li><li><strong>星期</strong>（0-6）：指定任务在某星期几执行。<code>0</code>和<code>7</code>都表示星期天，<code>1</code>表示星期一，以此类推。</li></ul><p>为了实现更复杂的时间调度，Cron语法支持多种特殊字符。</p><ul><li><strong>星号（*）</strong>：表示任何值。例如，<code>* * * * *</code>表示每分钟执行一次任务。</li><li><strong>逗号（,）</strong>：用于分隔多个值。例如，<code>0,15,30,45 * * * *</code>表示在每小时的0、15、30、45分钟执行任务。</li><li><strong>连字符（-）</strong>：用于定义一个范围。例如，<code>1-5</code>表示从1到5的所有值。</li><li><strong>斜杠（&#x2F;）</strong>：用于定义增量。例如，<code>*/5</code>表示每5个单位执行一次任务。</li></ul><p>Cron还支持一些快捷字符串，用于简化常见的时间调度需求。</p><ul><li>**<code>@reboot</code>**：在系统启动后执行任务。</li><li>**<code>@yearly</code>**：每年执行一次，等价于<code>0 0 1 1 *</code></li><li>**<code>@monthly</code>**：每月执行一次，等价于<code>0 0 1 * *</code></li><li>**<code>@weekly</code>**：每周执行一次，等价于<code>0 0 * * 0</code></li><li>**<code>@daily</code>**：每天执行一次，等价于<code>0 0 * * *</code></li><li>**<code>@hourly</code>**：每小时执行一次，等价于<code>0 * * * *</code></li></ul><h2 id="Cron的工作机制"><a href="#Cron的工作机制" class="headerlink" title="Cron的工作机制"></a>Cron的工作机制</h2><p>Cron任务的启动时机由Crontab文件中的时间字段决定。crond守护进程会每分钟检查一次Crontab文件，并在时间匹配时启动相应的任务。任务启动后，Cron会在后台执行任务，执行完成后将结果返回到指定的日志文件或发送至用户邮箱。</p><p>由于Cron任务在后台运行，因此环境变量的设置非常重要。默认情况下，Cron任务使用的环境变量与用户登录时的环境变量不同。如果任务需要使用特定的环境变量（如路径变量），则应在Crontab文件中显式设置这些变量。可以通过在Crontab文件的顶部添加环境变量设置来实现这一点。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br></pre></td></tr></table></figure><p>Cron任务通常在sh shell中执行，如果任务脚本依赖于其他shell（如bash或zsh），需要在Crontab中指定使用的shell。例如，在Crontab文件的开头添加<code>SHELL=/bin/bash</code>，即可让Cron任务在bash环境中执行。</p><h2 id="Cron任务的设置与管理"><a href="#Cron任务的设置与管理" class="headerlink" title="Cron任务的设置与管理"></a>Cron任务的设置与管理</h2><p>用户可以通过<code>crontab -e</code>命令编辑自己的Crontab文件，添加或修改定时任务。编辑器通常是系统默认的文本编辑器，如vim或nano。每个任务一行，格式为<code>时间字段 命令</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨2点执行备份脚本</span></span><br><span class="line">0 2 * * * /home/user/backup.sh</span><br></pre></td></tr></table></figure><p>系统管理员可以编辑<code>/etc/crontab</code>文件，定义系统级的定时任务。系统Crontab文件格式与用户Crontab略有不同，时间字段后面还需要指定运行任务的用户。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨3点执行系统日志清理</span></span><br><span class="line">0 3 * * * root /usr/bin/logrotate</span><br></pre></td></tr></table></figure><p>用户可以使用<code>crontab -l</code>命令查看自己的Cron任务列表。系统管理员可以通过查看<code>/etc/crontab</code>和<code>/etc/cron.d/</code>目录下的文件，查看系统级的Cron任务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出当前用户的Cron任务</span></span><br><span class="line">crontab -l</span><br></pre></td></tr></table></figure><p>编辑Cron任务可以通过<code>crontab -e</code>命令进行，删除任务则可以通过<code>crontab -r</code>命令完成。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除当前用户的所有Cron任务</span></span><br><span class="line">crontab -r</span><br></pre></td></tr></table></figure><p>Cron任务的执行状态可以通过日志文件查看。通常，Cron的执行日志记录在<code>/var/log/syslog</code>或<code>/var/log/cron</code>文件中。可以使用<code>grep</code>命令过滤日志，查找特定任务的执行记录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找所有与Cron相关的日志记录</span></span><br><span class="line">grep CRON /var/log/syslog</span><br></pre></td></tr></table></figure><h2 id="Cron的高级使用"><a href="#Cron的高级使用" class="headerlink" title="Cron的高级使用"></a>Cron的高级使用</h2><h3 id="Cron中的时间调度技巧"><a href="#Cron中的时间调度技巧" class="headerlink" title="Cron中的时间调度技巧"></a>Cron中的时间调度技巧</h3><p>高级用户可以使用复杂的时间调度技巧，如结合多个时间字段、使用特殊字符和范围，来实现精确的任务调度。例如，每隔10分钟从早上8点到晚上8点执行任务，可以使用以下Crontab规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每隔10分钟执行一次任务，从8:00到20:00</span></span><br><span class="line"></span><br><span class="line">*/10 8-20 * * * /path/to/command</span><br></pre></td></tr></table></figure><h3 id="Cron的调试与故障排除"><a href="#Cron的调试与故障排除" class="headerlink" title="Cron的调试与故障排除"></a>Cron的调试与故障排除</h3><p>当Cron任务没有按预期执行时，可以通过以下几种方式进行调试和故障排除：</p><ul><li><strong>检查Crontab语法</strong>：确保Crontab文件中没有语法错误，可以通过在线Crontab语法检查工具验证。</li><li><strong>查看日志文件</strong>：通过检查Cron日志文件，查看任务是否有执行记录，是否有报错信息。</li><li><strong>添加调试信息</strong>：在Crontab中添加调试信息，如将输出重定向到文件，记录任务执行时的输出内容。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将任务的输出重定向到文件，便于调试</span></span><br><span class="line"></span><br><span class="line">* * * * * /path/to/command &gt;&gt; /tmp/cron_debug.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="常见Cron使用场景"><a href="#常见Cron使用场景" class="headerlink" title="常见Cron使用场景"></a>常见Cron使用场景</h2><h3 id="定时备份与数据同步"><a href="#定时备份与数据同步" class="headerlink" title="定时备份与数据同步"></a>定时备份与数据同步</h3><p>定时备份是Cron最常见的应用场景之一。可以使用Cron安排每天定时备份数据库、文件或整个系统，并将备份文件同步到远程服务器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨3点备份数据库，并同步到远程服务器</span></span><br><span class="line">0 3 * * * /usr/bin/mysqldump -u root -p password database | gzip &gt; /backups/db_backup.sql.gz &amp;&amp; rsync -avz /backups/db_backup.sql.gz user@remote:/backup/</span><br></pre></td></tr></table></figure><h3 id="自动清理与维护任务"><a href="#自动清理与维护任务" class="headerlink" title="自动清理与维护任务"></a>自动清理与维护任务</h3><p>系统维护任务，如清理临时文件、压缩日志文件、删除过期数据等，也可以通过Cron自动化。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每周一凌晨4点清理/tmp目录中的过期文件</span></span><br><span class="line">0 4 * * 1 find /tmp -<span class="built_in">type</span> f -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="自动发送报告与提醒"><a href="#自动发送报告与提醒" class="headerlink" title="自动发送报告与提醒"></a>自动发送报告与提醒</h3><p>Cron还可以用于定期生成和发送报告，如系统状态报告、网站流量报告等。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天早上7点生成系统状态报告并发送到指定邮箱</span></span><br><span class="line">0 7 * * * /usr/local/bin/system_report.sh | mail -s <span class="string">&quot;Daily System Report&quot;</span> user@example.com</span><br></pre></td></tr></table></figure><h3 id="监控与报警"><a href="#监控与报警" class="headerlink" title="监控与报警"></a>监控与报警</h3><p>通过Cron定时执行监控脚本，可以实时检测系统或服务状态，并在出现异常时发送报警通知。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每5分钟检查web服务是否运行，如果停止则重启并发送报警邮件</span></span><br><span class="line">*/5 * * * * /usr/local/bin/check_web_service.sh || (/usr/bin/systemctl restart httpd &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Web Service Restarted&quot;</span> | mail -s <span class="string">&quot;Web Service Alert&quot;</span> user@example.com)</span><br></pre></td></tr></table></figure><h2 id="Cron的安全性"><a href="#Cron的安全性" class="headerlink" title="Cron的安全性"></a>Cron的安全性</h2><h3 id="限制用户使用Cron"><a href="#限制用户使用Cron" class="headerlink" title="限制用户使用Cron"></a>限制用户使用Cron</h3><p>为了防止未经授权的用户滥用Cron，可以通过编辑<code>/etc/cron.allow</code>和<code>/etc/cron.deny</code>文件来控制哪些用户可以使用Cron。</p><ul><li>**<code>/etc/cron.allow</code>**：列出允许使用Cron的用户。如果文件存在，只有文件中列出的用户可以使用Cron。</li><li>**<code>/etc/cron.deny</code>**：列出禁止使用Cron的用户。如果文件存在，列在其中的用户将被禁止使用Cron。</li></ul><h3 id="设置Cron任务的权限"><a href="#设置Cron任务的权限" class="headerlink" title="设置Cron任务的权限"></a>设置Cron任务的权限</h3><p>在设置Cron任务时，确保脚本和命令的权限设置正确，防止未授权用户访问或修改任务脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置脚本的权限为仅所有者可读写执行</span></span><br><span class="line"><span class="built_in">chmod</span> 700 /path/to/script.sh</span><br></pre></td></tr></table></figure><p>在使用Cron执行一些需要提升权限的任务时，可以通过SUID位设置，确保任务在正确的权限下执行。然而，需要谨慎使用SUID，避免引入安全风险。</p>]]></content>
    
    
    <summary type="html">Linux定时任务Cron</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>linux模拟垃圾回收站机制</title>
    <link href="http://example.com/2024/08/27/linux%E9%85%8D%E7%BD%AE%E5%9E%83%E5%9C%BE%E7%AB%99%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"/>
    <id>http://example.com/2024/08/27/linux%E9%85%8D%E7%BD%AE%E5%9E%83%E5%9C%BE%E7%AB%99%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</id>
    <published>2024-08-27T01:25:00.000Z</published>
    <updated>2024-08-27T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="linux模拟垃圾回收站机制"><a href="#linux模拟垃圾回收站机制" class="headerlink" title="linux模拟垃圾回收站机制"></a>linux模拟垃圾回收站机制</h1><p>众所周知，linux系统默认是没有类似windows的回收站的。特别是加上<code>-f</code>参数后，一不小心，喜提跑路套餐。可以想办法模拟一下Windows的回收站功能。</p><p><strong>第一步，先禁用rm</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文末添加</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;echo can not use rm command, please use de&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使得生效</span></span><br><span class="line"><span class="built_in">source</span>  /etc/profile</span><br></pre></td></tr></table></figure><p>效果<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240913143243643.png" alt="image-20240913143243643"></p><p><strong>第二步，创建回收站</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建回收站目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.Recycle_bin</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改bash文件</span></span><br><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bash文件后面，增加如下内容</span></span><br><span class="line"><span class="built_in">alias</span> de=Recycle_bin</span><br><span class="line"><span class="built_in">alias</span> dl=<span class="string">&#x27;ls ~/.Recycle_bin&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dr=undelfile</span><br><span class="line"><span class="function"><span class="title">undelfile</span></span>()&#123;</span><br><span class="line">  <span class="built_in">mv</span> -i ~/.Recycle_bin/<span class="variable">$@</span> ./</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">Recycle_bin</span></span>()&#123;</span><br><span class="line">  <span class="built_in">mv</span> <span class="variable">$@</span> ~/.Recycle_bin/</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">clearall</span></span>()&#123;</span><br><span class="line"> <span class="built_in">read</span> -p <span class="string">&quot;Clear Recycle_bin?[n]&quot;</span> confirm</span><br><span class="line"> [ <span class="variable">$confirm</span> == <span class="string">&#x27;y&#x27;</span> ] || [ <span class="variable">$confirm</span> == <span class="string">&#x27;Y&#x27;</span> ] &amp;&amp; /usr/bin/rm -rf ~/.Recycle_bin/*</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p><strong>效果，使用de进行删除，dr进行恢复，dl查看目录，clearall清空</strong><br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240913144723060.png" alt="image-20240913144723060"></p>]]></content>
    
    
    <summary type="html">linux模拟垃圾回收站机制</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux轻松加入AD域环境</title>
    <link href="http://example.com/2024/08/26/linux%E8%BD%BB%E6%9D%BE%E5%8A%A0%E5%85%A5ad%E5%9F%9F%E7%8E%AF%E5%A2%83/"/>
    <id>http://example.com/2024/08/26/linux%E8%BD%BB%E6%9D%BE%E5%8A%A0%E5%85%A5ad%E5%9F%9F%E7%8E%AF%E5%A2%83/</id>
    <published>2024-08-26T01:25:00.000Z</published>
    <updated>2024-08-26T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux轻松加入AD域环境"><a href="#Linux轻松加入AD域环境" class="headerlink" title="Linux轻松加入AD域环境"></a>Linux轻松加入AD域环境</h1><p><mark>此处使用系统为Rocky_Linux9，其它系统请自行测试</mark></p><h2 id="安装图形化管理工具"><a href="#安装图形化管理工具" class="headerlink" title="安装图形化管理工具"></a>安装图形化管理工具</h2><ul><li>安装Cockpit图形化管理工具</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install cockpit -y</span><br></pre></td></tr></table></figure><ul><li>启动服务</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cockpit</span><br></pre></td></tr></table></figure><ul><li>启动后，可以看到端口为9090，在浏览器中直接访问<code>ip:9090</code>即可</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ss -ntlp |grep 9090</span></span><br><span class="line">LISTEN 0      4096               *:9090            *:*    <span class="built_in">users</span>:((&quot;cockpit-tls&quot;,pid=<span class="number">2238</span>,fd=<span class="number">3</span>),(&quot;systemd&quot;,pid=<span class="number">1</span>,fd=<span class="number">151</span>))</span><br></pre></td></tr></table></figure><h2 id="加入域"><a href="#加入域" class="headerlink" title="加入域"></a>加入域</h2><p>登录后再概览这里可以看到<code>加入域</code>选项<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902111553.png"></p><p>在网络选项中，编辑网卡的<code>DNS</code>为域服务器的地址，根据自己的实际情况修改</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902111732.png"></p><p>然后回到概览，点击<code>加入域</code></p><p>输入域地址，管理员用户名、密码点击加入即会自动安装所需软件包</p><p>等待片刻后，可以看到Linux服务器成功加入<code>AD域</code></p><p>后台查看域</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm list</span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902111957.png"></p><p>查看客户端服务状态,Linux中是基于<code>sssd</code>服务的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status sssd </span><br><span class="line"><span class="comment">#加入开机自启 systemctl enable sssd</span></span><br></pre></td></tr></table></figure><h2 id="域服务器查看"><a href="#域服务器查看" class="headerlink" title="域服务器查看"></a>域服务器查看</h2><p>在域服务器查看已经加入域的客户端<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902112447.png"></p><p>在域服务器创建用户<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902112512.png"><br>使用域用户ssh登录Linux服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="built_in">test</span>@qclr.qclr@192.168.3.2</span><br></pre></td></tr></table></figure><p>查看域用户信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#由于是域用户，必须填写用户名＋域名否则识别不到</span></span><br><span class="line"><span class="built_in">id</span> <span class="built_in">test</span>@qclr.qclr</span><br></pre></td></tr></table></figure><p>也可以修改配置文件，使域用户不携带域名也能被识别</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sssd/sssd.conf</span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240902112626.png"><br>将True修改为False，这样在输入域用户时就不需要携带域名了</p><p>重启服务测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sssd</span><br></pre></td></tr></table></figure><p>此时，没有携带域名也能够识别到域用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>ssh服务也可以正常登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="built_in">test</span>@192.168.3.2</span><br></pre></td></tr></table></figure><h2 id="命令行发现与加入域"><a href="#命令行发现与加入域" class="headerlink" title="命令行发现与加入域"></a>命令行发现与加入域</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm list: 列出所有配置的域。realm discover: 自动发现可用的域。realm <span class="built_in">join</span>: 将系统加入到指定的域中。realm leave: 将系统从指定的域中移除。realm permit: 允许特定用户或组访问域。realm deny: 拒绝特定用户或组访问域。</span><br></pre></td></tr></table></figure><h3 id="常见用法如下"><a href="#常见用法如下" class="headerlink" title="常见用法如下"></a>常见用法如下</h3><p><code>realm list</code>: 显示当前系统上已配置的域。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm list</span><br></pre></td></tr></table></figure><p><code>realm discover [DOMAIN]</code>: 自动发现指定域的配置信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm discover qclr.qclr</span><br></pre></td></tr></table></figure><p><code>realm join [DOMAIN]</code>: 将系统加入到指定域中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm <span class="built_in">join</span> qclr.qclr -U administrator</span><br></pre></td></tr></table></figure><p><code>realm leave [DOMAIN]</code>: 将系统从指定域中移除。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm leave qclr.qclr</span><br></pre></td></tr></table></figure><p><code>realm permit [USER]</code>: 允许指定用户访问域。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm permit <span class="built_in">test</span>@qclr.qclr</span><br></pre></td></tr></table></figure><p><code>realm deny [USER]</code>: 拒绝指定用户访问域。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm deny <span class="built_in">test</span>@qclr.qclr</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux轻松加入AD域环境</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux扩容的两种方法探索</title>
    <link href="http://example.com/2024/08/25/Linux%E6%89%A9%E5%AE%B9%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%81%9A%E6%B3%95%E6%8E%A2%E7%B4%A2/"/>
    <id>http://example.com/2024/08/25/Linux%E6%89%A9%E5%AE%B9%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%81%9A%E6%B3%95%E6%8E%A2%E7%B4%A2/</id>
    <published>2024-08-25T01:25:00.000Z</published>
    <updated>2024-08-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux扩容的两种方法探索"><a href="#Linux扩容的两种方法探索" class="headerlink" title="Linux扩容的两种方法探索"></a>Linux扩容的两种方法探索</h2><ul><li>要扩展的vg和lv的名称要确定</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgdisplay</span><br><span class="line">lvdisplay</span><br></pre></td></tr></table></figure><h3 id="先分区再扩容"><a href="#先分区再扩容" class="headerlink" title="先分区再扩容"></a>先分区再扩容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w</span><br><span class="line">vgextend myvg /dev/sdb1</span><br><span class="line">lvresize  -L +20G  /dev/myvg-mylv</span><br><span class="line">xfs_growfs /dev/myvg-mylv</span><br></pre></td></tr></table></figure><h3 id="不分区直接扩"><a href="#不分区直接扩" class="headerlink" title="不分区直接扩"></a>不分区直接扩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs /dev/sdb</span><br><span class="line">pvcreate /dev/sdb</span><br><span class="line">vgextend myvg /dev/sdb</span><br><span class="line">lvextend -l +100%FREE /dev/myvg-mylv</span><br><span class="line">xfs_growfs /dev/myvg-mylv</span><br></pre></td></tr></table></figure><h3 id="本质区别"><a href="#本质区别" class="headerlink" title="本质区别"></a>本质区别</h3><ol><li><strong>分区 vs. 整个磁盘</strong>：第一种方法直接使用整个磁盘，而第二种方法则是通过分区来管理磁盘空间。</li><li><strong>灵活性</strong>：第二种方法提供了更大的灵活性，可以在同一块磁盘上创建多个分区，适合需要在同一磁盘上管理多个逻辑卷的场景。</li><li><strong>空间管理</strong>：第一种方法在扩展时会使用整个磁盘的空间，而第二种方法可以根据需要选择扩展的大小。</li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>选择哪种方法取决于具体的需求和环境。如果需要简单快速的扩展，第一种方法可能更合适；如果需要更细致的空间管理和灵活性，第二种方法则更为合适。</p><h3 id="在多路径磁盘的场景下"><a href="#在多路径磁盘的场景下" class="headerlink" title="在多路径磁盘的场景下"></a>在多路径磁盘的场景下</h3><p>在多路径（Multipath）配置的环境中，通常建议使用第一种方法，即直接在整个磁盘上进行操作。这是因为多路径设备通常会被视为一个逻辑设备，而不是多个物理分区。以下是一些原因和建议。</p><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><ol><li><strong>多路径设备的特性</strong>：多路径设备通常会将多个物理路径聚合为一个逻辑设备。在这种情况下，直接在整个设备上进行操作，可以避免潜在的分区问题。</li><li><strong>分区问题</strong>：如果你尝试在多路径设备上创建分区，可能会导致设备识别错误或路径不一致，从而引发错误。这是因为多路径设备的管理和分区可能会与预期不符。</li><li><strong>简化管理</strong>：使用整个磁盘作为物理卷可以简化管理，避免在多路径环境中处理多个分区的复杂性。</li><li><strong>多路径设备</strong>：如果你在多路径环境中工作，确保你使用的是多路径设备的正确名称（例如 <code>/dev/mapper/mpath0</code>），而不是物理设备名称。</li></ol><h4 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h4><ul><li><strong>使用第一种方法</strong>：在多路径环境中，建议直接使用整个磁盘进行物理卷的创建和逻辑卷的扩展。</li><li><strong>确保多路径配置正确</strong>：在进行任何操作之前，确保多路径配置正确，并且可以通过 <code>multipath -ll</code> 命令查看多路径设备的状态。</li><li><strong>备份数据</strong>：在进行扩展操作之前，始终备份重要数据，以防止意外情况导致数据丢失。</li></ul>]]></content>
    
    
    <summary type="html">Linux扩容的两种方法探索</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Centos7进入单用户模式修改密码</title>
    <link href="http://example.com/2024/08/25/centos7%E8%BF%9B%E5%85%A5%E5%8D%95%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/"/>
    <id>http://example.com/2024/08/25/centos7%E8%BF%9B%E5%85%A5%E5%8D%95%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/</id>
    <published>2024-08-25T01:25:00.000Z</published>
    <updated>2024-08-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Centos7进入单用户模式修改密码"><a href="#Centos7进入单用户模式修改密码" class="headerlink" title="Centos7进入单用户模式修改密码"></a>Centos7进入单用户模式修改密码</h2><p>本篇文章适用于经常忘记自己root用户密码的初学者！！！，会进入单用户模式修改root密码即可。</p><ol><li>系统启动进入到如下界面后输入字母“e”;</li><li>可以看到进入到如下界面；</li></ol><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913104710.png"></p><p>3.一直下翻到图中圈起来的这部分；</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913104739.png"></p><p>4.在Linux16这一段的最后（UTF-8）加上 <code>init=/bin/sh</code>;</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913104812.png"></p><p>5.按下<code>Ctrl X</code>,进入到如下界面；<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913104855.png"><br>6.输入命令：<code>mount -o remount,rw /</code>,如下图所示；<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913104956.png"></p><p>7.修改root密码；<code>passwd root</code><br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913105031.png"></p><p>8.输入命令<code>touch /.autorelabel</code>;<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913105110.png"></p><p>9.输入命令<code>exec /sbin/init</code>,退出单用户模式；</p><p>10、出现如下界面，等待即可</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240913105159.png"></p><p>11、验证效果，密码修改成功；</p><p><strong>注意事项 ：</strong></p><p>linux还有一个紧急救援模式，这里做一个简单区分。单用户模式适用于可以进入系统，只是root密码忘记 的场景；而紧急救援模式适用于系统无法进入，如grub损坏或某个配置文件改错等情况，<strong>救援模式需要挂载镜像</strong></p>]]></content>
    
    
    <summary type="html">Centos7进入单用户模式修改密码</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>lsof命令</title>
    <link href="http://example.com/2024/08/25/linux%E4%B8%80%E4%B8%AA%E5%BE%88%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%9Alsof/"/>
    <id>http://example.com/2024/08/25/linux%E4%B8%80%E4%B8%AA%E5%BE%88%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%9Alsof/</id>
    <published>2024-08-25T01:25:00.000Z</published>
    <updated>2024-08-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux一个很强大的命令：lsof"><a href="#Linux一个很强大的命令：lsof" class="headerlink" title="Linux一个很强大的命令：lsof"></a>Linux一个很强大的命令：lsof</h1><p><code>lsof</code>是一个命令行实用程序，用于列出有关由各种进程打开的文件的信息。在 <code>Linux</code> 中，一切都是文件（管道、套接字、目录、设备等）。因此，通过使用 <code>lsof</code>，您可以获得有关任何已打开文件的信息。<code>lsof代表列出打开的文件。</code>如果您将 lsof 命令视为<code>ls + of</code>，则很容易记住它，其中 <code>ls</code> 代表列表，<code>of</code> 代表打开的文件。</p><p>只需键入 <code>lsof</code> 即可提供属于所有活动进程的所有打开文件的列表。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof</span></span><br><span class="line">COMMAND  PID       USER   FD      TYPE     DEVICE  SIZE/OFF       NODE NAME</span><br><span class="line">init       1       root  cwd       DIR        8,1      4096          2 /</span><br><span class="line">init       1       root  txt       REG        8,1    124704     917562 /sbin/init</span><br><span class="line">init       1       root    0u      CHR        1,3       0t0       4369 /dev/null</span><br><span class="line">init       1       root    1u      CHR        1,3       0t0       4369 /dev/null</span><br><span class="line">init       1       root    2u      CHR        1,3       0t0       4369 /dev/null</span><br><span class="line">init       1       root    3r     FIFO        0,8       0t0       6323 pipe</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>默认情况下，每行显示一个文件。大多数列都是不言自明的。我们将解释几个神秘的列<code>（FD 和 TYPE）</code>的细节。</p><p><strong>FD代表文件描述符。FD的一些值是：</strong></p><ul><li><code>cwd</code> - 当前工作目录</li><li><code>txt</code> - 文本文件</li><li><code>mem</code> – 内存映射文件</li><li><code>mmap</code> – 内存映射设备</li><li><code>NUMBER</code> – 表示实际的文件描述符。数字后面的字符，即<code>1u</code>，代表文件打开的模式。<code>r</code> 读，<code>w</code> 写，<code>u</code> 读和写。</li></ul><p><strong>TYPE指定文件的类型。类型的一些值是：</strong></p><ul><li><p><code>REG</code> – 常规文件</p></li><li><p><code>DIR</code>——目录</p></li><li><p><code>FIFO</code>——先进先出</p></li><li><p><code>CHR</code>——字符特殊文件</p></li></ul><h3 id="列出打开特定文件的进程"><a href="#列出打开特定文件的进程" class="headerlink" title="列出打开特定文件的进程"></a>列出打开特定文件的进程</h3><p>通过提供文件名作为参数，您可以仅列出打开特定文件的进程。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof /var/log/syslog</span></span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">rsyslogd 488 syslog    1w   REG    8,1     1151 268940 /var/log/syslog</span><br></pre></td></tr></table></figure><h3 id="列出目录下打开的文件"><a href="#列出目录下打开的文件" class="headerlink" title="列出目录下打开的文件"></a>列出目录下打开的文件</h3><p>您可以使用<code>+D</code>选项列出在指定目录下打开文件的进程。<code>+D</code> 也将递归子目录。如果您不希望 <code>lsof</code> 递归，请使用<code>+d</code>选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof +D /var/log/</span></span><br><span class="line"></span><br><span class="line">COMMAND   PID   USER  FD   TYPE DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">rsyslogd  488 syslog   1w   REG    8,1     1151 268940 /var/log/syslog</span><br><span class="line">rsyslogd  488 syslog   2w   REG    8,1     2405 269616 /var/log/auth.log</span><br><span class="line">console-k 144   root   9w   REG    8,1    10871 269369 /var/log/ConsoleKit/history</span><br></pre></td></tr></table></figure><h3 id="根据进程名列出打开的文件"><a href="#根据进程名列出打开的文件" class="headerlink" title="根据进程名列出打开的文件"></a>根据进程名列出打开的文件</h3><p>您可以使用<code>-c</code>选项列出以字符串开头的进程名称打开的文件。<code>-c</code> 后跟进程名称将列出以该进程名称开头的进程打开的文件。您可以在单个命令行上提供多个 <code>-c</code> 开关。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -c ssh -c init</span></span><br><span class="line"></span><br><span class="line">COMMAND    PID   USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">init         1       root  txt    REG        8,1   124704  917562 /sbin/init</span><br><span class="line">init         1       root  mem    REG        8,1  1434180 1442625 /lib/i386-linux-gnu/libc-2.13.so</span><br><span class="line">init         1       root  mem    REG        8,1    30684 1442694 /lib/i386-linux-gnu/librt-2.13.so</span><br><span class="line">...</span><br><span class="line">ssh-agent 1528 zhangsan    1u   CHR        1,3      0t0    4369 /dev/null</span><br><span class="line">ssh-agent 1528 zhangsan    2u   CHR        1,3      0t0    4369 /dev/null</span><br><span class="line">ssh-agent 1528 zhangsan    3u  unix 0xdf70e240      0t0   10464 /tmp/ssh-sUymKXxw1495/agent.1495</span><br></pre></td></tr></table></figure><h3 id="使用挂载点列出进程"><a href="#使用挂载点列出进程" class="headerlink" title="使用挂载点列出进程"></a>使用挂载点列出进程</h3><p>有时当我们尝试卸载目录时，系统会提示“设备或资源忙”错误。所以我们需要找出所有使用挂载点的进程并杀死这些进程以卸载目录。通过使用 lsof 我们可以找到这些进程。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof /home</span></span><br></pre></td></tr></table></figure><p>以下也将起作用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof +D /home/</span></span><br></pre></td></tr></table></figure><h3 id="列出特定用户打开的文件"><a href="#列出特定用户打开的文件" class="headerlink" title="列出特定用户打开的文件"></a>列出特定用户打开的文件</h3><p>要查找特定用户打开的文件列表，请使用<code>-u</code>选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u zhangsan</span></span><br><span class="line"></span><br><span class="line">COMMAND    PID       USER   FD   TYPE     DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">update-no 1892 zhangsan   20r  FIFO        0,8      0t0      14536 pipe</span><br><span class="line">update-no 1892 zhangsan   21w  FIFO        0,8      0t0      14536 pipe</span><br><span class="line">bash      1995 zhangsan  cwd    DIR        8,1     4096     393218 /home/zhangsan</span><br></pre></td></tr></table></figure><p>有时您可能希望列出所有用户打开的文件，预计有 1 或 2 个。在这种情况下，您可以使用 ‘^’ 仅排除特定用户，如下所示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u ^zhangsan</span></span><br><span class="line"></span><br><span class="line">COMMAND    PID       USER   FD      TYPE     DEVICE  SIZE/OFF       NODE NAME</span><br><span class="line">rtkit-dae 1380      rtkit    7u     0000        0,9         0       4360 anon_inode</span><br><span class="line">udisks-da 1584       root  cwd       DIR        8,1      4096          2 /</span><br></pre></td></tr></table></figure><p>上面的命令列出了所有用户打开的所有文件，除了用户’zhangsan’。</p><h3 id="按特定进程列出所有打开的文件"><a href="#按特定进程列出所有打开的文件" class="headerlink" title="按特定进程列出所有打开的文件"></a>按特定进程列出所有打开的文件</h3><p>您可以使用“-p”选项列出特定进程打开的所有文件。有时获取有关特定流程的更多信息会很有帮助。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -p 1753</span></span><br><span class="line"></span><br><span class="line">COMMAND  PID       USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">bash    1753 zhangsan  cwd    DIR    8,1     4096  393571 /home/zhangsan/test.txt</span><br><span class="line">bash    1753 zhangsan  rtd    DIR    8,1     4096       2 /</span><br><span class="line">bash    1753 zhangsan  255u   CHR  136,0      0t0       3 /dev/pts/0</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="kill属于特定用户的所有进程"><a href="#kill属于特定用户的所有进程" class="headerlink" title="kill属于特定用户的所有进程"></a>kill属于特定用户的所有进程</h3><p>当你想kill所有由特定用户打开文件的进程时，你可以使用’-t’选项列出只输出进程的进程id，并将其传递给<code>kill</code>，如下所示。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kill -9 `lsof -t -u zhangsan`</span></span><br></pre></td></tr></table></figure><p>上述命令将kill属于用户“zhangsan”的所有进程，该用户已打开文件。</p><p>同样，您也可以通过多种方式使用“-t”。例如，列出打开 &#x2F;var&#x2F;log&#x2F;syslog 的进程的进程 ID 可以通过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -t /var/log/syslog489</span></span><br></pre></td></tr></table></figure><h3 id="使用-OR-AND-组合更多列表选项"><a href="#使用-OR-AND-组合更多列表选项" class="headerlink" title="使用 OR&#x2F;AND 组合更多列表选项"></a>使用 OR&#x2F;AND 组合更多列表选项</h3><p>默认情况下，当您在 lsof 中使用多个列表选项时，它们将被 ORed。例如，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u zhangsan -c init</span></span><br><span class="line"></span><br><span class="line">COMMAND    PID       USER   FD   TYPE     DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">init         1       root  cwd    DIR        8,1     4096          2 /</span><br><span class="line">init         1       root  txt    REG        8,1   124704     917562 /sbin/init</span><br><span class="line">bash      1995 zhangsan    2u   CHR      136,2      0t0          5 /dev/pts/2</span><br><span class="line">bash      1995 zhangsan  255u   CHR      136,2      0t0          5 /dev/pts/2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>上面的命令使用两个列表选项，<code>-u和-c</code>。因此该命令将列出属于用户<code>zhangsan</code>的进程以及以<code>init</code>开头的进程名称。</p><p>但是当你想列出一个进程属于用户<code>zhangsan</code>并且进程名称以<code>init</code>开头时，你可以使用<code>-a</code>选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u zhangsan -c init -a</span></span><br></pre></td></tr></table></figure><p>上面的命令不会输出任何东西，因为不存在属于用户<code>zhangsan</code>的名为 <code>init</code>的进程。</p><h3 id="以重复模式执行lsof"><a href="#以重复模式执行lsof" class="headerlink" title="以重复模式执行lsof"></a>以重复模式执行lsof</h3><p>lsof 还支持重复模式。它将首先根据给定的参数列出文件，并延迟指定的秒数，然后再次根据给定的参数列出文件。它可以被信号中断。</p><p>可以使用<code>-r</code>或<code>+r</code>启用重复模式。如果然后使用<code>+r</code>，则重复模式将在没有找到打开的文件时结束。<code>-r</code> 将继续列出、延迟、列出直到给出中断，而不管文件是否打开。</p><p>每个循环输出将使用 ‘<code>=======&#39;</code> 分隔。您还可以将时间延迟指定为 <code>-r</code> |<code>+r</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u zhangsan -c init -a -r5</span></span><br><span class="line"></span><br><span class="line">=======</span><br><span class="line">=======</span><br><span class="line">COMMAND   PID       USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">inita.sh 2971 zhangsan  cwd    DIR    8,1     4096  393218 /home/zhangsan</span><br><span class="line">inita.sh 2971 zhangsan  rtd    DIR    8,1     4096       2 /</span><br><span class="line">inita.sh 2971 zhangsan  txt    REG    8,1    83848  524315 /bin/dash</span><br><span class="line">inita.sh 2971 zhangsan  mem    REG    8,1  1434180 1442625 /lib/i386-linux-gnu/libc-2.13.so</span><br><span class="line">inita.sh 2971 zhangsan  mem    REG    8,1   117960 1442612 /lib/i386-linux-gnu/ld-2.13.so</span><br><span class="line">inita.sh 2971 zhangsan    0u   CHR  136,4      0t0       7 /dev/pts/4</span><br><span class="line">inita.sh 2971 zhangsan    1u   CHR  136,4      0t0       7 /dev/pts/4</span><br><span class="line">inita.sh 2971 zhangsan    2u   CHR  136,4      0t0       7 /dev/pts/4</span><br><span class="line">inita.sh 2971 zhangsan   10r   REG    8,1       20  393578 /home/zhangsan/inita.sh</span><br><span class="line">=======</span><br></pre></td></tr></table></figure><p>在上面的输出中，前 5 秒没有输出。之后启动名为<code>inita.sh</code>的脚本，并列出输出。</p><h3 id="寻找网络连接"><a href="#寻找网络连接" class="headerlink" title="寻找网络连接"></a>寻找网络连接</h3><p>网络连接也是文件。因此我们可以使用 <code>lsof</code> 找到有关它们的信息。</p><h4 id="列出所有网络连接"><a href="#列出所有网络连接" class="headerlink" title="列出所有网络连接"></a>列出所有网络连接</h4><p>您可以使用<code>-i</code>选项列出所有打开的网络连接。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i</span></span><br><span class="line"></span><br><span class="line">COMMAND    PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">avahi-dae  515 avahi   13u  IPv4   6848      0t0  UDP *:mdns</span><br><span class="line">avahi-dae  515 avahi   16u  IPv6   6851      0t0  UDP *:52060</span><br><span class="line">cupsd     1075  root    5u  IPv6  22512      0t0  TCP ip6-localhost:ipp (LISTEN)</span><br></pre></td></tr></table></figure><p>您还可以使用<code>-i4</code>或<code>-i6</code>分别仅列出<code>IPV4</code>或<code>IPV6</code>。</p><h4 id="列出特定进程正在使用的所有网络文件"><a href="#列出特定进程正在使用的所有网络文件" class="headerlink" title="列出特定进程正在使用的所有网络文件"></a>列出特定进程正在使用的所有网络文件</h4><p>您可以列出进程正在使用的所有网络文件，如下所示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i -a -p 234</span></span><br></pre></td></tr></table></figure><p>您还可以使用以下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i -a -c ssh</span></span><br></pre></td></tr></table></figure><p>上面的命令会列出以 ssh 开头的进程打开的网络文件。</p><h4 id="列出正在监听特定端口的进程"><a href="#列出正在监听特定端口的进程" class="headerlink" title="列出正在监听特定端口的进程"></a>列出正在监听特定端口的进程</h4><p>您可以使用<code>i</code> 和 <code>:</code> 列出正在侦听特定端口的进程，如下所示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i :25</span></span><br><span class="line"></span><br><span class="line">COMMAND  PID        USER   FD   TYPE DEVICE SIZE NODE NAME</span><br><span class="line">exim4   2541 Debian-exim    3u  IPv4   8677       TCP localhost:smtp (LISTEN)</span><br></pre></td></tr></table></figure><h4 id="列出所有-TCP-或-UDP-连接"><a href="#列出所有-TCP-或-UDP-连接" class="headerlink" title="列出所有 TCP 或 UDP 连接"></a>列出所有 TCP 或 UDP 连接</h4><p>您可以通过使用<code>-i</code>指定协议来列出所有 TCP 或 UDP 连接。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i tcp; lsof -i udp;</span></span><br></pre></td></tr></table></figure><h4 id="列出所有网络文件系统-NFS-文件"><a href="#列出所有网络文件系统-NFS-文件" class="headerlink" title="列出所有网络文件系统 (NFS) 文件"></a>列出所有网络文件系统 (NFS) 文件</h4><p>您可以使用<code>-N</code>选项列出所有 <code>NFS</code> 文件。以下 <code>lsof</code> 命令将列出用户<code>zhangsan</code>使用的所有 <code>NFS</code> 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -N -u zhangsan -a</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux一个很强大的命令：lsof</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Centos7将网卡名 ens修改为 eth</title>
    <link href="http://example.com/2024/08/23/centos7%E5%B0%86%E7%BD%91%E5%8D%A1%E4%BB%8Eens%E4%BF%AE%E6%94%B9%E6%88%90eth/"/>
    <id>http://example.com/2024/08/23/centos7%E5%B0%86%E7%BD%91%E5%8D%A1%E4%BB%8Eens%E4%BF%AE%E6%94%B9%E6%88%90eth/</id>
    <published>2024-08-23T01:25:00.000Z</published>
    <updated>2024-08-23T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Centos7将网卡名-ens修改为-eth"><a href="#Centos7将网卡名-ens修改为-eth" class="headerlink" title="Centos7将网卡名 ens修改为 eth"></a>Centos7将网卡名 ens修改为 eth</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><ul><li>grub已经有参数的就不用重新生成文件了，不然可能会有奇怪的问题，此方法只针对没经修改过配置的系统</li></ul><ul><li><p>为什么要修改网卡名称？</p><blockquote><p>以往的 CentOS7 以前的系统网卡命名虽然简单方便，但也会带来一些问题，例如，当 eth0 接口对应的网卡出问题以后，更换掉新网卡后新网卡的名字就可能不是 eth0 了。而 CentOS7 使用了新的网卡命名模式，接口名称被自动基于固件，拓扑结构和位置信息来确定。即使添加或移除网络设备，接口名称仍然保持固定，而无需重新枚举，和坏掉的硬件可以无缝替换。虽然新的命名有好处，但是新的接口名称命名方案比传统的 eth0 相比起来更难使用，出于习惯，把网卡名改为 eth0。</p></blockquote></li></ul><h3 id="1-修改网卡名称"><a href="#1-修改网卡名称" class="headerlink" title="1. 修改网卡名称"></a>1. 修改网卡名称</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/ &amp;&amp; <span class="built_in">mv</span> ifcfg-ens33 ifcfg-eth0</span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20240911191546.png"></p><h3 id="2-修改网卡的配置信息"><a href="#2-修改网卡的配置信息" class="headerlink" title="2. 修改网卡的配置信息"></a>2. 修改网卡的配置信息</h3><p>修改 ifcfg-eth0 文件的内容，<code>NAME=&quot;eth0&quot;</code>、<code>NAME=&quot;eth0&quot;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim ifcfg-eth0</span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0   <span class="comment">#这个</span></span><br><span class="line">UUID=1c028535-bd1d-4158-a1c0-29b077c7562c</span><br><span class="line">DEVICE=eth0   <span class="comment">#这个</span></span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=192.168.190.40</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.190.2</span><br><span class="line">DNS1=192.168.190.2</span><br></pre></td></tr></table></figure><p>下图所示是修改完之后的内容：<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20240911190752.png"></p><h3 id="3-修改并生成-grub-配置"><a href="#3-修改并生成-grub-配置" class="headerlink" title="3. 修改并生成 grub 配置"></a>3. 修改并生成 grub 配置</h3><ul><li>修改 grub 配置文件：<code>vim /etc/sysconfig/grub</code>；在文件中添加：<code>net.ifnames=0 biosdevname=0</code><br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20240911191055.png"></li><li>生成 grub 启动菜单，执行命令：<code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 network-scripts]<span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-1160.118.1.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-1160.118.1.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-c08aee54fcd84c1b957d27c58d566c61</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-c08aee54fcd84c1b957d27c58d566c61.img</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="4-重启系统"><a href="#4-重启系统" class="headerlink" title="4. 重启系统"></a>4. 重启系统</h3><h3 id="5-检验是否修改成功"><a href="#5-检验是否修改成功" class="headerlink" title="5. 检验是否修改成功"></a>5. 检验是否修改成功</h3><p>执行命令：<code>ifconfig</code>，查看一下自己的网卡名已经改为 eth0<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/20240911190935.png"></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>在装系统进入安装界面的时候按<code>tab</code>键，将参数<code>net.ifnames=0 biosdevname=0</code>输入到最后面,然后再安装</p>]]></content>
    
    
    <summary type="html">Centos7将网卡名 ens修改为 eth</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>firewalld防火墙的详细讲解</title>
    <link href="http://example.com/2024/08/22/firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A3/"/>
    <id>http://example.com/2024/08/22/firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A3/</id>
    <published>2024-08-22T01:25:00.000Z</published>
    <updated>2024-08-22T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="firewalld防火墙的详细讲解"><a href="#firewalld防火墙的详细讲解" class="headerlink" title="firewalld防火墙的详细讲解"></a>firewalld防火墙的详细讲解</h1><h2 id="防火墙概述"><a href="#防火墙概述" class="headerlink" title="防火墙概述"></a>防火墙概述</h2><p>Firewalld是一种提供了支持网络&#x2F;防火墙区域（zone）定义网络链接以及接口安全等级的动态防火墙管理工具，它<span style="color:#FF0000;">自身并不具备防火墙的功能</span>，而是和iptables一样需要<span style="color:#FF0000; font-style:italic;">通过内核的netfilter来实现</span>。他们的作用是维护规则，<span style="color:#FF0000;">而真正使用规则干活的是内核<code>netfilter</code></span>，firewalld和iptables的结构以及使用方法会有点不一样。</p><ul><li><p>从逻辑上可分为：<span style="color:#FF0000;">主机防火墙和网络防火墙 </span></p></li><li><p>从物理上可分为：<span style="color:#FF0000;">硬件防火墙和软件防火墙</span></p></li></ul><p><span style="font-style:italic; color:#FF0000;">firewalld和iptables就属于主机层面的防火墙</span></p><p>主机防火墙主要通过netfilter和TCP Wrappers两个机制来管理的。</p><p>Netfilter：数据包过滤机制 TCP Wrappers：程序管理机制</p><p>关于数据包过滤机制（Netfilter）两个软件：firewalld与iptables</p><p><span style="font-weight:bold;">注意：在RHEL7系列中，默认使用firewalld作为防火墙。在7系列之前使用的是iptables作为默认防火墙。</span></p><h2 id="Firewalld原理架构"><a href="#Firewalld原理架构" class="headerlink" title="Firewalld原理架构"></a>Firewalld原理架构</h2><h3 id="Firewalld区域管理"><a href="#Firewalld区域管理" class="headerlink" title="Firewalld区域管理"></a>Firewalld区域管理</h3><p>通过将网络划分成不同的区域，制定出不同区域之间的访问控制策略来控制不同程序区域间传送的数据流。</p><p>【例如】互联网是不可信任的区域，而内部网络是高度信任的区域。网络安全模型可以在安装， 初次启动和首次建立网络连接时选择初始化。该模型描述了主机所连接的整个网络环境的可信级别，并定义了新连接的处理方式。</p><h3 id="Firewalld域"><a href="#Firewalld域" class="headerlink" title="Firewalld域"></a>Firewalld域</h3><table><thead><tr><th align="center">网络区名称</th><th align="left">默认配置</th></tr></thead><tbody><tr><td align="center">trusted</td><td align="left">可接受所有的网络连接</td></tr><tr><td align="center">home</td><td align="left">用于家庭网络</td></tr><tr><td align="center">internal</td><td align="left">用于内部网络，仅接受ssh,mdns,gp-client,samba-client,dhcpv6-client连接</td></tr><tr><td align="center">work</td><td align="left">用于工作区，仅接受sshjpp-client,dhcpv6-client服务连接</td></tr><tr><td align="center">public</td><td align="left">用于工作区， 仅接受ssh,ipp-client,dhcpv6-client服务连接，在公共区域内使用，仅接受ssh或dhcpv6-client服务连接，是firewalld的默认区域</td></tr><tr><td align="center">dmz</td><td align="left">仅接受ssh服务的连接</td></tr></tbody></table><p><span style="font-weight:bold;">【温馨提示】<code>firewalld</code>的默认区域是 <code>public</code></span></p><h3 id="Firewalld配置文件"><a href="#Firewalld配置文件" class="headerlink" title="Firewalld配置文件"></a>Firewalld配置文件</h3><p><code>firewalld</code><span style="color:#FF0000;">默认提供了九个zone配置文件</span>：<code>block.xml、 dmz.xml、 drop.xml、 external.xml、 home.xml、 internal.xml、 public.xml、 trusted.xml、 work.xml</code>，都保存在 <code>/usr/lib/firewalld/zones/</code>目录下。</p><h2 id="Firewalld-和-Iptables-的异同"><a href="#Firewalld-和-Iptables-的异同" class="headerlink" title="Firewalld 和 Iptables 的异同"></a>Firewalld 和 Iptables 的异同</h2><h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><p>firewalld与 iptables 都是 linux 中防火墙的管理程序，但其实其角色主要为对于防火墙策略的管理，真正的防火墙执行者是位于内核中的 netfilter。</p><h3 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h3><ul><li>iptables 仅能通过命令行进行配置；而 <code>firewalld</code> 提供了图形接口，类似<code>windows</code>防火墙的操作方式；</li><li>iptables 每一个单独更改意味着清除所有旧的规则，并从 <code>/etc/sysconfig/iptables</code> 中读取所有新的规则；而 firewalld 在有规则变动后，可以仅仅运行规则中的不同之处，即在 firewalld 运行时间内，改变设置时可以不丢失现行链接；</li><li>iptables 的配置文件在 <code>/etc/sysconfig/iptables</code> 中；而 firewalld 的配置文件在 <code>/usr/lib/firewalld/</code> 和 <code>/etc/firewalld/</code> 中的各种 <code>XML</code> 文件中；</li><li><span style="color:#FF0000;"><code>iptables</code> 没有守护进程，并不能算是真正意义上的服务；而 <code>firewalld</code> 有守护进程；</span></li><li><span style="color:#FF0000;"><code>iptables</code> 通过控制端口来控制服务，而 <code>firewalld</code> 则是通过控制协议来控制端口</span></li><li><span style="color:#FF0000;"><code>firewalld</code>默认是拒绝，而<code>iptables</code>默认是允许</span></li></ul><p><span style="font-weight:bold; font-style:italic; color:#0000CC;">【温馨提示】</span></p><p>service说明：在 <code>/usr/lib/firewalld/services/</code> 目录中，还保存了另外一类配置文件，每个文件对应一项具体的网络服务，如 ssh 服务等。这个目录下的服务配置默认是放通的，不受<code>firewalld-cmd</code> 规则控制，除非把这个目录下的服务配置文件删掉，就恢复了默认了（默认拒绝），当然也可以添加一些服务配置文件。</p><h2 id="Firewalld常用操作"><a href="#Firewalld常用操作" class="headerlink" title="Firewalld常用操作"></a>Firewalld常用操作</h2><p>firewall-config(需要有图形化界面的才能使用), firewall-cmd是命令行工具，实际生产环境主要使用firewall-cmd来操作</p><h3 id="Firewalld规则的两种状态"><a href="#Firewalld规则的两种状态" class="headerlink" title="Firewalld规则的两种状态"></a>Firewalld规则的两种状态</h3><p>**运行时（ runtime)**：<span style="color:#0000CC;">修改规则马上生效,但是临时生效，默认是运行时状态</span></p><p><strong>持久配置（ permanent）</strong>：<span style="color:#0000CC;">修改后需要重载才会生效，有–permanent参数</span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent [RULE]</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h3 id="Firewalld常见选项"><a href="#Firewalld常见选项" class="headerlink" title="Firewalld常见选项"></a>Firewalld常见选项</h3><p>可以通过 <code>man firewall-cmd</code>或者 <code>firewall-cmd --help</code>查看帮助，<code>firewalld</code>的选项很多，下面列出一些比较常用的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">    --permanent  <span class="comment"># 配置写入到配置文件，永久生效</span></span><br><span class="line">    --reload     <span class="comment"># 重载配置文件，永久生效</span></span><br><span class="line">    --zone=      <span class="comment"># 指定区域，默认是public</span></span><br><span class="line">    --get-default-zone   <span class="comment"># 查看默认区域</span></span><br><span class="line">    --set-default-zone=   <span class="comment"># 设置默认区域</span></span><br><span class="line">    --get-zones     <span class="comment"># 获取所有可用的区域</span></span><br><span class="line">    --get-active-zones  <span class="comment"># 获取当前激活（活跃）的区域</span></span><br><span class="line">    --add-source=    <span class="comment"># 添加地址，可以是主机或网段，遵循当前区域的target</span></span><br><span class="line">    --remove-source  <span class="comment"># 移除地址，可以是主机或网段，遵循当前区域的target</span></span><br><span class="line">    --add-service=    <span class="comment"># 添加服务</span></span><br><span class="line">    --remove-service=   <span class="comment"># 移除服务</span></span><br><span class="line">    --list-services     <span class="comment"># 显示当前区域内允许访问的所有服务</span></span><br><span class="line">    --add-port=xx/tcp    <span class="comment"># 添加端口,后面要指定是TCP还是UDP</span></span><br><span class="line">    --remove-port=    <span class="comment"># 移除端口，遵循当前区域的target</span></span><br><span class="line">    --list-ports   <span class="comment"># 显示指定区域内允许访问的所有端口号</span></span><br><span class="line">    --list-all     <span class="comment"># 列出当前使用的区域的配置</span></span><br><span class="line">    --list-all-zones   <span class="comment"># 列出所有区域的配置</span></span><br><span class="line">    --get-zone-of-interface=    <span class="comment"># 获取指定接口所在的区域</span></span><br><span class="line">    --list-icmp-blocks   <span class="comment"># 显示指定区域内拒绝访问的所有ICMP类型</span></span><br><span class="line">    --list-protocols       <span class="comment">#--列出在指定区域中允许通过的协议</span></span><br></pre></td></tr></table></figure><h3 id="常用的增删改查操作（重点）"><a href="#常用的增删改查操作（重点）" class="headerlink" title="常用的增删改查操作（重点）"></a><span style="font-style:italic; color:#CC0000;">常用的增删改查操作（重点）</span></h3><p><strong>（1）查看规则</strong></p><p>查看当前区域的配置信息详解</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ]<span class="comment"># firewall-cmd --list-all</span></span><br><span class="line">public (active)   <span class="comment"># 活动的区域</span></span><br><span class="line">  target: default <span class="comment"># 默认启动的区域</span></span><br><span class="line">  icmp-block-inversion: no  <span class="comment"># ICMP协议类型黑白名单开关（yes/no）</span></span><br><span class="line">  interfaces: eth0 <span class="comment"># 关联的网卡接口</span></span><br><span class="line">  sources:    <span class="comment"># 来源，可以是IP地址，也可以是mac地址</span></span><br><span class="line">  services: dhcpv6-client ssh   <span class="comment"># 列出允许通过这个防火墙的服务</span></span><br><span class="line">  ports: 80/tcp  <span class="comment"># 列出允许通过这个防火墙的目标端口。（即 需要对外开放的端口）</span></span><br><span class="line">  protocols:  <span class="comment"># 协议值可以是一个协议 ID 数字,或者一个协议名</span></span><br><span class="line">  masquerade: no   <span class="comment"># 表示这个区域是否允许 IP 伪装。如果允许，它将允许 IP 转发，它可以让你的计算机作为一个路由器</span></span><br><span class="line">  forward-ports:   <span class="comment"># 列出转发的端口</span></span><br><span class="line">  source-ports:  <span class="comment"># 允许的来源端口</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#可添加ICMP类型，当icmp-block-inversion为no时，这些ICMP类型被拒绝；</span></span><br><span class="line"><span class="comment">#当icmp-block-inversion为yes时,这些ICMP类型被允许</span></span><br><span class="line">  icmp-blocks:   </span><br><span class="line">  </span><br><span class="line">  rich rules:   <span class="comment"># 富规则，即更细致、更详细的防火墙规则策略，它的优先级在所有的防火墙策略中也是最高的</span></span><br><span class="line">    rule family=<span class="string">&quot;ipv4&quot;</span> <span class="built_in">source</span> address=<span class="string">&quot;192.168.250.0/24&quot;</span> accept</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><span style="font-weight:bold;">常用的查看信息</span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询默认区域配置信息</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定区域配置信息</span></span><br><span class="line">firewall-cmd --list-all --zone=work</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有端口</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询指定端口</span></span><br><span class="line">firewall-cmd --zone=public --query-port=22/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询放通IP段</span></span><br><span class="line">firewall-cmd --list-sources</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看默认区域</span></span><br><span class="line">firewall-cmd --get-default-zone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有可以使用的区域</span></span><br><span class="line">firewall-cmd --get-zones</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看活跃的区域</span></span><br><span class="line">firewall-cmd --get-active-zones</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡绑定在了哪个区域</span></span><br><span class="line">firewall-cmd --get-zone-of-interface=[IFACE]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有服务</span></span><br><span class="line">firewall-cmd --get-services</span><br></pre></td></tr></table></figure><p><strong>（2）添加规则</strong></p><p><strong>1、开放特定端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放3306端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放snmp的161的UDP端口,默认的zone是public,可以不指定zone</span></span><br><span class="line">firewall-cmd --add-port=161/udp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让配置生效</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看规则</span></span><br><span class="line">firewall-cmd --list-ports </span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p><strong>2、放通某个服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 放通nfs服务的所有端口</span></span><br><span class="line">firewall-cmd --zone=public --add-service=nfs --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 放通ssh服务</span></span><br><span class="line">firewall-cmd --zone=public --add-service=ssh --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 放通snmp服务</span></span><br><span class="line">firewall-cmd --zone=public --add-service=snmp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载防火墙</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看放通了哪些服务访问</span></span><br><span class="line">firewall-cmd --list-services</span><br></pre></td></tr></table></figure><p><strong>3、放通某个网段访问</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-source=10.10.10.0/24 --zone=public</span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">firewall-cmd --list-sources</span><br></pre></td></tr></table></figure><p><strong>（3）删除规则</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除开放的3306端口</span></span><br><span class="line">firewall-cmd --permanent --remove-port=3306/tcp </span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除nfs服务</span></span><br><span class="line">firewall-cmd --permanent --remove-service=nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除某个网段访问</span></span><br><span class="line">firewall-cmd --permanent --zone=public --remove-source=10.10.10.0/24</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="Firewalld防火墙富规则（重点）"><a href="#Firewalld防火墙富规则（重点）" class="headerlink" title="Firewalld防火墙富规则（重点）"></a><span style="font-weight:bold; font-style:italic; color:#CC0000;">Firewalld防火墙富规则（重点）</span></h2><p>富规则是为了更细粒度的管控，在生产环境用的比较多，重点掌握</p><h3 id="富规则常用的选项"><a href="#富规则常用的选项" class="headerlink" title="富规则常用的选项"></a>富规则常用的选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd</span><br><span class="line"></span><br><span class="line">  --list-rich-rules   --列出富规则</span><br><span class="line">  --add-rich-rule=&lt;rule&gt;    --添加富规则</span><br><span class="line">  --remove-rich-rule=&lt;rule&gt;   --移除富规则</span><br><span class="line">  --list-all 和 --list-all-zones         --也能列出存在的富规则</span><br></pre></td></tr></table></figure><h3 id="富规则语法"><a href="#富规则语法" class="headerlink" title="富规则语法"></a>富规则语法</h3><p>规则的几乎每个单一元素都能够以option&#x3D;value形式来采用附加参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rule</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">source</span>]</span><br><span class="line"></span><br><span class="line">  [destination]</span><br><span class="line"></span><br><span class="line">  service|port|protocol|icmp-block|masquerade|forward-port</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">log</span>]</span><br><span class="line"></span><br><span class="line">  [audit]</span><br><span class="line"></span><br><span class="line">  [accept|reject|drop]</span><br></pre></td></tr></table></figure><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">rule [family=<span class="string">&quot;ipv4|ipv6&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> address=<span class="string">&quot;address[/mask]&quot;</span> [invert=<span class="string">&quot;True&quot;</span>]</span><br><span class="line"></span><br><span class="line">destination address=<span class="string">&quot;address[/mask]&quot;</span> invert=<span class="string">&quot;True&quot;</span></span><br><span class="line"></span><br><span class="line">service name=<span class="string">&quot;service name&quot;</span></span><br><span class="line"></span><br><span class="line">port port=<span class="string">&quot;port value&quot;</span> protocol=<span class="string">&quot;tcp|udp&quot;</span></span><br><span class="line"></span><br><span class="line">protocol value=<span class="string">&quot;protocol value&quot;</span></span><br><span class="line"></span><br><span class="line">forward-port port=<span class="string">&quot;port value&quot;</span> protocol=<span class="string">&quot;tcp|udp&quot;</span> to-port=<span class="string">&quot;port value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> to-addr=<span class="string">&quot;address&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> [prefix=<span class="string">&quot;prefix text&quot;</span>] [level=<span class="string">&quot;log level&quot;</span>] [<span class="built_in">limit</span> value=<span class="string">&quot;rate/duration&quot;</span>]</span><br><span class="line"></span><br><span class="line">accept | reject [<span class="built_in">type</span>=<span class="string">&quot;reject type&quot;</span>] | drop</span><br></pre></td></tr></table></figure><h3 id="常用的富规则配置（重点）"><a href="#常用的富规则配置（重点）" class="headerlink" title="常用的富规则配置（重点）"></a>常用的富规则配置（重点）</h3><p><strong>（1）对特定IP访问特定端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=<span class="string">&quot;rule family=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>10.10.10.110/32<span class="string">&quot; port port=&quot;</span>1521<span class="string">&quot; protocol=&quot;</span>tcp<span class="string">&quot; accept&quot;</span> </span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p><strong>（2）批量加端口，允许某个网段访问多个端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent  --add-rich-rule=<span class="string">&#x27;rule family=ipv4 source address=10.10.10.0/24 port port=8080-8090 protocol=tcp accept&#x27;</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p><strong>(3)开通某个IP访问某个服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=<span class="string">&#x27;rule family=ipv4 service name=nfs source address=&quot;10.10.10.101/32&quot; accept&#x27;</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p><strong>(4)拒绝某个IP访问所有端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=<span class="string">&#x27;rule family=ipv4 source address=10.10.10.110/32 reject&#x27;</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p><strong>（5）允许某个IP访问所有端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=<span class="string">&#x27;rule family=ipv4 source address=10.10.10.110/32 accept&#x27;</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">firewalld防火墙的详细讲解</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>NFS详解</title>
    <link href="http://example.com/2024/08/11/35.NFS/"/>
    <id>http://example.com/2024/08/11/35.NFS/</id>
    <published>2024-08-11T01:25:00.000Z</published>
    <updated>2024-08-11T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="NFS详解"><a href="#NFS详解" class="headerlink" title="NFS详解"></a>NFS详解</h2><h3 id="存储分类"><a href="#存储分类" class="headerlink" title="存储分类"></a>存储分类</h3><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240904142154.png"><br>NFS是Network File System的简写，即网络文件系统，NFS是FreeBSD支持的文件系统中的一种。NFS基于RPC(Remote Procedure Call)远程过程调用实现，其允许一个系统在网络上与它人共享目录和文件。通过使用NFS，用户和程序就可以像访问本地文件一样访问远端系统上的文件。NFS是一个非常稳定的，可移植的网络文件系统。</p><ul><li>使用 ftp 资源，必须要下载到本地之后才可以打开，所以 ftp 的资源是一个纯网络资源，nfs 就可以直接打开共享的文件。</li></ul><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240904142226.png"></p><p>在nfs服务器设置好一个共享目录&#x2F;data后，其他的有权访问NFS服务器的NFS客户端就可以将这个目录挂载到本地。并且能够看到服务端&#x2F;data的所有数据。因为挂载在本地的&#x2F;data目录，其实就是服务器端的&#x2F;data目录。如果服务器端配置的客户端只读，那么客户端就只能够只读。如果配置读写，客户端就能够进行读写。</p><p>NFS是通过网络来进行服务端和客户端之间的数据传输。两者之间要传输数据就要有想对应的网络端口来进行传输。NFS服务器端是随机选择端口来进行数据传输。NFS服务器是通过远程过程调用（remote procedure call 简称RPC）协议&#x2F;服务来实现的。也就是说RPC服务会统一管理NFS的端口，客户端和服务端<strong>通过RPC来先沟通</strong>NFS使用了哪些端口，之后再利用这些端口（小于1024）来进行数据的传输。</p><h3 id="RPC-远程过程调度（待补充）"><a href="#RPC-远程过程调度（待补充）" class="headerlink" title="RPC 远程过程调度（待补充）"></a>RPC 远程过程调度（待补充）</h3><h2 id="NFS搭建实验"><a href="#NFS搭建实验" class="headerlink" title="NFS搭建实验"></a>NFS搭建实验</h2><h3 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h3><p>192.168.80.20当作服务器，192.168.80.30当作其他机器测试</p><ul><li>安装nfs服务端<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]<span class="comment"># yum install rpcbind nfs-utils -y</span></span><br><span class="line">[root@server2 ~]<span class="comment"># systemctl enable nfs-server</span></span><br><span class="line">[root@server2 ~]<span class="comment"># systemctl restart nfs-server</span></span><br></pre></td></tr></table></figure></li><li>关闭防火墙和selinux<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@server2 ~]<span class="comment"># systemctl disable firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时关闭,重启后失效</span></span><br><span class="line">[root@server2 ~]<span class="comment"># setenforce 0</span></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line">[root@server2 ~]<span class="comment"># sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config </span></span><br><span class="line"><span class="comment"># 永久关闭需要重启</span></span><br><span class="line">[root@server2 ~]<span class="comment"># reboot</span></span><br></pre></td></tr></table></figure></li><li>查看一下服务状态<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]<span class="comment"># systemctl restart rpcbind</span></span><br><span class="line">[root@server2 ~]<span class="comment"># systemctl restart nfs</span></span><br><span class="line"></span><br><span class="line">[root@server2 ~]<span class="comment"># yum install net-tools -y</span></span><br><span class="line">[root@server2 ~]<span class="comment"># netstat -anpt | grep rpcbind  #查看rpcbind是否开启,rpcbind服务默认使用111端口</span></span><br></pre></td></tr></table></figure></li><li>创建测试文件并赋权限<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]<span class="comment"># mkdir /home/nfstest</span></span><br><span class="line">[root@server2 ~]<span class="comment"># chmod -R 777 /home/nfstest/</span></span><br><span class="line">[root@server2 ~]<span class="comment"># cd /home/nfstest/</span></span><br><span class="line">[root@server2 ~]<span class="comment"># vim nihao.txt</span></span><br></pre></td></tr></table></figure></li><li>修改nfs配置文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]<span class="comment"># vim /etc/exports</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">写入: </span></span><br><span class="line"><span class="string">/home/nfstest 192.168.80.0/24(rw)   </span></span><br><span class="line"><span class="string">共享文件路径 允许共享网段（共享文件可执行权限）</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">共享文件可执行权限有：</span><br><span class="line">      ro           只读访问</span><br><span class="line">      rw           读写访问</span><br><span class="line">      <span class="built_in">sync</span>          所有数据在请求时写入共享</span><br><span class="line">      hide          在NFS共享目录中不共享其子目录</span><br><span class="line">      no_hide         共享NFS目录的子目录</span><br><span class="line">      all_squash       共享文件的UID和GID映射匿名用户anonymous，适合公用目录。</span><br><span class="line">      no_all_squash      保留共享文件的UID和GID（默认）</span><br><span class="line">      root_squash       root用户的所有请求映射成如anonymous用户一样的权限（默认）</span><br><span class="line">      no_root_squas      root用户具有根目录的完全管理访问权限</span><br><span class="line">[root@server2 nfstest]<span class="comment"># systemctl restart rpcbind nfs</span></span><br></pre></td></tr></table></figure></li><li>设置开机自启<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.80.20:/home/nfstest /nfs nfs4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure></li></ul><h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><ul><li>安装nfs客户端<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># yum install nfs-utils -y</span></span><br></pre></td></tr></table></figure></li><li>查看服务端共享的目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># showmount -e 192.168.80.20</span></span><br></pre></td></tr></table></figure></li><li>客户端创建挂载目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># mkdir /test</span></span><br></pre></td></tr></table></figure></li><li>将服务端目录挂载到本地<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># mount -t nfs 192.168.80.20:home/nfstest /test</span></span><br></pre></td></tr></table></figure></li><li>查看挂载信息<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以看到最后的一行，已经挂载成功了</span></span><br><span class="line">[root@server3 ~]<span class="comment"># df -h</span></span><br><span class="line">文件系统                     容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                     898M     0  898M    0% /dev</span><br><span class="line">tmpfs                        910M     0  910M    0% /dev/shm</span><br><span class="line">tmpfs                        910M  9.6M  901M    2% /run</span><br><span class="line">tmpfs                        910M     0  910M    0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root       17G  1.9G   16G   12% /</span><br><span class="line">/dev/sda1                   1014M  153M  862M   16% /boot</span><br><span class="line">tmpfs                        182M     0  182M    0% /run/user/0</span><br><span class="line">192.168.80.20:/home/nfstest   17G  1.9G   16G   12% /test</span><br></pre></td></tr></table></figure></li><li>测试一下，能不能进入查看挂载文件夹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># cd /test</span></span><br><span class="line">[root@server3 <span class="built_in">test</span>]<span class="comment"># ll</span></span><br><span class="line">总用量 4</span><br><span class="line">-rw-r--r--. 1 root root 17 7月  28 09:42 nihao.txt</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">NFS详解</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>系统安全检查脚本</title>
    <link href="http://example.com/2024/08/11/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/08/11/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC/</id>
    <published>2024-08-11T01:25:00.000Z</published>
    <updated>2024-08-11T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="系统安全检查脚本"><a href="#系统安全检查脚本" class="headerlink" title="系统安全检查脚本"></a>系统安全检查脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">##Filename:     CentOS_Check_Script.sh</span></span><br><span class="line"><span class="comment">##Description:  Security detection script</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                         health check script                            #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#警告:本脚本只是一个检查的操作,未对服务器做任何修改,管理员可以根据此报告 #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#进行相应的安全整改                                                      #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="comment">#read -p &quot;=====================Are You Ready,Please press enter==================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                               主机安全检测                             #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;系统基本信息&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line">hostname=$(<span class="built_in">uname</span> -n)</span><br><span class="line">system=$(<span class="built_in">cat</span> /etc/os-release | grep <span class="string">&quot;^NAME&quot;</span> | awk -F\&quot; <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">version=$(<span class="built_in">cat</span> /etc/os-release | awk <span class="string">&#x27;&#123;print $4$5&#125;&#x27;</span>)</span><br><span class="line">kernel=$(<span class="built_in">uname</span> -r)</span><br><span class="line">platform=$(<span class="built_in">uname</span> -p)</span><br><span class="line">address=$(ip addr | grep inet | grep -v <span class="string">&quot;inet6&quot;</span> | grep -v <span class="string">&quot;127.0.0.1&quot;</span> | awk <span class="string">&#x27;&#123; print $2; &#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;\t&#x27;</span> )</span><br><span class="line">cpumodel=$(<span class="built_in">cat</span> /proc/cpuinfo | grep name | <span class="built_in">cut</span> -f2 -d: | <span class="built_in">uniq</span>)</span><br><span class="line">cpu=$(<span class="built_in">cat</span> /proc/cpuinfo | grep <span class="string">&#x27;processor&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">machinemodel=$(dmidecode | grep <span class="string">&quot;Product Name&quot;</span> | sed <span class="string">&#x27;s/^[ \t]*//g&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;\t&#x27;</span> )</span><br><span class="line"><span class="built_in">date</span>=$(<span class="built_in">date</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;主机名:           <span class="variable">$hostname</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统名称:         <span class="variable">$system</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统版本:         <span class="variable">$version</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;内核版本:         <span class="variable">$kernel</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统类型:         <span class="variable">$platform</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;本机IP地址:       <span class="variable">$address</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;CPU型号:          <span class="variable">$cpumodel</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;CPU核数:          <span class="variable">$cpu</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;机器型号:         <span class="variable">$machinemodel</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统时间:         <span class="variable">$date</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;资源使用情况&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line">summemory=$(free -h |grep <span class="string">&quot;Mem:&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">freememory=$(free -h |grep <span class="string">&quot;Mem:&quot;</span> | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>)</span><br><span class="line">usagememory=$(free -h |grep <span class="string">&quot;Mem:&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">uptime</span>=$(<span class="built_in">uptime</span> | awk <span class="string">&#x27;&#123;print $2&quot; &quot;$3&quot; &quot;$4&quot; &quot;$5&#125;&#x27;</span> | sed <span class="string">&#x27;s/,$//g&#x27;</span>)</span><br><span class="line">loadavg=$(<span class="built_in">uptime</span> | awk <span class="string">&#x27;&#123;print $9&quot; &quot;$10&quot; &quot;$11&quot; &quot;$12&quot; &quot;$13&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;总内存大小:           <span class="variable">$summemory</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;已使用内存大小:       <span class="variable">$usagememory</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;可使用内存大小:       <span class="variable">$freememory</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统运行时间:         <span class="variable">$uptime</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统负载:             <span class="variable">$loadavg</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;内存状态:&quot;</span></span><br><span class="line">vmstat 2 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;僵尸进程:&quot;</span></span><br><span class="line">ps -ef | grep zombie | grep -v grep</span><br><span class="line"><span class="keyword">if</span> [ $? == 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;无僵尸进程&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;有僵尸进程------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;耗CPU最多的进程:&quot;</span></span><br><span class="line">ps auxf |<span class="built_in">sort</span> -nr -k 3 |<span class="built_in">head</span> -5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;耗内存最多的进程:&quot;</span></span><br><span class="line">ps auxf |<span class="built_in">sort</span> -nr -k 4 |<span class="built_in">head</span> -5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;环境变量:&quot;</span></span><br><span class="line"><span class="built_in">env</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;路由表:&quot;</span></span><br><span class="line">route -n</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;监听端口:&quot;</span></span><br><span class="line">netstat -tunlp</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;当前建立的连接:&quot;</span></span><br><span class="line">netstat -n | awk <span class="string">&#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;开机启动的服务:&quot;</span></span><br><span class="line">systemctl list-unit-files | grep enabled</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;系统用户情况&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;活动用户:&quot;</span></span><br><span class="line">w | <span class="built_in">tail</span> -n +2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;系统所有用户:&quot;</span></span><br><span class="line"><span class="built_in">cut</span> -d: -f1,2,3,4 /etc/passwd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;系统所有组:&quot;</span></span><br><span class="line"><span class="built_in">cut</span> -d: -f1,2,3 /etc/group</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;当前用户的计划任务:&quot;</span></span><br><span class="line">crontab -l</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;身份鉴别安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;^password.*requisite.*pam_cracklib.so&quot;</span> /etc/pam.d/system-auth  &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;密码复杂度:已设置&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    grep -i <span class="string">&quot;pam_pwquality\.so&quot;</span> /etc/pam.d/system-auth &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;密码复杂度:已设置&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;密码复杂度:未设置,请加固密码--------[需调整]&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line">awk -F<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;if($2!~/^!|^*/)&#123;print &quot;&gt;&gt;&gt;(&quot;$1&quot;)&quot; &quot; 是一个未被锁定的账户,请管理员检查是否是可疑账户--------[需调整]&quot;&#125;&#125;&#x27;</span> /etc/shadow</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line">more /etc/login.defs | grep -E <span class="string">&quot;PASS_MAX_DAYS&quot;</span> | grep -v <span class="string">&quot;#&quot;</span> |awk -F<span class="string">&#x27; &#x27;</span>  <span class="string">&#x27;&#123;if($2!=90)&#123;print &quot;&gt;&gt;&gt;密码过期天数是&quot;$2&quot;天,请管理员改成90天------[需调整]&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;^auth.*required.*pam_tally2.so.*$&quot;</span> /etc/pam.d/sshd  &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;登入失败处理:已开启&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;登入失败处理:未开启,请加固登入失败锁定功能----------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;访问控制安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统中存在以下非系统默认用户:&quot;</span></span><br><span class="line">more /etc/passwd |awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;if($3&gt;500)&#123;print &quot;&gt;&gt;&gt;/etc/passwd里面的&quot;$1 &quot;的UID为&quot;$3&quot;，该账户非系统默认账户，请管理员确认是否为可疑账户--------[需调整]&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统特权用户:&quot;</span></span><br><span class="line">awk -F: <span class="string">&#x27;$3==0 &#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统中空口令账户:&quot;</span></span><br><span class="line">awk -F: <span class="string">&#x27;($2==&quot;!!&quot;) &#123;print $1&quot;该账户为空口令账户，请管理员确认是否为新增账户，如果为新建账户，请配置密码-------[需调整]&quot;&#125;&#x27;</span> /etc/shadow</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;安全审计&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;正常情况下登录到本机30天内的所有用户的历史记录:&quot;</span></span><br><span class="line">last | <span class="built_in">head</span> -n 30</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看syslog日志审计服务是否开启:&quot;</span></span><br><span class="line"><span class="keyword">if</span> service rsyslog status | egrep <span class="string">&quot; active \(running&quot;</span>;<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;经分析,syslog服务已开启&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;经分析,syslog服务未开启，建议通过service rsyslog start开启日志审计功能---------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看syslog日志是否开启外发:&quot;</span></span><br><span class="line"><span class="keyword">if</span> more /etc/rsyslog.conf | egrep <span class="string">&quot;@...\.|@..\.|@.\.|\*.\* @...\.|\*\.\* @..\.|\*\.\* @.\.&quot;</span>;<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;经分析,客户端syslog日志已开启外发--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;经分析,客户端syslog日志未开启外发---------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;审计的要素和审计日志:&quot;</span></span><br><span class="line">more /etc/rsyslog.conf  | grep -v <span class="string">&quot;^[$|#]&quot;</span> | grep -v <span class="string">&quot;^$&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统中关键文件修改时间:&quot;</span></span><br><span class="line"><span class="built_in">ls</span> -ltr /bin/ls /bin/login /etc/passwd  /bin/ps /etc/shadow|awk <span class="string">&#x27;&#123;print &quot;&gt;&gt;&gt;文件名：&quot;$9&quot;  &quot;&quot;最后修改时间：&quot;$6&quot; &quot;$7&quot; &quot;$8&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">###############################################################################################</span></span><br><span class="line"><span class="string">#   ls文件:是存储ls命令的功能函数,被删除以后,就无法执行ls命令                                 #</span></span><br><span class="line"><span class="string">#   login文件:login是控制用户登录的文件,一旦被篡改或删除,系统将无法切换用户或登陆用户         #</span></span><br><span class="line"><span class="string">#   /etc/passwd是一个文件,主要是保存用户信息                                                  #</span></span><br><span class="line"><span class="string">#   /bin/ps 进程查看命令功能支持文件,文件损坏或被更改后,无法正常使用ps命令                    #</span></span><br><span class="line"><span class="string">#   /etc/shadow是/etc/passwd的影子文件,密码存放在该文件当中,并且只有root用户可读              #</span></span><br><span class="line"><span class="string">###############################################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;检查重要日志文件是否存在:&quot;</span></span><br><span class="line">log_secure=/var/log/secure</span><br><span class="line">log_messages=/var/log/messages</span><br><span class="line">log_cron=/var/log/cron</span><br><span class="line">log_boot=/var/log/boot.log</span><br><span class="line">log_dmesg=/var/log/dmesg</span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$log_secure</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/secure日志文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/secure日志文件不存在------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$log_messages</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/messages日志文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/messages日志文件不存在------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$log_cron</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/cron日志文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/cron日志文件不存在--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$log_boot</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/boot.log日志文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/boot.log日志文件不存在--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$log_dmesg</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/dmesg日志文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span>  <span class="string">&quot;&gt;&gt;&gt;/var/log/dmesg日志文件不存在--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;剩余信息保护&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;分区情况:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;如果磁盘空间利用率过高，请及时调整---------[需调整]&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;可用块设备信息:&quot;</span></span><br><span class="line">lsblk</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件系统信息:&quot;</span></span><br><span class="line">more /etc/fstab  | grep -v <span class="string">&quot;^#&quot;</span> | grep -v <span class="string">&quot;^$&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;入侵防范安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统入侵行为:&quot;</span></span><br><span class="line">more /var/log/secure |grep refused</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;有入侵行为，请分析处理--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;无入侵行为&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;用户错误登入列表:&quot;</span></span><br><span class="line">lastb | <span class="built_in">head</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;无用户错误登入列表&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;用户错误登入--------[需调整]&quot;</span></span><br><span class="line">    lastb | <span class="built_in">head</span> </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh暴力登入信息:&quot;</span></span><br><span class="line">more /var/log/secure | grep  <span class="string">&quot;Failed&quot;</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;无ssh暴力登入信息&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    more /var/log/secure|awk <span class="string">&#x27;/Failed/&#123;print $(NF-3)&#125;&#x27;</span>|<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c|awk <span class="string">&#x27;&#123;print &quot;&gt;&gt;&gt;登入失败的IP和尝试次数: &quot;$2&quot;=&quot;$1&quot;次---------[需调整]&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;恶意代码防范&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;检查是否安装病毒软件:&quot;</span></span><br><span class="line">crontab -l | grep clamscan.sh &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;已安装ClamAV杀毒软件&quot;</span></span><br><span class="line">  crontab -l | grep freshclam.sh &gt; /dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;已部署定时更新病毒库&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;未安装ClamAV杀毒软件,请部署杀毒软件加固主机防护--------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;资源控制安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看是否开启了xinetd服务:&quot;</span></span><br><span class="line"><span class="keyword">if</span> ps -elf |grep xinet |grep -v <span class="string">&quot;grep xinet&quot;</span>;<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;xinetd服务正在运行，请检查是否可以把xinetd服务关闭--------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;xinetd服务未开启-------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;查看是否开启了ssh服务:&quot;</span></span><br><span class="line"><span class="keyword">if</span> service sshd status | grep -E <span class="string">&quot;listening on|active \(running\)&quot;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;SSH服务已开启&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;SSH服务未开启--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看是否开启了Telnet-Server服务:&quot;</span></span><br><span class="line"><span class="keyword">if</span> more /etc/xinetd.d/telnetd 2&gt;&amp;1|grep -E <span class="string">&quot;disable=no&quot;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;Telnet-Server服务已开启&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;Telnet-Server服务未开启--------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line">ps axu | grep iptables | grep -v grep || ps axu | grep firewalld | grep -v grep </span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;防火墙已启用&quot;</span></span><br><span class="line">iptables -nvL --line-numbers</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;防火墙未启用--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;查看系统SSH远程访问设置策略(host.deny拒绝列表):&quot;</span></span><br><span class="line"><span class="keyword">if</span> more /etc/hosts.deny | grep -E <span class="string">&quot;sshd&quot;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;远程访问策略已设置--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;远程访问策略未设置--------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看系统SSH远程访问设置策略(hosts.allow允许列表):&quot;</span></span><br><span class="line"><span class="keyword">if</span> more /etc/hosts.allow | grep -E <span class="string">&quot;sshd&quot;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;远程访问策略已设置--------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;远程访问策略未设置--------[无需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当hosts.allow和host.deny相冲突时,以hosts.allow设置为准&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================dividing line================================&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;TMOUT&quot;</span> /etc/profile /etc/bashrc</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;已设置登入超时限制&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;未设置登入超时限制,请设置,设置方法:在/etc/profile或者/etc/bashrc里面添加参数TMOUT=600 --------[需调整]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;end&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">基于等保要求的系统安全检查脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>等保安全加固脚本</title>
    <link href="http://example.com/2024/08/10/%E7%AD%89%E4%BF%9D%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/08/10/%E7%AD%89%E4%BF%9D%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/</id>
    <published>2024-08-10T01:25:00.000Z</published>
    <updated>2024-08-10T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="等保安全加固脚本"><a href="#等保安全加固脚本" class="headerlink" title="等保安全加固脚本"></a>等保安全加固脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">##Filename:     OS-centOS-Protective_v0.1.sh</span></span><br><span class="line"><span class="comment">##Description:  Operating system security reinforcement</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### variables ############################</span></span><br><span class="line">restart_flag=1</span><br><span class="line">ostype=<span class="string">&#x27;unknown&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########################### ostype ############################</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/os-release ]; <span class="keyword">then</span></span><br><span class="line">    . /etc/os-release</span><br><span class="line">    ostype=<span class="variable">$ID</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/redhat-release ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> grep -qi <span class="string">&#x27;centos&#x27;</span> /etc/redhat-release; <span class="keyword">then</span></span><br><span class="line">        ostype=<span class="string">&#x27;centos&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> grep -qi <span class="string">&#x27;redhat&#x27;</span> /etc/redhat-release; <span class="keyword">then</span></span><br><span class="line">        ostype=<span class="string">&#x27;redhat&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> grep -qi <span class="string">&#x27;rocky&#x27;</span> /etc/redhat-release; <span class="keyword">then</span></span><br><span class="line">        ostype=<span class="string">&#x27;rocky&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/centos-release ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> grep -qi <span class="string">&#x27;centos&#x27;</span> /etc/centos-release; <span class="keyword">then</span></span><br><span class="line">        ostype=<span class="string">&#x27;centos&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/lsb-release ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> grep -qi <span class="string">&#x27;ubuntu&#x27;</span> /etc/lsb-release; <span class="keyword">then</span></span><br><span class="line">        ostype=<span class="string">&#x27;ubuntu&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /System/Library/CoreServices/SystemVersion.plist ]; <span class="keyword">then</span></span><br><span class="line">    ostype=<span class="string">&#x27;macOS&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    OS type is <span class="variable">$ostype</span>    \033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################restart_ssh################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">restart_ssh</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$restart_flag</span> == 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31mPlease restart SSH service manully by using &#x27;service sshd restart&#x27; or &#x27;systemctl restart sshd&#x27;\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">########################### 文件备份 ############################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">backup</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;backup&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31mBackup directory already exists, to avoid overwriting these files, backup will not perform again\033[0m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">mkdir</span> backup</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义需要备份的文件及其目标文件名</span></span><br><span class="line">    <span class="built_in">declare</span> -A files_to_backup=(</span><br><span class="line">        [<span class="string">&quot;/etc/pam.d/system-auth&quot;</span>]=<span class="string">&quot;system-auth.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/pam.d/common-password&quot;</span>]=<span class="string">&quot;common-password.bak&quot;</span></span><br><span class="line">        [~/.ssh/authorized_keys]=<span class="string">&quot;authorized_keys.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/pam.d/sshd&quot;</span>]=<span class="string">&quot;sshd.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/sudoers&quot;</span>]=<span class="string">&quot;sudoers.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/ssh/sshd_config&quot;</span>]=<span class="string">&quot;sshd_config.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/profile&quot;</span>]=<span class="string">&quot;profile.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/pam.d/su&quot;</span>]=<span class="string">&quot;su.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/login.defs&quot;</span>]=<span class="string">&quot;login_defs.bak&quot;</span></span><br><span class="line">        [<span class="string">&quot;/etc/logrotate.conf&quot;</span>]=<span class="string">&quot;logrotate_conf.bak&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历并备份文件</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!files_to_backup[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span> <span class="string">&quot;backup/<span class="variable">$&#123;files_to_backup[$file]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    Auto backup successfully    \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">########################### 执行备份 ############################</span></span><br><span class="line">backup</span><br><span class="line"></span><br><span class="line"><span class="comment">########################### 文件还原 ############################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">recover</span></span>() &#123;</span><br><span class="line">    <span class="comment"># 定义需要还原的文件及其目标路径</span></span><br><span class="line">    <span class="built_in">declare</span> -A files_to_recover=(</span><br><span class="line">        [<span class="string">&quot;backup/system-auth.bak&quot;</span>]=<span class="string">&quot;/etc/pam.d/system-auth&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/common-password.bak&quot;</span>]=<span class="string">&quot;/etc/pam.d/common-password&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/authorized_keys.bak&quot;</span>]=<span class="string">&quot;~/.ssh/authorized_keys&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/sshd.bak&quot;</span>]=<span class="string">&quot;/etc/pam.d/sshd&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/sudoers.bak&quot;</span>]=<span class="string">&quot;/etc/sudoers&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/sshd_config.bak&quot;</span>]=<span class="string">&quot;/etc/ssh/sshd_config&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/profile.bak&quot;</span>]=<span class="string">&quot;/etc/profile&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/login_defs.bak&quot;</span>]=<span class="string">&quot;/etc/login.defs&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/logrotate_conf.bak&quot;</span>]=<span class="string">&quot;/etc/logrotate.conf&quot;</span></span><br><span class="line">        [<span class="string">&quot;backup/su.bak&quot;</span>]=<span class="string">&quot;/etc/pam.d/su&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历并还原文件</span></span><br><span class="line">    <span class="keyword">for</span> backup_file <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!files_to_recover[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$backup_file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cp</span> -rf <span class="string">&quot;<span class="variable">$backup_file</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;files_to_recover[$backup_file]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line">    restart_flag=0</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m   8、 Recover success\033[0m&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">###########################口令复杂度设置############################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">password</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m   2、 set password complexity requirements\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/pam.d/system-auth ];<span class="keyword">then</span></span><br><span class="line">    config=<span class="string">&quot;/etc/pam.d/system-auth&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/pam.d/common-password ];<span class="keyword">then</span></span><br><span class="line">    config=<span class="string">&quot;/etc/pam.d/common-password&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    Doesn&#x27;t support this OS    \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    grep -i <span class="string">&quot;^password.*requisite.*pam_cracklib.so&quot;</span> <span class="variable">$config</span>  &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">        sed -i <span class="string">&quot;s/^password.*requisite.*pam_cracklib\.so.*$/password    requisite       pam_cracklib.so retry=3 difok=3 minlen=12 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1/g&quot;</span> <span class="variable">$config</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m密码修改重试3次机会，新密码与老密码必须有3字符不同，最小密码长度12个字符，包含大写字符至少一个，小写字母至少一个，数字至少一个，特殊字符至少一个\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        grep -i <span class="string">&quot;pam_pwquality\.so&quot;</span> <span class="variable">$config</span> &gt; /dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">            sed -i <span class="string">&quot;s/password.*requisite.*pam_pwquality\.so.*$/password     requisite       pam_pwquality.so retry=3 difok=3 minlen=12 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1/g&quot;</span> <span class="variable">$config</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m密码修改重试3次机会，新密码与老密码必须有3字符不同，最小密码长度12个字符，包含大写字符至少一个，小写字母至少一个，数字至少一个，特殊字符至少一个\033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;password      requisite       pam_cracklib.so retry=3 difok=3 minlen=12 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1&#x27;</span> &gt;&gt; <span class="variable">$config</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m密码修改重试3次机会，新密码与老密码必须有3字符不同，最小密码长度12个字符，包含大写字符至少一个，小写字母至少一个，数字至少一个，特殊字符至少一个\033[0m&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Password complexity set success]\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [Password complexity set failed]\033[0m&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">################################新增超级管理员用户################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">create_user</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m   3、Create openroot account\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Be sure to create an openroot account?[y/n]:&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span> </span><br><span class="line">    y)</span><br><span class="line">grep -i <span class="string">&#x27;openroot&#x27;</span> /etc/passwd</span><br><span class="line">        <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31mAn openroot account has been created\033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Please enter your password:&quot;</span> PASSWD</span><br><span class="line">    useradd -g root openroot;<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PASSWD</span>&quot;</span> | passwd --stdin openroot  &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31mopenroot account created successfully    \033[0m&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;openroot&quot;</span> /etc/sudoers</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">chmod</span> u+w /etc/sudoers &gt; /dev/null </span><br><span class="line">    sed -i <span class="string">&#x27;/^root.*ALL=(ALL).*$/a\openroot  ALL=(ALL)       NOPASSWD:ALL&#x27;</span> /etc/sudoers &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Permissions set success]\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [Permissions set failed]\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">chmod</span> u-w /etc/sudoers &gt; /dev/null </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    Permissions have already been set    \033[0m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    openroot account created failed    \033[0m&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1 </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">    n)</span><br><span class="line">;;</span><br><span class="line">    *)</span><br><span class="line">create_user</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">############################限制超级管理员用户远程登录############################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">remote_login</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m   4、Set Remote Login Configuration(SSH)\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line"><span class="comment">#set Protocol 2</span></span><br><span class="line">    <span class="built_in">echo</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">    grep -i <span class="string">&#x27;^Protocol&#x27;</span> /etc/ssh/sshd_config &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">        sed -i <span class="string">&#x27;s/^Protocol.*$/Protocol 2/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">        <span class="keyword">if</span> [ $? != 0 ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [##Error##]: Cannot to set Protocol to &#x27;2&#x27;    \033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Success: Set SSH Protocol to 2]    \033[0m&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;Protocol 2&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Success: Set SSH Protocol to 2]    \033[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Disable root remote login?[y/n](Please make sure you have created at least one another account):&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    y)</span><br><span class="line">grep -i <span class="string">&#x27;^PermitRootLogin no&#x27;</span> /etc/ssh/sshd_config &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 1 ];<span class="keyword">then</span></span><br><span class="line">            grep -i <span class="string">&#x27;.*PermitRootLogin yes&#x27;</span> /etc/ssh/sshd_config &gt;/dev/null</span><br><span class="line">            <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">                sed -i <span class="string">&#x27;s/.*PermitRootLogin yes/PermitRootLogin no/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">                <span class="keyword">if</span> [ $? != 0 ];<span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m[##Error##]cannot to set PermitRootLogin to &#x27;no&#x27;\033[0m&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    Disable root remote login[Success]    \033[0m&quot;</span></span><br><span class="line">            restart_flag=0</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;PermitRootLogin no&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    Disable root remote login[Success]    \033[0m&quot;</span></span><br><span class="line">                restart_flag=0</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    Already disable root remote login\033[0m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">    n)</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        remote_login</span><br><span class="line">;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################配置系统历史命令操作记录和定时帐户自动登出时间################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">set_history_tmout</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    5、set history and timeout\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;set history size, format, and TMOUT?[y/n]:&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    y)</span><br><span class="line"><span class="comment">#history_size</span></span><br><span class="line">        grep -i <span class="string">&quot;^HISTSIZE=&quot;</span> /etc/profile &gt;/dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="comment">#history记录保留一万条</span></span><br><span class="line">            sed -i <span class="string">&quot;s/^HISTSIZE=.*$/HISTSIZE=10000/g&quot;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;HISTSIZE=10000&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    HISTSIZE has been set to 10000    \033[0m&quot;</span></span><br><span class="line"><span class="comment">#history_format</span></span><br><span class="line">        grep -i <span class="string">&quot;^export HISTTIMEFORMAT=&quot;</span> /etc/profile &gt; /dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">            sed -i <span class="string">&#x27;s/^export HISTTIMEFORMAT=.*$/export HISTTIMEFORMAT=&quot;%F %T `whoami`&quot;/g&#x27;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\033[1;31m    HISTTIMEFORMAT has been set to &quot;Number-Time-User-Command&quot;    \033[0m&#x27;</span></span><br><span class="line"><span class="comment">#TIME_OUT</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;set shell TMOUT?[300-600]seconds:&quot;</span> tmout </span><br><span class="line">: <span class="variable">$&#123;tmout:=600&#125;</span></span><br><span class="line">        grep -i <span class="string">&quot;^TMOUT=&quot;</span> /etc/profile&gt; /dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">            sed -i <span class="string">&quot;s/^TMOUT=.*$/TMOUT=<span class="variable">$tmout</span>/g&quot;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;TMOUT=<span class="variable">$tmout</span>&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Success]    \033[0m&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    n)</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        set_history_tmout;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################SSH端口配置################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ssh_port</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    6、set ssh port\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&#x27;change ssh port?[y/n]:&#x27;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    y)</span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&#x27;please input the new ssh port(recommend to between 1024 and 65534, please make sure the port is not in used):&#x27;</span> port</span><br><span class="line"><span class="comment">##验证端口是否被占用</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$port</span> -gt 1024 &amp;&amp; <span class="variable">$port</span> -lt 65535 ]];<span class="keyword">then</span></span><br><span class="line">          netstat -tlnp|awk -v port=<span class="variable">$port</span> <span class="string">&#x27;&#123;lens=split($4,a,&quot;:&quot;);if(a[lens]==port)&#123;exit 2&#125;&#125;&#x27;</span>  &gt;/dev/null <span class="comment">#2&gt;&amp;1</span></span><br><span class="line">          res=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$res</span> == 2 ];<span class="keyword">then</span></span><br><span class="line">              <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    The port <span class="variable">$port</span> is already in used, try again\033[0m&quot;</span></span><br><span class="line">              ssh_port</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$res</span> == 1 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [##Error##]    \033[0m&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="comment">##修改ssh端口</span></span><br><span class="line">grep -i <span class="string">&quot;^#Port &quot;</span> /etc/ssh/sshd_config &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    sed -i <span class="string">&quot;s/^#Port.*$/Port <span class="variable">$port</span>/g&quot;</span> /etc/ssh/sshd_config</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    grep -i <span class="string">&quot;^Port &quot;</span> /etc/ssh/sshd_config &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">sed -i <span class="string">&quot;s/^Port.*$/Port <span class="variable">$port</span>/g&quot;</span> /etc/ssh/sshd_config</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Port <span class="variable">$port</span>&quot;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Success]    \033[0m&quot;</span></span><br><span class="line">restart_flag=0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [##The port <span class="variable">$port</span> is error, please input new ssh port between 1024 and 65534 ##]    \033[0m&quot;</span></span><br><span class="line">    ssh_port</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    n)</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [##Error##]:invalid input    \033[0m&quot;</span></span><br><span class="line">        ssh_port</span><br><span class="line">;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################Logon failure handling################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">logon</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m    7、set logon failure handling\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">logonconfig=/etc/pam.d/sshd</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&#x27;Are you sure set logon failure handling?[y/n]:&#x27;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    y)</span><br><span class="line">grep -i <span class="string">&quot;^auth.*required.*pam_tally2.so.*$&quot;</span> <span class="variable">$logonconfig</span>  &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">   sed -i <span class="string">&quot;s/auth.*required.*pam_tally2.so.*$/auth required pam_tally2.so deny=3 unlock_time=300 even_deny_root root_unlock_time=300/g&quot;</span> <span class="variable">$logonconfig</span> &gt; /dev/null</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">   sed -i <span class="string">&#x27;/^#%PAM-1.0/a\auth required pam_tally2.so deny=3 unlock_time=300 even_deny_root root_unlock_time=300&#x27;</span> <span class="variable">$logonconfig</span> &gt; /dev/null</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[37;5m    [Logon failure handling set success]\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[1;31m限制登入失败三次，普通账号锁定5分钟，root账号锁定5分钟\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m    [Logon failure handling set failed]\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">    n)</span><br><span class="line">;;</span><br><span class="line">    *)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5m         [##Error##]:invalid input       \033[0m&quot;</span></span><br><span class="line">logon</span><br><span class="line">;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################修改系统/etc/login.defs文件中的记录成功登录的信息，允许记录未知用户名登录失败的信息################################</span></span><br><span class="line"><span class="comment">#######################修改系统/etc/login.defs文件中的设置密码长度和定期更换要求参数################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">modify_login_defs</span></span>() &#123;</span><br><span class="line">    <span class="comment">#Set logging of successful logins to yes</span></span><br><span class="line">    LOG_OK_LOGINS=<span class="string">&quot;yes&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Set logging of unknown usernames when login failures are recorded to yes</span></span><br><span class="line">    LOG_UNKFAIL_ENAB=<span class="string">&quot;yes&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Set maximum days between password changes to 90</span></span><br><span class="line">    PASS_MAX_DAYS=<span class="string">&quot;90&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Set minimum days before users can change their password to 0</span></span><br><span class="line">    PASS_MIN_DAYS=<span class="string">&quot;0&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Set the minimum password length to 8</span></span><br><span class="line">    PASS_MIN_LEN=<span class="string">&quot;8&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Set the warning age for password expiration to 7</span></span><br><span class="line">    PASS_WARN_AGE=<span class="string">&quot;7&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read the /etc/login.defs file</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="comment">#skip comment lines</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$line</span>&quot;</span> =~ ^<span class="comment">#.* ]]; then</span></span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains LOG_OK_LOGINS</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *LOG_OK_LOGINS* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Replace the line with the new LOG_OK_LOGINS value</span></span><br><span class="line">            sed -i <span class="string">&quot;s/<span class="variable">$line</span>/LOG_OK_LOGINS\t\t<span class="variable">$LOG_OK_LOGINS</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains LOG_UNKFAIL_ENAB</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *LOG_UNKFAIL_ENAB* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Replace the line with the new LOG_UNKFAIL_ENAB value</span></span><br><span class="line">            sed -i <span class="string">&quot;s/<span class="variable">$line</span>/LOG_UNKFAIL_ENAB\t<span class="variable">$LOG_UNKFAIL_ENAB</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains PASS_MAX_DAYS</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *PASS_MAX_DAYS* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Replace the line with the new PASS_MAX_DAYS value</span></span><br><span class="line">            sed -i <span class="string">&quot;s/<span class="variable">$line</span>/PASS_MAX_DAYS\t<span class="variable">$PASS_MAX_DAYS</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains PASS_MIN_DAYS</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *PASS_MIN_DAYS* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Replace the line with the new PASS_MIN_DAYS value</span></span><br><span class="line">            sed -i <span class="string">&quot;s/<span class="variable">$line</span>/PASS_MIN_DAYS\t<span class="variable">$PASS_MIN_DAYS</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains PASS_MIN_LEN</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *PASS_MIN_LEN* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Check if the PASS_MIN_LEN is blank</span></span><br><span class="line">            <span class="keyword">if</span> [[ -z <span class="variable">$line</span> ]]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># Append the PASS_MIN_LEN to the end of the /etc/login.defs file</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;PASS_MIN_LEN <span class="variable">$PASS_MIN_LEN</span>&quot;</span> &gt;&gt; /etc/login.defs</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment"># Replace the line with the new PASS_MIN_LEN value</span></span><br><span class="line">                sed -i <span class="string">&quot;s/<span class="variable">$line</span>/PASS_MIN_LEN\t<span class="variable">$PASS_MIN_LEN</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the line contains PASS_WARN_AGE</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$line</span> == *PASS_WARN_AGE* ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Replace the line with the new PASS_WARN_AGE value</span></span><br><span class="line">            sed -i <span class="string">&quot;s/<span class="variable">$line</span>/PASS_WARN_AGE\t<span class="variable">$PASS_WARN_AGE</span>/g&quot;</span> /etc/login.defs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span> &lt; /etc/login.defs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################修改系统/etc/logrotate.conf文件中的rotate值################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">modify_logrotate_conf</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">conf_file=<span class="string">&quot;/etc/logrotate.conf&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;/^[^#]*weekly/,/rotate/&#123;s/rotate.*/rotate 26/&#125;&#x27;</span> /etc/logrotate.conf<span class="comment">#week中rotate的值替换为26</span></span><br><span class="line">sed -i <span class="string">&#x27;/^[^#]*\/var\/log\/wtmp/,/rotate/&#123;s/rotate.*/rotate 7/&#125;&#x27;</span> /etc/logrotate.conf<span class="comment">#将/var/log/wtmp下monthly中rotate的值替换为7</span></span><br><span class="line">sed -i <span class="string">&#x27;/^[^#]*\/var\/log\/btmp/,/rotate/&#123;s/rotate.*/rotate 7/&#125;&#x27;</span> /etc/logrotate.conf<span class="comment">#将/var/log/btmp下monthly中rotate的值替换为7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################main################################</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span>  -e <span class="string">&quot;\033[1;31m</span></span><br><span class="line"><span class="string">#################################################################################################################</span></span><br><span class="line"><span class="string">#                                        Menu#</span></span><br><span class="line"><span class="string">#         1:ALL protective (一键进行全部加固、如有不需要执行全部加固的，请自行更改函数调用)#</span></span><br><span class="line"><span class="string">#         2:Set Password Complexity Requirements (设置密码复杂度)#</span></span><br><span class="line"><span class="string">#         3:Create openroot account (添加openroot账号)#</span></span><br><span class="line"><span class="string">#         4:Set Remote Login Configuration(SSH) (禁止root远程登入)#</span></span><br><span class="line"><span class="string">#         5:Set Shell History and TMOUT (设置history保存行数以及命令时间，设置窗口超时时间)#</span></span><br><span class="line"><span class="string">#         6:Set SSH Port (更改SSH端口)#</span></span><br><span class="line"><span class="string">#         7:Set Logon failure handling (登入失败处理)#</span></span><br><span class="line"><span class="string">#         8:Recover Configuration (还原配置文件)#</span></span><br><span class="line"><span class="string">#  9:Modify loginDefs (设置密码长度和定期更换要求)#</span></span><br><span class="line"><span class="string">#  10:Modify logrotateConf (建议操作系统对审计记录进行保护，通过日志服务器对审计记录进行定期存档备份)#</span></span><br><span class="line"><span class="string">#  11:Exit (退出)                                                                         #</span></span><br><span class="line"><span class="string">################################################################################################################# \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Please choice[1-11]:&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    1)</span><br><span class="line">        password</span><br><span class="line">        set_history_tmout</span><br><span class="line">logon</span><br><span class="line">        modify_login_defs</span><br><span class="line">modify_logrotate_conf</span><br><span class="line">        restart_ssh</span><br><span class="line">        ;;</span><br><span class="line">    2)</span><br><span class="line">        password</span><br><span class="line">;;</span><br><span class="line">    3)</span><br><span class="line">        create_user</span><br><span class="line">;;</span><br><span class="line">    4)</span><br><span class="line">        remote_login</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    5)</span><br><span class="line">        set_history_tmout</span><br><span class="line">;;</span><br><span class="line">    6)</span><br><span class="line">        ssh_port</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    7)</span><br><span class="line">logon</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    8)</span><br><span class="line">        recover</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    9)</span><br><span class="line">        modify_login_defs</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    10)</span><br><span class="line">        modify_logrotate_conf</span><br><span class="line">        restart_ssh</span><br><span class="line">;;</span><br><span class="line">    11)</span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[31;5minvalid input    \033[0m&quot;</span></span><br><span class="line">        main</span><br><span class="line">;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">基于等保安全的加固脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Centos7安装mysql8脚本</title>
    <link href="http://example.com/2024/08/09/Centos7%E5%AE%89%E8%A3%85mysql8%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/08/09/Centos7%E5%AE%89%E8%A3%85mysql8%E8%84%9A%E6%9C%AC/</id>
    <published>2024-08-09T01:25:00.000Z</published>
    <updated>2024-08-09T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Centos7安装mysql8脚本"><a href="#Centos7安装mysql8脚本" class="headerlink" title="Centos7安装mysql8脚本"></a>Centos7安装mysql8脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="comment"># =================================================                         #</span></span><br><span class="line"><span class="comment"># Description: MySQL automatic installation tool  #</span></span><br><span class="line"><span class="comment">#实测Centos7.9没问题，其余系统不行，优化改进中</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="built_in">export</span> PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">Install_MySQL</span></span>() &#123;</span><br><span class="line"><span class="comment"># CentOS 8 mysql: error while loading shared libraries: libncurses.so.5</span></span><br><span class="line">yum install ncurses ncurses-compat-libs -y</span><br><span class="line"><span class="comment"># Install dependencies</span></span><br><span class="line">setenforce 0</span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install wget tar jemalloc jemalloc-devel gcc gcc-c++</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL configuration</span></span><br><span class="line">mysql_version=<span class="string">&quot;8.0.21&quot;</span></span><br><span class="line">mysql_password=<span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /apps/server/mysql/data</span><br><span class="line">mysql_install_dir=<span class="string">&quot;/apps/server/mysql&quot;</span></span><br><span class="line">mysql_data_dir=<span class="string">&quot;/apps/server/mysql/data&quot;</span></span><br><span class="line">download_mysql=<span class="string">&quot;https://downloads.mysql.com/archives/get/p/23/file&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Download MySQL</span></span><br><span class="line"><span class="built_in">cd</span> /mnt</span><br><span class="line">useradd -M -s /sbin/nologin mysql &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">wget -c <span class="variable">$&#123;download_mysql&#125;</span>/mysql-<span class="variable">$&#123;mysql_version&#125;</span>-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== Start installing MySQL ============&quot;</span></span><br><span class="line">tar xJf mysql-<span class="variable">$&#123;mysql_version&#125;</span>-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">\<span class="built_in">mv</span> mysql-<span class="variable">$&#123;mysql_version&#125;</span>-linux-glibc2.12-x86_64/* <span class="variable">$&#123;mysql_install_dir&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -d <span class="string">&quot;<span class="variable">$&#123;mysql_install_dir&#125;</span>/support-files&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">rm</span> -rf mysql-<span class="variable">$&#123;mysql_version&#125;</span>-linux-glibc2.12-x86_64</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$&#123;mysql_install_dir&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Error: MySQL install failed, Please contact the author&quot;</span></span><br><span class="line"><span class="built_in">kill</span> -9 $$</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the database</span></span><br><span class="line"><span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysqld --initialize-insecure --user=mysql --basedir=<span class="variable">$&#123;mysql_install_dir&#125;</span> --datadir=<span class="variable">$&#123;mysql_data_dir&#125;</span></span><br><span class="line"><span class="built_in">chown</span> -R root . <span class="variable">$&#123;mysql_install_dir&#125;</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;mysql_data_dir&#125;</span></span><br><span class="line">\<span class="built_in">cp</span> -f <span class="variable">$&#123;mysql_install_dir&#125;</span>/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^basedir=.*@basedir=<span class="variable">$&#123;mysql_install_dir&#125;</span>@&quot;</span> /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^datadir=.*@datadir=<span class="variable">$&#123;mysql_data_dir&#125;</span>@&quot;</span> /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@/usr/local/mysql@<span class="variable">$&#123;mysql_install_dir&#125;</span>@g&quot;</span> <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysqld_safe</span><br><span class="line">sed -i <span class="string">&#x27;s@executing mysqld_safe@executing mysqld_safe\nexport LD_PRELOAD=/usr/lib64/libjemalloc.so@&#x27;</span> <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysqld_safe</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PATH=$PATH:&#x27;</span><span class="variable">$&#123;mysql_install_dir&#125;</span><span class="string">&#x27;/bin&#x27;</span> &gt;/etc/profile.d/mariadb_renwole.com.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># my.conf configuration</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">port = 3306</span></span><br><span class="line"><span class="string">socket = /tmp/mysql.sock</span></span><br><span class="line"><span class="string">default-character-set = utf8mb4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">prompt=&quot;MySQL [\\d]&gt; &quot;</span></span><br><span class="line"><span class="string">no-auto-rehash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port = 3306</span></span><br><span class="line"><span class="string">socket = /tmp/mysql.sock</span></span><br><span class="line"><span class="string">default_authentication_plugin = mysql_native_password</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">basedir = $&#123;mysql_install_dir&#125;</span></span><br><span class="line"><span class="string">datadir = $&#123;mysql_data_dir&#125;</span></span><br><span class="line"><span class="string">pid-file = $&#123;mysql_data_dir&#125;/mysql.pid</span></span><br><span class="line"><span class="string">user = mysql</span></span><br><span class="line"><span class="string">bind-address = 0.0.0.0</span></span><br><span class="line"><span class="string">server-id = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">init-connect = &#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line"><span class="string">character-set-server = utf8mb4</span></span><br><span class="line"><span class="string">collation-server = utf8mb4_0900_ai_ci</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">skip-name-resolve</span></span><br><span class="line"><span class="string">#skip-networking</span></span><br><span class="line"><span class="string">back_log = 300</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">max_connections = 1000</span></span><br><span class="line"><span class="string">max_connect_errors = 6000</span></span><br><span class="line"><span class="string">open_files_limit = 65535</span></span><br><span class="line"><span class="string">table_open_cache = 128</span></span><br><span class="line"><span class="string">max_allowed_packet = 500M</span></span><br><span class="line"><span class="string">binlog_cache_size = 1M</span></span><br><span class="line"><span class="string">max_heap_table_size = 8M</span></span><br><span class="line"><span class="string">tmp_table_size = 16M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">read_buffer_size = 2M</span></span><br><span class="line"><span class="string">read_rnd_buffer_size = 8M</span></span><br><span class="line"><span class="string">sort_buffer_size = 8M</span></span><br><span class="line"><span class="string">join_buffer_size = 8M</span></span><br><span class="line"><span class="string">key_buffer_size = 4M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">thread_cache_size = 8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ft_min_word_len = 4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">log_bin = mysql-bin</span></span><br><span class="line"><span class="string">binlog_format = mixed</span></span><br><span class="line"><span class="string">binlog_expire_logs_seconds = 604800</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">log_error = $&#123;mysql_data_dir&#125;/mysql-error.log</span></span><br><span class="line"><span class="string">slow_query_log = 1</span></span><br><span class="line"><span class="string">long_query_time = 1</span></span><br><span class="line"><span class="string">slow_query_log_file = $&#123;mysql_data_dir&#125;/mysql-slow.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">performance_schema = 0</span></span><br><span class="line"><span class="string">explicit_defaults_for_timestamp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#lower_case_table_names = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">skip-external-locking</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">default_storage_engine = InnoDB</span></span><br><span class="line"><span class="string">#default-storage-engine = MyISAM</span></span><br><span class="line"><span class="string">innodb_file_per_table = 1</span></span><br><span class="line"><span class="string">innodb_open_files = 500</span></span><br><span class="line"><span class="string">innodb_buffer_pool_size = 64M</span></span><br><span class="line"><span class="string">innodb_write_io_threads = 4</span></span><br><span class="line"><span class="string">innodb_read_io_threads = 4</span></span><br><span class="line"><span class="string">innodb_thread_concurrency = 0</span></span><br><span class="line"><span class="string">innodb_purge_threads = 1</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit = 2</span></span><br><span class="line"><span class="string">innodb_log_buffer_size = 2M</span></span><br><span class="line"><span class="string">innodb_log_file_size = 32M</span></span><br><span class="line"><span class="string">innodb_log_files_in_group = 3</span></span><br><span class="line"><span class="string">innodb_max_dirty_pages_pct = 90</span></span><br><span class="line"><span class="string">innodb_lock_wait_timeout = 120</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bulk_insert_buffer_size = 8M</span></span><br><span class="line"><span class="string">myisam_sort_buffer_size = 8M</span></span><br><span class="line"><span class="string">myisam_max_sort_file_size = 10G</span></span><br><span class="line"><span class="string">myisam_repair_threads = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">interactive_timeout = 28800</span></span><br><span class="line"><span class="string">wait_timeout = 28800</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet = 500M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[myisamchk]</span></span><br><span class="line"><span class="string">key_buffer_size = 8M</span></span><br><span class="line"><span class="string">sort_buffer_size = 8M</span></span><br><span class="line"><span class="string">read_buffer = 4M</span></span><br><span class="line"><span class="string">write_buffer = 4M</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># Set up MySQL</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/my.cnf</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line">  systemctl start mysqld</span><br><span class="line">  <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -e <span class="string">&quot;create user root@&#x27;127.0.0.1&#x27; identified by \&quot;<span class="variable">$&#123;mysql_password&#125;</span>\&quot;;&quot;</span></span><br><span class="line">  <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -e <span class="string">&quot;grant all privileges on *.* to root@&#x27;127.0.0.1&#x27; with grant option;&quot;</span></span><br><span class="line"> <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -e <span class="string">&quot;grant all privileges on *.* to root@&#x27;localhost&#x27; with grant option;&quot;</span></span><br><span class="line">  <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -e <span class="string">&quot;alter user root@&#x27;localhost&#x27; identified by \&quot;<span class="variable">$&#123;mysql_password&#125;</span>\&quot;;&quot;</span></span><br><span class="line">  <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -p<span class="variable">$&#123;mysql_password&#125;</span> -e <span class="string">&quot;reset master;&quot;</span></span><br><span class="line">  <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -p<span class="variable">$&#123;mysql_password&#125;</span> -e <span class="string">&quot;CREATE USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;<span class="variable">$&#123;mysql_password&#125;</span>&#x27;;&quot;</span></span><br><span class="line">    <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin/mysql -uroot -hlocalhost -p<span class="variable">$&#123;mysql_password&#125;</span> -e <span class="string">&quot;GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; WITH GRANT OPTION;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">rm</span> -rf /etc/ld.so.conf.d/&#123;mysql,mariadb,percona,alisql&#125;*.conf</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;mysql_install_dir&#125;</span>/lib&quot;</span> &gt; /etc/ld.so.conf.d/mysql_renwole.com.conf</span><br><span class="line">  ldconfig</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;========== MySQL installing Successfully =====&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;    Thank you for using Renwole.com script&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;MySQL:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;account: root&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;password: <span class="variable">$&#123;mysql_password&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;database: <span class="variable">$&#123;mysql_data_dir&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============================================&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Install_MySQL</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">ln</span> -s <span class="variable">$&#123;mysql_install_dir&#125;</span>/bin /usr/bin/mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果上面的配置文件里不想添加对任意ip开放，就注释掉配置里的，等安装完后用下列命令赋权</span></span><br><span class="line"><span class="comment"># CREATE USER &#x27;root&#x27;@&#x27;192.168.190.1&#x27; IDENTIFIED BY &#x27;Renwole.com#Node&#x27;;</span></span><br><span class="line"><span class="comment"># GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;192.168.190.1&#x27;;</span></span><br><span class="line"><span class="comment"># FLUSH PRIVILEGES;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Centos7.9安装mysql8，仅适用于centos7</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Centos同步yum源到本地</title>
    <link href="http://example.com/2024/08/07/Centos%E5%90%8C%E6%AD%A5yum%E6%BA%90%E5%88%B0%E6%9C%AC%E5%9C%B0/"/>
    <id>http://example.com/2024/08/07/Centos%E5%90%8C%E6%AD%A5yum%E6%BA%90%E5%88%B0%E6%9C%AC%E5%9C%B0/</id>
    <published>2024-08-07T01:25:00.000Z</published>
    <updated>2024-08-07T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Centos7同步yum源到本地"><a href="#Centos7同步yum源到本地" class="headerlink" title="Centos7同步yum源到本地"></a>Centos7同步yum源到本地</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装必要的工具</span></span><br><span class="line">yum install createrepo yum-utils rsync -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 CentOS 7 的仓库源地址</span></span><br><span class="line">REPO_URL=<span class="string">&quot;http://mirrors.aliyun.com/centos/7/&quot;</span></span><br><span class="line">BASE_REPO_ID=<span class="string">&quot;base&quot;</span></span><br><span class="line">UPDATES_REPO_ID=<span class="string">&quot;updates&quot;</span></span><br><span class="line">EXTRAS_REPO_ID=<span class="string">&quot;extras&quot;</span></span><br><span class="line">CENTOSPLUS_REPO_ID=<span class="string">&quot;centosplus&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建目标目录</span></span><br><span class="line">DEST_DIR=<span class="string">&quot;/home/wwwroot/default/yum/centos7&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;DEST_DIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步 CentOS 7 仓库</span></span><br><span class="line">reposync -r <span class="variable">$&#123;BASE_REPO_ID&#125;</span> -d <span class="variable">$&#123;DEST_DIR&#125;</span> --norepopath --download-metadata</span><br><span class="line">reposync -r <span class="variable">$&#123;UPDATES_REPO_ID&#125;</span> -d <span class="variable">$&#123;DEST_DIR&#125;</span> --norepopath --download-metadata</span><br><span class="line">reposync -r <span class="variable">$&#123;EXTRAS_REPO_ID&#125;</span> -d <span class="variable">$&#123;DEST_DIR&#125;</span> --norepopath --download-metadata</span><br><span class="line">reposync -r <span class="variable">$&#123;CENTOSPLUS_REPO_ID&#125;</span> -d <span class="variable">$&#123;DEST_DIR&#125;</span> --norepopath --download-metadata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成元数据</span></span><br><span class="line">createrepo <span class="variable">$&#123;DEST_DIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通知用户每个仓库的保存目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;同步完成！所有仓库的包已保存到：<span class="variable">$&#123;DEST_DIR&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;具体目录如下：&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - Base 仓库: <span class="variable">$&#123;DEST_DIR&#125;</span>/base&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - Updates 仓库: <span class="variable">$&#123;DEST_DIR&#125;</span>/updates&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - Extras 仓库: <span class="variable">$&#123;DEST_DIR&#125;</span>/extras&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - CentOSPlus 仓库: <span class="variable">$&#123;DEST_DIR&#125;</span>/centosplus&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Centos7同步yum源到本地</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Gemma和Emmax安装</title>
    <link href="http://example.com/2024/08/06/GEMMA%E5%92%8CEmmax/"/>
    <id>http://example.com/2024/08/06/GEMMA%E5%92%8CEmmax/</id>
    <published>2024-08-06T01:25:00.000Z</published>
    <updated>2024-08-06T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Gemma"><a href="#Gemma" class="headerlink" title="Gemma"></a>Gemma</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载软件并解压，可以选择需要放的地方</span></span><br><span class="line">wget https://github.com/genetics-statistics/GEMMA/releases/download/v0.98.5/gemma-0.98.5-linux-static-AMD64.gz</span><br><span class="line">gzip -d gemma-0.98.5-linux-static-AMD64.gz </span><br><span class="line"><span class="built_in">chmod</span> +x gemma-0.98.5-linux-static-AMD64 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看一下软件</span></span><br><span class="line">[root@server1 ~]<span class="comment"># /root/gemma-0.98.5-linux-static-AMD64</span></span><br><span class="line">GEMMA 0.98.5 (2021-08-25) by Xiang Zhou, Pjotr Prins and team (C) 2012-2021</span><br><span class="line"></span><br><span class="line"> <span class="built_in">type</span> ./gemma -h [num] <span class="keyword">for</span> detailed <span class="built_in">help</span></span><br><span class="line"> options:</span><br><span class="line">  1: quick guide</span><br><span class="line">  2: file I/O related</span><br><span class="line">  3: SNP QC</span><br><span class="line">  4: calculate relatedness matrix</span><br><span class="line">  5: perform eigen decomposition</span><br><span class="line">  6: perform variance component estimation</span><br><span class="line">  7: fit a linear model</span><br><span class="line">  8: fit a linear mixed model</span><br><span class="line">  9: fit a multivariate linear mixed model</span><br><span class="line"> 10: fit a Bayesian sparse linear mixed model</span><br><span class="line"> 11: obtain predicted values</span><br><span class="line"> 12: calculate snp variance covariance</span><br><span class="line"> 13: note</span><br><span class="line"> 14: debug options</span><br><span class="line"></span><br><span class="line">The GEMMA software is distributed under the GNU General Public v3</span><br><span class="line">   -license    show license information</span><br><span class="line">   see also http://www.xzlab.org/software.html, https://github.com/genetics-statistics</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="comment">#重命名并加入系统变量（可选，路径根据自己的需求可以改，以后在任何路径下直接使用gemma就可以了）</span></span><br><span class="line"><span class="built_in">mv</span> gemma-0.98.5-linux-static-AMD64 gemma</span><br><span class="line"><span class="built_in">ln</span> -s /root/gemma /usr/local/bin/gemma</span><br></pre></td></tr></table></figure><h3 id="Emmax"><a href="#Emmax" class="headerlink" title="Emmax"></a>Emmax</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget http://csg.sph.umich.edu//kang/emmax/download/emmax-beta-07Mar2010.tar.gz</span><br><span class="line">tar -xvf emmax-beta-07Mar2010.tar.gz</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias emmax=&quot;/root/emmax-beta-07Mar2010/emmax&quot;&#x27;</span> &gt;&gt; ~/.bash_alias</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias emmax-kin=&quot;/root/emmax-beta-07Mar2010/emmax-kin&quot;&#x27;</span> &gt;&gt; ~/.bash_alias</span><br><span class="line"><span class="built_in">source</span> ~/.bash_alias</span><br><span class="line"><span class="comment">#&gt; 测试</span></span><br><span class="line">emmax</span><br><span class="line"><span class="comment">#&gt; 出现下面提示说明安装完毕</span></span><br><span class="line"><span class="comment"># Usage: emmax [options]</span></span><br><span class="line"><span class="comment"># Required parameters</span></span><br><span class="line"><span class="comment">#   -t [tpedf_prefix] : prefix for tped/tfam files</span></span><br><span class="line"><span class="comment">#   -o [out_prefix]  : output file name prefix</span></span><br><span class="line"><span class="comment"># Likely essential parameters</span></span><br><span class="line"><span class="comment">#   -p [phenof] : 3-column phenotype file with FAMID, INDID at the first two colmns, in the same order of .tfam file. Not required only with -K option  -k [kinf] : n * n matrix containing kinship values in the individual order consistent to [tpedf].tfam file. [tpedf].kinf will be used if not specified</span></span><br><span class="line"><span class="comment">#   -c [covf] : multi-column covariate file with FAMID, INDID at the first two colmns, in the same order of .tfam fileOptional parameters</span></span><br><span class="line"><span class="comment"># Optional parameters</span></span><br><span class="line"><span class="comment">#   -i [in_prefix] : input file name prefix including eigenvectors</span></span><br><span class="line"><span class="comment">#   -d [# digits]  : precision of the output values (default : 5)</span></span><br><span class="line"><span class="comment">#   -s [start index of SNP] : start index of SNP (default : 0)</span></span><br><span class="line"><span class="comment">#   -e [end index of SNP] : end index of SNP (default : #snps)</span></span><br><span class="line"><span class="comment">#   -w : flag for writing eigenvalues/eigenvector files</span></span><br><span class="line"><span class="comment">#   -D [delimiters] : delimter string in quotation marks</span></span><br><span class="line"><span class="comment">#   -P [# heaer cols in tped] : # of column headers in tped file</span></span><br><span class="line"><span class="comment">#   -F [# heaer cols in tfam] : # of column headers in tfam file</span></span><br><span class="line"><span class="comment"># Segmentation fault (core dumped)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">两个生物基因分析的软件安装方法，杂类，碰巧有人求助，记录一下</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7停服后yum源配置指南</title>
    <link href="http://example.com/2024/08/05/centos7%E5%81%9C%E6%9C%8D%E5%90%8Eyum%E6%BA%90%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/"/>
    <id>http://example.com/2024/08/05/centos7%E5%81%9C%E6%9C%8D%E5%90%8Eyum%E6%BA%90%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</id>
    <published>2024-08-05T01:25:00.000Z</published>
    <updated>2024-08-05T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS7停服后yum源配置指南"><a href="#CentOS7停服后yum源配置指南" class="headerlink" title="CentOS7停服后yum源配置指南"></a>CentOS7停服后yum源配置指南</h1><p><code>CentOS7</code>已于2024年6月30日正式停服，停服后默认的yum源已全部404无法使用。<br>通过下载本文配置整理好的<code>CentOS7</code>系统源，可以有效解决默认源404异常问题，注意：本文仅适用于Centos7系统，请勿将本文用于其它版本系统。</p><h3 id="1、备份旧的yum源"><a href="#1、备份旧的yum源" class="headerlink" title="1、备份旧的yum源"></a>1、备份旧的yum源</h3><p>在<code>/etc/yum.repos.d/</code>目录下创建一个<code>bak</code>目录，再将<code>/etc/yum.repos.d/</code>中的<code>repo</code>源配置文件移动至<code>bak</code>目录中，当然如果您确定<code>/etc/yum.repos.d/</code>目录中的源配置没用，也可以将<code>/etc/yum.repos.d/</code>目录清空（<code>rm -f /etc/yum.repos.d/\*</code>）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/yum.repos.d/bakmv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/</span><br></pre></td></tr></table></figure><h3 id="2、配置Centos7源（x86-64架构）"><a href="#2、配置Centos7源（x86-64架构）" class="headerlink" title="2、配置Centos7源（x86_64架构）"></a>2、配置Centos7源（x86_64架构）</h3><p>这里整理了多个Centos7国内镜像的源，任选其一即可，在Centos7停服后，默认的源已从centos改成了centos-vault，这里所有的源都是二次配置修改过的。</p><p>提供curl命令下载方式，以及wget命令下载方式，任选其一。</p><p>阿里云源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-aliyun.repo https://mirrors.wlnmp.com/centos/Centos7-aliyun-x86_64.repo</span><br></pre></td></tr></table></figure><p>阿里云源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-aliyun-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>网易源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-163.repo https://mirrors.wlnmp.com/centos/Centos7-163-x86_64.repo</span><br></pre></td></tr></table></figure><p>网易源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-163-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>腾讯源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-tencent.repo https://mirrors.wlnmp.com/centos/Centos7-tencent-x86_64.repo</span><br></pre></td></tr></table></figure><p>腾讯源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-tencent-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>中国科学技术大学源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-ustc.repo https://mirrors.wlnmp.com/centos/Centos7-ustc-x86_64.repo</span><br></pre></td></tr></table></figure><p>中国科学技术大学源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-ustc-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>荆楚理工学院源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-jcut.repo https://mirrors.wlnmp.com/centos/Centos7-jcut-x86_64.repo</span><br></pre></td></tr></table></figure><p>荆楚理工学院源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-jcut-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>清华源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-tuna.repo https://mirrors.wlnmp.com/centos/Centos7-tuna-x86_64.repo</span><br></pre></td></tr></table></figure><p>清华源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-tuna-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>南阳理工学院源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-nyist.repo https://mirrors.wlnmp.com/centos/Centos7-nyist-x86_64.repo</span><br></pre></td></tr></table></figure><p>南阳理工学院源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-nyist-x86_64.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>附：x86_64架构系统，Centos7-aliyun.repo配置文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - base - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - updates - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - extras - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - centosplus - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[fasttrack]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - fasttrack - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/fasttrack/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[atomic]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - atomic - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/atomic/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[dotnet]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - dotnet - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/dotnet/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - rt - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/rt/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[sclo-rh]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - sclo-rh - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/sclo/<span class="variable">$basearch</span>/rh/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[sclo-sclo]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - sclo-sclo - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/centos/<span class="variable">$releasever</span>/sclo/<span class="variable">$basearch</span>/sclo/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure><h3 id="3、配置Centos7源（只要当前不是x86-64架构的，都使用以下配置，适用于aarch64、i386、ppc64等）"><a href="#3、配置Centos7源（只要当前不是x86-64架构的，都使用以下配置，适用于aarch64、i386、ppc64等）" class="headerlink" title="3、配置Centos7源（只要当前不是x86_64架构的，都使用以下配置，适用于aarch64、i386、ppc64等）"></a>3、配置Centos7源（只要当前不是x86_64架构的，都使用以下配置，适用于aarch64、i386、ppc64等）</h3><p>阿里云源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-aliyun.repo https://mirrors.wlnmp.com/centos/Centos7-aliyun-altarch.repo</span><br></pre></td></tr></table></figure><p>阿里云源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-aliyun-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>网易源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-163.repo https://mirrors.wlnmp.com/centos/Centos7-163-altarch.repo</span><br></pre></td></tr></table></figure><p>网易源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-163-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>腾讯源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-tencent.repo https://mirrors.wlnmp.com/centos/Centos7-tencent-altarch.repo</span><br></pre></td></tr></table></figure><p>腾讯源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-tencent-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>中国科学技术大学源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-ustc.repo https://mirrors.wlnmp.com/centos/Centos7-ustc-altarch.repo</span><br></pre></td></tr></table></figure><p>中国科学技术大学源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-ustc-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>荆楚理工学院源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-jcut.repo https://mirrors.wlnmp.com/centos/Centos7-jcut-altarch.repo</span><br></pre></td></tr></table></figure><p>荆楚理工学院源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-jcut-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>清华源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-tuna.repo https://mirrors.wlnmp.com/centos/Centos7-tuna-altarch.repo</span><br></pre></td></tr></table></figure><p>清华源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-tuna-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>南阳理工学院源（curl方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/Centos7-nyist.repo https://mirrors.wlnmp.com/centos/Centos7-nyist-altarch.repo</span><br></pre></td></tr></table></figure><p>南阳理工学院源（wget方式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.wlnmp.com/centos/Centos7-nyist-altarch.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>附：Centos7-aliyun.repo配置文件内容（非x86_64架构系统），配置文件通过$basearch变量自动识别系统架构。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - base - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - updates - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - extras - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - centosplus - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">[fasttrack]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - fasttrack - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/fasttrack/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[atomic]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - atomic - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/atomic/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[dotnet]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - dotnet - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/dotnet/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - rt - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/rt/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[sclo-rh]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - sclo-rh - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/sclo/<span class="variable">$basearch</span>/rh/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[sclo-sclo]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - sclo-sclo - mirrors.aliyun.com</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos-vault/altarch/<span class="variable">$releasever</span>/sclo/<span class="variable">$basearch</span>/sclo/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure><h3 id="4、清理缓存重建缓存"><a href="#4、清理缓存重建缓存" class="headerlink" title="4、清理缓存重建缓存"></a>4、清理缓存重建缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean allyum makecache</span><br></pre></td></tr></table></figure><p>此时CentOS7的yum源配置完成，可以像原来一样使用了。</p>]]></content>
    
    
    <summary type="html">CentOS7停服后yum源配置指南</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>批量检测网站连通性脚本</title>
    <link href="http://example.com/2024/08/03/%E6%89%B9%E9%87%8F%E6%A3%80%E6%B5%8B%E7%BD%91%E7%AB%99%E8%BF%9E%E9%80%9A%E6%80%A7/"/>
    <id>http://example.com/2024/08/03/%E6%89%B9%E9%87%8F%E6%A3%80%E6%B5%8B%E7%BD%91%E7%AB%99%E8%BF%9E%E9%80%9A%E6%80%A7/</id>
    <published>2024-08-03T01:25:00.000Z</published>
    <updated>2024-08-03T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="批量检测网站连通性脚本"><a href="#批量检测网站连通性脚本" class="headerlink" title="批量检测网站连通性脚本"></a>批量检测网站连通性脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL 列表</span></span><br><span class="line">URL_LIST=(<span class="string">&quot;www.baidu.com&quot;</span> <span class="string">&quot;www.ctnrs.com&quot;</span> <span class="string">&quot;www.zhihu.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认设置</span></span><br><span class="line">RETRY_COUNT=3  <span class="comment"># 重试次数</span></span><br><span class="line">TIMEOUT=3      <span class="comment"># 超时时间（秒）</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;url_check.log&quot;</span>  <span class="comment"># 错误日志文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印帮助信息的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">print_help</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> [-r retry_count] [-t timeout] [-l log_file]&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;选项:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  -r retry_count  每个 URL 的重试次数 (默认: <span class="variable">$RETRY_COUNT</span>)&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  -t timeout      每次 ping 的超时时间，单位为秒 (默认: <span class="variable">$TIMEOUT</span>)&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  -l log_file     记录错误日志的文件 (默认: <span class="variable">$LOG_FILE</span>)&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  -h              显示此帮助信息&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析命令行参数</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&quot;r:t:l:h&quot;</span> opt; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">        r) RETRY_COUNT=<span class="variable">$OPTARG</span> ;;  <span class="comment"># 设置重试次数</span></span><br><span class="line">        t) TIMEOUT=<span class="variable">$OPTARG</span> ;;      <span class="comment"># 设置超时时间</span></span><br><span class="line">        l) LOG_FILE=<span class="variable">$OPTARG</span> ;;     <span class="comment"># 设置日志文件路径</span></span><br><span class="line">        h) print_help; <span class="built_in">exit</span> 0 ;;   <span class="comment"># 显示帮助信息并退出</span></span><br><span class="line">        *) print_help; <span class="built_in">exit</span> 1 ;;   <span class="comment"># 显示帮助信息并退出（当出现无效参数时）</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 URL 的函数</span></span><br><span class="line"><span class="function"><span class="title">check_url</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> URL=<span class="variable">$1</span>  <span class="comment"># 当前要检查的 URL</span></span><br><span class="line">    <span class="built_in">local</span> FAIL_COUNT=0  <span class="comment"># 失败次数计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试 ping URL，最多重试 RETRY_COUNT 次</span></span><br><span class="line">    <span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=RETRY_COUNT; i++)); <span class="keyword">do</span></span><br><span class="line">        ping -c 1 -W <span class="variable">$TIMEOUT</span> <span class="variable">$URL</span> &gt; /dev/null 2&gt;&amp;1  <span class="comment"># 发送一次 ping 并等待 TIMEOUT 秒</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span> - <span class="variable">$URL</span> OK&quot;</span></span><br><span class="line">            <span class="built_in">return</span>  <span class="comment"># 如果 ping 成功，结束函数执行</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment"># ping 失败，输出重试信息并增加失败计数</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span> - <span class="variable">$URL</span> retry <span class="variable">$FAIL_COUNT</span>&quot;</span></span><br><span class="line">            <span class="built_in">let</span> FAIL_COUNT++</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果重试次数达到上限，输出警告并记录到日志文件</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$FAIL_COUNT</span> -eq <span class="variable">$RETRY_COUNT</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span> - Warning: <span class="variable">$URL</span> 访问失败!&quot;</span> | <span class="built_in">tee</span> -a <span class="variable">$LOG_FILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并发检查所有 URL</span></span><br><span class="line"><span class="keyword">for</span> URL <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;URL_LIST[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    check_url <span class="variable">$URL</span> &amp;  <span class="comment"># 使用后台进程并行检查</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待所有后台任务完成</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有 URL 检查完成。&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="优化点详细解释："><a href="#优化点详细解释：" class="headerlink" title="优化点详细解释："></a>优化点详细解释：</h3><ol><li><strong>数组管理 URL 列表</strong>：<ul><li>使用 Bash 数组存储 URL 列表，更易于管理和扩展。</li></ul></li><li><strong>增加参数支持</strong>：<ul><li>使用 <code>getopts</code> 命令解析命令行参数，允许用户自定义重试次数、超时时间和日志文件路径。</li></ul></li><li><strong>日志记录</strong>：<ul><li>错误日志记录到指定文件（默认是 <code>url_check.log</code>），方便后续检查。</li></ul></li><li><strong>并发处理</strong>：<ul><li>使用 <code>&amp;</code> 将 URL 检查任务放入后台，并使用 <code>wait</code> 等待所有任务完成，提高效率。</li></ul></li><li><strong>改进输出格式</strong>：<ul><li>在输出中加入时间戳，以便更好地跟踪和分析。</li></ul></li><li><strong>帮助信息</strong>：<ul><li>添加了 <code>-h</code> 参数，可以显示帮助信息，方便用户查看脚本的使用方法。</li></ul></li></ol><h3 id="使用示例："><a href="#使用示例：" class="headerlink" title="使用示例："></a>使用示例：</h3><ul><li><p>默认参数运行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./script.sh</span><br></pre></td></tr></table></figure></li><li><p>自定义重试次数、超时时间和日志文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./script.sh -r 5 -t 5 -l custom_log.log</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">批量检测网站连通性脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Linux获取CPU信息</title>
    <link href="http://example.com/2024/08/01/linux%E4%B8%8Acpu%E4%BF%A1%E6%81%AF%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96/"/>
    <id>http://example.com/2024/08/01/linux%E4%B8%8Acpu%E4%BF%A1%E6%81%AF%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96/</id>
    <published>2024-08-01T01:25:00.000Z</published>
    <updated>2024-08-06T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux获取CPU信息"><a href="#Linux获取CPU信息" class="headerlink" title="Linux获取CPU信息"></a>Linux获取CPU信息</h1><p>在 Linux 系统中，获取 CPU 信息是系统管理员、开发人员以及性能调优专家的常见任务。了解 CPU 的详细信息可以帮助你更好地管理系统资源、排查性能问题以及优化应用程序。本文将详细介绍 6 条关键命令，帮助你在 Linux 系统上获取 CPU 信息。</p><ul><li>**<code>lscpu</code>**：提供总体的 CPU 架构信息。</li><li>**<code>cat /proc/cpuinfo</code>**：详细列出每个逻辑处理器的信息。</li><li>**<code>top</code>**：实时监控 CPU 使用情况。</li><li>**<code>htop</code>**：增强的 <code>top</code>，具有更友好的界面。</li><li>**<code>mpstat</code>**：报告各个 CPU 的统计信息。</li><li>**<code>dmesg | grep -i cpu</code>**：查看内核日志中的 CPU 信息。</li></ul><h2 id="1-lscpu"><a href="#1-lscpu" class="headerlink" title="1. lscpu"></a>1. <code>lscpu</code></h2><p><code>lscpu</code> 是一个简洁而强大的命令，用于显示 CPU 架构的信息。它可以快速提供关于处理器的型号、核心数、线程数、缓存大小等详细信息。</p><p>打开终端并输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lscpu</span><br></pre></td></tr></table></figure><p>命令的输出包含许多有用的信息，例如：</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815220744467.png" alt="image-20240815220744467"></p><ul><li><code>Architecture</code>：CPU 架构类型（例如 x86_64 表示 64 位）。</li><li><code>CPU(s)</code>：CPU 的总核心数。</li><li><code>Thread(s) per core</code>：每个核心的线程数。</li><li><code>Core(s) per socket</code>：每个插槽的核心数。</li><li><code>Socket(s)</code>：插槽数量。</li><li><code>Model name</code>：CPU 的型号名称。</li><li><code>CPU MHz</code>：当前的 CPU 频率。</li><li><code>Cache</code> 信息：L1、L2 和 L3 缓存大小。</li></ul><h2 id="2-cat-proc-cpuinfo"><a href="#2-cat-proc-cpuinfo" class="headerlink" title="2. cat /proc/cpuinfo"></a>2. <code>cat /proc/cpuinfo</code></h2><p><code>/proc/cpuinfo</code> 文件包含了 CPU 的详细信息。通过读取这个文件，可以获得每个 CPU 核心的具体参数。</p><p>在终端中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure><p>该命令的输出可能非常长，因为它会列出每个逻辑 CPU 的信息。例如：</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815221104698.png" alt="image-20240815221104698"></p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815221133118.png" alt="image-20240815221133118"></p><ul><li><code>processor</code>：逻辑处理器 ID。</li><li><code>vendor_id</code>：CPU 供应商。</li><li><code>model name</code>：CPU 型号名称。</li><li><code>cpu MHz</code>：当前的 CPU 频率。</li><li><code>cache size</code>：缓存大小。</li><li><code>cpu cores</code>：核心数。</li><li><code>flags</code>：CPU 支持的特性和指令集。</li></ul><h3 id="常用技巧"><a href="#常用技巧" class="headerlink" title="常用技巧"></a>常用技巧</h3><ul><li>获取CPU信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo | grep <span class="string">&#x27;model name\|cpu MHz&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>统计CPU核心数</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -c <span class="string">&#x27;processor&#x27;</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure><h2 id="3-top"><a href="#3-top" class="headerlink" title="3. top"></a>3. <code>top</code></h2><p><code>top</code> 命令不仅用于监视系统的实时性能，还可以显示 CPU 的使用情况。通过 <code>top</code>，可以看到各个进程的 CPU 使用率以及整体 CPU 的状态。</p><p>在终端中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure><p>默认情况下，<code>top</code> 命令的输出如下：<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815221211522.png" alt="image-20240815221211522"></p><ul><li><code>%Cpu(s)</code>：各类 CPU 使用率，包括用户空间（us）、系统空间（sy）、空闲（id）等。</li><li><code>PID</code>：进程 ID。</li><li><code>%CPU</code>：进程的 CPU 使用率。</li></ul><h2 id="4-htop"><a href="#4-htop" class="headerlink" title="4. htop"></a>4. <code>htop</code></h2><p><code>htop</code> 是 <code>top</code> 的增强版本，提供了更友好的用户界面和更多的交互功能。它可以实时显示 CPU 使用情况，并以图形方式展示各个核心的负载。</p><p>在大多数 Linux 发行版上，可以使用包管理器安装 <code>htop</code>,要安装epel源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install htop -y    <span class="comment"># 对于 Debian/Ubuntu</span></span><br><span class="line">sudo yum install htop -y       <span class="comment"># 对于 CentOS/RHEL</span></span><br><span class="line">sudo dnf install htop -y        <span class="comment"># 对于 Fedora</span></span><br></pre></td></tr></table></figure><p>在终端中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htop</span><br></pre></td></tr></table></figure><p><code>htop</code> 的界面显示如下：</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815221913541.png" alt="image-20240815221913541"></p><ul><li>每个核心的使用率以条形图形式显示。</li><li><code>Tasks</code>：任务数量。</li><li><code>Load average</code>：系统负载平均值。</li><li><code>Mem</code> 和 <code>Swp</code>：内存和交换分区的使用情况。</li></ul><h2 id="5-mpstat"><a href="#5-mpstat" class="headerlink" title="5. mpstat"></a>5. <code>mpstat</code></h2><p><code>mpstat</code> 是 <code>sysstat</code> 工具包的一部分，用于报告各个 CPU 的统计信息。它可以帮助你了解每个核心的使用情况、等待时间和中断处理情况等。</p><p>在大多数 Linux 发行版上，可以使用包管理器安装 <code>sysstat</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install sysstat -y   <span class="comment"># 对于 Debian/Ubuntu</span></span><br><span class="line">sudo yum install sysstat -y        <span class="comment"># 对于 CentOS/RHEL</span></span><br><span class="line">sudo dnf install sysstat -y        <span class="comment"># 对于 Fedora</span></span><br></pre></td></tr></table></figure><p>在终端中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpstat -P ALL 1 <span class="comment">#每隔一秒显示一次</span></span><br></pre></td></tr></table></figure><p>该命令的输出如下：<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815222731208.png" alt="image-20240815222731208"></p><ul><li><code>%usr</code>：用户空间的 CPU 使用率。</li><li><code>%sys</code>：系统空间的 CPU 使用率。</li><li><code>%iowait</code>：I&#x2F;O 等待的 CPU 时间百分比。</li><li><code>%idle</code>：CPU 空闲时间百分比。</li></ul><h2 id="6-dmesg-grep-i-cpu"><a href="#6-dmesg-grep-i-cpu" class="headerlink" title="6. dmesg | grep -i cpu"></a>6. <code>dmesg | grep -i cpu</code></h2><p><code>dmesg</code> 命令用于显示内核和启动日志。通过过滤 <code>cpu</code> 相关信息，可以获取系统启动时内核检测到的 CPU 信息。</p><p>在终端中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i cpu</span><br></pre></td></tr></table></figure><p>该命令的输出可能包括如下内容：<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/image-20240815222758712.png" alt="image-20240815222758712"></p><ul><li><code>smpboot: CPU0</code>：CPU 的基本信息。</li><li><code>Performance Events</code>：性能事件相关信息。</li><li><code>node</code>：CPU 所在的 NUMA 节点。</li></ul>]]></content>
    
    
    <summary type="html">Linux获取CPU信息</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>不仅仅可用cat查看行号了，nl也不错</title>
    <link href="http://example.com/2024/07/31/nl%E5%91%BD%E4%BB%A4/"/>
    <id>http://example.com/2024/07/31/nl%E5%91%BD%E4%BB%A4/</id>
    <published>2024-07-31T01:25:00.000Z</published>
    <updated>2024-07-31T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="不仅仅可用cat查看行号了，nl也不错"><a href="#不仅仅可用cat查看行号了，nl也不错" class="headerlink" title="不仅仅可用cat查看行号了，nl也不错"></a>不仅仅可用cat查看行号了，nl也不错</h2><p>nl命令是Linux系统中的一个文本处理工具，其全称是“number lines”。它的主要功能是为文件内容添加行号，并将结果输出到标准输出或另一个文件中。nl命令特别适用于查看源代码或配置文件时，帮助用户更好地阅读和编辑文件内容。</p><h3 id="相较于cat命令的优势"><a href="#相较于cat命令的优势" class="headerlink" title="相较于cat命令的优势"></a>相较于cat命令的优势</h3><p>虽然cat命令也可以通过-n选项为文件内容添加行号，但nl命令在行号显示的灵活性和定制化方面具有更多优势：</p><ul><li><p>行号显示方式：nl命令可以通过不同的选项来控制行号的显示位置和格式。例如，可以选择行号显示在左侧或右侧，是否补齐0等。</p></li><li><p>空行处理：nl命令可以选择是否为空行添加行号，而cat -n命令默认会为所有行添加行号。</p></li><li><p>逻辑页支持：nl命令支持逻辑页的概念，可以为每个逻辑页单独设置行号计算方式，包括页眉、主体和页脚部分。</p></li></ul><h3 id="用法与示例"><a href="#用法与示例" class="headerlink" title="用法与示例"></a>用法与示例</h3><p>nl命令的基本语法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> [选项]... [文件]...</span><br></pre></td></tr></table></figure><p><strong>以下是一些常用选项及其示例：</strong></p><ul><li>基本用法：为文件内容添加行号</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 Hello </span><br><span class="line">2 World</span><br></pre></td></tr></table></figure><ul><li>为空行添加行号：使用-b a选项</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> -b a test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 Hello </span><br><span class="line">2 </span><br><span class="line">3 World</span><br></pre></td></tr></table></figure><ul><li>行号显示在右侧并补齐0：使用-n rz选项</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> -n rz test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">000001 Hello </span><br><span class="line">000002 World</span><br></pre></td></tr></table></figure><ul><li>设置行号的宽度：使用-w选项</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> -w 3 test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 Hello </span><br><span class="line">2 World</span><br></pre></td></tr></table></figure><ul><li>从特定行号开始：使用-v选项</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> -v 100 test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100 Hello </span><br><span class="line">101 World</span><br></pre></td></tr></table></figure><ul><li>在行号后添加字符串：使用-s选项</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> -s <span class="string">&quot;. &quot;</span> test.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Hello </span><br><span class="line">2. World</span><br></pre></td></tr></table></figure><p>nl命令是一个强大的文本处理工具，提供了比cat -n命令更灵活的行号显示方式。通过使用不同的选项，用户可以根据需求定制行号的显示格式和位置，使文件内容的阅读和编辑更加方便。如果你经常需要处理文本文件，nl命令无疑是一个非常有用的工具。</p>]]></content>
    
    
    <summary type="html">不仅仅可用cat查看行号了，nl也不错</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>在Linux系统中正确的删除文件</title>
    <link href="http://example.com/2024/07/31/%E5%A6%82%E4%BD%95%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6/"/>
    <id>http://example.com/2024/07/31/%E5%A6%82%E4%BD%95%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6/</id>
    <published>2024-07-31T01:25:00.000Z</published>
    <updated>2024-07-31T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何在Linux系统中正确的删除文件"><a href="#如何在Linux系统中正确的删除文件" class="headerlink" title="如何在Linux系统中正确的删除文件"></a>如何在Linux系统中正确的删除文件</h1><p>提到删除文件，首先想到的就是rm命令，但并不是所有的文件删除都需要通过rm命令，本文重点来普及下，在Linux命令行中如何正确的删除文件。</p><h3 id="1、删除单一文件"><a href="#1、删除单一文件" class="headerlink" title="1、删除单一文件"></a>1、删除单一文件</h3><p><code>unlink命令</code>：用于删除指定的单一文件，只能同时删除一个文件或链接，不能删除目录，不能批量删除，适合删除单一的文件。</p><p>例：<code>unlink wlnmp.sql</code></p><h3 id="2、删除一个或多个文件"><a href="#2、删除一个或多个文件" class="headerlink" title="2、删除一个或多个文件"></a>2、删除一个或多个文件</h3><p><code>rm命令</code>：也是我们最常用的删除命令，它可以删除一个、多个文件或目录，</p><p>注意：因为<code>rm</code>命令格外强大，在使用删除时需要格外小心，尤其要注意<code>-rf</code>和<code>-f</code>参数，在删除一个或多个文件时，请不要使用<code>-rf</code>，不要附加<code>-r</code>目录选项（养成一个良好的习惯），一旦误操作是毁灭性的。</p><p>例：删除whsir目录下的wh.log文件，并二次确认</p><p><code>rm whsir/wh.log</code></p><p>例：删除whsir目录及目录下所有文件</p><p><code>rm -rf whsir/</code></p><h3 id="3、删除正在有日志写入的文件"><a href="#3、删除正在有日志写入的文件" class="headerlink" title="3、删除正在有日志写入的文件"></a>3、删除正在有日志写入的文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;：通过标准输出方式删除，&gt;等同于<span class="built_in">echo</span> &gt;。</span><br></pre></td></tr></table></figure><p>例：当前有个MySQL日志文件whsir.log，不断有新的日志文件产生。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &gt; whsir.log</span><br></pre></td></tr></table></figure><h3 id="4、通过查找删除文件"><a href="#4、通过查找删除文件" class="headerlink" title="4、通过查找删除文件"></a>4、通过查找删除文件</h3><p><code>find</code>：使用过Linux的都知道他是一个很强大的搜索命令，但是少数人知道，它本身也具有删除文件功能。</p><p>例：删除whsir目录下所有以.txt结尾的文件</p><p><code>find /whsir -type f -name &quot;\*.txt&quot; -delete</code></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>1、删除文件需要结合当前场景，什么场景适用什么命令，不要一味的使用rm命令。</p><p>2、使用<strong>rm命令</strong>时，应当养成一个良好的习惯，<strong>不要一味的使用<code>-rf</code>参数</strong>，一旦哪天手抖了（不要抱有侥幸心里）</p><p>3、删除一个指定的文件可以选择<code>unlink</code>或<code>rm FILE</code>。</p><p>4、当删除有日志不断产生的文件时，首选&gt;标准输出方式清除文件内容，应避免直接删除，直接删除可能会导致空间无法释放，造成服务必须重启才能释放空间，<strong>这非常重要</strong>。</p><p>5、建议单独的创建一个回收站目录，使用mv将需要删除的文件放入这个回收站，定期的去清空它，这样可以更大限度的保障误删文件后的找回。</p>]]></content>
    
    
    <summary type="html">在Linux系统中正确的删除文件</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>用Shell脚本给Linux添加回收站并实现自动维护</title>
    <link href="http://example.com/2024/07/28/shell%E8%84%9A%E6%9C%AC%E7%BB%99linux%E6%B7%BB%E5%8A%A0%E5%9B%9E%E6%94%B6%E7%AB%99%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E7%BB%B4%E6%8A%A4/"/>
    <id>http://example.com/2024/07/28/shell%E8%84%9A%E6%9C%AC%E7%BB%99linux%E6%B7%BB%E5%8A%A0%E5%9B%9E%E6%94%B6%E7%AB%99%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E7%BB%B4%E6%8A%A4/</id>
    <published>2024-07-28T01:25:00.000Z</published>
    <updated>2024-07-28T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="用Shell脚本给Linux添加回收站并实现自动维护"><a href="#用Shell脚本给Linux添加回收站并实现自动维护" class="headerlink" title="用Shell脚本给Linux添加回收站并实现自动维护"></a>用Shell脚本给Linux添加回收站并实现自动维护</h1><p>在<code>Linux</code>系统中，删除文件通常是通过<code>rm</code>命令直接移除文件，这意味着文件一旦被删除，就很难恢复。因此，许多用户在日常操作中可能需要一个类似于<code>Windows</code>系统的回收站功能。本文将介绍如何使用<code>Shell</code>脚本为<code>Linux</code>系统增加回收站功能，并实现定期自动清理回收站的内容。</p><h2 id="回收站功能的基本原理"><a href="#回收站功能的基本原理" class="headerlink" title="回收站功能的基本原理"></a>回收站功能的基本原理</h2><p>在<code>Linux</code>下模拟回收站功能的思路是：将用户删除的文件或目录移动到一个特定的目录（例如<code>~/.trash</code>），而不是直接删除。这样，用户可以在需要时从回收站中恢复文件。此外，为了防止回收站无限制地占用磁盘空间，脚本还需要支持定期清理回收站中过期的文件。</p><h2 id="创建回收站目录"><a href="#创建回收站目录" class="headerlink" title="创建回收站目录"></a>创建回收站目录</h2><p>首先，我们需要为回收站创建一个目录。可以在用户的主目录下创建一个名为<code>.trash</code>的隐藏目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/.trash</span><br></pre></td></tr></table></figure><h2 id="实现trash命令"><a href="#实现trash命令" class="headerlink" title="实现trash命令"></a>实现<code>trash</code>命令</h2><p>接下来，我们编写一个名为<code>trash</code>的Shell脚本，用于替代<code>rm</code>命令来执行文件的“删除”操作。该脚本将文件移动到回收站目录中，并记录下文件的原始路径以便将来恢复。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回收站目录</span></span><br><span class="line">TRASH_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.trash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保回收站目录存在</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$TRASH_DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$TRASH_DIR</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否提供了文件名参数</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span><span class="string">&quot;Usage: <span class="variable">$0</span> file_or_directory&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有传递的参数</span></span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span><span class="string">&quot;<span class="variable">$@</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># 获取当前日期时间，用于重命名文件防止冲突</span></span><br><span class="line">        TIMESTAMP=$(<span class="built_in">date</span> +%Y%m%d%H%M%S)</span><br><span class="line">        BASENAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span>)</span><br><span class="line">        NEW_NAME=<span class="string">&quot;<span class="variable">$BASENAME</span>-<span class="variable">$TIMESTAMP</span>&quot;</span></span><br><span class="line">        <span class="built_in">mv</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span><span class="string">&quot;<span class="variable">$TRASH_DIR</span>/<span class="variable">$NEW_NAME</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span><span class="string">&quot;Moved &#x27;<span class="variable">$FILE</span>&#x27; to &#x27;<span class="variable">$TRASH_DIR</span>/<span class="variable">$NEW_NAME</span>&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span><span class="string">&quot;&#x27;<span class="variable">$FILE</span>&#x27; does not exist!&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>将该脚本保存为<code>~/bin/trash</code>，并赋予其可执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /bin/trash.sh</span><br></pre></td></tr></table></figure><p>现在把<code>trash</code>这边命令通过别名的方式替换原系统的<code>rm</code>命令，编辑<code>/etc/profile</code>，在文件开头添加如下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=/bin/trash.sh</span><br></pre></td></tr></table></figure><p>现在，用户可以使用rm命令来“删除”文件，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> myfile.txt</span><br></pre></td></tr></table></figure><p>此操作将文件<code>myfile.txt</code>移动到<code>~/.trash</code>目录，并在文件名后附加一个时间戳以避免重名。</p><h2 id="实现自动清理回收站"><a href="#实现自动清理回收站" class="headerlink" title="实现自动清理回收站"></a>实现自动清理回收站</h2><p>为了避免回收站无限制地占用磁盘空间，我们可以编写一个脚本来定期清理回收站中的旧文件。例如，可以删除超过30天的文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回收站目录</span></span><br><span class="line">TRASH_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.trash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除30天前的文件</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$TRASH_DIR</span>&quot;</span> -<span class="built_in">type</span> f -mtime +30 -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span><span class="string">&quot;Trash cleaned up.&quot;</span></span><br></pre></td></tr></table></figure><p>将该脚本保存为<code>/bin/clean_trash.sh</code>，并赋予其可执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /bin/clean_trash.sh</span><br></pre></td></tr></table></figure><p>为了让清理任务自动执行，可以将该脚本添加到crontab中，例如每天运行一次：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(crontab -l ; <span class="built_in">echo</span> <span class="string">&quot;0 2 * * * /bin/clean_trash.sh&quot;</span>) | crontab -</span><br></pre></td></tr></table></figure><p>这条crontab指令表示每天凌晨2点运行<code>clean_trash</code>脚本，自动清理回收站。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过上述步骤，我们已经成功地在Linux系统中实现了一个简单的回收站功能，并且可以自动清理回收站中过期的文件。这不仅保护了用户在误删文件时的恢复能力，还帮助用户有效管理磁盘空间。此解决方案可根据实际需求进行进一步的扩展和优化，例如增加文件恢复功能、通过参数调整保留时间等。</p>]]></content>
    
    
    <summary type="html">用Shell脚本给Linux添加回收站并实现自动维护</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>常用的网络排查命令</title>
    <link href="http://example.com/2024/07/25/%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4/"/>
    <id>http://example.com/2024/07/25/%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4/</id>
    <published>2024-07-25T01:25:00.000Z</published>
    <updated>2024-07-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常用的网络命令"><a href="#常用的网络命令" class="headerlink" title="常用的网络命令"></a>常用的网络命令</h2><h3 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 基础用法</span><br><span class="line">telnet [主机名/IP地址] [端口号]</span><br><span class="line"><span class="comment">#如telnet 192.168.1.100 23</span></span><br></pre></td></tr></table></figure><ul><li>常用参数<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-8: 允许使用8位字符数据传输</span><br><span class="line">-l [用户名]: 指定登录用户名</span><br><span class="line">-a: 尝试自动登录</span><br><span class="line">-r: 使用当前用户名进行rlogin式的自动登录</span><br></pre></td></tr></table></figure></li><li>连接后的操作</li></ul><ol><li>输入用户名和密码登录远程主机</li><li>执行远程主机上的命令</li><li>使用Ctrl+] 进入telnet命令模式</li><li>在命令模式下,输入quit断开连接并退出<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.1.100 23</span><br><span class="line"><span class="comment">#成功后将看到下面的提示</span></span><br><span class="line">Trying 192.168.1.100...</span><br><span class="line">Connected to 192.168.1.100.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br></pre></td></tr></table></figure></li></ol><h4 id="网络连通性测试"><a href="#网络连通性测试" class="headerlink" title="网络连通性测试"></a>网络连通性测试</h4><ul><li><strong>端口开放性检查</strong><br>如果能成功连接，说明目标IP和端口是开放的。如果返回”Connection refused”，表示网络可达但目标端口未开放。</li><li><strong>网络可达性测试</strong><br>如果返回”Connected to [IP]”，表示网络连接正常。如果返回”Connection timed out”，说明网络不通或被防火墙阻止。</li><li><strong>服务状态检查</strong><br>如果连接后立即返回”Connection closed by foreign host”，通常表示服务正在运行但拒绝了连接。</li></ul><h3 id="traceroute（tracert）"><a href="#traceroute（tracert）" class="headerlink" title="traceroute（tracert）"></a>traceroute（tracert）</h3><p><code>traceroute</code>（在某些系统上(windows)也称为<code>tracert</code>）是一个网络诊断工具，用于确定数据包从一个源IP地址到一个目的IP地址的路径。它通过发送一系列的UDP数据包，每个数据包的TTL（Time To Live，生存时间）值逐渐增加，以便在路由路径上的每一跳（路由器）都返回一个ICMP时间超时消息（Time Exceeded）给发送者。这样，<code>traceroute</code>就可以列出经过的每一跳及其延迟。</p><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><ol><li><strong>基本语法：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute &lt;目标IP地址或域名&gt;</span><br></pre></td></tr></table></figure>例如：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute www.google.com</span><br></pre></td></tr></table></figure></li><li><strong>如何解读输出：</strong><ul><li>每行显示一跳（路由器），按照它们从源到目标的顺序。</li><li>每一行显示了路由器的IP地址（或者如果可能，显示其域名），以及数据包从源到达该路由器所经历的时间（延迟）。</li></ul></li><li><strong>选项：</strong><br><code>-n</code>：以IP地址而非主机名显示跟踪。<br><code>-q &lt;查询次数&gt;</code>：指定每个跳跃的查询次数。<br><code>-m &lt;最大跳数&gt;</code>：设置最大跳数，以避免无限循环。<br><code>-w &lt;超时秒数&gt;</code>：设置超时时间，以等待每个回应。</li></ol><h4 id="示例解释"><a href="#示例解释" class="headerlink" title="示例解释"></a>示例解释</h4><p>假设你运行以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute www.google.com</span><br></pre></td></tr></table></figure><p>输出可能类似于：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">traceroute to www.google.com (216.58.194.196), 30 hops max, 60 byte packets</span><br><span class="line"> 1  192.168.1.1 (192.168.1.1)  1.123 ms  0.789 ms  0.643 ms</span><br><span class="line"> 2  10.20.30.1 (10.20.30.1)  5.234 ms  2.456 ms  3.789 ms</span><br><span class="line"> 3  30.40.50.1 (30.40.50.1)  15.678 ms  10.567 ms  12.345 ms</span><br><span class="line"> 4  50.60.70.1 (50.60.70.1)  20.456 ms  18.234 ms  21.567 ms</span><br><span class="line"> 5  80.90.100.1 (80.90.100.1)  25.678 ms  23.456 ms  24.567 ms</span><br><span class="line"> 6  110.120.130.1 (110.120.130.1)  30.789 ms  28.567 ms  31.234 ms</span><br><span class="line"> 7  140.150.160.1 (140.150.160.1)  35.678 ms  32.456 ms  34.789 ms</span><br><span class="line"> 8  170.180.190.1 (170.180.190.1)  40.567 ms  38.234 ms  39.567 ms</span><br><span class="line"> 9  200.210.220.1 (200.210.220.1)  45.678 ms  42.456 ms  44.789 ms</span><br><span class="line">10  216.58.194.196 (216.58.194.196)  50.567 ms  48.234 ms  49.567 ms</span><br></pre></td></tr></table></figure><p>每一行代表数据包从源到达目的地的每一跳。例如，第一行显示从源到第一跳（192.168.1.1）的延迟时间，以毫秒为单位。</p><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul><li><code>traceroute</code>结果可能因网络拓扑和路由器配置而异。</li><li>部分网络可能禁止ICMP消息，导致<code>traceroute</code>无法工作。</li></ul><h3 id="nc命令"><a href="#nc命令" class="headerlink" title="nc命令"></a>nc命令</h3><p><code>nc</code>（Netcat）是一个功能强大的网络工具，常用于网络调试和数据传输。</p><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>Netcat 是一个网络工具，可以用来：</p><ul><li>进行 TCP 或 UDP 连接</li><li>监听端口</li><li>发送和接收数据</li><li>进行端口扫描</li><li>作为简单的聊天工具</li></ul><h4 id="安装-Netcat"><a href="#安装-Netcat" class="headerlink" title="安装 Netcat"></a>安装 Netcat</h4><p>在大多数 Linux 发行版中，Netcat 通常预装。如果没有，可以通过包管理器安装：</p><ul><li><strong>Debian&#x2F;Ubuntu</strong>: <code>sudo apt-get install netcat -y</code></li><li><strong>CentOS&#x2F;RHEL</strong>: <code>sudo yum install nc -y</code></li><li><strong>macOS</strong>: <code>brew install netcat -y</code></li></ul><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc [hostname] [port]</span><br><span class="line">nc -l -p 1234 <span class="comment">#监听端口,这将在本地机器上监听 1234 端口</span></span><br></pre></td></tr></table></figure><h4 id="常见选项"><a href="#常见选项" class="headerlink" title="常见选项"></a>常见选项</h4><p><code>-l</code>: 监听模式<br><code>-p</code>: 指定端口（在监听模式下使用）<br><code>-u</code>: 使用 UDP 而不是 TCP<br><code>-v</code>: 显示详细输出<br><code>-z</code>: 扫描模式，不发送数据，只检查端口是否开放<br><code>-w</code>: 设置超时时间（单位：秒）</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="简单的聊天"><a href="#简单的聊天" class="headerlink" title="简单的聊天"></a>简单的聊天</h5><p>在一台机器上监听：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l -p 1234</span><br></pre></td></tr></table></figure><p>在另一台机器上连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc [IP地址] 1234</span><br></pre></td></tr></table></figure><p>现在两台机器可以互相发送消息</p><h5 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h5><ul><li><strong>发送文件</strong>：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l -p 1234 &lt; filename</span><br></pre></td></tr></table></figure><ul><li><strong>接收文件</strong>：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc [IP地址] 1234 &gt; filename</span><br></pre></td></tr></table></figure><h5 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -z -v [hostname] [port]</span><br><span class="line"><span class="comment">#如nc -z -v www.baidu.com 80</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#循环扫描</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> &#123;1..1000&#125;; <span class="keyword">do</span></span><br><span class="line">    nc -z -v www.baidu.com <span class="variable">$port</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="nmap命令"><a href="#nmap命令" class="headerlink" title="nmap命令"></a>nmap命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-1000 www.baidu.com</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">常用的网络排查命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>工作中常用的一些命令</title>
    <link href="http://example.com/2024/07/12/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>http://example.com/2024/07/12/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2024-07-12T01:25:00.000Z</published>
    <updated>2024-07-23T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常用的一些命令"><a href="#常用的一些命令" class="headerlink" title="常用的一些命令"></a>常用的一些命令</h2><h3 id="1-查看内存占用情况"><a href="#1-查看内存占用情况" class="headerlink" title="1.查看内存占用情况"></a>1.查看内存占用情况</h3><ul><li>输出内存占用的进程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -eo user,pid,pcpu,pmem,args --<span class="built_in">sort</span>=-pmem  |<span class="built_in">head</span> -n 10</span><br></pre></td></tr></table></figure><ul><li>也可使用smem命令，需要安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># smem -wtk</span></span><br><span class="line">Area                           Used      Cache   Noncache </span><br><span class="line">firmware/hardware                 0          0          0 </span><br><span class="line">kernel image                      0          0          0 </span><br><span class="line">kernel dynamic memory        489.4M     314.7M     174.7M </span><br><span class="line">userspace memory              69.5M      33.8M      35.6M </span><br><span class="line">free memory                    1.1G       1.1G          0 </span><br><span class="line">----------------------------------------------------------</span><br><span class="line">                               1.7G       1.5G     210.3M </span><br></pre></td></tr></table></figure><h3 id="2-查看CPU使用情况"><a href="#2-查看CPU使用情况" class="headerlink" title="2.查看CPU使用情况"></a>2.查看CPU使用情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -eo user,pid,pcpu,pmem,args --<span class="built_in">sort</span>=-pcpu  |<span class="built_in">head</span> -n 10</span><br></pre></td></tr></table></figure><h3 id="3-查看io情况"><a href="#3-查看io情况" class="headerlink" title="3.查看io情况"></a>3.查看io情况</h3><ul><li>yum install dstat -y</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dstat</span><br><span class="line">dstat -<span class="built_in">cd</span></span><br><span class="line">dstat -c -d 5 10 <span class="comment">#五秒一次，执行十次</span></span><br></pre></td></tr></table></figure><h3 id="4-find查看-删除指定日期前的文件"><a href="#4-find查看-删除指定日期前的文件" class="headerlink" title="4.find查看&#x2F;删除指定日期前的文件"></a>4.find查看&#x2F;删除指定日期前的文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find ./ -<span class="built_in">type</span> f -name <span class="string">&quot;*.log.*&quot;</span> ! -newermt <span class="string">&quot;2024-05-01&quot;</span> -<span class="built_in">exec</span> <span class="built_in">ls</span> -l &#123;&#125; \;  <span class="comment">#查看</span></span><br><span class="line">find ./ -<span class="built_in">type</span> f -name <span class="string">&quot;*.log.*&quot;</span> ! -newermt <span class="string">&quot;2024-05-01&quot;</span> -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \;  <span class="comment">#删除前要确认，很危险</span></span><br></pre></td></tr></table></figure><h3 id="5-清除系统代理"><a href="#5-清除系统代理" class="headerlink" title="5.清除系统代理"></a>5.清除系统代理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> ALL_PROXY</span><br><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">export</span> https_proxy=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">export</span> HTTP_PROXY=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">export</span> HTTPS_PROXY=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="6-远程复制"><a href="#6-远程复制" class="headerlink" title="6.远程复制"></a>6.远程复制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r ./* john@172.22.4.4:/old <span class="comment">#将本地的复制到远程机器的对应目录，在本地机器上执行</span></span><br><span class="line">scp -r john@172.22.4.4:/old ./  <span class="comment">#将远程的复制到本地机器的对应目录</span></span><br></pre></td></tr></table></figure><h3 id="7-windows批量修改后缀"><a href="#7-windows批量修改后缀" class="headerlink" title="7.windows批量修改后缀"></a>7.windows批量修改后缀</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ChildItem *.heic | Rename-Item -NewName &#123; <span class="variable">$_</span>.Name -replace <span class="string">&#x27;\.heic$&#x27;</span>, <span class="string">&#x27;.jpg&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">工作里常用的一些命令，方便提高效率</summary>
    
    
    
    <category term="常用命令" scheme="http://example.com/categories/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    
    
    <category term="常用命令" scheme="http://example.com/tags/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Redis单节点部署脚本</title>
    <link href="http://example.com/2024/07/05/Redis%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/07/05/Redis%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/</id>
    <published>2024-07-05T01:25:00.000Z</published>
    <updated>2024-07-18T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Redis单节点部署脚本"><a href="#Redis单节点部署脚本" class="headerlink" title="Redis单节点部署脚本"></a>Redis单节点部署脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">REDIS_VERSION=<span class="string">&quot;6.2.9&quot;</span></span><br><span class="line">REDIS_ID=<span class="string">&quot;6379&quot;</span></span><br><span class="line">INSTALL_DIR=<span class="string">&quot;/opt/app/redis&quot;</span></span><br><span class="line"><span class="function"><span class="title">install_dependencies</span></span>() &#123;</span><br><span class="line">    yum -y install gcc gcc-c++ automake autoconf make tcl zlib-devel tar wget</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_redis_user</span></span>() &#123;</span><br><span class="line">    useradd -s /sbin/nologin redis -M</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">modify_kernel_params</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 65535</span></span><br><span class="line"><span class="string">net.core.somaxconn = 65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 262144</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 120</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 1</span></span><br><span class="line"><span class="string">vm.swappiness = 1</span></span><br><span class="line"><span class="string">fs.file-max = 1024000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    sysctl -p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">disable_thp</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;never&#x27;</span> &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;never&#x27;</span> &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/rc.d/rc.local &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then</span></span><br><span class="line"><span class="string">    echo &#x27;never&#x27; &gt; /sys/kernel/mm/transparent_hugepage/enabled</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</span></span><br><span class="line"><span class="string">    echo &#x27;never&#x27; &gt; /sys/kernel/mm/transparent_hugepage/defrag</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">modify_ulimit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">redis            soft    nofile          1024000</span></span><br><span class="line"><span class="string">redis            hard    nofile          1024000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_redis</span></span>() &#123;</span><br><span class="line">    <span class="built_in">mkdir</span> -p -v <span class="variable">$&#123;INSTALL_DIR&#125;</span>/&#123;base,data,conf&#125; <span class="variable">$&#123;INSTALL_DIR&#125;</span>/software</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/software/</span><br><span class="line">    wget http://download.redis.io/releases/redis-<span class="variable">$&#123;REDIS_VERSION&#125;</span>.tar.gz</span><br><span class="line">    tar xf redis-<span class="variable">$&#123;REDIS_VERSION&#125;</span>.tar.gz -C <span class="variable">$&#123;INSTALL_DIR&#125;</span>/base/</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/base</span><br><span class="line">    <span class="built_in">mv</span> redis-<span class="variable">$&#123;REDIS_VERSION&#125;</span>/ <span class="variable">$&#123;REDIS_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/base/<span class="variable">$&#123;REDIS_VERSION&#125;</span>/deps/</span><br><span class="line">    make hiredis lua linenoise jemalloc</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/base/<span class="variable">$&#123;REDIS_VERSION&#125;</span>/</span><br><span class="line">    make -j$(<span class="built_in">nproc</span>) &amp;&amp; make install PREFIX=<span class="variable">$&#123;INSTALL_DIR&#125;</span>/base/<span class="variable">$&#123;REDIS_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">chown</span> -R redis.redis <span class="variable">$&#123;INSTALL_DIR&#125;</span>/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configure_redis</span></span>() &#123;</span><br><span class="line">    <span class="built_in">mkdir</span> -p -v <span class="variable">$&#123;INSTALL_DIR&#125;</span>/data/<span class="variable">$&#123;REDIS_ID&#125;</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/conf/<span class="variable">$&#123;REDIS_ID&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cat</span> &gt; <span class="variable">$&#123;INSTALL_DIR&#125;</span>/conf/<span class="variable">$&#123;REDIS_ID&#125;</span>/redis_<span class="variable">$&#123;REDIS_ID&#125;</span>.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">### Server ###</span></span><br><span class="line"><span class="string">pidfile                                   $&#123;INSTALL_DIR&#125;/data/$&#123;REDIS_ID&#125;/redis_$&#123;REDIS_ID&#125;.pid</span></span><br><span class="line"><span class="string">port                                      $&#123;REDIS_ID&#125;</span></span><br><span class="line"><span class="string">bind                                      0.0.0.0</span></span><br><span class="line"><span class="string">logfile                                   &quot;$&#123;INSTALL_DIR&#125;/data/$&#123;REDIS_ID&#125;/redis_$&#123;REDIS_ID&#125;.log&quot;</span></span><br><span class="line"><span class="string">dbfilename                                dump_$&#123;REDIS_ID&#125;.rdb</span></span><br><span class="line"><span class="string">dir                                       $&#123;INSTALL_DIR&#125;/data/$&#123;REDIS_ID&#125;</span></span><br><span class="line"><span class="string">appendfilename                            &quot;redis_$&#123;REDIS_ID&#125;.aof&quot;</span></span><br><span class="line"><span class="string">daemonize                                 yes</span></span><br><span class="line"><span class="string">loglevel                                  notice</span></span><br><span class="line"><span class="string">databases                                 16</span></span><br><span class="line"><span class="string">activerehashing                           yes</span></span><br><span class="line"><span class="string">hz                                        10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Auth ###</span></span><br><span class="line"><span class="string">requirepass                               &quot;123456&quot;</span></span><br><span class="line"><span class="string">masterauth                                &quot;123456&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Memory ###</span></span><br><span class="line"><span class="string">maxmemory                                 10gb</span></span><br><span class="line"><span class="string">maxmemory-policy                          noeviction</span></span><br><span class="line"><span class="string">maxmemory-samples                         5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Persistence ###</span></span><br><span class="line"><span class="string">save                                      &quot;&quot;</span></span><br><span class="line"><span class="string">#save                                      &quot;900 1&quot;</span></span><br><span class="line"><span class="string">#save                                      &quot;300 10&quot;</span></span><br><span class="line"><span class="string">#save                                      &quot;60 10000&quot;</span></span><br><span class="line"><span class="string">stop-writes-on-bgsave-error               no</span></span><br><span class="line"><span class="string">rdbcompression                            yes</span></span><br><span class="line"><span class="string">rdbchecksum                               yes</span></span><br><span class="line"><span class="string">appendonly                                yes</span></span><br><span class="line"><span class="string">appendfsync                               everysec</span></span><br><span class="line"><span class="string">no-appendfsync-on-rewrite                 yes</span></span><br><span class="line"><span class="string">auto-aof-rewrite-percentage               100</span></span><br><span class="line"><span class="string">auto-aof-rewrite-min-size                 2gb</span></span><br><span class="line"><span class="string">aof-load-truncated                        yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Clients ###</span></span><br><span class="line"><span class="string">maxclients                                10000</span></span><br><span class="line"><span class="string">tcp-backlog                               65535</span></span><br><span class="line"><span class="string">timeout                                   0</span></span><br><span class="line"><span class="string">tcp-keepalive                             60</span></span><br><span class="line"><span class="string">client-output-buffer-limit normal         0 0 0</span></span><br><span class="line"><span class="string">client-output-buffer-limit slave          256mb 64mb 60</span></span><br><span class="line"><span class="string">client-output-buffer-limit pubsub         32mb 8mb 60</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Replication ###</span></span><br><span class="line"><span class="string">slave-serve-stale-data                    yes</span></span><br><span class="line"><span class="string">slave-read-only                           yes</span></span><br><span class="line"><span class="string">repl-diskless-sync                        no</span></span><br><span class="line"><span class="string">repl-diskless-sync-delay                  5</span></span><br><span class="line"><span class="string">repl-ping-slave-period                    10</span></span><br><span class="line"><span class="string">repl-disable-tcp-nodelay                  no</span></span><br><span class="line"><span class="string">repl-backlog-size                         2gb</span></span><br><span class="line"><span class="string">repl-backlog-ttl                          3600</span></span><br><span class="line"><span class="string">slave-priority                            100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Command ###</span></span><br><span class="line"><span class="string">rename-command                            flushall &quot;&quot;</span></span><br><span class="line"><span class="string">rename-command                            flushdb &quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Slowlog ###</span></span><br><span class="line"><span class="string">slowlog-log-slower-than                   1000</span></span><br><span class="line"><span class="string">slowlog-max-len                           1024</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Redis 4.0 New ###</span></span><br><span class="line"><span class="string">lazyfree-lazy-eviction                    no</span></span><br><span class="line"><span class="string">lazyfree-lazy-expire                      yes</span></span><br><span class="line"><span class="string">lazyfree-lazy-server-del                  yes</span></span><br><span class="line"><span class="string">slave-lazy-flush                          yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Redis Cluster ###</span></span><br><span class="line"><span class="string">cluster-config-file                     nodes-$&#123;REDIS_ID&#125;.conf</span></span><br><span class="line"><span class="string">cluster-enabled                         yes</span></span><br><span class="line"><span class="string">cluster-node-timeout                    15000</span></span><br><span class="line"><span class="string">cluster-slave-validity-factor           10</span></span><br><span class="line"><span class="string">cluster-migration-barrier               1</span></span><br><span class="line"><span class="string">cluster-require-full-coverage           no</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">chown</span> -R redis.redis <span class="variable">$&#123;INSTALL_DIR&#125;</span>/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_redis_service</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/systemd/system/redis_<span class="variable">$&#123;REDIS_ID&#125;</span>.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Redis</span></span><br><span class="line"><span class="string">After=syslog.target network.target remote-fs.target nss-lookup.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">PIDFile=$&#123;INSTALL_DIR&#125;/data/$&#123;REDIS_ID&#125;/redis_$&#123;REDIS_ID&#125;.pid</span></span><br><span class="line"><span class="string">ExecStart=&quot;$&#123;INSTALL_DIR&#125;/base/$&#123;REDIS_VERSION&#125;/bin/redis-server&quot; &quot;$&#123;INSTALL_DIR&#125;/conf/$&#123;REDIS_ID&#125;/redis_$&#123;REDIS_ID&#125;.conf&quot;</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP \$MAINPID</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT \$MAINPID</span></span><br><span class="line"><span class="string">User=redis</span></span><br><span class="line"><span class="string">Group=redis</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string">ExecStartPost=/bin/sleep 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl start redis_<span class="variable">$&#123;REDIS_ID&#125;</span>.service</span><br><span class="line">    systemctl <span class="built_in">enable</span> redis_<span class="variable">$&#123;REDIS_ID&#125;</span>.service</span><br><span class="line">    systemctl status redis_<span class="variable">$&#123;REDIS_ID&#125;</span>.service</span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$&#123;INSTALL_DIR&#125;</span>/base/<span class="variable">$&#123;REDIS_VERSION&#125;</span>/bin/redis-cli /usr/bin/redis-cli</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    install_dependencies</span><br><span class="line">    create_redis_user</span><br><span class="line">    modify_kernel_params</span><br><span class="line">    disable_thp</span><br><span class="line">    modify_ulimit</span><br><span class="line">    install_redis</span><br><span class="line">    configure_redis</span><br><span class="line">    create_redis_service</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Redis installation and configuration completed.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一键部署Redis，单节点版本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Redhat无法使用yum的解决方法</title>
    <link href="http://example.com/2024/06/30/Redhat%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8yum%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <id>http://example.com/2024/06/30/Redhat%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8yum%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</id>
    <published>2024-06-30T01:25:00.000Z</published>
    <updated>2024-06-30T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redhat无法使用yum的解决方法"><a href="#Redhat无法使用yum的解决方法" class="headerlink" title="Redhat无法使用yum的解决方法"></a>Redhat无法使用yum的解决方法</h1><ul><li><p>第一步：替换yum源，最好是确认可用的源</p></li><li><p>第二步：禁用提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># cd /etc/yum/pluginconf.d</span></span><br><span class="line">[root@server1 pluginconf.d]<span class="comment"># vim subscription-manager.conf   #将1改成0</span></span><br><span class="line">[main]</span><br><span class="line">enabled=0</span><br></pre></td></tr></table></figure></li><li><p>第三步：将$releasever这个都替换成7就可用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[os]</span><br><span class="line">name=Qcloud centos os - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/os/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[updates]</span><br><span class="line">name=Qcloud centos updates - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/updates/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[centosplus]</span><br><span class="line">name=Qcloud centosplus - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[cr]</span><br><span class="line">name=Qcloud centos cr - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/cr/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=Qcloud centos extras - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/extras/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[fasttrack]</span><br><span class="line">name=Qcloud centos fasttrack - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/7/fasttrack/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure></li><li><p>下面是redhat6的</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[os]</span><br><span class="line">name=Qcloud centos os - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/os/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line">[updates]</span><br><span class="line">name=Qcloud centos updates - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/updates/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line">[centosplus]</span><br><span class="line">name=Qcloud centosplus - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line">[cr]</span><br><span class="line">name=Qcloud centos cr - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/cr/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=Qcloud centos extras - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/extras/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line">[fasttrack]</span><br><span class="line">name=Qcloud centos fasttrack - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://mirrors.cloud.tencent.com/centos/6/fasttrack/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-6</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Redhat无法使用yum的解决方法</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>使用dd命令管理swap</title>
    <link href="http://example.com/2024/06/25/dd%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BA/"/>
    <id>http://example.com/2024/06/25/dd%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BA/</id>
    <published>2024-06-25T01:25:00.000Z</published>
    <updated>2024-06-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用dd命令创建swap"><a href="#使用dd命令创建swap" class="headerlink" title="使用dd命令创建swap"></a>使用dd命令创建swap</h2><h3 id="默认开始没有交换分区"><a href="#默认开始没有交换分区" class="headerlink" title="默认开始没有交换分区"></a>默认开始没有交换分区</h3><ul><li>生成一个8GB大小的交换文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1G count=8</span><br></pre></td></tr></table></figure><ul><li>限制交换文件的访问权限，仅允许文件所有者读写</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br></pre></td></tr></table></figure><ul><li>将文件设置为交换空间</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkswap /swapfile</span><br></pre></td></tr></table></figure><ul><li>启用交换文件作为虚拟内存</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure><ul><li>加入开机启动配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> <span class="string">&quot;/swapfile swap swap defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><ul><li>检验一下是否成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapon -s</span><br></pre></td></tr></table></figure><h3 id="扩展交换分区"><a href="#扩展交换分区" class="headerlink" title="扩展交换分区"></a>扩展交换分区</h3><h4 id="涉及原有分区"><a href="#涉及原有分区" class="headerlink" title="涉及原有分区"></a>涉及原有分区</h4><p>使用 dd 命令创建的 swap 分区无法直接扩展。需要先关闭现有的 swap 分区，删除 swap 文件，再创建一个更大的 swap 文件，最后再启用它。</p><p><strong>小例子：如何将 8G 的 swap 分区扩展到 12G ?</strong></p><ul><li>停用现有 swap 分区：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff /swapfile</span><br></pre></td></tr></table></figure><ul><li>删除旧的 swap 文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> /swapfile</span><br></pre></td></tr></table></figure><ul><li>创建新的 12G swap 文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1G count=12</span><br></pre></td></tr></table></figure><ul><li>设置文件权限和属性：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line">sudo mkswap /swapfile</span><br></pre></td></tr></table></figure><ul><li>启用新的 swap 分区：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure><ul><li>更新 &#x2F;etc&#x2F;fstab 文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">&#x27;s/^\/swapfile.*/\/swapfile swap swap defaults 0 0/&#x27;</span> /etc/fstab</span><br></pre></td></tr></table></figure><ul><li>验证 swap 分区是否已启用：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapon -s</span><br></pre></td></tr></table></figure><h4 id="不涉及原有分区"><a href="#不涉及原有分区" class="headerlink" title="不涉及原有分区"></a>不涉及原有分区</h4><ul><li>查看所有交换分区</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon --show</span><br></pre></td></tr></table></figure><ul><li>直接创建一个新的交换文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/mnt/newswapfile bs=1M count=2048</span><br></pre></td></tr></table></figure><ul><li>开启交换分区</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkswap /mnt/newswapfile</span><br></pre></td></tr></table></figure><ul><li>激活</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapon /mnt/newswapfile</span><br></pre></td></tr></table></figure><ul><li>确认</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon --show</span><br></pre></td></tr></table></figure><ul><li>持久化</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/mnt/newswapfile none swap sw 0 0&#x27;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><ul><li>看下实际可用有多少</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure><h3 id="缩减swap分区-文件形式的"><a href="#缩减swap分区-文件形式的" class="headerlink" title="缩减swap分区(文件形式的)"></a>缩减swap分区(文件形式的)</h3><ul><li><p>首先，关闭正在使用的 Swap 分区：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -v /swapfile <span class="comment">#（将 `/swapfile` 替换为您实际的 Swap 分区路径）</span></span><br></pre></td></tr></table></figure></li><li><p>然后，删除或调整 Swap 文件的大小。如果是文件形式的 Swap，您可以使用 <code>truncate</code> 命令来调整大小</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">truncate</span> -s &lt;new_size&gt; /swapfile <span class="comment">#（`&lt;new_size&gt;` 为您期望的新大小）</span></span><br></pre></td></tr></table></figure></li><li><p>重新格式化并启用调整后的 Swap 分区：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkswap /swapfile</span><br><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">创建扩展或者缩减swap分区</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 密码忘记了怎么办？</title>
    <link href="http://example.com/2024/06/22/mysql-%E5%AF%86%E7%A0%81%E5%BF%98%E8%AE%B0%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/"/>
    <id>http://example.com/2024/06/22/mysql-%E5%AF%86%E7%A0%81%E5%BF%98%E8%AE%B0%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/</id>
    <published>2024-06-22T01:25:00.000Z</published>
    <updated>2024-06-22T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MySQL-密码忘记了怎么办？"><a href="#MySQL-密码忘记了怎么办？" class="headerlink" title="MySQL 密码忘记了怎么办？"></a>MySQL 密码忘记了怎么办？</h2><p>如果 MySQL 普通账户忘记了密码，很容易解决，可以通过登录 root 账户来重置普通账户密码。然而，如果 root 账户的密码也忘记或丢失了，该怎么办呢？</p><p>版本：MySQL5.7</p><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a><strong>方法1</strong></h3><p><strong>1.</strong> <strong>停止MySQL服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> `<span class="built_in">cat</span> /var/run/mysqld/mysqld.pid` </span><br><span class="line">或者</span><br><span class="line">pkill mysqld</span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>创建一个密码赋值语句的文本文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vi mysql-init</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;MyNewPass!6&#x27;</span>;</span><br></pre></td></tr></table></figure><p>实例启动在加载授权表之前会执行此语句来重置密码。</p><p><strong>3.</strong> <strong>使用–init-file选项启动MySQL服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --init-file=mysql-init --user=mysql &amp;</span><br></pre></td></tr></table></figure><p><strong>4.</strong> <strong>删除文本文件，使用新密码连接MySQL</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f mysql-init</span><br><span class="line">mysql -uroot -p <span class="string">&#x27;MyNewPass!6&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>5.</strong> <strong>停止MySQL服务并正常启动</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> `<span class="built_in">cat</span> /var/run/mysqld/mysqld.pid`</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a><strong>方法2</strong></h3><p><strong>1.</strong> <strong>停止MySQL服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> `<span class="built_in">cat</span> /var/run/mysqld/mysqld.pid`</span><br><span class="line">或者</span><br><span class="line">pkill mysql</span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>使用–skip-grant-tables和–skip-networking选项启动MySQL服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --skip-grant-tables --skip-networking --user=mysql</span><br></pre></td></tr></table></figure><ul><li><p>--skip-grant-tables：跳过授权表认证。</p></li><li><p>--skip-networking：加了跳过授权表选项后所有的人都可以无密码登录，这是很不安全的，此选项不监听网络，防止恶意登录。</p></li></ul><p><strong>3.</strong> <strong>无密码连接MySQL，并重置密码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt; ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;MyNewPass!6&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>4.</strong> <strong>停止MySQL服务并正常启动（不加上面两个skip选项）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> `<span class="built_in">cat</span> /var/run/mysqld/mysqld.pid`</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">仅适用于MySQL5.7，其余版本没测试</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Excel常用的技巧</title>
    <link href="http://example.com/2024/06/15/Excel%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <id>http://example.com/2024/06/15/Excel%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7/</id>
    <published>2024-06-15T01:25:00.000Z</published>
    <updated>2024-06-15T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="消除表格中的数字"><a href="#消除表格中的数字" class="headerlink" title="消除表格中的数字"></a>消除表格中的数字</h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(B1:B50, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;1&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;2&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;3&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;4&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;5&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;6&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;7&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;8&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">&quot;9&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="快速删除空白行"><a href="#快速删除空白行" class="headerlink" title="快速删除空白行"></a>快速删除空白行</h3><ul><li><p><strong>使用查找和定位功能</strong>： </p></li><li><p>按<code>Ctrl+G</code>打开“定位”对话框，点击“定位条件”，然后选择“空值”，这样所有的空白行就会被选中。接着，右键点击选中的空白行，选择“删除”，然后选择“整行”来删除这些行。</p></li></ul>]]></content>
    
    
    <summary type="html">一些常用的Excel表格操作技巧</summary>
    
    
    
    <category term="Excel" scheme="http://example.com/categories/Excel/"/>
    
    
    <category term="Excel" scheme="http://example.com/tags/Excel/"/>
    
  </entry>
  
  <entry>
    <title>批量命名器</title>
    <link href="http://example.com/2024/06/15/%E6%89%B9%E9%87%8F%E5%91%BD%E5%90%8D/"/>
    <id>http://example.com/2024/06/15/%E6%89%B9%E9%87%8F%E5%91%BD%E5%90%8D/</id>
    <published>2024-06-15T01:25:00.000Z</published>
    <updated>2024-06-15T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="批量命名器"><a href="#批量命名器" class="headerlink" title="批量命名器"></a>批量命名器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> filedialog, messagebox</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">batch_rename</span>(<span class="params">directory, prefix, start_num=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        files = os.listdir(directory)</span><br><span class="line">        files.sort()</span><br><span class="line">        <span class="keyword">for</span> i, filename <span class="keyword">in</span> <span class="built_in">enumerate</span>(files, start=start_num):</span><br><span class="line">            ext = os.path.splitext(filename)[<span class="number">1</span>]</span><br><span class="line">            new_name = <span class="string">f&quot;<span class="subst">&#123;prefix&#125;</span><span class="subst">&#123;i&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span></span><br><span class="line">            old_path = os.path.join(directory, filename)</span><br><span class="line">            new_path = os.path.join(directory, new_name)</span><br><span class="line">            os.rename(old_path, new_path)</span><br><span class="line">        messagebox.showinfo(<span class="string">&quot;Success&quot;</span>, <span class="string">&quot;Files have been renamed successfully.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;Error&quot;</span>, <span class="string">f&quot;An error occurred: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">browse_directory</span>():</span><br><span class="line">    directory = filedialog.askdirectory()</span><br><span class="line">    <span class="keyword">if</span> directory:</span><br><span class="line">        entry_directory.delete(<span class="number">0</span>, tk.END)</span><br><span class="line">        entry_directory.insert(<span class="number">0</span>, directory)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_renaming</span>():</span><br><span class="line">    directory = entry_directory.get()</span><br><span class="line">    prefix = entry_prefix.get()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> directory <span class="keyword">or</span> <span class="keyword">not</span> prefix:</span><br><span class="line">        messagebox.showwarning(<span class="string">&quot;Input Error&quot;</span>, <span class="string">&quot;Please provide both directory and prefix.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    batch_rename(directory, prefix)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主窗口</span></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">&quot;Batch File Renamer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目录输入框和浏览按钮</span></span><br><span class="line">tk.Label(root, text=<span class="string">&quot;Directory:&quot;</span>).grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">entry_directory = tk.Entry(root, width=<span class="number">40</span>)</span><br><span class="line">entry_directory.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">tk.Button(root, text=<span class="string">&quot;Browse&quot;</span>, command=browse_directory).grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前缀输入框</span></span><br><span class="line">tk.Label(root, text=<span class="string">&quot;Prefix:&quot;</span>).grid(row=<span class="number">1</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">entry_prefix = tk.Entry(root, width=<span class="number">40</span>)</span><br><span class="line">entry_prefix.grid(row=<span class="number">1</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始重命名按钮</span></span><br><span class="line">tk.Button(root, text=<span class="string">&quot;Start Renaming&quot;</span>, command=start_renaming).grid(row=<span class="number">2</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行主循环</span></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">简单批量修改文件名</summary>
    
    
    
    <category term="Python软件" scheme="http://example.com/categories/Python%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="Python软件" scheme="http://example.com/tags/Python%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>汉语转拼音</title>
    <link href="http://example.com/2024/06/12/%E6%B1%89%E8%AF%AD%E8%BD%AC%E6%8B%BC%E9%9F%B3/"/>
    <id>http://example.com/2024/06/12/%E6%B1%89%E8%AF%AD%E8%BD%AC%E6%8B%BC%E9%9F%B3/</id>
    <published>2024-06-12T01:25:00.000Z</published>
    <updated>2024-06-12T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="汉语转拼音"><a href="#汉语转拼音" class="headerlink" title="汉语转拼音"></a>汉语转拼音</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> scrolledtext, messagebox</span><br><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> pinyin, lazy_pinyin, Style</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_chinese_to_pinyin</span>(<span class="params">text: <span class="built_in">str</span>, mode: <span class="built_in">str</span> = <span class="string">&quot;basic&quot;</span>, heteronym: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将汉字转换为拼音的多功能转换器。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;basic&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> pinyin(text, style=Style.TONE)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&quot;heteronym&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> pinyin(text, style=Style.TONE, heteronym=heteronym)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&quot;first_letter&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> pinyin(text, style=Style.FIRST_LETTER)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&quot;bopomofo&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> pinyin(text, style=Style.BOPOMOFO)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&quot;lazy&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> lazy_pinyin(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;无效的转换模式&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>():</span><br><span class="line">    text = text_area.get(<span class="string">&quot;1.0&quot;</span>, tk.END).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;错误&quot;</span>, <span class="string">&quot;请输入汉字文本&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    mode_dict = &#123;</span><br><span class="line">        <span class="string">&quot;基本模式&quot;</span>: <span class="string">&quot;basic&quot;</span>,</span><br><span class="line">        <span class="string">&quot;多音字模式&quot;</span>: <span class="string">&quot;heteronym&quot;</span>,</span><br><span class="line">        <span class="string">&quot;首字母模式&quot;</span>: <span class="string">&quot;first_letter&quot;</span>,</span><br><span class="line">        <span class="string">&quot;注音模式&quot;</span>: <span class="string">&quot;bopomofo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;懒汉模式&quot;</span>: <span class="string">&quot;lazy&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mode = mode_dict.get(mode_var.get())</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> mode:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;错误&quot;</span>, <span class="string">&quot;请选择一个有效模式&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    heteronym = heteronym_var.get()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = convert_chinese_to_pinyin(text, mode=mode, heteronym=heteronym)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理不同模式的结果格式</span></span><br><span class="line">        <span class="keyword">if</span> mode <span class="keyword">in</span> [<span class="string">&quot;basic&quot;</span>, <span class="string">&quot;heteronym&quot;</span>, <span class="string">&quot;bopomofo&quot;</span>]:</span><br><span class="line">            concatenated_result = <span class="string">&quot; &quot;</span>.join([item[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">list</span>) <span class="keyword">else</span> item <span class="keyword">for</span> item <span class="keyword">in</span> result])</span><br><span class="line">        <span class="keyword">elif</span> mode == <span class="string">&quot;first_letter&quot;</span>:</span><br><span class="line">            concatenated_result = <span class="string">&quot; &quot;</span>.join([item[<span class="number">0</span>] <span class="keyword">for</span> item <span class="keyword">in</span> result])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            concatenated_result = <span class="string">&quot; &quot;</span>.join(result)</span><br><span class="line"></span><br><span class="line">        result_area.config(state=tk.NORMAL)</span><br><span class="line">        result_area.delete(<span class="string">&quot;1.0&quot;</span>, tk.END)</span><br><span class="line">        result_area.insert(tk.INSERT, concatenated_result)</span><br><span class="line">        result_area.config(state=tk.DISABLED)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;错误&quot;</span>, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主窗口</span></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">&quot;汉字转拼音转换器&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取屏幕尺寸</span></span><br><span class="line">screen_width = root.winfo_screenwidth()</span><br><span class="line">screen_height = root.winfo_screenheight()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定窗体尺寸为屏幕的一半</span></span><br><span class="line">window_width = <span class="built_in">int</span>(screen_width / <span class="number">2</span>)</span><br><span class="line">window_height = <span class="built_in">int</span>(screen_height / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算窗体居中显示的位置</span></span><br><span class="line">position_top = <span class="built_in">int</span>(screen_height / <span class="number">4</span>)</span><br><span class="line">position_right = <span class="built_in">int</span>(screen_width / <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗体大小及位置</span></span><br><span class="line">root.geometry(<span class="string">f&quot;<span class="subst">&#123;window_width&#125;</span>x<span class="subst">&#123;window_height&#125;</span>+<span class="subst">&#123;position_right&#125;</span>+<span class="subst">&#123;position_top&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许用户自由改变窗口大小和最大化</span></span><br><span class="line">root.resizable(<span class="literal">True</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建输入文本区域</span></span><br><span class="line">text_area = scrolledtext.ScrolledText(root, wrap=tk.WORD, width=<span class="number">60</span>, height=<span class="number">10</span>)</span><br><span class="line">text_area.grid(column=<span class="number">0</span>, row=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>, columnspan=<span class="number">3</span>, sticky=<span class="string">&quot;nsew&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建模式选择标签和下拉列表</span></span><br><span class="line">mode_var = tk.StringVar(value=<span class="string">&quot;基本模式&quot;</span>)</span><br><span class="line">modes = [<span class="string">&quot;基本模式&quot;</span>, <span class="string">&quot;多音字模式&quot;</span>, <span class="string">&quot;首字母模式&quot;</span>, <span class="string">&quot;注音模式&quot;</span>, <span class="string">&quot;懒汉模式&quot;</span>]</span><br><span class="line">mode_label = tk.Label(root, text=<span class="string">&quot;选择模式:&quot;</span>)</span><br><span class="line">mode_label.grid(column=<span class="number">0</span>, row=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>, sticky=tk.E)</span><br><span class="line">mode_menu = tk.OptionMenu(root, mode_var, *modes)</span><br><span class="line">mode_menu.grid(column=<span class="number">1</span>, row=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>, sticky=tk.W)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建多音字模式勾选框</span></span><br><span class="line">heteronym_var = tk.BooleanVar()</span><br><span class="line">heteronym_check = tk.Checkbutton(root, text=<span class="string">&quot;启用多音字模式&quot;</span>, variable=heteronym_var)</span><br><span class="line">heteronym_check.grid(column=<span class="number">2</span>, row=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建转换按钮</span></span><br><span class="line">convert_button = tk.Button(root, text=<span class="string">&quot;转换&quot;</span>, command=convert)</span><br><span class="line">convert_button.grid(column=<span class="number">0</span>, row=<span class="number">2</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>, columnspan=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建结果显示区域</span></span><br><span class="line">result_area = scrolledtext.ScrolledText(root, wrap=tk.WORD, width=<span class="number">60</span>, height=<span class="number">10</span>, state=tk.DISABLED)</span><br><span class="line">result_area.grid(column=<span class="number">0</span>, row=<span class="number">3</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>, columnspan=<span class="number">3</span>, sticky=<span class="string">&quot;nsew&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使得所有行列都能够动态调整大小</span></span><br><span class="line">root.grid_rowconfigure(<span class="number">0</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_rowconfigure(<span class="number">3</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_columnconfigure(<span class="number">0</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_columnconfigure(<span class="number">1</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_columnconfigure(<span class="number">2</span>, weight=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行主程序</span></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以将汉字转换成拼音，有五种模式</summary>
    
    
    
    <category term="Python软件" scheme="http://example.com/categories/Python%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="Python软件" scheme="http://example.com/tags/Python%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>DockerInstallation</title>
    <link href="http://example.com/2024/06/08/DockerInstallation/"/>
    <id>http://example.com/2024/06/08/DockerInstallation/</id>
    <published>2024-06-08T01:25:00.000Z</published>
    <updated>2024-06-08T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DockerInstallation"><a href="#DockerInstallation" class="headerlink" title="DockerInstallation"></a>DockerInstallation</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## Author: SuperManito</span></span><br><span class="line"><span class="comment">## Modified: 2024-06-07</span></span><br><span class="line"><span class="comment">## License: MIT</span></span><br><span class="line"><span class="comment">## GitHub: https://github.com/SuperManito/LinuxMirrors</span></span><br><span class="line"><span class="comment">## Website: https://linuxmirrors.cn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Docker CE 软件源列表</span></span><br><span class="line"><span class="comment"># 格式：&quot;软件源名称@软件源地址&quot;</span></span><br><span class="line">mirror_list_docker_ce=(</span><br><span class="line">    <span class="string">&quot;阿里云@mirrors.aliyun.com/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;腾讯云@mirrors.tencent.com/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;华为云@repo.huaweicloud.com/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;微软 Azure 中国@mirror.azure.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;网易@mirrors.163.com/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;火山引擎@mirrors.volces.com/docker&quot;</span></span><br><span class="line">    <span class="string">&quot;清华大学@mirrors.tuna.tsinghua.edu.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;北京大学@mirrors.pku.edu.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;南京大学@mirrors.nju.edu.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;上海交通大学@mirror.sjtu.edu.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;中国科学技术大学@mirrors.ustc.edu.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;中国科学院软件研究所@mirror.iscas.ac.cn/docker-ce&quot;</span></span><br><span class="line">    <span class="string">&quot;官方@download.docker.com&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Docker Registry 仓库列表</span></span><br><span class="line"><span class="comment"># 格式：&quot;软件源名称@软件源地址&quot;</span></span><br><span class="line">mirror_list_registry=(</span><br><span class="line">    <span class="string">&quot;道客 DaoCloud@docker.m.daocloud.io&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（杭州）@registry.cn-hangzhou.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（上海）@registry.cn-shanghai.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（青岛）@registry.cn-qingdao.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（北京）@registry.cn-beijing.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（张家口）@registry.cn-zhangjiakou.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（呼和浩特）@registry.cn-huhehaote.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（乌兰察布）@registry.cn-wulanchabu.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（深圳）@registry.cn-shenzhen.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（河源）@registry.cn-heyuan.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（广州）@registry.cn-guangzhou.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（成都）@registry.cn-chengdu.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（香港）@registry.cn-hongkong.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（日本-东京）@registry.ap-northeast-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（新加坡）@registry.ap-southeast-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（澳大利亚-悉尼）@registry.ap-southeast-2.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（马来西亚-吉隆坡）@registry.ap-southeast-3.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（印度尼西亚-雅加达）@registry.ap-southeast-5.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（印度-孟买）@registry.ap-south-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（德国-法兰克福）@registry.eu-central-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（英国-伦敦）@registry.eu-west-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（美国西部-硅谷）@registry.us-west-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（美国东部-弗吉尼亚）@registry.us-east-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;阿里云（阿联酋-迪拜）@registry.me-east-1.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;腾讯云@mirror.ccs.tencentyun.com&quot;</span></span><br><span class="line">    <span class="string">&quot;谷歌云@mirror.gcr.io&quot;</span></span><br><span class="line">    <span class="string">&quot;官方@registry.hub.docker.com&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义系统判定变量</span></span><br><span class="line">SYSTEM_DEBIAN=<span class="string">&quot;Debian&quot;</span></span><br><span class="line">SYSTEM_UBUNTU=<span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">SYSTEM_KALI=<span class="string">&quot;Kali&quot;</span></span><br><span class="line">SYSTEM_REDHAT=<span class="string">&quot;RedHat&quot;</span></span><br><span class="line">SYSTEM_RHEL=<span class="string">&quot;RedHat&quot;</span></span><br><span class="line">SYSTEM_CENTOS=<span class="string">&quot;CentOS&quot;</span></span><br><span class="line">SYSTEM_CENTOS_STREAM=<span class="string">&quot;CentOS Stream&quot;</span></span><br><span class="line">SYSTEM_ROCKY=<span class="string">&quot;Rocky&quot;</span></span><br><span class="line">SYSTEM_ALMALINUX=<span class="string">&quot;AlmaLinux&quot;</span></span><br><span class="line">SYSTEM_FEDORA=<span class="string">&quot;Fedora&quot;</span></span><br><span class="line">SYSTEM_OPENCLOUDOS=<span class="string">&quot;OpenCloudOS&quot;</span></span><br><span class="line">SYSTEM_OPENEULER=<span class="string">&quot;openEuler&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义目录和文件</span></span><br><span class="line">File_LinuxRelease=/etc/os-release</span><br><span class="line">File_RedHatRelease=/etc/redhat-release</span><br><span class="line">File_OpenCloudOSRelease=/etc/opencloudos-release</span><br><span class="line">File_openEulerRelease=/etc/openEuler-release</span><br><span class="line">File_DebianVersion=/etc/debian_version</span><br><span class="line">File_DebianSourceList=/etc/apt/sources.list</span><br><span class="line">Dir_DebianExtendSource=/etc/apt/sources.list.d</span><br><span class="line">Dir_YumRepos=/etc/yum.repos.d</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义 Docker 相关变量</span></span><br><span class="line">DockerDir=/etc/docker</span><br><span class="line">DockerConfig=<span class="variable">$DockerDir</span>/daemon.json</span><br><span class="line">DockerConfigBackup=<span class="variable">$DockerDir</span>/daemon.json.bak</span><br><span class="line">DockerVersionFile=docker-version.txt</span><br><span class="line">DockerCEVersionFile=docker-ce-version.txt</span><br><span class="line">DockerCECLIVersionFile=docker-ce-cli-version.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义颜色变量</span></span><br><span class="line">RED=<span class="string">&#x27;\033[31m&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;\033[32m&#x27;</span></span><br><span class="line">YELLOW=<span class="string">&#x27;\033[33m&#x27;</span></span><br><span class="line">BLUE=<span class="string">&#x27;\033[34m&#x27;</span></span><br><span class="line">PLAIN=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">BOLD=<span class="string">&#x27;\033[1m&#x27;</span></span><br><span class="line">SUCCESS=<span class="string">&#x27;[\033[32mOK\033[0m]&#x27;</span></span><br><span class="line">COMPLETE=<span class="string">&#x27;[\033[32mDONE\033[0m]&#x27;</span></span><br><span class="line">WARN=<span class="string">&#x27;[\033[33mWARN\033[0m]&#x27;</span></span><br><span class="line">ERROR=<span class="string">&#x27;[\033[31mERROR\033[0m]&#x27;</span></span><br><span class="line">WORKING=<span class="string">&#x27;[\033[34m*\033[0m]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">StartTitle</span></span>() &#123;</span><br><span class="line">    [[ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span> || -z <span class="string">&quot;<span class="variable">$&#123;SOURCE_REGISTRY&#125;</span>&quot;</span> ]] &amp;&amp; clear</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; +-----------------------------------+&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot; | \033[0;1;35;95m⡇\033[0m  \033[0;1;33;93m⠄\033[0m \033[0;1;32;92m⣀⡀\033[0m \033[0;1;36;96m⡀\033[0;1;34;94m⢀\033[0m \033[0;1;35;95m⡀⢀\033[0m \033[0;1;31;91m⡷\033[0;1;33;93m⢾\033[0m \033[0;1;32;92m⠄\033[0m \033[0;1;36;96m⡀⣀\033[0m \033[0;1;34;94m⡀\033[0;1;35;95m⣀\033[0m \033[0;1;31;91m⢀⡀\033[0m \033[0;1;33;93m⡀\033[0;1;32;92m⣀\033[0m \033[0;1;36;96m⢀⣀\033[0m |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot; | \033[0;1;31;91m⠧\033[0;1;33;93m⠤\033[0m \033[0;1;32;92m⠇\033[0m \033[0;1;36;96m⠇⠸\033[0m \033[0;1;34;94m⠣\033[0;1;35;95m⠼\033[0m \033[0;1;31;91m⠜⠣\033[0m \033[0;1;33;93m⠇\033[0;1;32;92m⠸\033[0m \033[0;1;36;96m⠇\033[0m \033[0;1;34;94m⠏\033[0m  \033[0;1;35;95m⠏\033[0m  \033[0;1;33;93m⠣⠜\033[0m \033[0;1;32;92m⠏\033[0m  \033[0;1;34;94m⠭⠕\033[0m |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; +-----------------------------------+&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27;  欢迎使用 Docker Engine 一键安装脚本&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 报错退出</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Output_Error</span></span>() &#123;</span><br><span class="line">    [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> <span class="variable">$1</span>\n&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 基础环境判断</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PermissionJudgment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$UID</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> 权限不足，请使用 Root 用户运行本脚本\n&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 系统判定变量</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">EnvJudgment</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 定义系统名称</span></span><br><span class="line">    SYSTEM_NAME=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^NAME=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> <span class="variable">$File_LinuxRelease</span> | grep <span class="string">&quot;PRETTY_NAME=&quot;</span> -q</span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; SYSTEM_PRETTY_NAME=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^PRETTY_NAME=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 定义系统版本号</span></span><br><span class="line">    SYSTEM_VERSION_NUMBER=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^VERSION_ID=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 定义系统ID</span></span><br><span class="line">    SYSTEM_ID=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^ID=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 判定当前系统派系</span></span><br><span class="line">    <span class="keyword">if</span> [ -s <span class="variable">$File_DebianVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_openEulerRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_RedHatRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_OpenCloudOSRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> <span class="comment"># 注：RedHat 判断优先级需要高于 OpenCloudOS，因为8版本基于红帽而9版本不是</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Output_Error <span class="string">&quot;无法判断当前运行环境，当前系统不在本脚本的支持范围内&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 判定系统名称、版本、版本号</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [ ! -x /usr/bin/lsb_release ]; <span class="keyword">then</span></span><br><span class="line">            apt-get install -y lsb-release</span><br><span class="line">            <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                Output_Error <span class="string">&quot;lsb-release 软件包安装失败\n        本脚本需要通过 lsb_release 指令判断系统具体类型和版本，当前系统可能为精简安装，请自行安装后重新执行脚本！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="subst">$(lsb_release -is)</span>&quot;</span></span><br><span class="line">        SYSTEM_VERSION_CODENAME=<span class="string">&quot;<span class="variable">$&#123;DEBIAN_CODENAME:-&quot;$(lsb_release -cs)&quot;&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span>)</span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="subst">$(cat $File_RedHatRelease | awk -F &#x27; &#x27; &#x27;&#123;printf$1&#125;&#x27;)</span>&quot;</span></span><br><span class="line">        <span class="comment">## Red Hat Enterprise Linux</span></span><br><span class="line">        <span class="built_in">cat</span> <span class="variable">$File_RedHatRelease</span> | grep -q <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment">## CentOS Stream</span></span><br><span class="line">        <span class="built_in">cat</span> <span class="variable">$File_RedHatRelease</span> | grep -q <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 判定系统处理器架构</span></span><br><span class="line">    <span class="keyword">case</span> $(<span class="built_in">uname</span> -m) <span class="keyword">in</span></span><br><span class="line">    x86_64)</span><br><span class="line">        SYSTEM_ARCH=<span class="string">&quot;x86_64&quot;</span></span><br><span class="line">        SOURCE_ARCH=<span class="string">&quot;amd64&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    aarch64)</span><br><span class="line">        SYSTEM_ARCH=<span class="string">&quot;ARM64&quot;</span></span><br><span class="line">        SOURCE_ARCH=<span class="string">&quot;arm64&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    armv7l)</span><br><span class="line">        SYSTEM_ARCH=<span class="string">&quot;ARMv7&quot;</span></span><br><span class="line">        SOURCE_ARCH=<span class="string">&quot;armhf&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    armv6l)</span><br><span class="line">        SYSTEM_ARCH=<span class="string">&quot;ARMv6&quot;</span></span><br><span class="line">        SOURCE_ARCH=<span class="string">&quot;armhf&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    i386 | i686)</span><br><span class="line">        Output_Error <span class="string">&quot;Docker Engine 不支持安装在 x86_32 架构的环境上！&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        SYSTEM_ARCH=$(<span class="built_in">uname</span> -m)</span><br><span class="line">        SOURCE_ARCH=armhf</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 定义软件源分支名称</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span>)</span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT,,&#125;</span>&quot;</span> | sed <span class="string">&quot;s/ /-/g&quot;</span>)</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;centos&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;rhel&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_KALI&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># Kali 使用 Debian 12 的 docker ce 源</span></span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;debian&quot;</span></span><br><span class="line">        SYSTEM_VERSION_CODENAME=<span class="string">&quot;bullseye&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不在本脚本的支持范围内&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 定义软件源更新文字</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;更新软件源&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;生成软件源缓存&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ChooseMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 打印软件源列表</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">PrintMirrorsList</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> tmp_mirror_name tmp_mirror_url arr_num default_mirror_name_length tmp_mirror_name_length tmp_spaces_nums a i j</span><br><span class="line">        <span class="comment">## 计算字符串长度</span></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">StringLength</span></span>() &#123;</span><br><span class="line">            <span class="built_in">local</span> text=<span class="variable">$1</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;#text&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">local</span> list_arr=()</span><br><span class="line">        <span class="built_in">local</span> list_arr_sum=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;#$1[@]&#125;)</span>&quot;</span></span><br><span class="line">        <span class="keyword">for</span> ((a = <span class="number">0</span>; a &lt; <span class="variable">$list_arr_sum</span>; a++)); <span class="keyword">do</span></span><br><span class="line">            list_arr[<span class="variable">$a</span>]=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$1[a]&#125;)</span>&quot;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [ -x /usr/bin/printf ]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">for</span> ((i = <span class="number">0</span>; i &lt; <span class="variable">$&#123;#list_arr[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                tmp_mirror_name=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$1&#125;&#x27;</span>) <span class="comment"># 软件源名称</span></span><br><span class="line">                <span class="comment"># tmp_mirror_url=$(echo &quot;$&#123;list_arr[i]&#125;&quot; | awk -F &#x27;@&#x27; &#x27;&#123;print$2&#125;&#x27;) # 软件源地址</span></span><br><span class="line">                arr_num=$((i + <span class="number">1</span>))</span><br><span class="line">                default_mirror_name_length=<span class="variable">$&#123;2:-&quot;30&quot;&#125;</span> <span class="comment"># 默认软件源名称打印长度</span></span><br><span class="line">                <span class="comment">## 补齐长度差异（中文的引号在等宽字体中占1格而非2格）</span></span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;“&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;“&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;”&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;”&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;‘&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;‘&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;’&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;’&quot;</span>)</span><br><span class="line">                <span class="comment"># 非一般字符长度</span></span><br><span class="line">                tmp_mirror_name_length=$(StringLength $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | sed <span class="string">&quot;s| ||g&quot;</span> | sed <span class="string">&quot;s|[0-9a-zA-Z\.\=\:\_\(\)\&#x27;\&quot;-\/\!·]||g;&quot;</span>))</span><br><span class="line">                <span class="comment">## 填充空格</span></span><br><span class="line">                tmp_spaces_nums=$(($((<span class="variable">$default_mirror_name_length</span> - <span class="variable">$&#123;tmp_mirror_name_length&#125;</span> - $(StringLength &quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;))) / 2))</span><br><span class="line">                <span class="keyword">for</span> ((j = <span class="number">1</span>; j &lt;= <span class="variable">$&#123;tmp_spaces_nums&#125;</span>; j++)); <span class="keyword">do</span></span><br><span class="line">                    tmp_mirror_name=<span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span> &quot;</span></span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot; ❖  %-<span class="subst">$(($default_mirror_name_length + $&#123;tmp_mirror_name_length&#125;)</span>)s %4s\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$arr_num</span>)&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">for</span> ((i = <span class="number">0</span>; i &lt; <span class="variable">$&#123;#list_arr[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                tmp_mirror_name=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$1&#125;&#x27;</span>) <span class="comment"># 软件源名称</span></span><br><span class="line">                tmp_mirror_url=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$2&#125;&#x27;</span>)  <span class="comment"># 软件源地址</span></span><br><span class="line">                arr_num=$((i + <span class="number">1</span>))</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot; ❖  <span class="variable">$arr_num</span>. <span class="variable">$&#123;tmp_mirror_url&#125;</span> | <span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Title</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> system_name=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_PRETTY_NAME:-&quot;<span class="variable">$&#123;SYSTEM_NAME&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER&#125;</span>&quot;&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">local</span> <span class="built_in">arch</span>=<span class="string">&quot;&quot;</span><span class="variable">$&#123;DEVICE_ARCH&#125;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">local</span> <span class="built_in">date</span>=<span class="string">&quot;<span class="subst">$(date <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span>&quot;</span></span><br><span class="line">        <span class="built_in">local</span> timezone=<span class="string">&quot;<span class="subst">$(timedatectl status 2&gt;/dev/null | grep <span class="string">&quot;Time zone&quot;</span> | awk -F &#x27;:&#x27; &#x27;&#123;print$2&#125;&#x27; | awk -F &#x27; &#x27; &#x27;&#123;print$1&#125;&#x27;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot; 运行环境 <span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;system_name&#125;</span> <span class="variable">$&#123;arch&#125;</span><span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot; 系统时间 <span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;date&#125;</span> <span class="variable">$&#123;timezone&#125;</span><span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Title</span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;INSTALL_LATESTED_DOCKER&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment">## 是否手动选择安装版本</span></span><br><span class="line">        <span class="built_in">local</span> CHOICE_A=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否安装最新版本的 Docker Engine? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE_A&#125;</span>&quot;</span> INPUT</span><br><span class="line">        [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">        [Yy] | [Yy][Ee][Ss])</span><br><span class="line">            INSTALL_LATESTED_DOCKER=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        [Nn] | [Nn][Oo])</span><br><span class="line">            <span class="comment">## 安装旧版本只有官方仓库有</span></span><br><span class="line">            INSTALL_LATESTED_DOCKER=<span class="string">&quot;false&quot;</span></span><br><span class="line">            SOURCE=<span class="string">&quot;download.docker.com&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            INSTALL_LATESTED_DOCKER=<span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认安装最新版本！&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">local</span> mirror_list_name</span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">local</span> mirror_list_name=<span class="string">&quot;mirror_list_docker_ce&quot;</span></span><br><span class="line">        PrintMirrorsList <span class="string">&quot;<span class="variable">$&#123;mirror_list_name&#125;</span>&quot;</span> 38</span><br><span class="line">        <span class="built_in">local</span> CHOICE_B=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 请选择并输入你想使用的 Docker CE 源 [ 1-<span class="subst">$(eval echo \$&#123;#$mirror_list_name[@]&#125;)</span> ]：<span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE_B&#125;</span>&quot;</span> INPUT</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [1-9] | [1-9][0-9] | [1-9][0-9][0-9])</span><br><span class="line">                <span class="built_in">local</span> tmp_source=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$(($INPUT - 1)</span>)]&#125;)&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;tmp_source&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入有效的数字序号！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$(($INPUT - 1)</span>)]&#125; | awk -F &#x27;@&#x27; &#x27;&#123;print<span class="variable">$2</span>&#125;&#x27;)&quot;</span></span><br><span class="line">                    <span class="comment"># echo &quot;$&#123;SOURCE&#125;&quot;</span></span><br><span class="line">                    <span class="comment"># exit</span></span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入数字序号以选择你想使用的软件源！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE_REGISTRY&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        mirror_list_name=<span class="string">&quot;mirror_list_registry&quot;</span></span><br><span class="line">        PrintMirrorsList <span class="string">&quot;<span class="variable">$&#123;mirror_list_name&#125;</span>&quot;</span> 44</span><br><span class="line">        <span class="built_in">local</span> CHOICE_C=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 请选择并输入你想使用的 Docker Registry 源 [ 1-<span class="subst">$(eval echo \$&#123;#$mirror_list_name[@]&#125;)</span> ]：<span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE_C&#125;</span>&quot;</span> INPUT</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [1-9] | [1-9][0-9] | [1-9][0-9][0-9])</span><br><span class="line">                <span class="built_in">local</span> tmp_source=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$(($INPUT - 1)</span>)]&#125;)&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;tmp_source&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入有效的数字序号！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE_REGISTRY=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$(($INPUT - 1)</span>)]&#125; | awk -F &#x27;@&#x27; &#x27;&#123;print<span class="variable">$2</span>&#125;&#x27;)&quot;</span></span><br><span class="line">                    <span class="comment"># echo &quot;$&#123;SOURCE_REGISTRY&#125;&quot;</span></span><br><span class="line">                    <span class="comment"># exit</span></span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入数字序号以选择你想使用的软件源！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭防火墙和SELinux</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CloseFirewall</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -x /usr/bin/systemctl ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="subst">$(systemctl is-active firewalld)</span>&quot;</span> == <span class="string">&quot;active&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;CLOSE_FIREWALL&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE</span><br><span class="line">            CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否关闭防火墙和 SELinux ? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss])</span><br><span class="line">                CLOSE_FIREWALL=<span class="string">&quot;true&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            [Nn] | [Nn][Oo]) ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不关闭！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;CLOSE_FIREWALL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> SelinuxConfig=/etc/selinux/config</span><br><span class="line">            systemctl <span class="built_in">disable</span> --now firewalld &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            [ -s <span class="variable">$SelinuxConfig</span> ] &amp;&amp; sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> <span class="variable">$SelinuxConfig</span> &amp;&amp; setenforce 0 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装环境包</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">EnvironmentInstall</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 删除原有源</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        sed -i <span class="string">&#x27;/docker-ce/d&#x27;</span> <span class="variable">$File_DebianSourceList</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$Dir_DebianExtendSource</span>/docker.list</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/*docker*.repo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WORKING</span> 开始<span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>...\n&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        apt-get update</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        yum makecache</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    VERIFICATION_SOURCESYNC=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;VERIFICATION_SOURCESYNC&#125;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;<span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>出错，请先确保软件包管理工具可用！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> <span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>结束\n&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 注：红帽 8 版本才发布了 dnf 包管理工具，为了兼容性而优先选择安装 dnf-utils</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">        7)</span><br><span class="line">            yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            yum install -y dnf-utils device-mapper-persistent-data lvm2</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 卸载旧版本的 Docker Engine</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RemoveOldVersion</span></span>() &#123;</span><br><span class="line">    systemctl <span class="built_in">disable</span> --now docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    <span class="built_in">sleep</span> 2s</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        apt-get remove -y docker* containerd.io runc</span><br><span class="line">        apt-get autoremove -y &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        yum remove -y docker* containerd.io podman* runc</span><br><span class="line">        yum autoremove -y &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置 Docker CE 源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ConfigureDockerCEMirror</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment">## 安装密钥</span></span><br><span class="line">        apt-key del 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 &gt;/dev/null 2&gt;&amp;1 <span class="comment"># 删除旧的密钥</span></span><br><span class="line">        [ -f /etc/apt/keyrings/docker.gpg ] &amp;&amp; <span class="built_in">rm</span> -rf /etc/apt/keyrings/docker.gpg</span><br><span class="line">        install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">        curl -fsSL https://<span class="variable">$&#123;SOURCE&#125;</span>/linux/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line">        <span class="comment">## 添加源</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;deb [arch=<span class="variable">$&#123;SOURCE_ARCH&#125;</span> signed-by=/etc/apt/keyrings/docker.gpg] https://<span class="variable">$&#123;SOURCE&#125;</span>/linux/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> stable&quot;</span> | <span class="built_in">tee</span> <span class="variable">$Dir_DebianExtendSource</span>/docker.list &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        apt-get update</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        yum-config-manager -y --add-repo https://<span class="variable">$&#123;SOURCE&#125;</span>/linux/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/docker-ce.repo</span><br><span class="line">        sed -i <span class="string">&quot;s|download.docker.com|<span class="variable">$&#123;SOURCE&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/docker-ce.repo</span><br><span class="line">        <span class="comment">## 兼容处理版本号</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            7 | 8 | 9)</span><br><span class="line">                sed -i <span class="string">&quot;s|\$releasever|<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/docker-ce.repo</span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                sed -i <span class="string">&quot;s|\$releasever|8|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/docker-ce.repo</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            yum makecache</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装 Docker Engine</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">DockerEngine</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 导出可安装的版本列表</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Export_VersionList</span></span>() &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">            apt-cache madison docker-ce | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | grep -Eo <span class="string">&quot;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&quot;</span> &gt;<span class="variable">$DockerCEVersionFile</span></span><br><span class="line">            apt-cache madison docker-ce-cli | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | grep -Eo <span class="string">&quot;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&quot;</span> &gt;<span class="variable">$DockerCECLIVersionFile</span></span><br><span class="line">            grep -wf <span class="variable">$DockerCEVersionFile</span> <span class="variable">$DockerCECLIVersionFile</span> &gt;<span class="variable">$DockerVersionFile</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">            yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | grep -Eo <span class="string">&quot;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&quot;</span> &gt;<span class="variable">$DockerCEVersionFile</span></span><br><span class="line">            yum list docker-ce-cli --showduplicates | <span class="built_in">sort</span> -r | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | grep -Eo <span class="string">&quot;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&quot;</span> &gt;<span class="variable">$DockerCECLIVersionFile</span></span><br><span class="line">            grep -wf <span class="variable">$DockerCEVersionFile</span> <span class="variable">$DockerCECLIVersionFile</span> &gt;<span class="variable">$DockerVersionFile</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$DockerCEVersionFile</span> <span class="variable">$DockerCECLIVersionFile</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 安装</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Install</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_LATESTED_DOCKER&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">                apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">                yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Export_VersionList</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;GREEN&#125;</span> --------- 请选择你要安装的版本，如：20.10.24 ---------- <span class="variable">$&#123;PLAIN&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="built_in">cat</span> <span class="variable">$DockerVersionFile</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&#x27;\n注：以上可供选择的安装版本由官方源提供，此列表以外的版本则无法安装在当前操作系统上&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">local</span> CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 请根据上面的列表，选择并输入你想要安装的具体版本号：<span class="variable">$&#123;PLAIN&#125;</span>\n&quot;</span>)</span><br><span class="line">                <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> DOCKER_VERSION</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="built_in">cat</span> <span class="variable">$DockerVersionFile</span> | grep -Eqw <span class="string">&quot;<span class="variable">$&#123;DOCKER_VERSION&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DOCKER_VERSION&#125;</span>&quot;</span> | grep -Eqw <span class="string">&#x27;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&#x27;</span></span><br><span class="line">                    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">rm</span> -rf <span class="variable">$DockerVersionFile</span></span><br><span class="line">                        <span class="built_in">break</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$ERROR</span> 请输入正确的版本号！&quot;</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$ERROR</span> 输入错误请重新输入！&quot;</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">                CheckVersion=<span class="string">&quot;<span class="subst">$(echo $&#123;DOCKER_VERSION&#125; | cut -c1-2)</span>&quot;</span></span><br><span class="line">                CheckSubversion=<span class="string">&quot;<span class="subst">$(echo $&#123;DOCKER_VERSION&#125; | cut -c4-5)</span>&quot;</span></span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$&#123;CheckVersion&#125;</span> <span class="keyword">in</span></span><br><span class="line">                18)</span><br><span class="line">                    <span class="keyword">if</span> [ <span class="variable">$&#123;CheckSubversion&#125;</span> == <span class="string">&quot;09&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                        INSTALL_JUDGMENT=<span class="string">&quot;5:&quot;</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        INSTALL_JUDGMENT=<span class="string">&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    INSTALL_JUDGMENT=<span class="string">&quot;5:&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                apt-get install -y docker-ce=<span class="variable">$&#123;INSTALL_JUDGMENT&#125;</span><span class="variable">$&#123;DOCKER_VERSION&#125;</span>* docker-ce-cli=5:<span class="variable">$&#123;DOCKER_VERSION&#125;</span>* containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">                yum install -y docker-ce-<span class="variable">$&#123;DOCKER_VERSION&#125;</span> docker-ce-cli-<span class="variable">$&#123;DOCKER_VERSION&#125;</span> containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 修改 Docker Registry 源</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">RegistryMirror</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;REGISTRY_SOURCEL&#125;</span>&quot;</span> != <span class="string">&quot;registry.hub.docker.com&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [ -d <span class="variable">$DockerDir</span> ] &amp;&amp; [ -e <span class="variable">$DockerConfig</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">if</span> [ -e <span class="variable">$DockerConfigBackup</span> ]; <span class="keyword">then</span></span><br><span class="line">                    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;IGNORE_BACKUP_TIPS&#125;</span>&quot;</span> == <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">local</span> CHOICE_BACKUP=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到已备份的 Docker 配置文件，是否跳过覆盖备份? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE_BACKUP&#125;</span>&quot;</span> INPUT</span><br><span class="line">                        [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">                        <span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">                        [Yy] | [Yy][Ee][Ss]) ;;</span><br><span class="line">                        [Nn] | [Nn][Oo])</span><br><span class="line">                            <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                            <span class="built_in">cp</span> -rvf <span class="variable">$DockerConfig</span> <span class="variable">$DockerConfigBackup</span> 2&gt;&amp;1</span><br><span class="line">                            ;;</span><br><span class="line">                        *)</span><br><span class="line">                            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不覆盖！&quot;</span></span><br><span class="line">                            ;;</span><br><span class="line">                        <span class="keyword">esac</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">cp</span> -rvf <span class="variable">$DockerConfig</span> <span class="variable">$DockerConfigBackup</span> 2&gt;&amp;1</span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 已备份原有 Docker 配置文件至 <span class="variable">$DockerConfigBackup</span>\n&quot;</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">sleep</span> 2s</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">mkdir</span> -p <span class="variable">$DockerDir</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">                <span class="built_in">touch</span> <span class="variable">$DockerConfig</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&#x27;&#123;\n  &quot;registry-mirrors&quot;: [&quot;https://SOURCE&quot;]\n&#125;&#x27;</span> &gt;<span class="variable">$DockerConfig</span></span><br><span class="line">            sed -i <span class="string">&quot;s|SOURCE|<span class="variable">$&#123;SOURCE_REGISTRY&#125;</span>|g&quot;</span> <span class="variable">$DockerConfig</span></span><br><span class="line">            systemctl daemon-reload</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 判定是否已安装</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        dpkg -l | grep docker-ce-cli -q</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        rpm -qa | grep docker-ce-cli -q</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        Export_VersionList</span><br><span class="line">        DOCKER_INSTALLED_VERSION=$(docker -v | grep -Eo <span class="string">&quot;[0-9][0-9].[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;&quot;</span>)</span><br><span class="line">        DOCKER_VERSION_LATEST=$(<span class="built_in">cat</span> <span class="variable">$DockerVersionFile</span> | <span class="built_in">head</span> -n 1)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;DOCKER_INSTALLED_VERSION&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;DOCKER_VERSION_LATEST&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_LATESTED_DOCKER&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 检测到已安装最新版本的 Docker Engine，跳过安装&quot;</span></span><br><span class="line">                RegistryMirror</span><br><span class="line">                <span class="keyword">if</span> [[ $(systemctl is-active docker) == <span class="string">&quot;active&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    systemctl restart docker</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                systemctl <span class="built_in">enable</span> --now docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">                CheckVersion</span><br><span class="line">                RunEnd</span><br><span class="line">                <span class="built_in">exit</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">local</span> CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到已安装最新版本的 Docker Engine，是否继续安装其它版本? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_LATESTED_DOCKER&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">local</span> CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到已安装旧版本的 Docker Engine，是否覆盖安装为最新版本? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">local</span> CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到已安装旧版本的 Docker Engine，是否继续安装其它版本? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">        [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">        [Yy] | [Yy][Ee][Ss])</span><br><span class="line">            <span class="built_in">echo</span> -en <span class="string">&quot;\n<span class="variable">$WORKING</span> 正在卸载之前的版本...\n&quot;</span></span><br><span class="line">            RemoveOldVersion</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 卸载完毕\n&quot;</span></span><br><span class="line">            Install</span><br><span class="line">            ;;</span><br><span class="line">        [Nn] | [Nn][Oo]) ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不覆盖安装！\n&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$DockerVersionFile</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        RemoveOldVersion</span><br><span class="line">        Install</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    RegistryMirror</span><br><span class="line">    systemctl stop docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    systemctl <span class="built_in">enable</span> --now docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看版本并验证安装结果</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CheckVersion</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ -x /usr/bin/docker ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -en <span class="string">&quot;\n验证安装版本：&quot;</span></span><br><span class="line">        docker -v</span><br><span class="line">        VERIFICATION_DOCKER=$?</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;VERIFICATION_DOCKER&#125;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 安装完成&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> 安装失败&quot;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n检查源文件：cat <span class="variable">$Dir_DebianExtendSource</span>/docker.list&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&#x27;请尝试手动执行安装命令： apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n&#x27;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n检查源文件：cat <span class="variable">$Dir_YumRepos</span>/docker.repo&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&#x27;请尝试手动执行安装命令： yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n&#x27;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ $(systemctl is-active docker) != <span class="string">&quot;active&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">sleep</span> 2</span><br><span class="line">            systemctl <span class="built_in">disable</span> --now docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            <span class="built_in">sleep</span> 2</span><br><span class="line">            systemctl <span class="built_in">enable</span> --now docker &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            <span class="built_in">sleep</span> 2</span><br><span class="line">            <span class="keyword">if</span> [[ $(systemctl is-active docker) != <span class="string">&quot;active&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> 检测到 Docker 服务启动异常，可能由于重复安装导致&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;YELLOW&#125;</span> 请执行 &quot;</span>systemctl start docker<span class="string">&quot; 或 &quot;</span>service docker start<span class="string">&quot; 命令尝试启动，如若报错请尝试重新执行本脚本<span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> 安装失败\n&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 运行结束</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RunEnd</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n     ------ 脚本执行结束 ------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;35;95m┌─\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m──\033[0;1;36;96m──\033[0;1;34;94m──\033[0;1;35;95m──\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m──\033[0;1;36;96m──\033[0;1;34;94m──\033[0;1;35;95m──\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m──\033[0;1;36;96m┐\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;31;91m│▞\033[0;1;33;93m▀▖\033[0m            \033[0;1;32;92m▙▗\033[0;1;36;96m▌\033[0m      \033[0;1;31;91m▗\033[0;1;33;93m▐\033[0m     \033[0;1;34;94m│\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;33;93m│▚\033[0;1;32;92m▄\033[0m \033[0;1;36;96m▌\033[0m \033[0;1;34;94m▌▛\033[0;1;35;95m▀▖\033[0;1;31;91m▞▀\033[0;1;33;93m▖▙\033[0;1;32;92m▀▖\033[0;1;36;96m▌▘\033[0;1;34;94m▌▝\033[0;1;35;95m▀▖\033[0;1;31;91m▛▀\033[0;1;33;93m▖▄\033[0;1;32;92m▜▀\033[0m \033[0;1;36;96m▞\033[0;1;34;94m▀▖\033[0;1;35;95m│\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;32;92m│▖\033[0m \033[0;1;36;96m▌\033[0;1;34;94m▌\033[0m \033[0;1;35;95m▌▙\033[0;1;31;91m▄▘\033[0;1;33;93m▛▀\033[0m \033[0;1;32;92m▌\033[0m  \033[0;1;34;94m▌\033[0m \033[0;1;35;95m▌▞\033[0;1;31;91m▀▌\033[0;1;33;93m▌\033[0m \033[0;1;32;92m▌▐\033[0;1;36;96m▐\033[0m \033[0;1;34;94m▖▌\033[0m \033[0;1;35;95m▌\033[0;1;31;91m│\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;36;96m│▝\033[0;1;34;94m▀\033[0m \033[0;1;35;95m▝▀\033[0;1;31;91m▘▌\033[0m  \033[0;1;32;92m▝▀\033[0;1;36;96m▘▘\033[0m  \033[0;1;35;95m▘\033[0m \033[0;1;31;91m▘▝\033[0;1;33;93m▀▘\033[0;1;32;92m▘\033[0m \033[0;1;36;96m▘▀\033[0;1;34;94m▘▀\033[0m \033[0;1;35;95m▝\033[0;1;31;91m▀\033[0m \033[0;1;33;93m│\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \033[0;1;34;94m└─\033[0;1;35;95m──\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m──\033[0;1;36;96m──\033[0;1;34;94m──\033[0;1;35;95m──\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m──\033[0;1;36;96m──\033[0;1;34;94m──\033[0;1;35;95m──\033[0;1;31;91m──\033[0;1;33;93m──\033[0;1;32;92m┘\033[0m&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;     \033[1;34mPowered by linuxmirrors.cn\033[0m\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 处理命令选项</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CommandOptions</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 命令帮助</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Output_Help_Info</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;</span></span><br><span class="line"><span class="string">命令选项(参数名/含义/参数值)：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  --source                 指定 Docker CE 源地址                     地址</span></span><br><span class="line"><span class="string">  --source-registry        指定 Docker Registry 源地址               地址</span></span><br><span class="line"><span class="string">  --codename               指定 Debian 系操作系统的版本代号          代号名称</span></span><br><span class="line"><span class="string">  --install-latested       控制是否安装最新版本的 Docker Engine      true 或 false</span></span><br><span class="line"><span class="string">  --ignore-backup-tips     忽略覆盖备份提示                          无</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">问题报告 https://github.com/SuperManito/LinuxMirrors/issues</span></span><br><span class="line"><span class="string">  &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 判断参数</span></span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$#</span> -gt 0 ]; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="comment">## 指定 Docker CE 软件源地址</span></span><br><span class="line">        --<span class="built_in">source</span>)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | grep -Eq <span class="string">&quot;\(|\)|\[|\]|\&#123;|\&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    Output_Error <span class="string">&quot;检测到无效参数值 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> ，请输入有效的地址！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | sed -e &#x27;s,^http[s]\?://,,g&#x27; -e &#x27;s,/$,,&#x27;)</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 指定 Docker Registry 仓库地址</span></span><br><span class="line">        --source-registry)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | grep -Eq <span class="string">&quot;\(|\)|\[|\]|\&#123;|\&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    Output_Error <span class="string">&quot;检测到无效参数值 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> ，请输入有效的地址！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE_REGISTRY=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | sed -e &#x27;s,^http[s]\?://,,g&#x27; -e &#x27;s,/$,,&#x27;)</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 指定 Debian 版本代号</span></span><br><span class="line">        --codename)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                DEBIAN_CODENAME=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定版本代号！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 安装最新版本</span></span><br><span class="line">        --install-latested)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    INSTALL_LATESTED_DOCKER=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 忽略覆盖备份提示</span></span><br><span class="line">        --ignore-backup-tips)</span><br><span class="line">            IGNORE_BACKUP_TIPS=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 命令帮助</span></span><br><span class="line">        --<span class="built_in">help</span>)</span><br><span class="line">            Output_Help_Info</span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请确认后重新输入！&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="comment">## 给部分命令选项赋予默认值</span></span><br><span class="line">    IGNORE_BACKUP_TIPS=<span class="string">&quot;<span class="variable">$&#123;IGNORE_BACKUP_TIPS:-&quot;false&quot;&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 组合函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Combin_Function</span></span>() &#123;</span><br><span class="line">    PermissionJudgment</span><br><span class="line">    EnvJudgment</span><br><span class="line">    StartTitle</span><br><span class="line">    ChooseMirrors</span><br><span class="line">    CloseFirewall</span><br><span class="line">    EnvironmentInstall</span><br><span class="line">    ConfigureDockerCEMirror</span><br><span class="line">    DockerEngine</span><br><span class="line">    CheckVersion</span><br><span class="line">    RunEnd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CommandOptions <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">Combin_Function</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">DockerInstallation for all Linux</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>ChangeMirrors</title>
    <link href="http://example.com/2024/06/07/%E6%9B%B4%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6%E6%BA%90%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/06/07/%E6%9B%B4%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6%E6%BA%90%E8%84%9A%E6%9C%AC/</id>
    <published>2024-06-07T01:25:00.000Z</published>
    <updated>2024-06-07T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="更改软件源脚本"><a href="#更改软件源脚本" class="headerlink" title="更改软件源脚本"></a>更改软件源脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br><span class="line">2636</span><br><span class="line">2637</span><br><span class="line">2638</span><br><span class="line">2639</span><br><span class="line">2640</span><br><span class="line">2641</span><br><span class="line">2642</span><br><span class="line">2643</span><br><span class="line">2644</span><br><span class="line">2645</span><br><span class="line">2646</span><br><span class="line">2647</span><br><span class="line">2648</span><br><span class="line">2649</span><br><span class="line">2650</span><br><span class="line">2651</span><br><span class="line">2652</span><br><span class="line">2653</span><br><span class="line">2654</span><br><span class="line">2655</span><br><span class="line">2656</span><br><span class="line">2657</span><br><span class="line">2658</span><br><span class="line">2659</span><br><span class="line">2660</span><br><span class="line">2661</span><br><span class="line">2662</span><br><span class="line">2663</span><br><span class="line">2664</span><br><span class="line">2665</span><br><span class="line">2666</span><br><span class="line">2667</span><br><span class="line">2668</span><br><span class="line">2669</span><br><span class="line">2670</span><br><span class="line">2671</span><br><span class="line">2672</span><br><span class="line">2673</span><br><span class="line">2674</span><br><span class="line">2675</span><br><span class="line">2676</span><br><span class="line">2677</span><br><span class="line">2678</span><br><span class="line">2679</span><br><span class="line">2680</span><br><span class="line">2681</span><br><span class="line">2682</span><br><span class="line">2683</span><br><span class="line">2684</span><br><span class="line">2685</span><br><span class="line">2686</span><br><span class="line">2687</span><br><span class="line">2688</span><br><span class="line">2689</span><br><span class="line">2690</span><br><span class="line">2691</span><br><span class="line">2692</span><br><span class="line">2693</span><br><span class="line">2694</span><br><span class="line">2695</span><br><span class="line">2696</span><br><span class="line">2697</span><br><span class="line">2698</span><br><span class="line">2699</span><br><span class="line">2700</span><br><span class="line">2701</span><br><span class="line">2702</span><br><span class="line">2703</span><br><span class="line">2704</span><br><span class="line">2705</span><br><span class="line">2706</span><br><span class="line">2707</span><br><span class="line">2708</span><br><span class="line">2709</span><br><span class="line">2710</span><br><span class="line">2711</span><br><span class="line">2712</span><br><span class="line">2713</span><br><span class="line">2714</span><br><span class="line">2715</span><br><span class="line">2716</span><br><span class="line">2717</span><br><span class="line">2718</span><br><span class="line">2719</span><br><span class="line">2720</span><br><span class="line">2721</span><br><span class="line">2722</span><br><span class="line">2723</span><br><span class="line">2724</span><br><span class="line">2725</span><br><span class="line">2726</span><br><span class="line">2727</span><br><span class="line">2728</span><br><span class="line">2729</span><br><span class="line">2730</span><br><span class="line">2731</span><br><span class="line">2732</span><br><span class="line">2733</span><br><span class="line">2734</span><br><span class="line">2735</span><br><span class="line">2736</span><br><span class="line">2737</span><br><span class="line">2738</span><br><span class="line">2739</span><br><span class="line">2740</span><br><span class="line">2741</span><br><span class="line">2742</span><br><span class="line">2743</span><br><span class="line">2744</span><br><span class="line">2745</span><br><span class="line">2746</span><br><span class="line">2747</span><br><span class="line">2748</span><br><span class="line">2749</span><br><span class="line">2750</span><br><span class="line">2751</span><br><span class="line">2752</span><br><span class="line">2753</span><br><span class="line">2754</span><br><span class="line">2755</span><br><span class="line">2756</span><br><span class="line">2757</span><br><span class="line">2758</span><br><span class="line">2759</span><br><span class="line">2760</span><br><span class="line">2761</span><br><span class="line">2762</span><br><span class="line">2763</span><br><span class="line">2764</span><br><span class="line">2765</span><br><span class="line">2766</span><br><span class="line">2767</span><br><span class="line">2768</span><br><span class="line">2769</span><br><span class="line">2770</span><br><span class="line">2771</span><br><span class="line">2772</span><br><span class="line">2773</span><br><span class="line">2774</span><br><span class="line">2775</span><br><span class="line">2776</span><br><span class="line">2777</span><br><span class="line">2778</span><br><span class="line">2779</span><br><span class="line">2780</span><br><span class="line">2781</span><br><span class="line">2782</span><br><span class="line">2783</span><br><span class="line">2784</span><br><span class="line">2785</span><br><span class="line">2786</span><br><span class="line">2787</span><br><span class="line">2788</span><br><span class="line">2789</span><br><span class="line">2790</span><br><span class="line">2791</span><br><span class="line">2792</span><br><span class="line">2793</span><br><span class="line">2794</span><br><span class="line">2795</span><br><span class="line">2796</span><br><span class="line">2797</span><br><span class="line">2798</span><br><span class="line">2799</span><br><span class="line">2800</span><br><span class="line">2801</span><br><span class="line">2802</span><br><span class="line">2803</span><br><span class="line">2804</span><br><span class="line">2805</span><br><span class="line">2806</span><br><span class="line">2807</span><br><span class="line">2808</span><br><span class="line">2809</span><br><span class="line">2810</span><br><span class="line">2811</span><br><span class="line">2812</span><br><span class="line">2813</span><br><span class="line">2814</span><br><span class="line">2815</span><br><span class="line">2816</span><br><span class="line">2817</span><br><span class="line">2818</span><br><span class="line">2819</span><br><span class="line">2820</span><br><span class="line">2821</span><br><span class="line">2822</span><br><span class="line">2823</span><br><span class="line">2824</span><br><span class="line">2825</span><br><span class="line">2826</span><br><span class="line">2827</span><br><span class="line">2828</span><br><span class="line">2829</span><br><span class="line">2830</span><br><span class="line">2831</span><br><span class="line">2832</span><br><span class="line">2833</span><br><span class="line">2834</span><br><span class="line">2835</span><br><span class="line">2836</span><br><span class="line">2837</span><br><span class="line">2838</span><br><span class="line">2839</span><br><span class="line">2840</span><br><span class="line">2841</span><br><span class="line">2842</span><br><span class="line">2843</span><br><span class="line">2844</span><br><span class="line">2845</span><br><span class="line">2846</span><br><span class="line">2847</span><br><span class="line">2848</span><br><span class="line">2849</span><br><span class="line">2850</span><br><span class="line">2851</span><br><span class="line">2852</span><br><span class="line">2853</span><br><span class="line">2854</span><br><span class="line">2855</span><br><span class="line">2856</span><br><span class="line">2857</span><br><span class="line">2858</span><br><span class="line">2859</span><br><span class="line">2860</span><br><span class="line">2861</span><br><span class="line">2862</span><br><span class="line">2863</span><br><span class="line">2864</span><br><span class="line">2865</span><br><span class="line">2866</span><br><span class="line">2867</span><br><span class="line">2868</span><br><span class="line">2869</span><br><span class="line">2870</span><br><span class="line">2871</span><br><span class="line">2872</span><br><span class="line">2873</span><br><span class="line">2874</span><br><span class="line">2875</span><br><span class="line">2876</span><br><span class="line">2877</span><br><span class="line">2878</span><br><span class="line">2879</span><br><span class="line">2880</span><br><span class="line">2881</span><br><span class="line">2882</span><br><span class="line">2883</span><br><span class="line">2884</span><br><span class="line">2885</span><br><span class="line">2886</span><br><span class="line">2887</span><br><span class="line">2888</span><br><span class="line">2889</span><br><span class="line">2890</span><br><span class="line">2891</span><br><span class="line">2892</span><br><span class="line">2893</span><br><span class="line">2894</span><br><span class="line">2895</span><br><span class="line">2896</span><br><span class="line">2897</span><br><span class="line">2898</span><br><span class="line">2899</span><br><span class="line">2900</span><br><span class="line">2901</span><br><span class="line">2902</span><br><span class="line">2903</span><br><span class="line">2904</span><br><span class="line">2905</span><br><span class="line">2906</span><br><span class="line">2907</span><br><span class="line">2908</span><br><span class="line">2909</span><br><span class="line">2910</span><br><span class="line">2911</span><br><span class="line">2912</span><br><span class="line">2913</span><br><span class="line">2914</span><br><span class="line">2915</span><br><span class="line">2916</span><br><span class="line">2917</span><br><span class="line">2918</span><br><span class="line">2919</span><br><span class="line">2920</span><br><span class="line">2921</span><br><span class="line">2922</span><br><span class="line">2923</span><br><span class="line">2924</span><br><span class="line">2925</span><br><span class="line">2926</span><br><span class="line">2927</span><br><span class="line">2928</span><br><span class="line">2929</span><br><span class="line">2930</span><br><span class="line">2931</span><br><span class="line">2932</span><br><span class="line">2933</span><br><span class="line">2934</span><br><span class="line">2935</span><br><span class="line">2936</span><br><span class="line">2937</span><br><span class="line">2938</span><br><span class="line">2939</span><br><span class="line">2940</span><br><span class="line">2941</span><br><span class="line">2942</span><br><span class="line">2943</span><br><span class="line">2944</span><br><span class="line">2945</span><br><span class="line">2946</span><br><span class="line">2947</span><br><span class="line">2948</span><br><span class="line">2949</span><br><span class="line">2950</span><br><span class="line">2951</span><br><span class="line">2952</span><br><span class="line">2953</span><br><span class="line">2954</span><br><span class="line">2955</span><br><span class="line">2956</span><br><span class="line">2957</span><br><span class="line">2958</span><br><span class="line">2959</span><br><span class="line">2960</span><br><span class="line">2961</span><br><span class="line">2962</span><br><span class="line">2963</span><br><span class="line">2964</span><br><span class="line">2965</span><br><span class="line">2966</span><br><span class="line">2967</span><br><span class="line">2968</span><br><span class="line">2969</span><br><span class="line">2970</span><br><span class="line">2971</span><br><span class="line">2972</span><br><span class="line">2973</span><br><span class="line">2974</span><br><span class="line">2975</span><br><span class="line">2976</span><br><span class="line">2977</span><br><span class="line">2978</span><br><span class="line">2979</span><br><span class="line">2980</span><br><span class="line">2981</span><br><span class="line">2982</span><br><span class="line">2983</span><br><span class="line">2984</span><br><span class="line">2985</span><br><span class="line">2986</span><br><span class="line">2987</span><br><span class="line">2988</span><br><span class="line">2989</span><br><span class="line">2990</span><br><span class="line">2991</span><br><span class="line">2992</span><br><span class="line">2993</span><br><span class="line">2994</span><br><span class="line">2995</span><br><span class="line">2996</span><br><span class="line">2997</span><br><span class="line">2998</span><br><span class="line">2999</span><br><span class="line">3000</span><br><span class="line">3001</span><br><span class="line">3002</span><br><span class="line">3003</span><br><span class="line">3004</span><br><span class="line">3005</span><br><span class="line">3006</span><br><span class="line">3007</span><br><span class="line">3008</span><br><span class="line">3009</span><br><span class="line">3010</span><br><span class="line">3011</span><br><span class="line">3012</span><br><span class="line">3013</span><br><span class="line">3014</span><br><span class="line">3015</span><br><span class="line">3016</span><br><span class="line">3017</span><br><span class="line">3018</span><br><span class="line">3019</span><br><span class="line">3020</span><br><span class="line">3021</span><br><span class="line">3022</span><br><span class="line">3023</span><br><span class="line">3024</span><br><span class="line">3025</span><br><span class="line">3026</span><br><span class="line">3027</span><br><span class="line">3028</span><br><span class="line">3029</span><br><span class="line">3030</span><br><span class="line">3031</span><br><span class="line">3032</span><br><span class="line">3033</span><br><span class="line">3034</span><br><span class="line">3035</span><br><span class="line">3036</span><br><span class="line">3037</span><br><span class="line">3038</span><br><span class="line">3039</span><br><span class="line">3040</span><br><span class="line">3041</span><br><span class="line">3042</span><br><span class="line">3043</span><br><span class="line">3044</span><br><span class="line">3045</span><br><span class="line">3046</span><br><span class="line">3047</span><br><span class="line">3048</span><br><span class="line">3049</span><br><span class="line">3050</span><br><span class="line">3051</span><br><span class="line">3052</span><br><span class="line">3053</span><br><span class="line">3054</span><br><span class="line">3055</span><br><span class="line">3056</span><br><span class="line">3057</span><br><span class="line">3058</span><br><span class="line">3059</span><br><span class="line">3060</span><br><span class="line">3061</span><br><span class="line">3062</span><br><span class="line">3063</span><br><span class="line">3064</span><br><span class="line">3065</span><br><span class="line">3066</span><br><span class="line">3067</span><br><span class="line">3068</span><br><span class="line">3069</span><br><span class="line">3070</span><br><span class="line">3071</span><br><span class="line">3072</span><br><span class="line">3073</span><br><span class="line">3074</span><br><span class="line">3075</span><br><span class="line">3076</span><br><span class="line">3077</span><br><span class="line">3078</span><br><span class="line">3079</span><br><span class="line">3080</span><br><span class="line">3081</span><br><span class="line">3082</span><br><span class="line">3083</span><br><span class="line">3084</span><br><span class="line">3085</span><br><span class="line">3086</span><br><span class="line">3087</span><br><span class="line">3088</span><br><span class="line">3089</span><br><span class="line">3090</span><br><span class="line">3091</span><br><span class="line">3092</span><br><span class="line">3093</span><br><span class="line">3094</span><br><span class="line">3095</span><br><span class="line">3096</span><br><span class="line">3097</span><br><span class="line">3098</span><br><span class="line">3099</span><br><span class="line">3100</span><br><span class="line">3101</span><br><span class="line">3102</span><br><span class="line">3103</span><br><span class="line">3104</span><br><span class="line">3105</span><br><span class="line">3106</span><br><span class="line">3107</span><br><span class="line">3108</span><br><span class="line">3109</span><br><span class="line">3110</span><br><span class="line">3111</span><br><span class="line">3112</span><br><span class="line">3113</span><br><span class="line">3114</span><br><span class="line">3115</span><br><span class="line">3116</span><br><span class="line">3117</span><br><span class="line">3118</span><br><span class="line">3119</span><br><span class="line">3120</span><br><span class="line">3121</span><br><span class="line">3122</span><br><span class="line">3123</span><br><span class="line">3124</span><br><span class="line">3125</span><br><span class="line">3126</span><br><span class="line">3127</span><br><span class="line">3128</span><br><span class="line">3129</span><br><span class="line">3130</span><br><span class="line">3131</span><br><span class="line">3132</span><br><span class="line">3133</span><br><span class="line">3134</span><br><span class="line">3135</span><br><span class="line">3136</span><br><span class="line">3137</span><br><span class="line">3138</span><br><span class="line">3139</span><br><span class="line">3140</span><br><span class="line">3141</span><br><span class="line">3142</span><br><span class="line">3143</span><br><span class="line">3144</span><br><span class="line">3145</span><br><span class="line">3146</span><br><span class="line">3147</span><br><span class="line">3148</span><br><span class="line">3149</span><br><span class="line">3150</span><br><span class="line">3151</span><br><span class="line">3152</span><br><span class="line">3153</span><br><span class="line">3154</span><br><span class="line">3155</span><br><span class="line">3156</span><br><span class="line">3157</span><br><span class="line">3158</span><br><span class="line">3159</span><br><span class="line">3160</span><br><span class="line">3161</span><br><span class="line">3162</span><br><span class="line">3163</span><br><span class="line">3164</span><br><span class="line">3165</span><br><span class="line">3166</span><br><span class="line">3167</span><br><span class="line">3168</span><br><span class="line">3169</span><br><span class="line">3170</span><br><span class="line">3171</span><br><span class="line">3172</span><br><span class="line">3173</span><br><span class="line">3174</span><br><span class="line">3175</span><br><span class="line">3176</span><br><span class="line">3177</span><br><span class="line">3178</span><br><span class="line">3179</span><br><span class="line">3180</span><br><span class="line">3181</span><br><span class="line">3182</span><br><span class="line">3183</span><br><span class="line">3184</span><br><span class="line">3185</span><br><span class="line">3186</span><br><span class="line">3187</span><br><span class="line">3188</span><br><span class="line">3189</span><br><span class="line">3190</span><br><span class="line">3191</span><br><span class="line">3192</span><br><span class="line">3193</span><br><span class="line">3194</span><br><span class="line">3195</span><br><span class="line">3196</span><br><span class="line">3197</span><br><span class="line">3198</span><br><span class="line">3199</span><br><span class="line">3200</span><br><span class="line">3201</span><br><span class="line">3202</span><br><span class="line">3203</span><br><span class="line">3204</span><br><span class="line">3205</span><br><span class="line">3206</span><br><span class="line">3207</span><br><span class="line">3208</span><br><span class="line">3209</span><br><span class="line">3210</span><br><span class="line">3211</span><br><span class="line">3212</span><br><span class="line">3213</span><br><span class="line">3214</span><br><span class="line">3215</span><br><span class="line">3216</span><br><span class="line">3217</span><br><span class="line">3218</span><br><span class="line">3219</span><br><span class="line">3220</span><br><span class="line">3221</span><br><span class="line">3222</span><br><span class="line">3223</span><br><span class="line">3224</span><br><span class="line">3225</span><br><span class="line">3226</span><br><span class="line">3227</span><br><span class="line">3228</span><br><span class="line">3229</span><br><span class="line">3230</span><br><span class="line">3231</span><br><span class="line">3232</span><br><span class="line">3233</span><br><span class="line">3234</span><br><span class="line">3235</span><br><span class="line">3236</span><br><span class="line">3237</span><br><span class="line">3238</span><br><span class="line">3239</span><br><span class="line">3240</span><br><span class="line">3241</span><br><span class="line">3242</span><br><span class="line">3243</span><br><span class="line">3244</span><br><span class="line">3245</span><br><span class="line">3246</span><br><span class="line">3247</span><br><span class="line">3248</span><br><span class="line">3249</span><br><span class="line">3250</span><br><span class="line">3251</span><br><span class="line">3252</span><br><span class="line">3253</span><br><span class="line">3254</span><br><span class="line">3255</span><br><span class="line">3256</span><br><span class="line">3257</span><br><span class="line">3258</span><br><span class="line">3259</span><br><span class="line">3260</span><br><span class="line">3261</span><br><span class="line">3262</span><br><span class="line">3263</span><br><span class="line">3264</span><br><span class="line">3265</span><br><span class="line">3266</span><br><span class="line">3267</span><br><span class="line">3268</span><br><span class="line">3269</span><br><span class="line">3270</span><br><span class="line">3271</span><br><span class="line">3272</span><br><span class="line">3273</span><br><span class="line">3274</span><br><span class="line">3275</span><br><span class="line">3276</span><br><span class="line">3277</span><br><span class="line">3278</span><br><span class="line">3279</span><br><span class="line">3280</span><br><span class="line">3281</span><br><span class="line">3282</span><br><span class="line">3283</span><br><span class="line">3284</span><br><span class="line">3285</span><br><span class="line">3286</span><br><span class="line">3287</span><br><span class="line">3288</span><br><span class="line">3289</span><br><span class="line">3290</span><br><span class="line">3291</span><br><span class="line">3292</span><br><span class="line">3293</span><br><span class="line">3294</span><br><span class="line">3295</span><br><span class="line">3296</span><br><span class="line">3297</span><br><span class="line">3298</span><br><span class="line">3299</span><br><span class="line">3300</span><br><span class="line">3301</span><br><span class="line">3302</span><br><span class="line">3303</span><br><span class="line">3304</span><br><span class="line">3305</span><br><span class="line">3306</span><br><span class="line">3307</span><br><span class="line">3308</span><br><span class="line">3309</span><br><span class="line">3310</span><br><span class="line">3311</span><br><span class="line">3312</span><br><span class="line">3313</span><br><span class="line">3314</span><br><span class="line">3315</span><br><span class="line">3316</span><br><span class="line">3317</span><br><span class="line">3318</span><br><span class="line">3319</span><br><span class="line">3320</span><br><span class="line">3321</span><br><span class="line">3322</span><br><span class="line">3323</span><br><span class="line">3324</span><br><span class="line">3325</span><br><span class="line">3326</span><br><span class="line">3327</span><br><span class="line">3328</span><br><span class="line">3329</span><br><span class="line">3330</span><br><span class="line">3331</span><br><span class="line">3332</span><br><span class="line">3333</span><br><span class="line">3334</span><br><span class="line">3335</span><br><span class="line">3336</span><br><span class="line">3337</span><br><span class="line">3338</span><br><span class="line">3339</span><br><span class="line">3340</span><br><span class="line">3341</span><br><span class="line">3342</span><br><span class="line">3343</span><br><span class="line">3344</span><br><span class="line">3345</span><br><span class="line">3346</span><br><span class="line">3347</span><br><span class="line">3348</span><br><span class="line">3349</span><br><span class="line">3350</span><br><span class="line">3351</span><br><span class="line">3352</span><br><span class="line">3353</span><br><span class="line">3354</span><br><span class="line">3355</span><br><span class="line">3356</span><br><span class="line">3357</span><br><span class="line">3358</span><br><span class="line">3359</span><br><span class="line">3360</span><br><span class="line">3361</span><br><span class="line">3362</span><br><span class="line">3363</span><br><span class="line">3364</span><br><span class="line">3365</span><br><span class="line">3366</span><br><span class="line">3367</span><br><span class="line">3368</span><br><span class="line">3369</span><br><span class="line">3370</span><br><span class="line">3371</span><br><span class="line">3372</span><br><span class="line">3373</span><br><span class="line">3374</span><br><span class="line">3375</span><br><span class="line">3376</span><br><span class="line">3377</span><br><span class="line">3378</span><br><span class="line">3379</span><br><span class="line">3380</span><br><span class="line">3381</span><br><span class="line">3382</span><br><span class="line">3383</span><br><span class="line">3384</span><br><span class="line">3385</span><br><span class="line">3386</span><br><span class="line">3387</span><br><span class="line">3388</span><br><span class="line">3389</span><br><span class="line">3390</span><br><span class="line">3391</span><br><span class="line">3392</span><br><span class="line">3393</span><br><span class="line">3394</span><br><span class="line">3395</span><br><span class="line">3396</span><br><span class="line">3397</span><br><span class="line">3398</span><br><span class="line">3399</span><br><span class="line">3400</span><br><span class="line">3401</span><br><span class="line">3402</span><br><span class="line">3403</span><br><span class="line">3404</span><br><span class="line">3405</span><br><span class="line">3406</span><br><span class="line">3407</span><br><span class="line">3408</span><br><span class="line">3409</span><br><span class="line">3410</span><br><span class="line">3411</span><br><span class="line">3412</span><br><span class="line">3413</span><br><span class="line">3414</span><br><span class="line">3415</span><br><span class="line">3416</span><br><span class="line">3417</span><br><span class="line">3418</span><br><span class="line">3419</span><br><span class="line">3420</span><br><span class="line">3421</span><br><span class="line">3422</span><br><span class="line">3423</span><br><span class="line">3424</span><br><span class="line">3425</span><br><span class="line">3426</span><br><span class="line">3427</span><br><span class="line">3428</span><br><span class="line">3429</span><br><span class="line">3430</span><br><span class="line">3431</span><br><span class="line">3432</span><br><span class="line">3433</span><br><span class="line">3434</span><br><span class="line">3435</span><br><span class="line">3436</span><br><span class="line">3437</span><br><span class="line">3438</span><br><span class="line">3439</span><br><span class="line">3440</span><br><span class="line">3441</span><br><span class="line">3442</span><br><span class="line">3443</span><br><span class="line">3444</span><br><span class="line">3445</span><br><span class="line">3446</span><br><span class="line">3447</span><br><span class="line">3448</span><br><span class="line">3449</span><br><span class="line">3450</span><br><span class="line">3451</span><br><span class="line">3452</span><br><span class="line">3453</span><br><span class="line">3454</span><br><span class="line">3455</span><br><span class="line">3456</span><br><span class="line">3457</span><br><span class="line">3458</span><br><span class="line">3459</span><br><span class="line">3460</span><br><span class="line">3461</span><br><span class="line">3462</span><br><span class="line">3463</span><br><span class="line">3464</span><br><span class="line">3465</span><br><span class="line">3466</span><br><span class="line">3467</span><br><span class="line">3468</span><br><span class="line">3469</span><br><span class="line">3470</span><br><span class="line">3471</span><br><span class="line">3472</span><br><span class="line">3473</span><br><span class="line">3474</span><br><span class="line">3475</span><br><span class="line">3476</span><br><span class="line">3477</span><br><span class="line">3478</span><br><span class="line">3479</span><br><span class="line">3480</span><br><span class="line">3481</span><br><span class="line">3482</span><br><span class="line">3483</span><br><span class="line">3484</span><br><span class="line">3485</span><br><span class="line">3486</span><br><span class="line">3487</span><br><span class="line">3488</span><br><span class="line">3489</span><br><span class="line">3490</span><br><span class="line">3491</span><br><span class="line">3492</span><br><span class="line">3493</span><br><span class="line">3494</span><br><span class="line">3495</span><br><span class="line">3496</span><br><span class="line">3497</span><br><span class="line">3498</span><br><span class="line">3499</span><br><span class="line">3500</span><br><span class="line">3501</span><br><span class="line">3502</span><br><span class="line">3503</span><br><span class="line">3504</span><br><span class="line">3505</span><br><span class="line">3506</span><br><span class="line">3507</span><br><span class="line">3508</span><br><span class="line">3509</span><br><span class="line">3510</span><br><span class="line">3511</span><br><span class="line">3512</span><br><span class="line">3513</span><br><span class="line">3514</span><br><span class="line">3515</span><br><span class="line">3516</span><br><span class="line">3517</span><br><span class="line">3518</span><br><span class="line">3519</span><br><span class="line">3520</span><br><span class="line">3521</span><br><span class="line">3522</span><br><span class="line">3523</span><br><span class="line">3524</span><br><span class="line">3525</span><br><span class="line">3526</span><br><span class="line">3527</span><br><span class="line">3528</span><br><span class="line">3529</span><br><span class="line">3530</span><br><span class="line">3531</span><br><span class="line">3532</span><br><span class="line">3533</span><br><span class="line">3534</span><br><span class="line">3535</span><br><span class="line">3536</span><br><span class="line">3537</span><br><span class="line">3538</span><br><span class="line">3539</span><br><span class="line">3540</span><br><span class="line">3541</span><br><span class="line">3542</span><br><span class="line">3543</span><br><span class="line">3544</span><br><span class="line">3545</span><br><span class="line">3546</span><br><span class="line">3547</span><br><span class="line">3548</span><br><span class="line">3549</span><br><span class="line">3550</span><br><span class="line">3551</span><br><span class="line">3552</span><br><span class="line">3553</span><br><span class="line">3554</span><br><span class="line">3555</span><br><span class="line">3556</span><br><span class="line">3557</span><br><span class="line">3558</span><br><span class="line">3559</span><br><span class="line">3560</span><br><span class="line">3561</span><br><span class="line">3562</span><br><span class="line">3563</span><br><span class="line">3564</span><br><span class="line">3565</span><br><span class="line">3566</span><br><span class="line">3567</span><br><span class="line">3568</span><br><span class="line">3569</span><br><span class="line">3570</span><br><span class="line">3571</span><br><span class="line">3572</span><br><span class="line">3573</span><br><span class="line">3574</span><br><span class="line">3575</span><br><span class="line">3576</span><br><span class="line">3577</span><br><span class="line">3578</span><br><span class="line">3579</span><br><span class="line">3580</span><br><span class="line">3581</span><br><span class="line">3582</span><br><span class="line">3583</span><br><span class="line">3584</span><br><span class="line">3585</span><br><span class="line">3586</span><br><span class="line">3587</span><br><span class="line">3588</span><br><span class="line">3589</span><br><span class="line">3590</span><br><span class="line">3591</span><br><span class="line">3592</span><br><span class="line">3593</span><br><span class="line">3594</span><br><span class="line">3595</span><br><span class="line">3596</span><br><span class="line">3597</span><br><span class="line">3598</span><br><span class="line">3599</span><br><span class="line">3600</span><br><span class="line">3601</span><br><span class="line">3602</span><br><span class="line">3603</span><br><span class="line">3604</span><br><span class="line">3605</span><br><span class="line">3606</span><br><span class="line">3607</span><br><span class="line">3608</span><br><span class="line">3609</span><br><span class="line">3610</span><br><span class="line">3611</span><br><span class="line">3612</span><br><span class="line">3613</span><br><span class="line">3614</span><br><span class="line">3615</span><br><span class="line">3616</span><br><span class="line">3617</span><br><span class="line">3618</span><br><span class="line">3619</span><br><span class="line">3620</span><br><span class="line">3621</span><br><span class="line">3622</span><br><span class="line">3623</span><br><span class="line">3624</span><br><span class="line">3625</span><br><span class="line">3626</span><br><span class="line">3627</span><br><span class="line">3628</span><br><span class="line">3629</span><br><span class="line">3630</span><br><span class="line">3631</span><br><span class="line">3632</span><br><span class="line">3633</span><br><span class="line">3634</span><br><span class="line">3635</span><br><span class="line">3636</span><br><span class="line">3637</span><br><span class="line">3638</span><br><span class="line">3639</span><br><span class="line">3640</span><br><span class="line">3641</span><br><span class="line">3642</span><br><span class="line">3643</span><br><span class="line">3644</span><br><span class="line">3645</span><br><span class="line">3646</span><br><span class="line">3647</span><br><span class="line">3648</span><br><span class="line">3649</span><br><span class="line">3650</span><br><span class="line">3651</span><br><span class="line">3652</span><br><span class="line">3653</span><br><span class="line">3654</span><br><span class="line">3655</span><br><span class="line">3656</span><br><span class="line">3657</span><br><span class="line">3658</span><br><span class="line">3659</span><br><span class="line">3660</span><br><span class="line">3661</span><br><span class="line">3662</span><br><span class="line">3663</span><br><span class="line">3664</span><br><span class="line">3665</span><br><span class="line">3666</span><br><span class="line">3667</span><br><span class="line">3668</span><br><span class="line">3669</span><br><span class="line">3670</span><br><span class="line">3671</span><br><span class="line">3672</span><br><span class="line">3673</span><br><span class="line">3674</span><br><span class="line">3675</span><br><span class="line">3676</span><br><span class="line">3677</span><br><span class="line">3678</span><br><span class="line">3679</span><br><span class="line">3680</span><br><span class="line">3681</span><br><span class="line">3682</span><br><span class="line">3683</span><br><span class="line">3684</span><br><span class="line">3685</span><br><span class="line">3686</span><br><span class="line">3687</span><br><span class="line">3688</span><br><span class="line">3689</span><br><span class="line">3690</span><br><span class="line">3691</span><br><span class="line">3692</span><br><span class="line">3693</span><br><span class="line">3694</span><br><span class="line">3695</span><br><span class="line">3696</span><br><span class="line">3697</span><br><span class="line">3698</span><br><span class="line">3699</span><br><span class="line">3700</span><br><span class="line">3701</span><br><span class="line">3702</span><br><span class="line">3703</span><br><span class="line">3704</span><br><span class="line">3705</span><br><span class="line">3706</span><br><span class="line">3707</span><br><span class="line">3708</span><br><span class="line">3709</span><br><span class="line">3710</span><br><span class="line">3711</span><br><span class="line">3712</span><br><span class="line">3713</span><br><span class="line">3714</span><br><span class="line">3715</span><br><span class="line">3716</span><br><span class="line">3717</span><br><span class="line">3718</span><br><span class="line">3719</span><br><span class="line">3720</span><br><span class="line">3721</span><br><span class="line">3722</span><br><span class="line">3723</span><br><span class="line">3724</span><br><span class="line">3725</span><br><span class="line">3726</span><br><span class="line">3727</span><br><span class="line">3728</span><br><span class="line">3729</span><br><span class="line">3730</span><br><span class="line">3731</span><br><span class="line">3732</span><br><span class="line">3733</span><br><span class="line">3734</span><br><span class="line">3735</span><br><span class="line">3736</span><br><span class="line">3737</span><br><span class="line">3738</span><br><span class="line">3739</span><br><span class="line">3740</span><br><span class="line">3741</span><br><span class="line">3742</span><br><span class="line">3743</span><br><span class="line">3744</span><br><span class="line">3745</span><br><span class="line">3746</span><br><span class="line">3747</span><br><span class="line">3748</span><br><span class="line">3749</span><br><span class="line">3750</span><br><span class="line">3751</span><br><span class="line">3752</span><br><span class="line">3753</span><br><span class="line">3754</span><br><span class="line">3755</span><br><span class="line">3756</span><br><span class="line">3757</span><br><span class="line">3758</span><br><span class="line">3759</span><br><span class="line">3760</span><br><span class="line">3761</span><br><span class="line">3762</span><br><span class="line">3763</span><br><span class="line">3764</span><br><span class="line">3765</span><br><span class="line">3766</span><br><span class="line">3767</span><br><span class="line">3768</span><br><span class="line">3769</span><br><span class="line">3770</span><br><span class="line">3771</span><br><span class="line">3772</span><br><span class="line">3773</span><br><span class="line">3774</span><br><span class="line">3775</span><br><span class="line">3776</span><br><span class="line">3777</span><br><span class="line">3778</span><br><span class="line">3779</span><br><span class="line">3780</span><br><span class="line">3781</span><br><span class="line">3782</span><br><span class="line">3783</span><br><span class="line">3784</span><br><span class="line">3785</span><br><span class="line">3786</span><br><span class="line">3787</span><br><span class="line">3788</span><br><span class="line">3789</span><br><span class="line">3790</span><br><span class="line">3791</span><br><span class="line">3792</span><br><span class="line">3793</span><br><span class="line">3794</span><br><span class="line">3795</span><br><span class="line">3796</span><br><span class="line">3797</span><br><span class="line">3798</span><br><span class="line">3799</span><br><span class="line">3800</span><br><span class="line">3801</span><br><span class="line">3802</span><br><span class="line">3803</span><br><span class="line">3804</span><br><span class="line">3805</span><br><span class="line">3806</span><br><span class="line">3807</span><br><span class="line">3808</span><br><span class="line">3809</span><br><span class="line">3810</span><br><span class="line">3811</span><br><span class="line">3812</span><br><span class="line">3813</span><br><span class="line">3814</span><br><span class="line">3815</span><br><span class="line">3816</span><br><span class="line">3817</span><br><span class="line">3818</span><br><span class="line">3819</span><br><span class="line">3820</span><br><span class="line">3821</span><br><span class="line">3822</span><br><span class="line">3823</span><br><span class="line">3824</span><br><span class="line">3825</span><br><span class="line">3826</span><br><span class="line">3827</span><br><span class="line">3828</span><br><span class="line">3829</span><br><span class="line">3830</span><br><span class="line">3831</span><br><span class="line">3832</span><br><span class="line">3833</span><br><span class="line">3834</span><br><span class="line">3835</span><br><span class="line">3836</span><br><span class="line">3837</span><br><span class="line">3838</span><br><span class="line">3839</span><br><span class="line">3840</span><br><span class="line">3841</span><br><span class="line">3842</span><br><span class="line">3843</span><br><span class="line">3844</span><br><span class="line">3845</span><br><span class="line">3846</span><br><span class="line">3847</span><br><span class="line">3848</span><br><span class="line">3849</span><br><span class="line">3850</span><br><span class="line">3851</span><br><span class="line">3852</span><br><span class="line">3853</span><br><span class="line">3854</span><br><span class="line">3855</span><br><span class="line">3856</span><br><span class="line">3857</span><br><span class="line">3858</span><br><span class="line">3859</span><br><span class="line">3860</span><br><span class="line">3861</span><br><span class="line">3862</span><br><span class="line">3863</span><br><span class="line">3864</span><br><span class="line">3865</span><br><span class="line">3866</span><br><span class="line">3867</span><br><span class="line">3868</span><br><span class="line">3869</span><br><span class="line">3870</span><br><span class="line">3871</span><br><span class="line">3872</span><br><span class="line">3873</span><br><span class="line">3874</span><br><span class="line">3875</span><br><span class="line">3876</span><br><span class="line">3877</span><br><span class="line">3878</span><br><span class="line">3879</span><br><span class="line">3880</span><br><span class="line">3881</span><br><span class="line">3882</span><br><span class="line">3883</span><br><span class="line">3884</span><br><span class="line">3885</span><br><span class="line">3886</span><br><span class="line">3887</span><br><span class="line">3888</span><br><span class="line">3889</span><br><span class="line">3890</span><br><span class="line">3891</span><br><span class="line">3892</span><br><span class="line">3893</span><br><span class="line">3894</span><br><span class="line">3895</span><br><span class="line">3896</span><br><span class="line">3897</span><br><span class="line">3898</span><br><span class="line">3899</span><br><span class="line">3900</span><br><span class="line">3901</span><br><span class="line">3902</span><br><span class="line">3903</span><br><span class="line">3904</span><br><span class="line">3905</span><br><span class="line">3906</span><br><span class="line">3907</span><br><span class="line">3908</span><br><span class="line">3909</span><br><span class="line">3910</span><br><span class="line">3911</span><br><span class="line">3912</span><br><span class="line">3913</span><br><span class="line">3914</span><br><span class="line">3915</span><br><span class="line">3916</span><br><span class="line">3917</span><br><span class="line">3918</span><br><span class="line">3919</span><br><span class="line">3920</span><br><span class="line">3921</span><br><span class="line">3922</span><br><span class="line">3923</span><br><span class="line">3924</span><br><span class="line">3925</span><br><span class="line">3926</span><br><span class="line">3927</span><br><span class="line">3928</span><br><span class="line">3929</span><br><span class="line">3930</span><br><span class="line">3931</span><br><span class="line">3932</span><br><span class="line">3933</span><br><span class="line">3934</span><br><span class="line">3935</span><br><span class="line">3936</span><br><span class="line">3937</span><br><span class="line">3938</span><br><span class="line">3939</span><br><span class="line">3940</span><br><span class="line">3941</span><br><span class="line">3942</span><br><span class="line">3943</span><br><span class="line">3944</span><br><span class="line">3945</span><br><span class="line">3946</span><br><span class="line">3947</span><br><span class="line">3948</span><br><span class="line">3949</span><br><span class="line">3950</span><br><span class="line">3951</span><br><span class="line">3952</span><br><span class="line">3953</span><br><span class="line">3954</span><br><span class="line">3955</span><br><span class="line">3956</span><br><span class="line">3957</span><br><span class="line">3958</span><br><span class="line">3959</span><br><span class="line">3960</span><br><span class="line">3961</span><br><span class="line">3962</span><br><span class="line">3963</span><br><span class="line">3964</span><br><span class="line">3965</span><br><span class="line">3966</span><br><span class="line">3967</span><br><span class="line">3968</span><br><span class="line">3969</span><br><span class="line">3970</span><br><span class="line">3971</span><br><span class="line">3972</span><br><span class="line">3973</span><br><span class="line">3974</span><br><span class="line">3975</span><br><span class="line">3976</span><br><span class="line">3977</span><br><span class="line">3978</span><br><span class="line">3979</span><br><span class="line">3980</span><br><span class="line">3981</span><br><span class="line">3982</span><br><span class="line">3983</span><br><span class="line">3984</span><br><span class="line">3985</span><br><span class="line">3986</span><br><span class="line">3987</span><br><span class="line">3988</span><br><span class="line">3989</span><br><span class="line">3990</span><br><span class="line">3991</span><br><span class="line">3992</span><br><span class="line">3993</span><br><span class="line">3994</span><br><span class="line">3995</span><br><span class="line">3996</span><br><span class="line">3997</span><br><span class="line">3998</span><br><span class="line">3999</span><br><span class="line">4000</span><br><span class="line">4001</span><br><span class="line">4002</span><br><span class="line">4003</span><br><span class="line">4004</span><br><span class="line">4005</span><br><span class="line">4006</span><br><span class="line">4007</span><br><span class="line">4008</span><br><span class="line">4009</span><br><span class="line">4010</span><br><span class="line">4011</span><br><span class="line">4012</span><br><span class="line">4013</span><br><span class="line">4014</span><br><span class="line">4015</span><br><span class="line">4016</span><br><span class="line">4017</span><br><span class="line">4018</span><br><span class="line">4019</span><br><span class="line">4020</span><br><span class="line">4021</span><br><span class="line">4022</span><br><span class="line">4023</span><br><span class="line">4024</span><br><span class="line">4025</span><br><span class="line">4026</span><br><span class="line">4027</span><br><span class="line">4028</span><br><span class="line">4029</span><br><span class="line">4030</span><br><span class="line">4031</span><br><span class="line">4032</span><br><span class="line">4033</span><br><span class="line">4034</span><br><span class="line">4035</span><br><span class="line">4036</span><br><span class="line">4037</span><br><span class="line">4038</span><br><span class="line">4039</span><br><span class="line">4040</span><br><span class="line">4041</span><br><span class="line">4042</span><br><span class="line">4043</span><br><span class="line">4044</span><br><span class="line">4045</span><br><span class="line">4046</span><br><span class="line">4047</span><br><span class="line">4048</span><br><span class="line">4049</span><br><span class="line">4050</span><br><span class="line">4051</span><br><span class="line">4052</span><br><span class="line">4053</span><br><span class="line">4054</span><br><span class="line">4055</span><br><span class="line">4056</span><br><span class="line">4057</span><br><span class="line">4058</span><br><span class="line">4059</span><br><span class="line">4060</span><br><span class="line">4061</span><br><span class="line">4062</span><br><span class="line">4063</span><br><span class="line">4064</span><br><span class="line">4065</span><br><span class="line">4066</span><br><span class="line">4067</span><br><span class="line">4068</span><br><span class="line">4069</span><br><span class="line">4070</span><br><span class="line">4071</span><br><span class="line">4072</span><br><span class="line">4073</span><br><span class="line">4074</span><br><span class="line">4075</span><br><span class="line">4076</span><br><span class="line">4077</span><br><span class="line">4078</span><br><span class="line">4079</span><br><span class="line">4080</span><br><span class="line">4081</span><br><span class="line">4082</span><br><span class="line">4083</span><br><span class="line">4084</span><br><span class="line">4085</span><br><span class="line">4086</span><br><span class="line">4087</span><br><span class="line">4088</span><br><span class="line">4089</span><br><span class="line">4090</span><br><span class="line">4091</span><br><span class="line">4092</span><br><span class="line">4093</span><br><span class="line">4094</span><br><span class="line">4095</span><br><span class="line">4096</span><br><span class="line">4097</span><br><span class="line">4098</span><br><span class="line">4099</span><br><span class="line">4100</span><br><span class="line">4101</span><br><span class="line">4102</span><br><span class="line">4103</span><br><span class="line">4104</span><br><span class="line">4105</span><br><span class="line">4106</span><br><span class="line">4107</span><br><span class="line">4108</span><br><span class="line">4109</span><br><span class="line">4110</span><br><span class="line">4111</span><br><span class="line">4112</span><br><span class="line">4113</span><br><span class="line">4114</span><br><span class="line">4115</span><br><span class="line">4116</span><br><span class="line">4117</span><br><span class="line">4118</span><br><span class="line">4119</span><br><span class="line">4120</span><br><span class="line">4121</span><br><span class="line">4122</span><br><span class="line">4123</span><br><span class="line">4124</span><br><span class="line">4125</span><br><span class="line">4126</span><br><span class="line">4127</span><br><span class="line">4128</span><br><span class="line">4129</span><br><span class="line">4130</span><br><span class="line">4131</span><br><span class="line">4132</span><br><span class="line">4133</span><br><span class="line">4134</span><br><span class="line">4135</span><br><span class="line">4136</span><br><span class="line">4137</span><br><span class="line">4138</span><br><span class="line">4139</span><br><span class="line">4140</span><br><span class="line">4141</span><br><span class="line">4142</span><br><span class="line">4143</span><br><span class="line">4144</span><br><span class="line">4145</span><br><span class="line">4146</span><br><span class="line">4147</span><br><span class="line">4148</span><br><span class="line">4149</span><br><span class="line">4150</span><br><span class="line">4151</span><br><span class="line">4152</span><br><span class="line">4153</span><br><span class="line">4154</span><br><span class="line">4155</span><br><span class="line">4156</span><br><span class="line">4157</span><br><span class="line">4158</span><br><span class="line">4159</span><br><span class="line">4160</span><br><span class="line">4161</span><br><span class="line">4162</span><br><span class="line">4163</span><br><span class="line">4164</span><br><span class="line">4165</span><br><span class="line">4166</span><br><span class="line">4167</span><br><span class="line">4168</span><br><span class="line">4169</span><br><span class="line">4170</span><br><span class="line">4171</span><br><span class="line">4172</span><br><span class="line">4173</span><br><span class="line">4174</span><br><span class="line">4175</span><br><span class="line">4176</span><br><span class="line">4177</span><br><span class="line">4178</span><br><span class="line">4179</span><br><span class="line">4180</span><br><span class="line">4181</span><br><span class="line">4182</span><br><span class="line">4183</span><br><span class="line">4184</span><br><span class="line">4185</span><br><span class="line">4186</span><br><span class="line">4187</span><br><span class="line">4188</span><br><span class="line">4189</span><br><span class="line">4190</span><br><span class="line">4191</span><br><span class="line">4192</span><br><span class="line">4193</span><br><span class="line">4194</span><br><span class="line">4195</span><br><span class="line">4196</span><br><span class="line">4197</span><br><span class="line">4198</span><br><span class="line">4199</span><br><span class="line">4200</span><br><span class="line">4201</span><br><span class="line">4202</span><br><span class="line">4203</span><br><span class="line">4204</span><br><span class="line">4205</span><br><span class="line">4206</span><br><span class="line">4207</span><br><span class="line">4208</span><br><span class="line">4209</span><br><span class="line">4210</span><br><span class="line">4211</span><br><span class="line">4212</span><br><span class="line">4213</span><br><span class="line">4214</span><br><span class="line">4215</span><br><span class="line">4216</span><br><span class="line">4217</span><br><span class="line">4218</span><br><span class="line">4219</span><br><span class="line">4220</span><br><span class="line">4221</span><br><span class="line">4222</span><br><span class="line">4223</span><br><span class="line">4224</span><br><span class="line">4225</span><br><span class="line">4226</span><br><span class="line">4227</span><br><span class="line">4228</span><br><span class="line">4229</span><br><span class="line">4230</span><br><span class="line">4231</span><br><span class="line">4232</span><br><span class="line">4233</span><br><span class="line">4234</span><br><span class="line">4235</span><br><span class="line">4236</span><br><span class="line">4237</span><br><span class="line">4238</span><br><span class="line">4239</span><br><span class="line">4240</span><br><span class="line">4241</span><br><span class="line">4242</span><br><span class="line">4243</span><br><span class="line">4244</span><br><span class="line">4245</span><br><span class="line">4246</span><br><span class="line">4247</span><br><span class="line">4248</span><br><span class="line">4249</span><br><span class="line">4250</span><br><span class="line">4251</span><br><span class="line">4252</span><br><span class="line">4253</span><br><span class="line">4254</span><br><span class="line">4255</span><br><span class="line">4256</span><br><span class="line">4257</span><br><span class="line">4258</span><br><span class="line">4259</span><br><span class="line">4260</span><br><span class="line">4261</span><br><span class="line">4262</span><br><span class="line">4263</span><br><span class="line">4264</span><br><span class="line">4265</span><br><span class="line">4266</span><br><span class="line">4267</span><br><span class="line">4268</span><br><span class="line">4269</span><br><span class="line">4270</span><br><span class="line">4271</span><br><span class="line">4272</span><br><span class="line">4273</span><br><span class="line">4274</span><br><span class="line">4275</span><br><span class="line">4276</span><br><span class="line">4277</span><br><span class="line">4278</span><br><span class="line">4279</span><br><span class="line">4280</span><br><span class="line">4281</span><br><span class="line">4282</span><br><span class="line">4283</span><br><span class="line">4284</span><br><span class="line">4285</span><br><span class="line">4286</span><br><span class="line">4287</span><br><span class="line">4288</span><br><span class="line">4289</span><br><span class="line">4290</span><br><span class="line">4291</span><br><span class="line">4292</span><br><span class="line">4293</span><br><span class="line">4294</span><br><span class="line">4295</span><br><span class="line">4296</span><br><span class="line">4297</span><br><span class="line">4298</span><br><span class="line">4299</span><br><span class="line">4300</span><br><span class="line">4301</span><br><span class="line">4302</span><br><span class="line">4303</span><br><span class="line">4304</span><br><span class="line">4305</span><br><span class="line">4306</span><br><span class="line">4307</span><br><span class="line">4308</span><br><span class="line">4309</span><br><span class="line">4310</span><br><span class="line">4311</span><br><span class="line">4312</span><br><span class="line">4313</span><br><span class="line">4314</span><br><span class="line">4315</span><br><span class="line">4316</span><br><span class="line">4317</span><br><span class="line">4318</span><br><span class="line">4319</span><br><span class="line">4320</span><br><span class="line">4321</span><br><span class="line">4322</span><br><span class="line">4323</span><br><span class="line">4324</span><br><span class="line">4325</span><br><span class="line">4326</span><br><span class="line">4327</span><br><span class="line">4328</span><br><span class="line">4329</span><br><span class="line">4330</span><br><span class="line">4331</span><br><span class="line">4332</span><br><span class="line">4333</span><br><span class="line">4334</span><br><span class="line">4335</span><br><span class="line">4336</span><br><span class="line">4337</span><br><span class="line">4338</span><br><span class="line">4339</span><br><span class="line">4340</span><br><span class="line">4341</span><br><span class="line">4342</span><br><span class="line">4343</span><br><span class="line">4344</span><br><span class="line">4345</span><br><span class="line">4346</span><br><span class="line">4347</span><br><span class="line">4348</span><br><span class="line">4349</span><br><span class="line">4350</span><br><span class="line">4351</span><br><span class="line">4352</span><br><span class="line">4353</span><br><span class="line">4354</span><br><span class="line">4355</span><br><span class="line">4356</span><br><span class="line">4357</span><br><span class="line">4358</span><br><span class="line">4359</span><br><span class="line">4360</span><br><span class="line">4361</span><br><span class="line">4362</span><br><span class="line">4363</span><br><span class="line">4364</span><br><span class="line">4365</span><br><span class="line">4366</span><br><span class="line">4367</span><br><span class="line">4368</span><br><span class="line">4369</span><br><span class="line">4370</span><br><span class="line">4371</span><br><span class="line">4372</span><br><span class="line">4373</span><br><span class="line">4374</span><br><span class="line">4375</span><br><span class="line">4376</span><br><span class="line">4377</span><br><span class="line">4378</span><br><span class="line">4379</span><br><span class="line">4380</span><br><span class="line">4381</span><br><span class="line">4382</span><br><span class="line">4383</span><br><span class="line">4384</span><br><span class="line">4385</span><br><span class="line">4386</span><br><span class="line">4387</span><br><span class="line">4388</span><br><span class="line">4389</span><br><span class="line">4390</span><br><span class="line">4391</span><br><span class="line">4392</span><br><span class="line">4393</span><br><span class="line">4394</span><br><span class="line">4395</span><br><span class="line">4396</span><br><span class="line">4397</span><br><span class="line">4398</span><br><span class="line">4399</span><br><span class="line">4400</span><br><span class="line">4401</span><br><span class="line">4402</span><br><span class="line">4403</span><br><span class="line">4404</span><br><span class="line">4405</span><br><span class="line">4406</span><br><span class="line">4407</span><br><span class="line">4408</span><br><span class="line">4409</span><br><span class="line">4410</span><br><span class="line">4411</span><br><span class="line">4412</span><br><span class="line">4413</span><br><span class="line">4414</span><br><span class="line">4415</span><br><span class="line">4416</span><br><span class="line">4417</span><br><span class="line">4418</span><br><span class="line">4419</span><br><span class="line">4420</span><br><span class="line">4421</span><br><span class="line">4422</span><br><span class="line">4423</span><br><span class="line">4424</span><br><span class="line">4425</span><br><span class="line">4426</span><br><span class="line">4427</span><br><span class="line">4428</span><br><span class="line">4429</span><br><span class="line">4430</span><br><span class="line">4431</span><br><span class="line">4432</span><br><span class="line">4433</span><br><span class="line">4434</span><br><span class="line">4435</span><br><span class="line">4436</span><br><span class="line">4437</span><br><span class="line">4438</span><br><span class="line">4439</span><br><span class="line">4440</span><br><span class="line">4441</span><br><span class="line">4442</span><br><span class="line">4443</span><br><span class="line">4444</span><br><span class="line">4445</span><br><span class="line">4446</span><br><span class="line">4447</span><br><span class="line">4448</span><br><span class="line">4449</span><br><span class="line">4450</span><br><span class="line">4451</span><br><span class="line">4452</span><br><span class="line">4453</span><br><span class="line">4454</span><br><span class="line">4455</span><br><span class="line">4456</span><br><span class="line">4457</span><br><span class="line">4458</span><br><span class="line">4459</span><br><span class="line">4460</span><br><span class="line">4461</span><br><span class="line">4462</span><br><span class="line">4463</span><br><span class="line">4464</span><br><span class="line">4465</span><br><span class="line">4466</span><br><span class="line">4467</span><br><span class="line">4468</span><br><span class="line">4469</span><br><span class="line">4470</span><br><span class="line">4471</span><br><span class="line">4472</span><br><span class="line">4473</span><br><span class="line">4474</span><br><span class="line">4475</span><br><span class="line">4476</span><br><span class="line">4477</span><br><span class="line">4478</span><br><span class="line">4479</span><br><span class="line">4480</span><br><span class="line">4481</span><br><span class="line">4482</span><br><span class="line">4483</span><br><span class="line">4484</span><br><span class="line">4485</span><br><span class="line">4486</span><br><span class="line">4487</span><br><span class="line">4488</span><br><span class="line">4489</span><br><span class="line">4490</span><br><span class="line">4491</span><br><span class="line">4492</span><br><span class="line">4493</span><br><span class="line">4494</span><br><span class="line">4495</span><br><span class="line">4496</span><br><span class="line">4497</span><br><span class="line">4498</span><br><span class="line">4499</span><br><span class="line">4500</span><br><span class="line">4501</span><br><span class="line">4502</span><br><span class="line">4503</span><br><span class="line">4504</span><br><span class="line">4505</span><br><span class="line">4506</span><br><span class="line">4507</span><br><span class="line">4508</span><br><span class="line">4509</span><br><span class="line">4510</span><br><span class="line">4511</span><br><span class="line">4512</span><br><span class="line">4513</span><br><span class="line">4514</span><br><span class="line">4515</span><br><span class="line">4516</span><br><span class="line">4517</span><br><span class="line">4518</span><br><span class="line">4519</span><br><span class="line">4520</span><br><span class="line">4521</span><br><span class="line">4522</span><br><span class="line">4523</span><br><span class="line">4524</span><br><span class="line">4525</span><br><span class="line">4526</span><br><span class="line">4527</span><br><span class="line">4528</span><br><span class="line">4529</span><br><span class="line">4530</span><br><span class="line">4531</span><br><span class="line">4532</span><br><span class="line">4533</span><br><span class="line">4534</span><br><span class="line">4535</span><br><span class="line">4536</span><br><span class="line">4537</span><br><span class="line">4538</span><br><span class="line">4539</span><br><span class="line">4540</span><br><span class="line">4541</span><br><span class="line">4542</span><br><span class="line">4543</span><br><span class="line">4544</span><br><span class="line">4545</span><br><span class="line">4546</span><br><span class="line">4547</span><br><span class="line">4548</span><br><span class="line">4549</span><br><span class="line">4550</span><br><span class="line">4551</span><br><span class="line">4552</span><br><span class="line">4553</span><br><span class="line">4554</span><br><span class="line">4555</span><br><span class="line">4556</span><br><span class="line">4557</span><br><span class="line">4558</span><br><span class="line">4559</span><br><span class="line">4560</span><br><span class="line">4561</span><br><span class="line">4562</span><br><span class="line">4563</span><br><span class="line">4564</span><br><span class="line">4565</span><br><span class="line">4566</span><br><span class="line">4567</span><br><span class="line">4568</span><br><span class="line">4569</span><br><span class="line">4570</span><br><span class="line">4571</span><br><span class="line">4572</span><br><span class="line">4573</span><br><span class="line">4574</span><br><span class="line">4575</span><br><span class="line">4576</span><br><span class="line">4577</span><br><span class="line">4578</span><br><span class="line">4579</span><br><span class="line">4580</span><br><span class="line">4581</span><br><span class="line">4582</span><br><span class="line">4583</span><br><span class="line">4584</span><br><span class="line">4585</span><br><span class="line">4586</span><br><span class="line">4587</span><br><span class="line">4588</span><br><span class="line">4589</span><br><span class="line">4590</span><br><span class="line">4591</span><br><span class="line">4592</span><br><span class="line">4593</span><br><span class="line">4594</span><br><span class="line">4595</span><br><span class="line">4596</span><br><span class="line">4597</span><br><span class="line">4598</span><br><span class="line">4599</span><br><span class="line">4600</span><br><span class="line">4601</span><br><span class="line">4602</span><br><span class="line">4603</span><br><span class="line">4604</span><br><span class="line">4605</span><br><span class="line">4606</span><br><span class="line">4607</span><br><span class="line">4608</span><br><span class="line">4609</span><br><span class="line">4610</span><br><span class="line">4611</span><br><span class="line">4612</span><br><span class="line">4613</span><br><span class="line">4614</span><br><span class="line">4615</span><br><span class="line">4616</span><br><span class="line">4617</span><br><span class="line">4618</span><br><span class="line">4619</span><br><span class="line">4620</span><br><span class="line">4621</span><br><span class="line">4622</span><br><span class="line">4623</span><br><span class="line">4624</span><br><span class="line">4625</span><br><span class="line">4626</span><br><span class="line">4627</span><br><span class="line">4628</span><br><span class="line">4629</span><br><span class="line">4630</span><br><span class="line">4631</span><br><span class="line">4632</span><br><span class="line">4633</span><br><span class="line">4634</span><br><span class="line">4635</span><br><span class="line">4636</span><br><span class="line">4637</span><br><span class="line">4638</span><br><span class="line">4639</span><br><span class="line">4640</span><br><span class="line">4641</span><br><span class="line">4642</span><br><span class="line">4643</span><br><span class="line">4644</span><br><span class="line">4645</span><br><span class="line">4646</span><br><span class="line">4647</span><br><span class="line">4648</span><br><span class="line">4649</span><br><span class="line">4650</span><br><span class="line">4651</span><br><span class="line">4652</span><br><span class="line">4653</span><br><span class="line">4654</span><br><span class="line">4655</span><br><span class="line">4656</span><br><span class="line">4657</span><br><span class="line">4658</span><br><span class="line">4659</span><br><span class="line">4660</span><br><span class="line">4661</span><br><span class="line">4662</span><br><span class="line">4663</span><br><span class="line">4664</span><br><span class="line">4665</span><br><span class="line">4666</span><br><span class="line">4667</span><br><span class="line">4668</span><br><span class="line">4669</span><br><span class="line">4670</span><br><span class="line">4671</span><br><span class="line">4672</span><br><span class="line">4673</span><br><span class="line">4674</span><br><span class="line">4675</span><br><span class="line">4676</span><br><span class="line">4677</span><br><span class="line">4678</span><br><span class="line">4679</span><br><span class="line">4680</span><br><span class="line">4681</span><br><span class="line">4682</span><br><span class="line">4683</span><br><span class="line">4684</span><br><span class="line">4685</span><br><span class="line">4686</span><br><span class="line">4687</span><br><span class="line">4688</span><br><span class="line">4689</span><br><span class="line">4690</span><br><span class="line">4691</span><br><span class="line">4692</span><br><span class="line">4693</span><br><span class="line">4694</span><br><span class="line">4695</span><br><span class="line">4696</span><br><span class="line">4697</span><br><span class="line">4698</span><br><span class="line">4699</span><br><span class="line">4700</span><br><span class="line">4701</span><br><span class="line">4702</span><br><span class="line">4703</span><br><span class="line">4704</span><br><span class="line">4705</span><br><span class="line">4706</span><br><span class="line">4707</span><br><span class="line">4708</span><br><span class="line">4709</span><br><span class="line">4710</span><br><span class="line">4711</span><br><span class="line">4712</span><br><span class="line">4713</span><br><span class="line">4714</span><br><span class="line">4715</span><br><span class="line">4716</span><br><span class="line">4717</span><br><span class="line">4718</span><br><span class="line">4719</span><br><span class="line">4720</span><br><span class="line">4721</span><br><span class="line">4722</span><br><span class="line">4723</span><br><span class="line">4724</span><br><span class="line">4725</span><br><span class="line">4726</span><br><span class="line">4727</span><br><span class="line">4728</span><br><span class="line">4729</span><br><span class="line">4730</span><br><span class="line">4731</span><br><span class="line">4732</span><br><span class="line">4733</span><br><span class="line">4734</span><br><span class="line">4735</span><br><span class="line">4736</span><br><span class="line">4737</span><br><span class="line">4738</span><br><span class="line">4739</span><br><span class="line">4740</span><br><span class="line">4741</span><br><span class="line">4742</span><br><span class="line">4743</span><br><span class="line">4744</span><br><span class="line">4745</span><br><span class="line">4746</span><br><span class="line">4747</span><br><span class="line">4748</span><br><span class="line">4749</span><br><span class="line">4750</span><br><span class="line">4751</span><br><span class="line">4752</span><br><span class="line">4753</span><br><span class="line">4754</span><br><span class="line">4755</span><br><span class="line">4756</span><br><span class="line">4757</span><br><span class="line">4758</span><br><span class="line">4759</span><br><span class="line">4760</span><br><span class="line">4761</span><br><span class="line">4762</span><br><span class="line">4763</span><br><span class="line">4764</span><br><span class="line">4765</span><br><span class="line">4766</span><br><span class="line">4767</span><br><span class="line">4768</span><br><span class="line">4769</span><br><span class="line">4770</span><br><span class="line">4771</span><br><span class="line">4772</span><br><span class="line">4773</span><br><span class="line">4774</span><br><span class="line">4775</span><br><span class="line">4776</span><br><span class="line">4777</span><br><span class="line">4778</span><br><span class="line">4779</span><br><span class="line">4780</span><br><span class="line">4781</span><br><span class="line">4782</span><br><span class="line">4783</span><br><span class="line">4784</span><br><span class="line">4785</span><br><span class="line">4786</span><br><span class="line">4787</span><br><span class="line">4788</span><br><span class="line">4789</span><br><span class="line">4790</span><br><span class="line">4791</span><br><span class="line">4792</span><br><span class="line">4793</span><br><span class="line">4794</span><br><span class="line">4795</span><br><span class="line">4796</span><br><span class="line">4797</span><br><span class="line">4798</span><br><span class="line">4799</span><br><span class="line">4800</span><br><span class="line">4801</span><br><span class="line">4802</span><br><span class="line">4803</span><br><span class="line">4804</span><br><span class="line">4805</span><br><span class="line">4806</span><br><span class="line">4807</span><br><span class="line">4808</span><br><span class="line">4809</span><br><span class="line">4810</span><br><span class="line">4811</span><br><span class="line">4812</span><br><span class="line">4813</span><br><span class="line">4814</span><br><span class="line">4815</span><br><span class="line">4816</span><br><span class="line">4817</span><br><span class="line">4818</span><br><span class="line">4819</span><br><span class="line">4820</span><br><span class="line">4821</span><br><span class="line">4822</span><br><span class="line">4823</span><br><span class="line">4824</span><br><span class="line">4825</span><br><span class="line">4826</span><br><span class="line">4827</span><br><span class="line">4828</span><br><span class="line">4829</span><br><span class="line">4830</span><br><span class="line">4831</span><br><span class="line">4832</span><br><span class="line">4833</span><br><span class="line">4834</span><br><span class="line">4835</span><br><span class="line">4836</span><br><span class="line">4837</span><br><span class="line">4838</span><br><span class="line">4839</span><br><span class="line">4840</span><br><span class="line">4841</span><br><span class="line">4842</span><br><span class="line">4843</span><br><span class="line">4844</span><br><span class="line">4845</span><br><span class="line">4846</span><br><span class="line">4847</span><br><span class="line">4848</span><br><span class="line">4849</span><br><span class="line">4850</span><br><span class="line">4851</span><br><span class="line">4852</span><br><span class="line">4853</span><br><span class="line">4854</span><br><span class="line">4855</span><br><span class="line">4856</span><br><span class="line">4857</span><br><span class="line">4858</span><br><span class="line">4859</span><br><span class="line">4860</span><br><span class="line">4861</span><br><span class="line">4862</span><br><span class="line">4863</span><br><span class="line">4864</span><br><span class="line">4865</span><br><span class="line">4866</span><br><span class="line">4867</span><br><span class="line">4868</span><br><span class="line">4869</span><br><span class="line">4870</span><br><span class="line">4871</span><br><span class="line">4872</span><br><span class="line">4873</span><br><span class="line">4874</span><br><span class="line">4875</span><br><span class="line">4876</span><br><span class="line">4877</span><br><span class="line">4878</span><br><span class="line">4879</span><br><span class="line">4880</span><br><span class="line">4881</span><br><span class="line">4882</span><br><span class="line">4883</span><br><span class="line">4884</span><br><span class="line">4885</span><br><span class="line">4886</span><br><span class="line">4887</span><br><span class="line">4888</span><br><span class="line">4889</span><br><span class="line">4890</span><br><span class="line">4891</span><br><span class="line">4892</span><br><span class="line">4893</span><br><span class="line">4894</span><br><span class="line">4895</span><br><span class="line">4896</span><br><span class="line">4897</span><br><span class="line">4898</span><br><span class="line">4899</span><br><span class="line">4900</span><br><span class="line">4901</span><br><span class="line">4902</span><br><span class="line">4903</span><br><span class="line">4904</span><br><span class="line">4905</span><br><span class="line">4906</span><br><span class="line">4907</span><br><span class="line">4908</span><br><span class="line">4909</span><br><span class="line">4910</span><br><span class="line">4911</span><br><span class="line">4912</span><br><span class="line">4913</span><br><span class="line">4914</span><br><span class="line">4915</span><br><span class="line">4916</span><br><span class="line">4917</span><br><span class="line">4918</span><br><span class="line">4919</span><br><span class="line">4920</span><br><span class="line">4921</span><br><span class="line">4922</span><br><span class="line">4923</span><br><span class="line">4924</span><br><span class="line">4925</span><br><span class="line">4926</span><br><span class="line">4927</span><br><span class="line">4928</span><br><span class="line">4929</span><br><span class="line">4930</span><br><span class="line">4931</span><br><span class="line">4932</span><br><span class="line">4933</span><br><span class="line">4934</span><br><span class="line">4935</span><br><span class="line">4936</span><br><span class="line">4937</span><br><span class="line">4938</span><br><span class="line">4939</span><br><span class="line">4940</span><br><span class="line">4941</span><br><span class="line">4942</span><br><span class="line">4943</span><br><span class="line">4944</span><br><span class="line">4945</span><br><span class="line">4946</span><br><span class="line">4947</span><br><span class="line">4948</span><br><span class="line">4949</span><br><span class="line">4950</span><br><span class="line">4951</span><br><span class="line">4952</span><br><span class="line">4953</span><br><span class="line">4954</span><br><span class="line">4955</span><br><span class="line">4956</span><br><span class="line">4957</span><br><span class="line">4958</span><br><span class="line">4959</span><br><span class="line">4960</span><br><span class="line">4961</span><br><span class="line">4962</span><br><span class="line">4963</span><br><span class="line">4964</span><br><span class="line">4965</span><br><span class="line">4966</span><br><span class="line">4967</span><br><span class="line">4968</span><br><span class="line">4969</span><br><span class="line">4970</span><br><span class="line">4971</span><br><span class="line">4972</span><br><span class="line">4973</span><br><span class="line">4974</span><br><span class="line">4975</span><br><span class="line">4976</span><br><span class="line">4977</span><br><span class="line">4978</span><br><span class="line">4979</span><br><span class="line">4980</span><br><span class="line">4981</span><br><span class="line">4982</span><br><span class="line">4983</span><br><span class="line">4984</span><br><span class="line">4985</span><br><span class="line">4986</span><br><span class="line">4987</span><br><span class="line">4988</span><br><span class="line">4989</span><br><span class="line">4990</span><br><span class="line">4991</span><br><span class="line">4992</span><br><span class="line">4993</span><br><span class="line">4994</span><br><span class="line">4995</span><br><span class="line">4996</span><br><span class="line">4997</span><br><span class="line">4998</span><br><span class="line">4999</span><br><span class="line">5000</span><br><span class="line">5001</span><br><span class="line">5002</span><br><span class="line">5003</span><br><span class="line">5004</span><br><span class="line">5005</span><br><span class="line">5006</span><br><span class="line">5007</span><br><span class="line">5008</span><br><span class="line">5009</span><br><span class="line">5010</span><br><span class="line">5011</span><br><span class="line">5012</span><br><span class="line">5013</span><br><span class="line">5014</span><br><span class="line">5015</span><br><span class="line">5016</span><br><span class="line">5017</span><br><span class="line">5018</span><br><span class="line">5019</span><br><span class="line">5020</span><br><span class="line">5021</span><br><span class="line">5022</span><br><span class="line">5023</span><br><span class="line">5024</span><br><span class="line">5025</span><br><span class="line">5026</span><br><span class="line">5027</span><br><span class="line">5028</span><br><span class="line">5029</span><br><span class="line">5030</span><br><span class="line">5031</span><br><span class="line">5032</span><br><span class="line">5033</span><br><span class="line">5034</span><br><span class="line">5035</span><br><span class="line">5036</span><br><span class="line">5037</span><br><span class="line">5038</span><br><span class="line">5039</span><br><span class="line">5040</span><br><span class="line">5041</span><br><span class="line">5042</span><br><span class="line">5043</span><br><span class="line">5044</span><br><span class="line">5045</span><br><span class="line">5046</span><br><span class="line">5047</span><br><span class="line">5048</span><br><span class="line">5049</span><br><span class="line">5050</span><br><span class="line">5051</span><br><span class="line">5052</span><br><span class="line">5053</span><br><span class="line">5054</span><br><span class="line">5055</span><br><span class="line">5056</span><br><span class="line">5057</span><br><span class="line">5058</span><br><span class="line">5059</span><br><span class="line">5060</span><br><span class="line">5061</span><br><span class="line">5062</span><br><span class="line">5063</span><br><span class="line">5064</span><br><span class="line">5065</span><br><span class="line">5066</span><br><span class="line">5067</span><br><span class="line">5068</span><br><span class="line">5069</span><br><span class="line">5070</span><br><span class="line">5071</span><br><span class="line">5072</span><br><span class="line">5073</span><br><span class="line">5074</span><br><span class="line">5075</span><br><span class="line">5076</span><br><span class="line">5077</span><br><span class="line">5078</span><br><span class="line">5079</span><br><span class="line">5080</span><br><span class="line">5081</span><br><span class="line">5082</span><br><span class="line">5083</span><br><span class="line">5084</span><br><span class="line">5085</span><br><span class="line">5086</span><br><span class="line">5087</span><br><span class="line">5088</span><br><span class="line">5089</span><br><span class="line">5090</span><br><span class="line">5091</span><br><span class="line">5092</span><br><span class="line">5093</span><br><span class="line">5094</span><br><span class="line">5095</span><br><span class="line">5096</span><br><span class="line">5097</span><br><span class="line">5098</span><br><span class="line">5099</span><br><span class="line">5100</span><br><span class="line">5101</span><br><span class="line">5102</span><br><span class="line">5103</span><br><span class="line">5104</span><br><span class="line">5105</span><br><span class="line">5106</span><br><span class="line">5107</span><br><span class="line">5108</span><br><span class="line">5109</span><br><span class="line">5110</span><br><span class="line">5111</span><br><span class="line">5112</span><br><span class="line">5113</span><br><span class="line">5114</span><br><span class="line">5115</span><br><span class="line">5116</span><br><span class="line">5117</span><br><span class="line">5118</span><br><span class="line">5119</span><br><span class="line">5120</span><br><span class="line">5121</span><br><span class="line">5122</span><br><span class="line">5123</span><br><span class="line">5124</span><br><span class="line">5125</span><br><span class="line">5126</span><br><span class="line">5127</span><br><span class="line">5128</span><br><span class="line">5129</span><br><span class="line">5130</span><br><span class="line">5131</span><br><span class="line">5132</span><br><span class="line">5133</span><br><span class="line">5134</span><br><span class="line">5135</span><br><span class="line">5136</span><br><span class="line">5137</span><br><span class="line">5138</span><br><span class="line">5139</span><br><span class="line">5140</span><br><span class="line">5141</span><br><span class="line">5142</span><br><span class="line">5143</span><br><span class="line">5144</span><br><span class="line">5145</span><br><span class="line">5146</span><br><span class="line">5147</span><br><span class="line">5148</span><br><span class="line">5149</span><br><span class="line">5150</span><br><span class="line">5151</span><br><span class="line">5152</span><br><span class="line">5153</span><br><span class="line">5154</span><br><span class="line">5155</span><br><span class="line">5156</span><br><span class="line">5157</span><br><span class="line">5158</span><br><span class="line">5159</span><br><span class="line">5160</span><br><span class="line">5161</span><br><span class="line">5162</span><br><span class="line">5163</span><br><span class="line">5164</span><br><span class="line">5165</span><br><span class="line">5166</span><br><span class="line">5167</span><br><span class="line">5168</span><br><span class="line">5169</span><br><span class="line">5170</span><br><span class="line">5171</span><br><span class="line">5172</span><br><span class="line">5173</span><br><span class="line">5174</span><br><span class="line">5175</span><br><span class="line">5176</span><br><span class="line">5177</span><br><span class="line">5178</span><br><span class="line">5179</span><br><span class="line">5180</span><br><span class="line">5181</span><br><span class="line">5182</span><br><span class="line">5183</span><br><span class="line">5184</span><br><span class="line">5185</span><br><span class="line">5186</span><br><span class="line">5187</span><br><span class="line">5188</span><br><span class="line">5189</span><br><span class="line">5190</span><br><span class="line">5191</span><br><span class="line">5192</span><br><span class="line">5193</span><br><span class="line">5194</span><br><span class="line">5195</span><br><span class="line">5196</span><br><span class="line">5197</span><br><span class="line">5198</span><br><span class="line">5199</span><br><span class="line">5200</span><br><span class="line">5201</span><br><span class="line">5202</span><br><span class="line">5203</span><br><span class="line">5204</span><br><span class="line">5205</span><br><span class="line">5206</span><br><span class="line">5207</span><br><span class="line">5208</span><br><span class="line">5209</span><br><span class="line">5210</span><br><span class="line">5211</span><br><span class="line">5212</span><br><span class="line">5213</span><br><span class="line">5214</span><br><span class="line">5215</span><br><span class="line">5216</span><br><span class="line">5217</span><br><span class="line">5218</span><br><span class="line">5219</span><br><span class="line">5220</span><br><span class="line">5221</span><br><span class="line">5222</span><br><span class="line">5223</span><br><span class="line">5224</span><br><span class="line">5225</span><br><span class="line">5226</span><br><span class="line">5227</span><br><span class="line">5228</span><br><span class="line">5229</span><br><span class="line">5230</span><br><span class="line">5231</span><br><span class="line">5232</span><br><span class="line">5233</span><br><span class="line">5234</span><br><span class="line">5235</span><br><span class="line">5236</span><br><span class="line">5237</span><br><span class="line">5238</span><br><span class="line">5239</span><br><span class="line">5240</span><br><span class="line">5241</span><br><span class="line">5242</span><br><span class="line">5243</span><br><span class="line">5244</span><br><span class="line">5245</span><br><span class="line">5246</span><br><span class="line">5247</span><br><span class="line">5248</span><br><span class="line">5249</span><br><span class="line">5250</span><br><span class="line">5251</span><br><span class="line">5252</span><br><span class="line">5253</span><br><span class="line">5254</span><br><span class="line">5255</span><br><span class="line">5256</span><br><span class="line">5257</span><br><span class="line">5258</span><br><span class="line">5259</span><br><span class="line">5260</span><br><span class="line">5261</span><br><span class="line">5262</span><br><span class="line">5263</span><br><span class="line">5264</span><br><span class="line">5265</span><br><span class="line">5266</span><br><span class="line">5267</span><br><span class="line">5268</span><br><span class="line">5269</span><br><span class="line">5270</span><br><span class="line">5271</span><br><span class="line">5272</span><br><span class="line">5273</span><br><span class="line">5274</span><br><span class="line">5275</span><br><span class="line">5276</span><br><span class="line">5277</span><br><span class="line">5278</span><br><span class="line">5279</span><br><span class="line">5280</span><br><span class="line">5281</span><br><span class="line">5282</span><br><span class="line">5283</span><br><span class="line">5284</span><br><span class="line">5285</span><br><span class="line">5286</span><br><span class="line">5287</span><br><span class="line">5288</span><br><span class="line">5289</span><br><span class="line">5290</span><br><span class="line">5291</span><br><span class="line">5292</span><br><span class="line">5293</span><br><span class="line">5294</span><br><span class="line">5295</span><br><span class="line">5296</span><br><span class="line">5297</span><br><span class="line">5298</span><br><span class="line">5299</span><br><span class="line">5300</span><br><span class="line">5301</span><br><span class="line">5302</span><br><span class="line">5303</span><br><span class="line">5304</span><br><span class="line">5305</span><br><span class="line">5306</span><br><span class="line">5307</span><br><span class="line">5308</span><br><span class="line">5309</span><br><span class="line">5310</span><br><span class="line">5311</span><br><span class="line">5312</span><br><span class="line">5313</span><br><span class="line">5314</span><br><span class="line">5315</span><br><span class="line">5316</span><br><span class="line">5317</span><br><span class="line">5318</span><br><span class="line">5319</span><br><span class="line">5320</span><br><span class="line">5321</span><br><span class="line">5322</span><br><span class="line">5323</span><br><span class="line">5324</span><br><span class="line">5325</span><br><span class="line">5326</span><br><span class="line">5327</span><br><span class="line">5328</span><br><span class="line">5329</span><br><span class="line">5330</span><br><span class="line">5331</span><br><span class="line">5332</span><br><span class="line">5333</span><br><span class="line">5334</span><br><span class="line">5335</span><br><span class="line">5336</span><br><span class="line">5337</span><br><span class="line">5338</span><br><span class="line">5339</span><br><span class="line">5340</span><br><span class="line">5341</span><br><span class="line">5342</span><br><span class="line">5343</span><br><span class="line">5344</span><br><span class="line">5345</span><br><span class="line">5346</span><br><span class="line">5347</span><br><span class="line">5348</span><br><span class="line">5349</span><br><span class="line">5350</span><br><span class="line">5351</span><br><span class="line">5352</span><br><span class="line">5353</span><br><span class="line">5354</span><br><span class="line">5355</span><br><span class="line">5356</span><br><span class="line">5357</span><br><span class="line">5358</span><br><span class="line">5359</span><br><span class="line">5360</span><br><span class="line">5361</span><br><span class="line">5362</span><br><span class="line">5363</span><br><span class="line">5364</span><br><span class="line">5365</span><br><span class="line">5366</span><br><span class="line">5367</span><br><span class="line">5368</span><br><span class="line">5369</span><br><span class="line">5370</span><br><span class="line">5371</span><br><span class="line">5372</span><br><span class="line">5373</span><br><span class="line">5374</span><br><span class="line">5375</span><br><span class="line">5376</span><br><span class="line">5377</span><br><span class="line">5378</span><br><span class="line">5379</span><br><span class="line">5380</span><br><span class="line">5381</span><br><span class="line">5382</span><br><span class="line">5383</span><br><span class="line">5384</span><br><span class="line">5385</span><br><span class="line">5386</span><br><span class="line">5387</span><br><span class="line">5388</span><br><span class="line">5389</span><br><span class="line">5390</span><br><span class="line">5391</span><br><span class="line">5392</span><br><span class="line">5393</span><br><span class="line">5394</span><br><span class="line">5395</span><br><span class="line">5396</span><br><span class="line">5397</span><br><span class="line">5398</span><br><span class="line">5399</span><br><span class="line">5400</span><br><span class="line">5401</span><br><span class="line">5402</span><br><span class="line">5403</span><br><span class="line">5404</span><br><span class="line">5405</span><br><span class="line">5406</span><br><span class="line">5407</span><br><span class="line">5408</span><br><span class="line">5409</span><br><span class="line">5410</span><br><span class="line">5411</span><br><span class="line">5412</span><br><span class="line">5413</span><br><span class="line">5414</span><br><span class="line">5415</span><br><span class="line">5416</span><br><span class="line">5417</span><br><span class="line">5418</span><br><span class="line">5419</span><br><span class="line">5420</span><br><span class="line">5421</span><br><span class="line">5422</span><br><span class="line">5423</span><br><span class="line">5424</span><br><span class="line">5425</span><br><span class="line">5426</span><br><span class="line">5427</span><br><span class="line">5428</span><br><span class="line">5429</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## Author: SuperManito</span></span><br><span class="line"><span class="comment">## Modified: 2024-06-07</span></span><br><span class="line"><span class="comment">## License: MIT</span></span><br><span class="line"><span class="comment">## GitHub: https://github.com/SuperManito/LinuxMirrors</span></span><br><span class="line"><span class="comment">## Website: https://linuxmirrors.cn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 软件源列表</span></span><br><span class="line"><span class="comment"># 国内格式：&quot;软件源名称@软件源地址&quot;</span></span><br><span class="line">mirror_list_default=(</span><br><span class="line">    <span class="string">&quot;阿里云@mirrors.aliyun.com&quot;</span></span><br><span class="line">    <span class="string">&quot;腾讯云@mirrors.tencent.com&quot;</span></span><br><span class="line">    <span class="string">&quot;华为云@repo.huaweicloud.com&quot;</span></span><br><span class="line">    <span class="string">&quot;网易@mirrors.163.com&quot;</span></span><br><span class="line">    <span class="string">&quot;搜狐@mirrors.sohu.com&quot;</span></span><br><span class="line">    <span class="string">&quot;火山引擎@mirrors.volces.com&quot;</span></span><br><span class="line">    <span class="string">&quot;清华大学@mirrors.tuna.tsinghua.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;北京大学@mirrors.pku.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;浙江大学@mirrors.zju.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南京大学@mirrors.nju.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;兰州大学@mirror.lzu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;上海交通大学@mirror.sjtu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;重庆邮电大学@mirrors.cqupt.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;中国科学技术大学@mirrors.ustc.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;中国科学院软件研究所@mirror.iscas.ac.cn&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 海外格式：&quot;洲 · 软件源名称 · 国家/地区@软件源地址&quot;，修改前请先前往官网阅读添加规范</span></span><br><span class="line">mirror_list_abroad=(</span><br><span class="line">    <span class="string">&quot;亚洲 · xTom · 香港@mirrors.xtom.hk&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 01Link · 香港@mirror.01link.hk&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 新加坡国立大学(NUS) · 新加坡@download.nus.edu.sg/mirror&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · SG.GS · 新加坡@mirror.sg.gs&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · Neo Soon Keat · 新加坡@mirror.soonkeat.sg&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 自由软件实验室(NCHC) · 台湾@free.nchc.org.tw&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · OSS Planet · 台湾@mirror.ossplanet.net&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 国立阳明交通大学 · 台湾@linux.cs.nctu.edu.tw&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 淡江大学 · 台湾@ftp.tku.edu.tw&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · AniGil Linux Archive · 韩国@mirror.anigil.com&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 工业网络安全中心(ICSCoE) · 日本@ftp.udx.icscoe.jp/Linux&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · Internet Initiative Japan(IIJ) · 日本@ftp.iij.ad.jp/pub/linux&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 北陆先端科学技术大学院大学(JAIST) · 日本@ftp.jaist.ac.jp/pub/Linux&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 山形大学 · 日本@linux2.yz.yamagata-u.ac.jp/pub/Linux&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · xTom · 日本@mirrors.xtom.jp&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · GB Network Solutions · 马来西亚@mirrors.gbnetwork.com&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · 孔敬大学 · 泰国@mirror.kku.ac.th&quot;</span></span><br><span class="line">    <span class="string">&quot;亚洲 · RISE · 菲律宾@mirror.rise.ph&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Vorboss Ltd · 英国@mirror.vorboss.net&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · QuickHost · 英国@mirror.quickhost.uk&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · dogado · 德国@mirror.dogado.de&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · xTom · 德国@mirrors.xtom.de&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 亚琛工业大学(RWTH Aachen) · 德国@ftp.halifax.rwth-aachen.de&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 德累斯顿大学(AG DSN) · 德国@ftp.agdsn.de&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · CCIN2P3 · 法国@mirror.in2p3.fr/pub/linux&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Ircam · 法国@mirrors.ircam.fr/pub&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Crans · 法国@eclats.crans.org&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · CRIHAN · 法国@ftp.crihan.fr&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · xTom · 荷兰@mirrors.xtom.nl&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · DataPacket · 荷兰@mirror.datapacket.com&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Linux Kernel · 荷兰@eu.edge.kernel.org&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · xTom · 爱沙尼亚@mirrors.xtom.ee&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · netsite · 丹麦@mirror.netsite.dk&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Dotsrc · 丹麦@mirrors.dotsrc.org&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Academic Computer Club · 瑞典@mirror.accum.se&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Lysator · 瑞典@ftp.lysator.liu.se&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Yandex · 俄罗斯@mirror.yandex.ru&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · ia64 · 俄罗斯@mirror.linux-ia64.org&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Truenetwork · 俄罗斯@mirror.truenetwork.ru&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Belgian Research Network · 比利时@ftp.belnet.be/mirror&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 克里特大学计算机中心 · 希腊@ftp.cc.uoc.gr/mirrors/linux&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 马萨里克大学信息学院 · 捷克@ftp.fi.muni.cz/pub/linux&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 捷克理工大学学生会俱乐部(Silicon Hill) · 捷克@ftp.sh.cvut.cz&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · Vodafone · 捷克@mirror.karneval.cz/pub/linux&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · CZ.NIC · 捷克@mirrors.nic.cz&quot;</span></span><br><span class="line">    <span class="string">&quot;欧洲 · 苏黎世联邦理工学院 · 瑞士@mirror.ethz.ch&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · Linux Kernel · 美国@mirrors.kernel.org&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · 麻省理工学院(MIT) · 美国@mirrors.mit.edu&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · 普林斯顿大学数学系 · 美国@mirror.math.princeton.edu/pub&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · 俄勒冈州立大学开源实验室 · 美国@ftp-chi.osuosl.org/pub&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · Fremont Cabal Internet Exchange(FCIX) · 美国@mirror.fcix.net&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · xTom · 美国@mirrors.xtom.com&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · Steadfast · 美国@mirror.steadfast.net&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · 不列颠哥伦比亚大学 · 加拿大@mirror.it.ubc.ca&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · GoCodeIT · 加拿大@mirror.xenyth.net&quot;</span></span><br><span class="line">    <span class="string">&quot;北美 · Switch · 加拿大@mirrors.switch.ca&quot;</span></span><br><span class="line">    <span class="string">&quot;南美 · PoP-SC · 巴西@mirror.pop-sc.rnp.br/mirror&quot;</span></span><br><span class="line">    <span class="string">&quot;南美 · 蓬塔格罗萨州立大学 · 巴西@mirror.uepg.br&quot;</span></span><br><span class="line">    <span class="string">&quot;南美 · UFSCar · 巴西@mirror.ufscar.br&quot;</span></span><br><span class="line">    <span class="string">&quot;南美 · Sysarmy Community · 阿根廷@mirrors.eze.sysarmy.com&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · Fremont Cabal Internet Exchange(FCIX) · 澳大利亚@gsl-syd.mm.fcix.net&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · AARNet · 澳大利亚@mirror.aarnet.edu.au/pub&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · DataMossa · 澳大利亚@mirror.datamossa.io&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · Amaze · 澳大利亚@mirror.amaze.com.au&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · xTom · 澳大利亚@mirrors.xtom.au&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · Over the Wire · 澳大利亚@mirror.overthewire.com.au&quot;</span></span><br><span class="line">    <span class="string">&quot;大洋 · Free Software Mirror Group · 新西兰@mirror.fsmg.org.nz&quot;</span></span><br><span class="line">    <span class="string">&quot;非洲 · Liquid Telecom · 肯尼亚@mirror.liquidtelecom.com&quot;</span></span><br><span class="line">    <span class="string">&quot;非洲 · Dimension Data · 南非@mirror.dimensiondata.com&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 中国大陆教育网格式：&quot;软件源名称@软件源地址&quot;</span></span><br><span class="line">mirror_list_edu=(</span><br><span class="line">    <span class="string">&quot;清华大学@mirrors.tuna.tsinghua.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;北京大学@mirrors.pku.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南京大学@mirrors.nju.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;重庆大学@mirrors.cqu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;兰州大学@mirror.lzu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;浙江大学@mirrors.zju.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;山东大学@mirrors.sdu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;吉林大学@mirrors.jlu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;上海交通大学@mirror.sjtu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;上海科技大学@mirrors.shanghaitech.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南方科技大学@mirrors.sustech.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南京邮电大学@mirrors.njupt.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南京工业大学@mirrors.njtech.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;电子科技大学@mirrors.uestc.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;北京交通大学@mirror.bjtu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;北京邮电大学@mirrors.bupt.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;齐鲁工业大学@mirrors.qlu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;华南农业大学@mirrors.scau.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;西安交通大学@mirrors.xjtu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;江西理工大学@mirrors.jxust.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;重庆邮电大学@mirrors.cqupt.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;南阳理工学院@mirror.nyist.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;武昌首义学院@mirrors.wsyu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;北京外国语大学@mirrors.bfsu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;中国科学技术大学@mirrors.ustc.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;西北农林科技大学@mirrors.nwafu.edu.cn&quot;</span></span><br><span class="line">    <span class="string">&quot;大连东软信息学院@mirrors.neusoft.edu.cn&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置需要区分公网地址和内网地址的软件源（不分地域）</span></span><br><span class="line"><span class="comment"># 配置方法：需要同时在两个数组变量中分别定义软件源地址，并且保证排列顺序一致</span></span><br><span class="line"><span class="comment"># 工作原理：当检测到用户所选择的软件源地址在 “软件源公网地址列表” 中时就会询问是否切换为内网地址，然后在 “软件源内网地址列表” 从相同的位置提取内网地址</span></span><br><span class="line"><span class="comment"># 软件源公网地址列表</span></span><br><span class="line">mirror_list_extranet=(</span><br><span class="line">    <span class="string">&quot;mirrors.aliyun.com&quot;</span></span><br><span class="line">    <span class="string">&quot;mirrors.tencent.com&quot;</span></span><br><span class="line">    <span class="string">&quot;repo.huaweicloud.com&quot;</span></span><br><span class="line">    <span class="string">&quot;mirrors.volces.com&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 软件源内网地址列表</span></span><br><span class="line">mirror_list_intranet=(</span><br><span class="line">    <span class="string">&quot;mirrors.cloud.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">&quot;mirrors.tencentyun.com&quot;</span></span><br><span class="line">    <span class="string">&quot;mirrors.myhuaweicloud.com&quot;</span></span><br><span class="line">    <span class="string">&quot;mirrors.ivolces.com&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义系统判定变量</span></span><br><span class="line">SYSTEM_DEBIAN=<span class="string">&quot;Debian&quot;</span></span><br><span class="line">SYSTEM_UBUNTU=<span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">SYSTEM_KALI=<span class="string">&quot;Kali&quot;</span></span><br><span class="line">SYSTEM_DEEPIN=<span class="string">&quot;Deepin&quot;</span></span><br><span class="line">SYSTEM_REDHAT=<span class="string">&quot;RedHat&quot;</span></span><br><span class="line">SYSTEM_RHEL=<span class="string">&quot;Red Hat Enterprise Linux&quot;</span></span><br><span class="line">SYSTEM_CENTOS=<span class="string">&quot;CentOS&quot;</span></span><br><span class="line">SYSTEM_CENTOS_STREAM=<span class="string">&quot;CentOS Stream&quot;</span></span><br><span class="line">SYSTEM_ROCKY=<span class="string">&quot;Rocky&quot;</span></span><br><span class="line">SYSTEM_ALMALINUX=<span class="string">&quot;AlmaLinux&quot;</span></span><br><span class="line">SYSTEM_FEDORA=<span class="string">&quot;Fedora&quot;</span></span><br><span class="line">SYSTEM_OPENCLOUDOS=<span class="string">&quot;OpenCloudOS&quot;</span></span><br><span class="line">SYSTEM_OPENEULER=<span class="string">&quot;openEuler&quot;</span></span><br><span class="line">SYSTEM_OPENSUSE=<span class="string">&quot;openSUSE&quot;</span></span><br><span class="line">SYSTEM_ARCH=<span class="string">&quot;Arch&quot;</span></span><br><span class="line">SYSTEM_ALPINE=<span class="string">&quot;Alpine&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义系统版本文件</span></span><br><span class="line">File_LinuxRelease=/etc/os-release</span><br><span class="line">File_RedHatRelease=/etc/redhat-release</span><br><span class="line">File_DebianVersion=/etc/debian_version</span><br><span class="line">File_ArmbianRelease=/etc/armbian-release</span><br><span class="line">File_OpenCloudOSRelease=/etc/opencloudos-release</span><br><span class="line">File_openEulerRelease=/etc/openEuler-release</span><br><span class="line">File_ArchRelease=/etc/arch-release</span><br><span class="line">File_AlpineRelease=/etc/alpine-release</span><br><span class="line">File_ProxmoxVersion=/etc/pve/.version</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义软件源相关文件或目录</span></span><br><span class="line">File_DebianSourceList=/etc/apt/sources.list</span><br><span class="line">File_DebianSourceListBackup=/etc/apt/sources.list.bak</span><br><span class="line">File_DebianSources=/etc/apt/sources.list.d/debian.sources</span><br><span class="line">File_DebianSourcesBackup=/etc/apt/sources.list.d/debian.sources.bak</span><br><span class="line">File_UbuntuSources=/etc/apt/sources.list.d/ubuntu.sources</span><br><span class="line">File_UbuntuSourcesBackup=/etc/apt/sources.list.d/ubuntu.sources.bak</span><br><span class="line">File_ArmbianSourceList=/etc/apt/sources.list.d/armbian.list</span><br><span class="line">File_ArmbianSourceListBackup=/etc/apt/sources.list.d/armbian.list.bak</span><br><span class="line">File_ProxmoxSourceList=/etc/apt/sources.list.d/pve-no-subscription.list</span><br><span class="line">File_ProxmoxSourceListBackup=/etc/apt/sources.list.d/pve-no-subscription.list.bak</span><br><span class="line">Dir_DebianExtendSource=/etc/apt/sources.list.d</span><br><span class="line">Dir_DebianExtendSourceBackup=/etc/apt/sources.list.d.bak</span><br><span class="line">File_ArchMirrorList=/etc/pacman.d/mirrorlist</span><br><span class="line">File_ArchMirrorListBackup=/etc/pacman.d/mirrorlist.bak</span><br><span class="line">File_AlpineRepositories=/etc/apk/repositories</span><br><span class="line">File_AlpineRepositoriesBackup=/etc/apk/repositories.bak</span><br><span class="line">Dir_YumRepos=/etc/yum.repos.d</span><br><span class="line">Dir_YumReposBackup=/etc/yum.repos.d.bak</span><br><span class="line">Dir_openSUSERepos=/etc/zypp/repos.d</span><br><span class="line">Dir_openSUSEReposBackup=/etc/zypp/repos.d.bak</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义颜色变量</span></span><br><span class="line">RED=<span class="string">&#x27;\033[31m&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;\033[32m&#x27;</span></span><br><span class="line">YELLOW=<span class="string">&#x27;\033[33m&#x27;</span></span><br><span class="line">BLUE=<span class="string">&#x27;\033[34m&#x27;</span></span><br><span class="line">PURPLE=<span class="string">&#x27;\033[35m&#x27;</span></span><br><span class="line">AZURE=<span class="string">&#x27;\033[36m&#x27;</span></span><br><span class="line">PLAIN=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">BOLD=<span class="string">&#x27;\033[1m&#x27;</span></span><br><span class="line">SUCCESS=<span class="string">&quot;[\033[1;32m成功<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">COMPLETE=<span class="string">&quot;[\033[1;32m完成<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">WARN=<span class="string">&quot;[\033[1;5;33m注意<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">ERROR=<span class="string">&quot;[\033[1;31m错误<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">FAIL=<span class="string">&quot;[\033[1;31m失败<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">TIP=<span class="string">&quot;[\033[1;32m提示<span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line">WORKING=<span class="string">&quot;[\033[1;36m &gt;_ <span class="variable">$&#123;PLAIN&#125;</span>]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">StartTitle</span></span>() &#123;</span><br><span class="line">    [ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span> ] &amp;&amp; clear</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; +-----------------------------------+&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot; | \033[0;1;35;95m⡇\033[0m  \033[0;1;33;93m⠄\033[0m \033[0;1;32;92m⣀⡀\033[0m \033[0;1;36;96m⡀\033[0;1;34;94m⢀\033[0m \033[0;1;35;95m⡀⢀\033[0m \033[0;1;31;91m⡷\033[0;1;33;93m⢾\033[0m \033[0;1;32;92m⠄\033[0m \033[0;1;36;96m⡀⣀\033[0m \033[0;1;34;94m⡀\033[0;1;35;95m⣀\033[0m \033[0;1;31;91m⢀⡀\033[0m \033[0;1;33;93m⡀\033[0;1;32;92m⣀\033[0m \033[0;1;36;96m⢀⣀\033[0m |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot; | \033[0;1;31;91m⠧\033[0;1;33;93m⠤\033[0m \033[0;1;32;92m⠇\033[0m \033[0;1;36;96m⠇⠸\033[0m \033[0;1;34;94m⠣\033[0;1;35;95m⠼\033[0m \033[0;1;31;91m⠜⠣\033[0m \033[0;1;33;93m⠇\033[0;1;32;92m⠸\033[0m \033[0;1;36;96m⠇\033[0m \033[0;1;34;94m⠏\033[0m  \033[0;1;35;95m⠏\033[0m  \033[0;1;33;93m⠣⠜\033[0m \033[0;1;32;92m⠏\033[0m  \033[0;1;34;94m⠭⠕\033[0m |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; +-----------------------------------+&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; 欢迎使用 GNU/Linux 更换系统软件源脚本&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 报错退出</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Output_Error</span></span>() &#123;</span><br><span class="line">    [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$ERROR</span> <span class="variable">$1</span>\n&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 权限判定</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PermissionJudgment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$UID</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;权限不足，请使用 Root 用户运行本脚本&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 系统判定变量</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">EnvJudgment</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 定义系统名称</span></span><br><span class="line">    SYSTEM_NAME=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^NAME=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> <span class="variable">$File_LinuxRelease</span> | grep <span class="string">&quot;PRETTY_NAME=&quot;</span> -q</span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; SYSTEM_PRETTY_NAME=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^PRETTY_NAME=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 定义系统版本号</span></span><br><span class="line">    SYSTEM_VERSION_NUMBER=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^VERSION_ID=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 定义系统ID</span></span><br><span class="line">    SYSTEM_ID=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^ID=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="comment">## 判定当前系统派系</span></span><br><span class="line">    <span class="keyword">if</span> [ -s <span class="variable">$File_DebianVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_openEulerRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="variable">$File_ArchRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="variable">$File_AlpineRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_RedHatRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> <span class="comment"># 注：RedHat 判断优先级需要高于 OpenCloudOS，因为8版本基于红帽而9版本不是</span></span><br><span class="line">    <span class="keyword">elif</span> [ -s <span class="variable">$File_OpenCloudOSRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_NAME&#125;</span>&quot;</span> == *<span class="string">&quot;openSUSE&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">        SYSTEM_FACTIONS=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Output_Error <span class="string">&quot;无法判断当前运行环境，当前系统不在本脚本的支持范围内&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 判定系统名称、版本、版本号</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [ ! -x /usr/bin/lsb_release ]; <span class="keyword">then</span></span><br><span class="line">            apt-get install -y lsb-release</span><br><span class="line">            <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                Output_Error <span class="string">&quot;lsb-release 软件包安装失败\n\n本脚本需要通过 lsb_release 指令判断系统具体类型和版本，当前系统可能为精简安装，请自行安装后重新执行脚本！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="subst">$(lsb_release -is)</span>&quot;</span></span><br><span class="line">        SYSTEM_VERSION_CODENAME=<span class="string">&quot;<span class="variable">$&#123;DEBIAN_CODENAME:-&quot;$(lsb_release -cs)&quot;&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span>)</span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="subst">$(awk &#x27;&#123;printf $1&#125;&#x27; $File_RedHatRelease)</span>&quot;</span></span><br><span class="line">        <span class="comment">## Red Hat Enterprise Linux</span></span><br><span class="line">        grep -q <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span> <span class="variable">$File_RedHatRelease</span> &amp;&amp; SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment">## CentOS Stream</span></span><br><span class="line">        grep -q <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span> <span class="variable">$File_RedHatRelease</span> &amp;&amp; SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        SYSTEM_JUDGMENT=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 判断系统和其版本是否受本脚本支持</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span> != [8-9] &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != 1[0-3] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != 1[4-9] &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != 2[0-4] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span> != [7-9] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span> != [7-8] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span> != [8-9] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != [3-4][0-9] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != 2[1-3] ]]; <span class="keyword">then</span></span><br><span class="line">            Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ID&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;opensuse-leap&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:2&#125;</span>&quot;</span> != 15 ]]; <span class="keyword">then</span></span><br><span class="line">                Output_Error <span class="string">&quot;当前系统版本不在本脚本的支持范围内&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;opensuse-tumbleweed&quot;</span>) ;;</span><br><span class="line">        *)</span><br><span class="line">            Output_Error <span class="string">&quot;当前系统不在本脚本的支持范围内&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_KALI&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEEPIN&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 理论全部支持或不作判断</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不在本脚本的支持范围内&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 判定系统处理器架构</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="subst">$(uname -m)</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    x86_64)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;x86_64&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    aarch64)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;ARM64&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    armv7l)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;ARMv7&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    armv6l)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;ARMv6&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    i686)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;x86_32&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        DEVICE_ARCH=<span class="string">&quot;<span class="subst">$(uname -m)</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 定义软件源分支名称</span></span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment">## 默认为系统名称小写，替换空格</span></span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT,,&#125;</span>&quot;</span></span><br><span class="line">        SOURCE_BRANCH=<span class="string">&quot;<span class="variable">$&#123;SOURCE_BRANCH// /-&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment">## 处理特殊的分支名称</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            8 | 9)</span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;debian-archive&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;debian&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            9)</span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;rocky&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;centos&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == <span class="string">&quot;x86_64&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;centos&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;centos-altarch&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            8)</span><br><span class="line">                <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == <span class="string">&quot;x86_64&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    SOURCE_BRANCH=<span class="string">&quot;centos&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE_BRANCH=<span class="string">&quot;centos-altarch&quot;</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;centos-stream&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == <span class="string">&quot;x86_64&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == *i?86* ]]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;ubuntu&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;ubuntu-ports&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == <span class="string">&quot;x86_64&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span> == *i?86* ]]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;archlinux&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;archlinuxarm&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 定义软件源更新文字</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;更新软件源&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;生成软件源缓存&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;刷新软件源&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;同步软件源&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        SYNC_MIRROR_TEXT=<span class="string">&quot;更新软件源&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 命令选项兼容性判断</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CheckCommandOptions</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_ABROAD_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;USE_EDU_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;两种模式不可同时使用！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$&#123;SOURCE_SECURITY&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> || <span class="string">&quot;<span class="variable">$&#123;SOURCE_BRANCH_SECURITY&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不支持使用 security 仓库相关命令选项，请确认后重试！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$&#123;DEBIAN_CODENAME&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不支持使用指定版本代号命令选项，请确认后重试！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> || <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_EPEL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> || <span class="string">&quot;<span class="variable">$&#123;ONLY_EPEL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不支持安装 EPEL 附件软件包故无法使用相关命令选项，请确认后重试！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$&#123;SOURCE_VAULT&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> || <span class="string">&quot;<span class="variable">$&#123;SOURCE_BRANCH_VAULT&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        Output_Error <span class="string">&quot;当前系统不支持使用 vault 仓库相关命令选项，请确认后重试！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选择软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ChooseMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 打印软件源列表</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">PrintMirrorsList</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> tmp_mirror_name tmp_mirror_url arr_num default_mirror_name_length tmp_mirror_name_length tmp_spaces_nums a i j</span><br><span class="line">        <span class="comment">## 计算字符串长度</span></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">StringLength</span></span>() &#123;</span><br><span class="line">            <span class="built_in">local</span> text=<span class="variable">$1</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;#text&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">local</span> list_arr=()</span><br><span class="line">        <span class="built_in">local</span> list_arr_sum</span><br><span class="line">        list_arr_sum=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;#$1[@]&#125;)</span>&quot;</span></span><br><span class="line">        <span class="keyword">for</span> ((a = <span class="number">0</span>; a &lt; <span class="variable">$list_arr_sum</span>; a++)); <span class="keyword">do</span></span><br><span class="line">            list_arr[<span class="variable">$a</span>]=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$1[a]&#125;)</span>&quot;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [ -x /usr/bin/printf ]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">for</span> ((i = <span class="number">0</span>; i &lt; <span class="variable">$&#123;#list_arr[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                tmp_mirror_name=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$1&#125;&#x27;</span>) <span class="comment"># 软件源名称</span></span><br><span class="line">                <span class="comment"># tmp_mirror_url=$(echo &quot;$&#123;list_arr[i]&#125;&quot; | awk -F &#x27;@&#x27; &#x27;&#123;print$2&#125;&#x27;) # 软件源地址</span></span><br><span class="line">                arr_num=$((i + <span class="number">1</span>))</span><br><span class="line">                default_mirror_name_length=<span class="variable">$&#123;2:-&quot;30&quot;&#125;</span> <span class="comment"># 默认软件源名称打印长度</span></span><br><span class="line">                <span class="comment">## 补齐长度差异（中文的引号在等宽字体中占1格而非2格）</span></span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;“&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;“&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;”&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;”&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;‘&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;‘&quot;</span>)</span><br><span class="line">                [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;’&quot;</span>) -gt 0 ]] &amp;&amp; <span class="built_in">let</span> default_mirror_name_length+=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> | grep -c <span class="string">&quot;’&quot;</span>)</span><br><span class="line">                <span class="comment"># 非一般字符长度</span></span><br><span class="line">                tmp_mirror_name_length=$(StringLength <span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name// /&#125;</span>&quot;</span> | sed <span class="string">&quot;s|[0-9a-zA-Z\.\=\:\_\(\)\&#x27;\&quot;-\/\!·]||g;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                <span class="comment">## 填充空格</span></span><br><span class="line">                tmp_spaces_nums=$(($((default_mirror_name_length - tmp_mirror_name_length - $(StringLength &quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;))) / 2))</span><br><span class="line">                <span class="keyword">for</span> ((j = <span class="number">1</span>; j &lt;= <span class="variable">$&#123;tmp_spaces_nums&#125;</span>; j++)); <span class="keyword">do</span></span><br><span class="line">                    tmp_mirror_name=<span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span> &quot;</span></span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot; ❖  %-<span class="subst">$((default_mirror_name_length + tmp_mirror_name_length)</span>)s %4s\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$arr_num</span>)&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">for</span> ((i = <span class="number">0</span>; i &lt; <span class="variable">$&#123;#list_arr[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                tmp_mirror_name=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$1&#125;&#x27;</span>) <span class="comment"># 软件源名称</span></span><br><span class="line">                tmp_mirror_url=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;list_arr[i]&#125;</span>&quot;</span> | awk -F <span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print$2&#125;&#x27;</span>)  <span class="comment"># 软件源地址</span></span><br><span class="line">                arr_num=$((i + <span class="number">1</span>))</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot; ❖  <span class="variable">$arr_num</span>. <span class="variable">$&#123;tmp_mirror_url&#125;</span> | <span class="variable">$&#123;tmp_mirror_name&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 选择软件源内网地址</span></span><br><span class="line">    <span class="comment"># 例如部分云计算厂商的镜像站区分外网（公网）地址和内网地址，内网地址仅面向云计算厂商云服务器用户使用</span></span><br><span class="line">    <span class="comment"># 内网地址一般不支持使用 HTTPS 协议，所以默认设置为 HTTP 协议</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">ChooseMirrorIntranetAddress</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> intranet_source</span><br><span class="line">        <span class="keyword">for</span> ((i = <span class="number">0</span>; i &lt; <span class="variable">$&#123;#mirror_list_extranet[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;mirror_list_extranet[i]&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># echo &quot;$&#123;SOURCE&#125;&quot;</span></span><br><span class="line">                intranet_source=<span class="string">&quot;<span class="variable">$&#123;mirror_list_intranet[i]&#125;</span>&quot;</span></span><br><span class="line">                <span class="comment"># echo &quot;$&#123;intranet_source&#125;&quot;</span></span><br><span class="line">                <span class="comment"># exit</span></span><br><span class="line">                ONLY_HTTP=<span class="string">&quot;True&quot;</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;USE_INTRANET_SOURCE&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE</span><br><span class="line">            CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 默认使用软件源的公网地址，是否继续? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss]) ;;</span><br><span class="line">            [Nn] | [Nn][Oo])</span><br><span class="line">                SOURCE=<span class="string">&quot;<span class="variable">$&#123;intranet_source&#125;</span>&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 已切换至内网专用地址，仅限在特定环境下使用！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不使用内网地址！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_INTRANET_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            SOURCE=<span class="string">&quot;<span class="variable">$&#123;intranet_source&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Title</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> system_name=<span class="string">&quot;<span class="variable">$&#123;SYSTEM_PRETTY_NAME:-&quot;<span class="variable">$&#123;SYSTEM_NAME&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER&#125;</span>&quot;&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">local</span> <span class="built_in">arch</span>=<span class="string">&quot;<span class="variable">$&#123;DEVICE_ARCH&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">local</span> date_time time_zone</span><br><span class="line">        date_time=<span class="string">&quot;<span class="subst">$(date <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span>&quot;</span></span><br><span class="line">        time_zone=<span class="string">&quot;<span class="subst">$(timedatectl status 2&gt;/dev/null | grep <span class="string">&quot;Time zone&quot;</span> | awk -F &#x27;:&#x27; &#x27;&#123;print$2&#125;&#x27; | awk -F &#x27; &#x27; &#x27;&#123;print$1&#125;&#x27;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot; 运行环境 <span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;system_name&#125;</span> <span class="variable">$&#123;arch&#125;</span><span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot; 系统时间 <span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;date_time&#125;</span> <span class="variable">$&#123;time_zone&#125;</span><span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Title</span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment">## 使用官方源</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$&#123;USE_ABROAD_SOURCE&#125;</span> = <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> mirror_list_name=<span class="string">&quot;mirror_list_abroad&quot;</span></span><br><span class="line">            PrintMirrorsList <span class="string">&quot;<span class="variable">$&#123;mirror_list_name&#125;</span>&quot;</span> 60</span><br><span class="line">        <span class="keyword">elif</span> [[ <span class="variable">$&#123;USE_EDU_SOURCE&#125;</span> = <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> mirror_list_name=<span class="string">&quot;mirror_list_edu&quot;</span></span><br><span class="line">            PrintMirrorsList <span class="string">&quot;<span class="variable">$&#123;mirror_list_name&#125;</span>&quot;</span> 31</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">local</span> mirror_list_name=<span class="string">&quot;mirror_list_default&quot;</span></span><br><span class="line">            PrintMirrorsList <span class="string">&quot;<span class="variable">$&#123;mirror_list_name&#125;</span>&quot;</span> 31</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">local</span> CHOICE</span><br><span class="line">        CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 请选择并输入你想使用的软件源 [ 1-<span class="subst">$(eval echo \$&#123;#$mirror_list_name[@]&#125;)</span> ]：<span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [1-9] | [1-9][0-9] | [1-9][0-9][0-9])</span><br><span class="line">                <span class="built_in">local</span> tmp_source</span><br><span class="line">                tmp_source=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$((INPUT - 1)</span>)]&#125;)&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;tmp_source&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入有效的数字序号！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE=<span class="string">&quot;<span class="subst">$(eval echo \$&#123;$&#123;mirror_list_name&#125;[$((INPUT - 1)</span>)]&#125; | awk -F &#x27;@&#x27; &#x27;&#123;print<span class="variable">$2</span>&#125;&#x27;)&quot;</span></span><br><span class="line">                    <span class="comment"># echo &quot;$&#123;SOURCE&#125;&quot;</span></span><br><span class="line">                    <span class="comment"># exit</span></span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 请输入数字序号以选择你想使用的软件源！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 选择软件源内网地址</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;mirror_list_extranet[*]&#125;</span>&quot;</span> =~ (^|[^[:alpha:]])<span class="string">&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;</span>([^[:alpha:]]|$) ]]; <span class="keyword">then</span></span><br><span class="line">        ChooseMirrorIntranetAddress</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选择同步软件源所使用的 WEB 协议（ HTTP：80 端口，HTTPS：443 端口）</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ChooseWebProtocol</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;ONLY_HTTP&#125;</span>&quot;</span> == <span class="string">&quot;True&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            WEB_PROTOCOL=<span class="string">&quot;http&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE</span><br><span class="line">            CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 软件源是否使用 HTTP 协议? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss])</span><br><span class="line">                WEB_PROTOCOL=<span class="string">&quot;http&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            [Nn] | [Nn][Oo])</span><br><span class="line">                WEB_PROTOCOL=<span class="string">&quot;https&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认使用 HTTPS 协议！&quot;</span></span><br><span class="line">                WEB_PROTOCOL=<span class="string">&quot;https&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    WEB_PROTOCOL=<span class="string">&quot;<span class="variable">$&#123;WEB_PROTOCOL,,&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 适用于部分红帽系统的 EPEL 附加软件包（安装/换源）</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ChooseInstallEPEL</span></span>() &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">CheckInstallStatus</span></span>() &#123;</span><br><span class="line">        <span class="comment">## 判断是否已安装 EPEL 软件包</span></span><br><span class="line">        rpm -qa | grep epel-release -q</span><br><span class="line">        VERIFICATION_EPEL=$?</span><br><span class="line">        <span class="comment">## 判断 /etc/yum.repos.d 目录下是否存在 epel 附加软件包 repo 源文件</span></span><br><span class="line">        [ -d <span class="variable">$Dir_YumRepos</span> ] &amp;&amp; <span class="built_in">ls</span> <span class="variable">$Dir_YumRepos</span> | grep epel -q</span><br><span class="line">        VERIFICATION_EPELFILES=$?</span><br><span class="line">        <span class="comment">## 判断 /etc/yum.repos.d.bak 目录下是否存在 epel 附加软件包 repo 源文件</span></span><br><span class="line">        [ -d <span class="variable">$Dir_YumReposBackup</span> ] &amp;&amp; <span class="built_in">ls</span> <span class="variable">$Dir_YumReposBackup</span> | grep epel -q</span><br><span class="line">        VERIFICATION_EPELBACKUPFILES=$?</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;INSTALL_EPEL&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">                CheckInstallStatus</span><br><span class="line">                <span class="keyword">if</span> [ <span class="variable">$&#123;VERIFICATION_EPEL&#125;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">local</span> CHOICE</span><br><span class="line">                    CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到系统已安装 EPEL 附加软件包，是否替换/覆盖软件源? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">local</span> CHOICE</span><br><span class="line">                    CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否安装 EPEL 附加软件包? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">                [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Yy] | [Yy][Ee][Ss])</span><br><span class="line">                    INSTALL_EPEL=<span class="string">&quot;true&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                [Nn] | [Nn][Oo])</span><br><span class="line">                    INSTALL_EPEL=<span class="string">&quot;false&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不更换！&quot;</span></span><br><span class="line">                    INSTALL_EPEL=<span class="string">&quot;false&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_EPEL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            CheckInstallStatus</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭防火墙和SELinux</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CloseFirewall</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -x /usr/bin/systemctl ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="subst">$(systemctl is-active firewalld)</span>&quot;</span> == <span class="string">&quot;active&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;CLOSE_FIREWALL&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE</span><br><span class="line">            CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否关闭防火墙和 SELinux ? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss])</span><br><span class="line">                CLOSE_FIREWALL=<span class="string">&quot;true&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            [Nn] | [Nn][Oo]) ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不关闭！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;CLOSE_FIREWALL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">local</span> SelinuxConfig=/etc/selinux/config</span><br><span class="line">            systemctl <span class="built_in">disable</span> --now firewalld &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            [ -s <span class="variable">$SelinuxConfig</span> ] &amp;&amp; sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> <span class="variable">$SelinuxConfig</span> &amp;&amp; setenforce 0 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 备份原有软件源（文件/目录）</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">BackupOriginalMirrors</span></span>() &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">BackupFile</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> target_file=<span class="variable">$1</span></span><br><span class="line">        <span class="built_in">local</span> backup_file=<span class="variable">$2</span></span><br><span class="line">        <span class="built_in">local</span> <span class="built_in">type</span>=<span class="string">&quot;<span class="variable">$3</span>&quot;</span></span><br><span class="line">        <span class="comment">## 判断是否存在源文件</span></span><br><span class="line">        [ -f <span class="string">&quot;<span class="variable">$&#123;target_file&#125;</span>&quot;</span> ] || <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;target_file&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> [ ! -s <span class="string">&quot;<span class="variable">$&#123;target_file&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## 判断是否存在已备份的源文件</span></span><br><span class="line">        <span class="keyword">if</span> [ -s <span class="string">&quot;<span class="variable">$&#123;backup_file&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;IGNORE_BACKUP_TIPS&#125;</span>&quot;</span> != <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">return</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE_BACKUP</span><br><span class="line">            CHOICE_BACKUP=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到系统中存在已备份的 <span class="variable">$&#123;type&#125;</span> 源文件，是否跳过覆盖备份? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE_BACKUP&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss]) ;;</span><br><span class="line">            [Nn] | [Nn][Oo])</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="built_in">cp</span> -rvf <span class="string">&quot;<span class="variable">$&#123;target_file&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;backup_file&#125;</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">                BACKED_UP=<span class="string">&quot;true&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不覆盖！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cp</span> -rvf <span class="string">&quot;<span class="variable">$&#123;target_file&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;backup_file&#125;</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">            BACKED_UP=<span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 已备份原有 <span class="variable">$&#123;type&#125;</span> 源文件&quot;</span></span><br><span class="line">            <span class="built_in">sleep</span> 1s</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">BackupDir</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> target_dir=<span class="variable">$1</span></span><br><span class="line">        <span class="built_in">local</span> backup_dir=<span class="variable">$2</span></span><br><span class="line">        [ -d <span class="string">&quot;<span class="variable">$&#123;target_dir&#125;</span>&quot;</span> ] || <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;target_dir&#125;</span>&quot;</span></span><br><span class="line">        [ -d <span class="string">&quot;<span class="variable">$&#123;backup_dir&#125;</span>&quot;</span> ] || <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;backup_dir&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment">## 判断是否存在 repo 源文件</span></span><br><span class="line">        <span class="built_in">ls</span> <span class="string">&quot;<span class="variable">$&#123;target_dir&#125;</span>&quot;</span> | grep <span class="string">&#x27;\.repo$&#x27;</span> -q</span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## 判断是否存在已备份的 repo 源文件</span></span><br><span class="line">        <span class="built_in">ls</span> <span class="string">&quot;<span class="variable">$&#123;backup_dir&#125;</span>&quot;</span> | grep <span class="string">&#x27;\.repo$&#x27;</span> -q</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;IGNORE_BACKUP_TIPS&#125;</span>&quot;</span> != <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">return</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE_BACKUP</span><br><span class="line">            CHOICE_BACKUP=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 检测到系统中存在已备份的 repo 源文件，是否跳过覆盖备份? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE_BACKUP&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss]) ;;</span><br><span class="line">            [Nn] | [Nn][Oo])</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="built_in">cp</span> -rvf <span class="variable">$target_dir</span>/* <span class="string">&quot;<span class="variable">$&#123;backup_dir&#125;</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">                BACKED_UP=<span class="string">&quot;true&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不覆盖！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cp</span> -rvf <span class="variable">$target_dir</span>/* <span class="string">&quot;<span class="variable">$&#123;backup_dir&#125;</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">            BACKED_UP=<span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 已备份原有 repo 源文件&quot;</span></span><br><span class="line">            <span class="built_in">sleep</span> 1s</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BACKED_UP=<span class="string">&quot;false&quot;</span> <span class="comment"># 是否已备份</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;BACKUP&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># /etc/apt/sources.list</span></span><br><span class="line">            BackupFile <span class="variable">$File_DebianSourceList</span> <span class="variable">$File_DebianSourceListBackup</span> <span class="string">&quot;sources.list&quot;</span></span><br><span class="line">            <span class="comment">## 自新版本的 Debian 与 Ubuntu 起，软件源文件格式统一为 DEB822 格式，涉及 Debian 12 的容器镜像、Ubuntu 24.04 和未来尚未发布的版本</span></span><br><span class="line">            <span class="comment">## Debian DEB822 格式源文件</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                BackupFile <span class="variable">$File_DebianSources</span> <span class="variable">$File_DebianSourcesBackup</span> <span class="string">&quot;debian.sources&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="comment">## Ubuntu DEB822 格式源文件</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                BackupFile <span class="variable">$File_UbuntuSources</span> <span class="variable">$File_UbuntuSourcesBackup</span> <span class="string">&quot;ubuntu.sources&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="comment">## Armbian</span></span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="variable">$File_ArmbianRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">                BackupFile <span class="variable">$File_ArmbianSourceList</span> <span class="variable">$File_ArmbianSourceListBackup</span> <span class="string">&quot;armbian.list&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="comment">## Proxmox</span></span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="variable">$File_ProxmoxVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">                BackupFile <span class="variable">$File_ProxmoxSourceList</span> <span class="variable">$File_ProxmoxSourceListBackup</span> <span class="string">&quot;pve-no-subscription.list&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># /etc/yum.repos.d</span></span><br><span class="line">            BackupDir <span class="variable">$Dir_YumRepos</span> <span class="variable">$Dir_YumReposBackup</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># /etc/zypp/repos.d</span></span><br><span class="line">            BackupDir <span class="variable">$Dir_openSUSERepos</span> <span class="variable">$Dir_openSUSEReposBackup</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># /etc/pacman.d/mirrorlist</span></span><br><span class="line">            BackupFile <span class="variable">$File_ArchMirrorList</span> <span class="variable">$File_ArchMirrorListBackup</span> <span class="string">&quot;mirrorlist&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># /etc/apk/repositories</span></span><br><span class="line">            BackupFile <span class="variable">$File_AlpineRepositories</span> <span class="variable">$File_AlpineRepositoriesBackup</span> <span class="string">&quot;repositories&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 移除原有软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RemoveOriginMirrors</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        [ -f <span class="variable">$File_DebianSourceList</span> ] &amp;&amp; sed -i <span class="string">&#x27;1,$d&#x27;</span> <span class="variable">$File_DebianSourceList</span></span><br><span class="line">        [ -d <span class="variable">$Dir_DebianExtendSource</span> ] || <span class="built_in">mkdir</span> -p <span class="variable">$Dir_DebianExtendSource</span></span><br><span class="line">        <span class="comment">## 自新版本的 Debian 与 Ubuntu 起，软件源文件格式统一为 DEB822 格式，涉及 Debian 12 的容器镜像、Ubuntu 24.04 和未来尚未发布的版本</span></span><br><span class="line">        <span class="comment">## Debian DEB822 格式源文件</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            [ -f <span class="variable">$File_DebianSources</span> ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$File_DebianSources</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## Ubuntu DEB822 格式源文件</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            [ -f <span class="variable">$File_UbuntuSources</span> ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$File_UbuntuSources</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## Armbian</span></span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="variable">$File_ArmbianRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">            [ -f <span class="variable">$File_ArmbianSourceList</span> ] &amp;&amp; sed -i <span class="string">&#x27;1,$d&#x27;</span> <span class="variable">$File_ArmbianSourceList</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## Proxmox</span></span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="variable">$File_ProxmoxVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">            [ -f <span class="variable">$File_ProxmoxSourceList</span> ] &amp;&amp; sed -i <span class="string">&#x27;1,$d&#x27;</span> <span class="variable">$File_ProxmoxSourceList</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [ ! -d <span class="variable">$Dir_YumRepos</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/fedora*</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;ONLY_EPEL&#125;</span>&quot;</span> != <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">return</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                9)</span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/rocky*</span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    <span class="keyword">if</span> [ -f <span class="variable">$Dir_YumRepos</span>/epel.repo ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">ls</span> <span class="variable">$Dir_YumRepos</span>/ | grep -Ev epel | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/*</span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> [ -f <span class="variable">$Dir_YumRepos</span>/epel.repo ]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">ls</span> <span class="variable">$Dir_YumRepos</span>/ | grep -Ev epel | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/*</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                9)</span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/centos*</span><br><span class="line">                    ;;</span><br><span class="line">                8)</span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/CentOS-Stream-*</span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                9)</span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/rocky*</span><br><span class="line">                    ;;</span><br><span class="line">                8)</span><br><span class="line">                    <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/Rocky-*</span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/almalinux*</span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/OpenCloudOS*</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        [ -d <span class="variable">$Dir_YumRepos</span> ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/OpenCloudOS*</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        [ -d <span class="variable">$Dir_YumRepos</span> ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/openEuler.repo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        [ -d <span class="variable">$Dir_openSUSERepos</span> ] &amp;&amp; <span class="built_in">ls</span> <span class="variable">$Dir_openSUSERepos</span>/ | grep -E <span class="string">&quot;^repo-&quot;</span> | grep -Ev <span class="string">&quot;openh264&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">        [ -f <span class="variable">$File_ArchMirrorList</span> ] &amp;&amp; sed -i <span class="string">&#x27;1,$d&#x27;</span> <span class="variable">$File_ArchMirrorList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        [ -f <span class="variable">$File_AlpineRepositories</span> ] &amp;&amp; sed -i <span class="string">&#x27;1,$d&#x27;</span> <span class="variable">$File_AlpineRepositories</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 换源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ChangeMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 打印修改前后差异</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">PrintDiff</span></span>() &#123;</span><br><span class="line">        <span class="comment">## 单一文件比较模式</span></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">DiffFile</span></span>() &#123;</span><br><span class="line">            <span class="built_in">local</span> diff_file=<span class="variable">$1</span></span><br><span class="line">            <span class="built_in">local</span> origin_file=<span class="variable">$2</span></span><br><span class="line">            <span class="keyword">if</span> [[ -s <span class="variable">$diff_file</span> ]] &amp;&amp; [[ -s <span class="variable">$origin_file</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">if</span> [[ <span class="string">&quot;<span class="subst">$(cat <span class="string">&quot;<span class="variable">$&#123;diff_file&#125;</span>&quot;</span>)</span>&quot;</span> != <span class="string">&quot;<span class="subst">$(cat <span class="string">&quot;<span class="variable">$&#123;origin_file&#125;</span>&quot;</span>)</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;diff_file&#125;</span><span class="variable">$&#123;PLAIN&#125;</span> -&gt; <span class="variable">$&#123;BLUE&#125;</span><span class="variable">$&#123;origin_file&#125;</span><span class="variable">$&#123;PLAIN&#125;</span>&quot;</span></span><br><span class="line">                    diff <span class="string">&quot;<span class="variable">$&#123;diff_file&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;origin_file&#125;</span>&quot;</span> -d --color=always -I -B -E</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">## 目录文件比较模式</span></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">DiffDir</span></span>() &#123;</span><br><span class="line">            <span class="built_in">local</span> diff_dir=<span class="variable">$1</span></span><br><span class="line">            <span class="built_in">local</span> origin_dir=<span class="variable">$2</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> $(<span class="built_in">ls</span> <span class="variable">$diff_dir</span> | xargs); <span class="keyword">do</span></span><br><span class="line">                DiffFile <span class="string">&quot;<span class="variable">$&#123;diff_dir&#125;</span>/<span class="variable">$&#123;item&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;origin_dir&#125;</span>/<span class="variable">$&#123;item&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [[ -x /usr/bin/diff &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;BACKED_UP&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">                DiffFile <span class="variable">$File_DebianSourceListBackup</span> <span class="variable">$File_DebianSourceList</span></span><br><span class="line">                <span class="comment">## Armbian</span></span><br><span class="line">                <span class="keyword">if</span> [ -f <span class="variable">$File_ArmbianRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">                    DiffFile <span class="variable">$File_ArmbianSourceListBackup</span> <span class="variable">$File_ArmbianSourceList</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="comment">## Proxmox</span></span><br><span class="line">                <span class="keyword">if</span> [ -f <span class="variable">$File_ProxmoxVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">                    DiffFile <span class="variable">$File_ProxmoxSourceListBackup</span> <span class="variable">$File_ProxmoxSourceList</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">                DiffDir <span class="variable">$Dir_YumReposBackup</span> <span class="variable">$Dir_YumRepos</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">                DiffDir <span class="variable">$Dir_openSUSEReposBackup</span> <span class="variable">$Dir_openSUSERepos</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">                DiffFile <span class="variable">$File_ArchMirrorListBackup</span> <span class="variable">$File_ArchMirrorList</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">                DiffFile <span class="variable">$File_AlpineRepositoriesBackup</span> <span class="variable">$File_AlpineRepositories</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 调用换源函数</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        DebianMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span>)</span><br><span class="line">        RedHatMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        OpenCloudOSMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        openEulerMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        openSUSEMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">        ArchMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        AlpineMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 比较差异</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;PRINT_DIFF&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        PrintDiff</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 更新软件源</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WORKING</span> 开始<span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>...\n&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        apt-get update</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        yum makecache</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        zypper ref</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span>)</span><br><span class="line">        pacman -Sy</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        apk update -f</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$SUCCESS</span> 软件源更换完毕&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$FAIL</span> 软件源更换完毕，但<span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>失败\n&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;请再次执行脚本并更换相同软件源后进行尝试，若仍然<span class="variable">$&#123;SYNC_MIRROR_TEXT&#125;</span>失败那么可能由以下原因导致&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;1. 网络问题：例如连接异常、由地区影响的网络间歇式中断等&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;2. 软件源问题：建议更换其它镜像站进行尝试，少数情况下软件源若处于同步中状态则可能会出现文件同步错误问题&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n软件源地址：<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>\n&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 升级软件包</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">UpgradeSoftware</span></span>() &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">CleanCache</span></span>() &#123;</span><br><span class="line">        <span class="comment">## 跳过特殊系统</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="comment">## 交互确认</span></span><br><span class="line">        <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;CLEAN_CACHE&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            CLEAN_CACHE=<span class="string">&quot;false&quot;</span></span><br><span class="line">            <span class="built_in">local</span> CHOICE</span><br><span class="line">            CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否清理已下载的软件包缓存? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">            [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">            [Yy] | [Yy][Ee][Ss])</span><br><span class="line">                CLEAN_CACHE=<span class="string">&quot;true&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            [Nn] | [Nn][Oo]) ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不清理！&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;CLEAN_CACHE&#125;</span>&quot;</span> == <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## 调用系统命令</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">            apt-get autoremove -y &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            apt-get clean &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">            yum autoremove -y &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            yum clean packages -y &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$COMPLETE</span> 清理完毕&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 跳过特殊系统</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ARCH&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 交互确认</span></span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$&#123;UPGRADE_SOFTWARE&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        UPGRADE_SOFTWARE=<span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="built_in">local</span> CHOICE</span><br><span class="line">        CHOICE=$(<span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;BOLD&#125;</span>└─ 是否跳过更新软件包? [Y/n] <span class="variable">$&#123;PLAIN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">read</span> -rp <span class="string">&quot;<span class="variable">$&#123;CHOICE&#125;</span>&quot;</span> INPUT</span><br><span class="line">        [[ -z <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> ]] &amp;&amp; INPUT=Y</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;INPUT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        [Yy] | [Yy][Ee][Ss]) ;;</span><br><span class="line">        [Nn] | [Nn][Oo])</span><br><span class="line">            UPGRADE_SOFTWARE=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$WARN</span> 输入错误，默认不更新！&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;UPGRADE_SOFTWARE&#125;</span>&quot;</span> == <span class="string">&quot;false&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">## 调用系统命令</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FACTIONS&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        apt-get upgrade -y</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_REDHAT&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENEULER&#125;</span>&quot;</span>)</span><br><span class="line">        yum update -y --skip-broken</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENSUSE&#125;</span>&quot;</span>)</span><br><span class="line">        zypper update -y</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALPINE&#125;</span>&quot;</span>)</span><br><span class="line">        apk upgrade --no-cache</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    CleanCache</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 运行结束</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RunEnd</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n---------- 脚本执行结束 ----------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n\033[1;34mPowered by https://linuxmirrors.cn\033[0m\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 Debian 系 Linux 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">DebianMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">            SOURCE=<span class="string">&quot;deb.debian.org&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span>)</span><br><span class="line">            SOURCE=<span class="string">&quot;archive.ubuntu.com&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_KALI&#125;</span>&quot;</span>)</span><br><span class="line">            SOURCE=<span class="string">&quot;http.kali.org&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEEPIN&#125;</span>&quot;</span>)</span><br><span class="line">            SOURCE=<span class="string">&quot;community-packages.deepin.com&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">local</span> source_suffix</span><br><span class="line">    <span class="built_in">local</span> tips=<span class="string">&quot;## 默认禁用源码镜像以提高速度，如需启用请自行取消注释&quot;</span></span><br><span class="line">    <span class="built_in">local</span> basic_url=<span class="string">&quot;<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEBIAN&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        8 | 9 | 10 | 11)</span><br><span class="line">            source_suffix=<span class="string">&quot;main contrib non-free&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            source_suffix=<span class="string">&quot;main contrib non-free non-free-firmware&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>&quot;</span> != <span class="string">&quot;sid&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tips&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-updates <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-updates <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-backports <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-backports <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">            <span class="comment">## 处理 debian-security 仓库源</span></span><br><span class="line">            <span class="built_in">local</span> security_url=<span class="string">&quot;<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE_SECURITY:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_SECURITY:-&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>-security&quot;&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;deb <span class="variable">$&#123;security_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-security <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;security_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-security <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_UBUNTU&#125;</span>&quot;</span>)</span><br><span class="line">        source_suffix=<span class="string">&quot;main restricted universe multiverse&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tips&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-updates <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-updates <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-backports <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-backports <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-security <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-security <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 预发布软件源（不建议启用）</span></span><br><span class="line"><span class="string"># deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-proposed <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-proposed <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_KALI&#125;</span>&quot;</span>)</span><br><span class="line">        source_suffix=<span class="string">&quot;main non-free contrib&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tips&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_DEEPIN&#125;</span>&quot;</span>)</span><br><span class="line">        source_suffix=<span class="string">&quot;apricot main contrib non-free&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;tips&#125;</span></span></span><br><span class="line"><span class="string">deb <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span></span></span><br><span class="line"><span class="string"># deb-src <span class="variable">$&#123;basic_url&#125;</span> <span class="variable">$&#123;source_suffix&#125;</span>&quot;</span> &gt;&gt;<span class="variable">$File_DebianSourceList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 处理其它衍生系统的专用源</span></span><br><span class="line">    <span class="comment"># Armbian</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$File_ArmbianRelease</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/armbian.gpg] <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/armbian <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> main <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-utils <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span>-desktop&quot;</span> &gt;&gt;<span class="variable">$File_ArmbianSourceList</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment"># Proxmox</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$File_ProxmoxVersion</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;deb <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/proxmox/debian/pve <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> pve-no-subscription</span></span><br><span class="line"><span class="string"># deb <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/proxmox/debian/pbs <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> pbs-no-subscription</span></span><br><span class="line"><span class="string"># deb <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/proxmox/debian/pbs-client <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> pbs-client-no-subscription</span></span><br><span class="line"><span class="string"># deb <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/proxmox/debian/pmg <span class="variable">$&#123;SYSTEM_VERSION_CODENAME&#125;</span> pmg-no-subscription&quot;</span> &gt;&gt;<span class="variable">$File_ProxmoxSourceList</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 RedHat 系 Linux 发行版软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RedHatMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 安装/更换 EPEL (Extra Packages for Enterprise Linux) 附加软件包软件源</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">EPELMirrors</span></span>() &#123;</span><br><span class="line">        <span class="comment">## 安装 EPEL 软件包</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;VERIFICATION_EPEL&#125;</span>&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;WORKING&#125;</span> 安装 epel-release 软件包...\n&quot;</span></span><br><span class="line">            yum install -y https://mirrors.cloud.tencent.com/epel/epel-release-latest-<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>.noarch.rpm</span><br><span class="line">            <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="comment">## 删除原有 repo 源文件</span></span><br><span class="line">        [ <span class="string">&quot;<span class="variable">$&#123;VERIFICATION_EPELFILES&#125;</span>&quot;</span> -eq 0 ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">        [ <span class="string">&quot;<span class="variable">$&#123;VERIFICATION_EPELBACKUPFILES&#125;</span>&quot;</span> -eq 0 ] &amp;&amp; <span class="built_in">rm</span> -rf <span class="variable">$Dir_YumReposBackup</span>/epel*</span><br><span class="line">        <span class="comment">## 生成 repo 源文件</span></span><br><span class="line">        GenRepoFiles_EPEL</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更换 WEB 协议（HTTP/HTTPS）</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">        9 | 8)</span><br><span class="line">            sed -i <span class="string">&quot;s|^#baseurl=https|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            sed -i <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="comment"># 修改源</span></span><br><span class="line">        sed -i <span class="string">&#x27;s|^metalink=|#metalink=|g&#x27;</span> <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">        9 | 8)</span><br><span class="line">            sed -i <span class="string">&quot;s|download.example/pub|<span class="variable">$&#123;SOURCE&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            sed -i <span class="string">&quot;s|download.fedoraproject.org/pub|<span class="variable">$&#123;SOURCE&#125;</span>|g&quot;</span> <span class="variable">$Dir_YumRepos</span>/epel*</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        [ -f <span class="variable">$Dir_YumRepos</span>/epel-cisco-openh264.repo ] &amp;&amp; <span class="built_in">rm</span> -rf epel-cisco-openh264.repo <span class="comment"># 删除不兼容的仓库</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## 仅 EPEL 模式</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;ONLY_EPEL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        EPELMirrors</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 生成基于 RedHat 发行版和及其衍生发行版的官方 repo 源文件</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">        9)</span><br><span class="line">            GenRepoFiles_RockyLinux <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            GenRepoFiles_CentOS <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_CentOS <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_CentOSStream <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_RockyLinux <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_AlmaLinux <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_Fedora</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        GenRepoFiles_OpenCloudOS <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> != <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment">## 修改源</span></span><br><span class="line">        <span class="built_in">cd</span> <span class="variable">$Dir_YumRepos</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            9)</span><br><span class="line">                <span class="comment"># wget &quot;$&#123;WEB_PROTOCOL&#125;://$&#123;SOURCE&#125;/$&#123;SOURCE_BRANCH&#125;/RPM-GPG-KEY-rockyofficial&quot; -P /etc/pki/rpm-gpg</span></span><br><span class="line">                <span class="comment"># wget &quot;$&#123;WEB_PROTOCOL&#125;://$&#123;SOURCE&#125;/$&#123;SOURCE_BRANCH&#125;/RPM-GPG-KEY-Rocky-9&quot; -P /etc/pki/rpm-gpg</span></span><br><span class="line">                sed -e <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^gpgcheck=1|gpgcheck=0|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^gpgkey=|#gpgkey=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|dl.rockylinux.org/\$contentdir|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    rocky.repo \</span><br><span class="line">                    rocky-addons.repo \</span><br><span class="line">                    rocky-devel.repo \</span><br><span class="line">                    rocky-extras.repo</span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                sed -i <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">                sed -i <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> CentOS-*</span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                8)</span><br><span class="line">                    sed -i <span class="string">&quot;s|mirror.centos.org/\$contentdir|mirror.centos.org/centos-vault|g&quot;</span> CentOS-*</span><br><span class="line">                    sed -i <span class="string">&quot;s/\$releasever/8.5.2111/g&quot;</span> CentOS-*</span><br><span class="line">                    <span class="comment"># 单独处理 CentOS-Linux-Sources.repo</span></span><br><span class="line">                    sed -i <span class="string">&quot;s|vault.centos.org/\$contentdir|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;centos-vault&quot;&#125;</span>|g&quot;</span> CentOS-Linux-Sources.repo</span><br><span class="line">                    ;;</span><br><span class="line">                7)</span><br><span class="line">                    sed -i <span class="string">&quot;s|mirror.centos.org/\$contentdir|mirror.centos.org/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">                    sed -i <span class="string">&quot;s/\$releasever/7/g&quot;</span> CentOS-*</span><br><span class="line">                    <span class="comment"># 单独处理 CentOS-Sources.repo</span></span><br><span class="line">                    sed -i <span class="string">&quot;s|vault.centos.org/centos|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;&#125;</span>|g&quot;</span> CentOS-Sources.repo</span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                sed -i <span class="string">&quot;s|mirror.centos.org|<span class="variable">$&#123;SOURCE&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span>)</span><br><span class="line">            sed -i <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">            sed -i <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> CentOS-*</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            8)</span><br><span class="line">                <span class="comment">## CentOS 8 操作系统版本结束了生命周期（EOL），Linux 社区已不再维护该操作系统版本，最终版本为 8.5.2011</span></span><br><span class="line">                <span class="comment"># 原 centos 镜像中的 CentOS 8 相关内容已被官方移动，从 2022-02 开始切换至 centos-vault 源</span></span><br><span class="line">                sed -i <span class="string">&quot;s|mirror.centos.org/\$contentdir|mirror.centos.org/centos-vault|g&quot;</span> CentOS-*</span><br><span class="line">                sed -i <span class="string">&quot;s/\$releasever/8.5.2111/g&quot;</span> CentOS-*</span><br><span class="line">                <span class="comment"># 单独处理 CentOS-Linux-Sources.repo</span></span><br><span class="line">                sed -i <span class="string">&quot;s|vault.centos.org/\$contentdir|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;centos-vault&quot;&#125;</span>|g&quot;</span> CentOS-Linux-Sources.repo</span><br><span class="line">                ;;</span><br><span class="line">            7)</span><br><span class="line">                sed -i <span class="string">&quot;s|mirror.centos.org/\$contentdir|mirror.centos.org/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">                sed -i <span class="string">&quot;s|vault.centos.org/centos|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;&#125;</span>|g&quot;</span> CentOS-Sources.repo <span class="comment"># 单独处理 CentOS-Sources.repo</span></span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            sed -i <span class="string">&quot;s|mirror.centos.org|<span class="variable">$&#123;SOURCE&#125;</span>|g&quot;</span> CentOS-*</span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># CentOS Stream 9 使用的是 centos-stream 镜像，而 CentOS Stream 8 使用的是 centos 镜像</span></span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            9)</span><br><span class="line">                sed -e <span class="string">&quot;s|^#baseurl=https|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^metalink=|#metalink=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|mirror.stream.centos.org|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    centos.repo \</span><br><span class="line">                    centos-addons.repo</span><br><span class="line">                ;;</span><br><span class="line">            8)</span><br><span class="line">                sed -i <span class="string">&quot;s|vault.centos.org/\$contentdir|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;&#125;</span>|g&quot;</span> CentOS-Stream-Sources.repo <span class="comment"># 单独处理 CentOS-Stream-Sources.repo</span></span><br><span class="line">                sed -e <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|mirror.centos.org/\$contentdir|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    CentOS-Stream-*</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            9)</span><br><span class="line">                sed -e <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|dl.rockylinux.org/\$contentdir|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    rocky.repo \</span><br><span class="line">                    rocky-addons.repo \</span><br><span class="line">                    rocky-devel.repo \</span><br><span class="line">                    rocky-extras.repo</span><br><span class="line">                ;;</span><br><span class="line">            8)</span><br><span class="line">                sed -e <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|dl.rockylinux.org/\$contentdir|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    Rocky-*</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            9)</span><br><span class="line">                sed -e <span class="string">&quot;s|^# baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|repo.almalinux.org/vault|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;almalinux-vault&quot;&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|repo.almalinux.org/almalinux|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    almalinux-*</span><br><span class="line">                ;;</span><br><span class="line">            8)</span><br><span class="line">                sed -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|^# baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|repo.almalinux.org/vault|<span class="variable">$&#123;SOURCE_VAULT:-&quot;<span class="variable">$&#123;SOURCE&#125;</span>&quot;&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH_VAULT:-&quot;almalinux-vault&quot;&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|repo.almalinux.org/almalinux|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    almalinux-ha.repo \</span><br><span class="line">                    almalinux-nfv.repo \</span><br><span class="line">                    almalinux-plus.repo \</span><br><span class="line">                    almalinux-powertools.repo \</span><br><span class="line">                    almalinux-resilientstorage.repo \</span><br><span class="line">                    almalinux-rt.repo \</span><br><span class="line">                    almalinux-sap.repo \</span><br><span class="line">                    almalinux-saphana.repo \</span><br><span class="line">                    almalinux.repo</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_FEDORA&#125;</span>&quot;</span>)</span><br><span class="line">            sed -e <span class="string">&quot;s|^metalink=|#metalink=|g&quot;</span> \</span><br><span class="line">                -e <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                -e <span class="string">&quot;s|download.example/pub/fedora/linux|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                -i \</span><br><span class="line">                fedora.repo \</span><br><span class="line">                fedora-updates.repo \</span><br><span class="line">                fedora-modular.repo \</span><br><span class="line">                fedora-updates-modular.repo \</span><br><span class="line">                fedora-updates-testing.repo \</span><br><span class="line">                fedora-updates-testing-modular.repo</span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">            8)</span><br><span class="line">                sed -e <span class="string">&quot;s|^baseurl=https|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -e <span class="string">&quot;s|mirrors.opencloudos.tech/opencloudos|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                    -i \</span><br><span class="line">                    OpenCloudOS-Debuginfo.repo \</span><br><span class="line">                    OpenCloudOS.repo \</span><br><span class="line">                    OpenCloudOS-Sources.repo</span><br><span class="line">                ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## EPEL 附加软件包（安装/换源）</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_JUDGMENT&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;SYSTEM_RHEL&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_CENTOS_STREAM&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ROCKY&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ALMALINUX&#125;</span>&quot;</span> | <span class="string">&quot;<span class="variable">$&#123;SYSTEM_OPENCLOUDOS&#125;</span>&quot;</span>)</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$&#123;INSTALL_EPEL&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]] &amp;&amp; EPELMirrors</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 OpenCloudOS 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">OpenCloudOSMirrors</span></span>() &#123;</span><br><span class="line">    GenRepoFiles_OpenCloudOS <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 修改源</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$Dir_YumRepos</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        sed -e <span class="string">&quot;s|^baseurl=https|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">            -e <span class="string">&quot;s|mirrors.opencloudos.tech/opencloudos|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">            -i \</span><br><span class="line">            OpenCloudOS.repo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 openEuler 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">openEulerMirrors</span></span>() &#123;</span><br><span class="line">    GenRepoFiles_openEuler</span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 修改源</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$Dir_YumRepos</span></span><br><span class="line">    <span class="built_in">local</span> version_name=<span class="string">&quot;<span class="subst">$(cat $File_LinuxRelease | grep -E <span class="string">&quot;^VERSION=&quot;</span> | awk -F &#x27;=&#x27; &#x27;&#123;print$2&#125;&#x27; | sed <span class="string">&quot;s/[\&#x27;\&quot;]//g; s/[()]/ /g; s/  / /g; s/^ //g; s/ $//g; s/ /-/g; s/_/-/g&quot;</span>)</span>&quot;</span></span><br><span class="line">    sed -e <span class="string">&quot;s|^metalink=|#metalink=|g&quot;</span> \</span><br><span class="line">        -e <span class="string">&quot;s|^baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> \</span><br><span class="line">        -e <span class="string">&quot;s|repo.openeuler.org|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">        -e <span class="string">&quot;s|openEuler-version|openEuler-<span class="variable">$&#123;version_name&#125;</span>|g&quot;</span> \</span><br><span class="line">        -i \</span><br><span class="line">        openEuler.repo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 openSUSE 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">openSUSEMirrors</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ID&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;opensuse-leap&quot;</span>)</span><br><span class="line">        GenRepoFiles_openSUSE <span class="string">&quot;leap&quot;</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER&#125;</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;opensuse-tumbleweed&quot;</span>)</span><br><span class="line">        GenRepoFiles_openSUSE <span class="string">&quot;tumbleweed&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 修改源</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$Dir_openSUSERepos</span></span><br><span class="line">    <span class="comment"># 更换 WEB 协议（HTTP/HTTPS）</span></span><br><span class="line">    sed -i <span class="string">&quot;s|^#baseurl=http|baseurl=<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>|g&quot;</span> repo-*</span><br><span class="line">    <span class="comment"># 更换软件源</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_ID&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    opensuse-leap)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_VERSION_NUMBER&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        15.[0-2])</span><br><span class="line">            sed -i <span class="string">&quot;s|download.opensuse.org|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                repo-debug-non-oss.repo \</span><br><span class="line">                repo-debug.repo \</span><br><span class="line">                repo-debug-update-non-oss.repo \</span><br><span class="line">                repo-debug-update.repo \</span><br><span class="line">                repo-non-oss.repo \</span><br><span class="line">                repo-oss.repo \</span><br><span class="line">                repo-source-non-oss.repo \</span><br><span class="line">                repo-source.repo \</span><br><span class="line">                repo-update-non-oss.repo \</span><br><span class="line">                repo-update.repo</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            sed -i <span class="string">&quot;s|download.opensuse.org|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">                repo-backports-debug-update.repo \</span><br><span class="line">                repo-backports-update.repo \</span><br><span class="line">                repo-debug-non-oss.repo \</span><br><span class="line">                repo-debug.repo \</span><br><span class="line">                repo-debug-update-non-oss.repo \</span><br><span class="line">                repo-debug-update.repo \</span><br><span class="line">                repo-non-oss.repo \</span><br><span class="line">                repo-oss.repo \</span><br><span class="line">                repo-sle-debug-update.repo \</span><br><span class="line">                repo-sle-update.repo \</span><br><span class="line">                repo-source.repo \</span><br><span class="line">                repo-update-non-oss.repo \</span><br><span class="line">                repo-update.repo</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        ;;</span><br><span class="line">    opensuse-tumbleweed)</span><br><span class="line">        sed -i <span class="string">&quot;s|download.opensuse.org|<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>|g&quot;</span> \</span><br><span class="line">            repo-debug.repo \</span><br><span class="line">            repo-non-oss.repo \</span><br><span class="line">            repo-openh264.repo \</span><br><span class="line">            repo-oss.repo \</span><br><span class="line">            repo-source.repo \</span><br><span class="line">            repo-update.repo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 Arch Linux 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ArchMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        SOURCE=<span class="string">&quot;mirrors.aliyun.com&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;TIP&#125;</span> 由于 Arch Linux 无官方源因此已切换至阿里源\n&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 修改源</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;archlinuxarm&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Server = <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/\$arch/\$repo&quot;</span> &gt;&gt;<span class="variable">$File_ArchMirrorList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;archlinuxcn&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Server = <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/\$arch&quot;</span> &gt;&gt;<span class="variable">$File_ArchMirrorList</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Server = <span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/\$repo/os/\$arch&quot;</span> &gt;&gt;<span class="variable">$File_ArchMirrorList</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更换基于 Alpine Linux 发行版的软件源</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">AlpineMirrors</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 使用官方源</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE&#125;</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        SOURCE=<span class="string">&quot;dl-cdn.alpinelinux.org&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">local</span> version_name</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;SYSTEM_PRETTY_NAME&#125;</span>&quot;</span> | grep <span class="string">&quot; edge&quot;</span> -q</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        version_name=<span class="string">&quot;edge&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        version_name=<span class="string">&quot;v<span class="variable">$&#123;SYSTEM_VERSION_NUMBER%.*&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">## 修改源</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/<span class="variable">$&#123;version_name&#125;</span>/main</span></span><br><span class="line"><span class="string"><span class="variable">$&#123;WEB_PROTOCOL&#125;</span>://<span class="variable">$&#123;SOURCE&#125;</span>/<span class="variable">$&#123;SOURCE_BRANCH&#125;</span>/<span class="variable">$&#123;version_name&#125;</span>/community&quot;</span> &gt;&gt;<span class="variable">$File_AlpineRepositories</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 处理命令选项</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CommandOptions</span></span>() &#123;</span><br><span class="line">    <span class="comment">## 命令帮助</span></span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">Output_Help_Info</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;</span></span><br><span class="line"><span class="string">命令选项(参数名/含义/参数值)：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  --abroad                 使用海外软件源                                    无</span></span><br><span class="line"><span class="string">  --edu                    使用中国大陆教育网软件源                          无</span></span><br><span class="line"><span class="string">  --source                 指定软件源地址                                    地址</span></span><br><span class="line"><span class="string">  --source-security        指定 Debian 的 security 软件源地址                地址</span></span><br><span class="line"><span class="string">  --source-vault           指定 CentOS/AlmaLinux 的 vault 软件源地址         地址</span></span><br><span class="line"><span class="string">  --use-official-source    使用操作系统官方软件源                            无</span></span><br><span class="line"><span class="string">  --branch                 指定软件源分支(路径)                              分支名</span></span><br><span class="line"><span class="string">  --branch-security        指定 Debian 的 security 软件源分支(路径)          分支名</span></span><br><span class="line"><span class="string">  --branch-vault           指定 CentOS/AlmaLinux 的 vault 软件源分支(路径)   分支名</span></span><br><span class="line"><span class="string">  --codename               指定 Debian 系操作系统的版本代号                  代号名称</span></span><br><span class="line"><span class="string">  --protocol               指定 WEB 协议                                     http 或 https</span></span><br><span class="line"><span class="string">  --intranet               优先使用内网地址                                  true 或 false</span></span><br><span class="line"><span class="string">  --install-epel           安装 EPEL 附加软件包                              true 或 false</span></span><br><span class="line"><span class="string">  --only-epel              仅更换 EPEL 软件源模式                            无</span></span><br><span class="line"><span class="string">  --close-firewall         关闭防火墙                                        true 或 false</span></span><br><span class="line"><span class="string">  --backup                 备份原有软件源                                    true 或 false</span></span><br><span class="line"><span class="string">  --ignore-backup-tips     忽略覆盖备份提示                                  无</span></span><br><span class="line"><span class="string">  --upgrade-software       更新软件包                                        true 或 false</span></span><br><span class="line"><span class="string">  --clean-cache            清理下载缓存                                      true 或 false</span></span><br><span class="line"><span class="string">  --print-diff             打印源文件修改前后差异                            无</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">问题报告 https://github.com/SuperManito/LinuxMirrors/issues</span></span><br><span class="line"><span class="string">  &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 判断参数</span></span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$#</span> -gt 0 ]; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="comment">## 海外模式</span></span><br><span class="line">        --abroad)</span><br><span class="line">            USE_ABROAD_SOURCE=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 中国大陆教育网模式</span></span><br><span class="line">        --edu)</span><br><span class="line">            USE_EDU_SOURCE=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 指定软件源地址</span></span><br><span class="line">        --<span class="built_in">source</span>)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | grep -Eq <span class="string">&quot;\(|\)|\[|\]|\&#123;|\&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    Output_Error <span class="string">&quot;检测到无效参数值 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> ，请输入有效的地址！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | sed -e &#x27;s,^http[s]\?://,,g&#x27; -e &#x27;s,/$,,&#x27;)</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        --source-security)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | grep -Eq <span class="string">&quot;\(|\)|\[|\]|\&#123;|\&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    Output_Error <span class="string">&quot;检测到无效参数值 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> ，请输入有效的地址！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE_SECURITY=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | sed -e &#x27;s,^http[s]\?://,,g&#x27; -e &#x27;s,/$,,&#x27;)</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        --source-vault)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | grep -Eq <span class="string">&quot;\(|\)|\[|\]|\&#123;|\&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                    Output_Error <span class="string">&quot;检测到无效参数值 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> ，请输入有效的地址！&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    SOURCE_VAULT=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$2</span>&quot;</span> | sed -e &#x27;s,^http[s]\?://,,g&#x27; -e &#x27;s,/$,,&#x27;)</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 使用官方源</span></span><br><span class="line">        --use-official-source)</span><br><span class="line">            USE_OFFICIAL_SOURCE=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 指定软件源分支</span></span><br><span class="line">        --branch)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        --branch-security)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH_SECURITY=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        --branch-vault)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                SOURCE_BRANCH_VAULT=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定软件源地址！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 指定 Debian 系操作系统的版本代号</span></span><br><span class="line">        --codename)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                DEBIAN_CODENAME=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定版本代号！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 优先使用内网地址</span></span><br><span class="line">        --intranet)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    USE_INTRANET_SOURCE=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## WEB 协议（HTTP/HTTPS）</span></span><br><span class="line">        --protocol | --web-protocol)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                http | https | HTTP | HTTPS)</span><br><span class="line">                    WEB_PROTOCOL=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 http 或 https 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 WEB 协议（HTTP/HTTPS）！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 安装 EPEL 附加软件包</span></span><br><span class="line">        --install-epel)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    INSTALL_EPEL=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        --only-epel)</span><br><span class="line">            ONLY_EPEL=<span class="string">&quot;true&quot;</span></span><br><span class="line">            INSTALL_EPEL=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 关闭防火墙</span></span><br><span class="line">        --close-firewall)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    CLOSE_FIREWALL=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 备份原有软件源</span></span><br><span class="line">        --backup)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    BACKUP=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 忽略覆盖备份提示</span></span><br><span class="line">        --ignore-backup-tips)</span><br><span class="line">            IGNORE_BACKUP_TIPS=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 更新软件包</span></span><br><span class="line">        --upgrade-software | --updata-software)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    UPGRADE_SOFTWARE=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 清理下载缓存</span></span><br><span class="line">        --clean-cache)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                [Tt]rue | [Ff]alse)</span><br><span class="line">                    CLEAN_CACHE=<span class="string">&quot;<span class="variable">$&#123;2,,&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$2<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数值，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请在该参数后指定 true 或 false 作为参数值！&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 打印源文件修改前后差异</span></span><br><span class="line">        --print-diff)</span><br><span class="line">            PRINT_DIFF=<span class="string">&quot;true&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="comment">## 命令帮助</span></span><br><span class="line">        --<span class="built_in">help</span>)</span><br><span class="line">            Output_Help_Info</span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            Output_Error <span class="string">&quot;检测到 <span class="variable">$&#123;BLUE&#125;</span>$1<span class="variable">$&#123;PLAIN&#125;</span> 为无效参数，请确认后重新输入！&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="comment">## 给部分命令选项赋予默认值</span></span><br><span class="line">    ONLY_EPEL=<span class="string">&quot;<span class="variable">$&#123;ONLY_EPEL:-&quot;false&quot;&#125;</span>&quot;</span></span><br><span class="line">    BACKUP=<span class="string">&quot;<span class="variable">$&#123;BACKUP:-&quot;true&quot;&#125;</span>&quot;</span></span><br><span class="line">    USE_OFFICIAL_SOURCE=<span class="string">&quot;<span class="variable">$&#123;USE_OFFICIAL_SOURCE:-&quot;false&quot;&#125;</span>&quot;</span></span><br><span class="line">    IGNORE_BACKUP_TIPS=<span class="string">&quot;<span class="variable">$&#123;IGNORE_BACKUP_TIPS:-&quot;false&quot;&#125;</span>&quot;</span></span><br><span class="line">    PRINT_DIFF=<span class="string">&quot;<span class="variable">$&#123;PRINT_DIFF:-&quot;false&quot;&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 CentOS 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_CentOS</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-AppStream.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-AppStream.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/AppStream/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-BaseOS.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-BaseOS.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-ContinuousRelease.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-ContinuousRelease.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Continuous Release (CR) repository contains packages for the next minor</span></span><br><span class="line"><span class="comment"># release of CentOS Linux.  This repository only has content in the time period</span></span><br><span class="line"><span class="comment"># between an upstream release and the official CentOS Linux release.  These</span></span><br><span class="line"><span class="comment"># packages have not been fully tested yet and should be considered beta</span></span><br><span class="line"><span class="comment"># quality.  They are made available for people willing to test and provide</span></span><br><span class="line"><span class="comment"># feedback for the next release.</span></span><br><span class="line"></span><br><span class="line">[cr]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - ContinuousRelease</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=cr&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/cr/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Debuginfo.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Debuginfo.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># All debug packages are merged into a single repo, split by basearch, and are</span></span><br><span class="line"><span class="comment"># not signed.</span></span><br><span class="line"></span><br><span class="line">[debuginfo]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Debuginfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Devel.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Devel.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[devel]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Devel WARNING! FOR BUILDROOT USE ONLY!</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=Devel&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/Devel/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Extras.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Extras.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/extras/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-FastTrack.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-FastTrack.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[fasttrack]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - FastTrack</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=fasttrack&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/fasttrack/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-HighAvailability.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-HighAvailability.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[ha]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/HighAvailability/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Media.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can use this repo to install items directly off the installation media.</span></span><br><span class="line"><span class="comment"># Verify your mount point matches one of the below file:// paths.</span></span><br><span class="line"></span><br><span class="line">[media-baseos]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Media - BaseOS</span><br><span class="line">baseurl=file:///media/CentOS/BaseOS</span><br><span class="line">        file:///media/cdrom/BaseOS</span><br><span class="line">        file:///media/cdrecorder/BaseOS</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[media-appstream]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Media - AppStream</span><br><span class="line">baseurl=file:///media/CentOS/AppStream</span><br><span class="line">        file:///media/cdrom/AppStream</span><br><span class="line">        file:///media/cdrecorder/AppStream</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Plus.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Plus.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[plus]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=centosplus&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/centosplus/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-PowerTools.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-PowerTools.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[powertools]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - PowerTools</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=PowerTools&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$releasever/PowerTools/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Linux-Sources.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Linux-Sources.repo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$releasever</span>/BaseOS/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$releasever</span>/AppStream/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Extras - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$releasever</span>/extras/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[plus-source]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Plus - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$releasever</span>/centosplus/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    7)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Base.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Base.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirror system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick mirrors that are updated to and</span></span><br><span class="line"><span class="comment"># geographically close to the client.  You should use this for CentOS updates</span></span><br><span class="line"><span class="comment"># unless you are manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist= does not work for you, as a fall back you can try the </span></span><br><span class="line"><span class="comment"># remarked out baseurl= line instead.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=os&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates </span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Updates</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=updates&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=centosplus&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-CR.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-CR.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Continuous Release ( CR )  repository contains rpms that are due in the next</span></span><br><span class="line"><span class="comment"># release for a specific CentOS Version ( eg. next release in CentOS-7 ); these rpms</span></span><br><span class="line"><span class="comment"># are far less tested, with no integration checking or update path testing having</span></span><br><span class="line"><span class="comment"># taken place. They are still built from the upstream sources, but might not map </span></span><br><span class="line"><span class="comment"># to an exact upstream distro release.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># These packages are made available soon after they are built, for people willing </span></span><br><span class="line"><span class="comment"># to test their environments, provide feedback on content for the next release, and</span></span><br><span class="line"><span class="comment"># for people looking for early-access to next release content.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The CR repo is shipped in a disabled state by default; its important that users </span></span><br><span class="line"><span class="comment"># understand the implications of turning this on. </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> We do not use a mirrorlist for the CR repos, to ensure content is available</span></span><br><span class="line"><span class="comment">#       to everyone as soon as possible, and not need to wait for the external</span></span><br><span class="line"><span class="comment">#       mirror network to seed first. However, many local mirrors will carry CR repos</span></span><br><span class="line"><span class="comment">#       and if desired you can use one of these local mirrors by editing the baseurl</span></span><br><span class="line"><span class="comment">#       line in the repo config below.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[cr]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - cr</span><br><span class="line">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/cr/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Debuginfo.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Debug.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirror system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick mirrors that are updated to and</span></span><br><span class="line"><span class="comment"># geographically close to the client.  You should use this for CentOS updates</span></span><br><span class="line"><span class="comment"># unless you are manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># All debug packages from all the various CentOS-7 releases</span></span><br><span class="line"><span class="comment"># are merged into a single repo, split by BaseArch</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note: packages in the debuginfo repo are currently not signed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[base-debuginfo]</span><br><span class="line">name=CentOS-7 - Debuginfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/7/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-Debug-7</span><br><span class="line">enabled=0</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-fasttrack.repo &lt;&lt;\EOF</span><br><span class="line">[fasttrack]</span><br><span class="line">name=CentOS-7 - fasttrack</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=fasttrack&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/fasttrack/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Media.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  This repo can be used with mounted DVD media, verify the mount point for</span></span><br><span class="line"><span class="comment">#  CentOS-7.  You can use this repo and yum to install items directly off the</span></span><br><span class="line"><span class="comment">#  DVD ISO that we release.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To use this repo, put in your DVD and use it with the other repos too:</span></span><br><span class="line"><span class="comment">#  yum --enablerepo=c7-media [command]</span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># or for ONLY the media repo, do this:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  yum --disablerepo=\* --enablerepo=c7-media [command]</span></span><br><span class="line"></span><br><span class="line">[c7-media]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Media</span><br><span class="line">baseurl=file:///media/CentOS/</span><br><span class="line">        file:///media/cdrom/</span><br><span class="line">        file:///media/cdrecorder/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Sources.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Sources.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirror system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick mirrors that are updated to and</span></span><br><span class="line"><span class="comment"># geographically close to the client.  You should use this for CentOS updates</span></span><br><span class="line"><span class="comment"># unless you are manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist= does not work for you, as a fall back you can try the </span></span><br><span class="line"><span class="comment"># remarked out baseurl= line instead.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[base-source]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base Sources</span><br><span class="line">baseurl=http://vault.centos.org/centos/<span class="variable">$releasever</span>/os/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates </span></span><br><span class="line">[updates-source]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Updates Sources</span><br><span class="line">baseurl=http://vault.centos.org/centos/<span class="variable">$releasever</span>/updates/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras-source]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Extras Sources</span><br><span class="line">baseurl=http://vault.centos.org/centos/<span class="variable">$releasever</span>/extras/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus-source]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Plus Sources</span><br><span class="line">baseurl=http://vault.centos.org/centos/<span class="variable">$releasever</span>/centosplus/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 CentOS Stream 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_CentOSStream</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/centos.repo &lt;&lt;\EOF</span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/BaseOS/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-baseos-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[baseos-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-baseos-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-baseos-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/AppStream/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-appstream-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[appstream-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-appstream-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-appstream-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[crb]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - CRB</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/CRB/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-crb-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[crb-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - CRB - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-crb-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[crb-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - CRB - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-crb-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/centos-addons.repo &lt;&lt;\EOF</span><br><span class="line">[highavailability]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/HighAvailability/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-highavailability-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[highavailability-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - HighAvailability - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-highavailability-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[highavailability-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - HighAvailability - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-highavailability-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[nfv]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - NFV</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/NFV/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-nfv-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[nfv-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - NFV - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-nfv-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[nfv-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - NFV - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-nfv-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - RT</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/RT/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-rt-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[rt-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - RT - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-rt-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[rt-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - RT - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-rt-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[resilientstorage]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/$releasever-stream/ResilientStorage/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-resilientstorage-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[resilientstorage-debug]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - ResilientStorage - Debug</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-resilientstorage-debug-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[resilientstorage-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - ResilientStorage - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-resilientstorage-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[extras-common]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Extras packages</span><br><span class="line"><span class="comment">#baseurl=https://mirror.stream.centos.org/SIGs/$releasever-stream/extras/$basearch/extras-common/</span></span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-extras-sig-extras-common-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Extras-SHA512</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[extras-common-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Extras packages - Source</span><br><span class="line">metalink=https://mirrors.centos.org/metalink?repo=centos-extras-sig-extras-common-source-<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;protocol=https,http</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Extras-SHA512</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-AppStream.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-AppStream.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/AppStream/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-BaseOS.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-BaseOS.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/BaseOS/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-Debuginfo.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-Debuginfo.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># All debug packages are merged into a single repo, split by basearch, and are</span></span><br><span class="line"><span class="comment"># not signed.</span></span><br><span class="line"></span><br><span class="line">[debuginfo]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Debuginfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/<span class="variable">$stream</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-Extras-common.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-Extras-common.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[extras-common]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Extras common packages</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras-extras-common</span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/extras/$basearch/extras-common/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Extras</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-Extras.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-Extras.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/extras/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-HighAvailability.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-HighAvailability.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[ha]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/HighAvailability/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-Media.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can use this repo to install items directly off the installation media.</span></span><br><span class="line"><span class="comment"># Verify your mount point matches one of the below file:// paths.</span></span><br><span class="line"></span><br><span class="line">[media-baseos]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Media - BaseOS</span><br><span class="line">baseurl=file:///media/CentOS/BaseOS</span><br><span class="line">        file:///media/cdrom/BaseOS</span><br><span class="line">        file:///media/cdrecorder/BaseOS</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[media-appstream]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Media - AppStream</span><br><span class="line">baseurl=file:///media/CentOS/AppStream</span><br><span class="line">        file:///media/cdrom/AppStream</span><br><span class="line">        file:///media/cdrecorder/AppStream</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-NFV.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-NFV.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[nfv]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - NFV</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=NFV&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/NFV/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-PowerTools.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-PowerTools.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[powertools]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - PowerTools</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=PowerTools&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/PowerTools/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-RealTime.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-RealTime.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - RealTime</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/RT/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-ResilientStorage.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-ResilientStorage.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for CentOS updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[resilientstorage]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$stream</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=ResilientStorage&amp;infra=<span class="variable">$infra</span></span><br><span class="line"><span class="comment">#baseurl=http://mirror.centos.org/$contentdir/$stream/ResilientStorage/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/CentOS-Stream-Sources.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># CentOS-Stream-Sources.repo</span></span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/BaseOS/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/AppStream/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[powertools-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - PowerTools - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/PowerTools/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - Extras - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/extras/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[ha-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - HighAvailability - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/HighAvailability/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[rt-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - RT - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/RT/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[resilientstorage-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - ResilientStorage - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/ResilientStorage/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[nfv-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - NFV - Source</span><br><span class="line">baseurl=http://vault.centos.org/<span class="variable">$contentdir</span>/<span class="variable">$stream</span>/NFV/Source/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 Rocky Linux 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_RockyLinux</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/rocky.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># rocky.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[baseos]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[baseos-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=BaseOS-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[appstream-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=AppStream-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[crb]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - CRB</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=CRB-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/CRB/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[crb-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - CRB - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=CRB-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/CRB/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[crb-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - CRB - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=CRB-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/CRB/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/rocky-addons.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># rocky-addons.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[highavailability]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - High Availability</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[highavailability-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - High Availability - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[highavailability-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - High Availability - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=HighAvailability-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[resilientstorage]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Resilient Storage</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=ResilientStorage-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[resilientstorage-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Resilient Storage - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=ResilientStorage-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[resilientstorage-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Resilient Storage - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=ResilientStorage-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[nfv]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - NFV</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=NFV-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/NFV/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[nfv-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - NFV Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/NFV/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[nfv-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - NFV Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/NFV/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Realtime</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/RT/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[rt-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Realtime Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/RT/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[rt-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Realtime Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/RT/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[sap]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAP</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAP-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAP/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[sap-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAP Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAP-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAP/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[sap-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAP Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAP-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAP/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[saphana]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAPHANA</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAPHANA-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAPHANA/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[saphana-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAPHANA Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAPHANA-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAPHANA/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[saphana-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - SAPHANA Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=SAPHANA-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/SAPHANA/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/rocky-devel.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># rocky-devel.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># devel and no-package-left-behind</span></span><br><span class="line"></span><br><span class="line">[devel]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Devel WARNING! FOR BUILDROOT ONLY DO NOT LEAVE ENABLED</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=devel-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/devel/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/rocky-extras.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># rocky-extras.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/extras/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[extras-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Extras Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/extras/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Extras Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/extras/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[plus]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=plus-$releasever<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/plus/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[plus-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Plus - Debug</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=plus-<span class="variable">$releasever</span>-debug<span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/plus/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line"></span><br><span class="line">[plus-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Plus - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=plus-<span class="variable">$releasever</span>-<span class="built_in">source</span><span class="variable">$rltype</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/plus/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-AppStream.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-AppStream.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-BaseOS.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-BaseOS.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[baseos]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Debuginfo.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Debuginfo.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[baseos-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=BaseOS-<span class="variable">$releasever</span>-debug</span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[appstream-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=AppStream-<span class="variable">$releasever</span>-debug</span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[ha-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - High Availability - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability-<span class="variable">$releasever</span>-debug</span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[powertools-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - PowerTools - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=PowerTools-<span class="variable">$releasever</span>-debug</span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/PowerTools/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[resilient-storage-debug]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Resilient Storage - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=ResilientStorage-<span class="variable">$releasever</span>-debug</span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/$basearch/debug/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Devel.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Devel.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[devel]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Devel WARNING! FOR BUILDROOT AND KOJI USE</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=Devel-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/Devel/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Extras.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Extras.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=extras-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/extras/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-HighAvailability.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-HighAvailability.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[ha]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=HighAvailability-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Media.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can use this repo to install items directly off the installation media.</span></span><br><span class="line"><span class="comment"># Verify your mount point matches one of the below file:// paths.</span></span><br><span class="line"></span><br><span class="line">[media-baseos]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Media - BaseOS</span><br><span class="line">baseurl=file:///media/Rocky/BaseOS</span><br><span class="line">        file:///media/cdrom/BaseOS</span><br><span class="line">        file:///media/cdrecorder/BaseOS</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[media-appstream]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Media - AppStream</span><br><span class="line">baseurl=file:///media/Rocky/AppStream</span><br><span class="line">        file:///media/cdrom/AppStream</span><br><span class="line">        file:///media/cdrecorder/AppStream</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-NFV.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-NFV.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[nfv]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - NFV</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=NFV-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/nfv/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Plus.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Plus.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[plus]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=rockyplus-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/plus/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-PowerTools.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-PowerTools.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[powertools]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - PowerTools</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=PowerTools-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/PowerTools/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-ResilientStorage.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-ResilientStorage.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[resilient-storage]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=ResilientStorage-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-RT.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-RT.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The mirrorlist system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="comment"># update status of each mirror to pick current mirrors that are geographically</span></span><br><span class="line"><span class="comment"># close to the client.  You should use this for Rocky updates unless you are</span></span><br><span class="line"><span class="comment"># manually picking other mirrors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the mirrorlist does not work for you, you can try the commented out</span></span><br><span class="line"><span class="comment"># baseurl line instead.</span></span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Realtime</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=RT-<span class="variable">$releasever</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/RT/$basearch/os/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/Rocky-Sources.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># Rocky-Sources.repo</span></span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=BaseOS-<span class="variable">$releasever</span>-<span class="built_in">source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=AppStream-<span class="variable">$releasever</span>-<span class="built_in">source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/AppStream/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line"><span class="comment">#[extras-source]</span></span><br><span class="line"><span class="comment">#name=Rocky Linux $releasever - Extras - Source</span></span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.rockylinux.org/mirrorlist?arch=source&amp;repo=extras-$releasever-source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/extras/source/tree/</span></span><br><span class="line"><span class="comment">#gpgcheck=1</span></span><br><span class="line"><span class="comment">#enabled=0</span></span><br><span class="line"><span class="comment">#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[plus-source]</span></span><br><span class="line"><span class="comment">#name=Rocky Linux $releasever - Plus - Source</span></span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.rockylinux.org/mirrorlist?arch=source&amp;repo=plus-$releasever-source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/Plus/source/tree/</span></span><br><span class="line"><span class="comment">#gpgcheck=1</span></span><br><span class="line"><span class="comment">#enabled=0</span></span><br><span class="line"><span class="comment">#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"></span><br><span class="line">[ha-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - High Availability - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=HighAvailability-<span class="variable">$releasever</span>-<span class="built_in">source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/HighAvailability/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[powertools-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - PowerTools - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=PowerTools-<span class="variable">$releasever</span>-<span class="built_in">source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/PowerTools/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line"></span><br><span class="line">[resilient-storage-source]</span><br><span class="line">name=Rocky Linux <span class="variable">$releasever</span> - Resilient Storage - Source</span><br><span class="line">mirrorlist=https://mirrors.rockylinux.org/mirrorlist?<span class="built_in">arch</span>=<span class="built_in">source</span>&amp;repo=ResilientStorage-<span class="variable">$releasever</span>-<span class="built_in">source</span></span><br><span class="line"><span class="comment">#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/ResilientStorage/source/tree/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 AlmaLinux 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_AlmaLinux</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-appstream.repo &lt;&lt;\EOF</span><br><span class="line">[appstream]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/AppStream/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=1</span><br><span class="line"></span><br><span class="line">[appstream-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/AppStream/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/AppStream/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-baseos.repo &lt;&lt;\EOF</span><br><span class="line">[baseos]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=1</span><br><span class="line"></span><br><span class="line">[baseos-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/BaseOS/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/BaseOS/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-crb.repo &lt;&lt;\EOF</span><br><span class="line">[crb]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - CRB</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/crb</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/CRB/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[crb-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - CRB - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/crb-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/CRB/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[crb-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - CRB - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/crb-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/CRB/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-extras.repo &lt;&lt;\EOF</span><br><span class="line">[extras]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/extras/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[extras-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/extras/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/extras/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-highavailability.repo &lt;&lt;\EOF</span><br><span class="line">[highavailability]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/highavailability</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/HighAvailability/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[highavailability-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/highavailability-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/HighAvailability/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[highavailability-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/highavailability-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/HighAvailability/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-nfv.repo &lt;&lt;\EOF</span><br><span class="line">[nfv]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - NFV</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/NFV/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[nfv-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - NFV - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/NFV/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[nfv-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - NFV - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/NFV/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-plus.repo &lt;&lt;\EOF</span><br><span class="line">[plus]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/plus/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[plus-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/plus/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[plus-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/plus/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-resilientstorage.repo &lt;&lt;\EOF</span><br><span class="line">[resilientstorage]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/ResilientStorage/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[resilientstorage-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/ResilientStorage/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[resilientstorage-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/ResilientStorage/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-rt.repo &lt;&lt;\EOF</span><br><span class="line">[rt]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - RT</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/RT/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[rt-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - RT - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/RT/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[rt-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - RT - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/RT/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-sap.repo &lt;&lt;\EOF</span><br><span class="line">[sap]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/SAP/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[sap-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAP/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[sap-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAP/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-saphana.repo &lt;&lt;\EOF</span><br><span class="line">[saphana]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAPHANA</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/SAPHANA/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[saphana-debug]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAPHANA - Debug</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana-debug</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAPHANA/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line"></span><br><span class="line">[saphana-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAPHANA - Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAPHANA/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9</span><br><span class="line">metadata_expire=86400</span><br><span class="line">enabled_metadata=0</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-ha.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-ha.repo</span></span><br><span class="line"></span><br><span class="line">[ha]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/ha</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/HighAvailability/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[ha-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/ha-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/HighAvailability/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[ha-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - HighAvailability debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/ha-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/HighAvailability/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-nfv.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-nfv.repo</span></span><br><span class="line"></span><br><span class="line">[nfv]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time <span class="keyword">for</span> NFV</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/NFV/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[nfv-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time <span class="keyword">for</span> NFV Sources</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/NFV/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[nfv-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time <span class="keyword">for</span> NFV Debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/nfv-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/NFV/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-plus.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-plus.repo</span></span><br><span class="line"></span><br><span class="line">[plus]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/plus/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[plus-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/plus/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[plus-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Plus debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/plus-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/plus/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-powertools.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-powertools.repo</span></span><br><span class="line"></span><br><span class="line">[powertools]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - PowerTools</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/powertools</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/PowerTools/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[powertools-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - PowerTools Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/powertools-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/PowerTools/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[powertools-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - PowerTools debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/powertools-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/PowerTools/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-resilientstorage.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-resilientstorage.repo</span></span><br><span class="line"></span><br><span class="line">[resilientstorage]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/ResilientStorage/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[resilientstorage-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/ResilientStorage/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[resilientstorage-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - ResilientStorage debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/resilientstorage-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/ResilientStorage/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-rt.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-rt.repo</span></span><br><span class="line"></span><br><span class="line">[rt]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/RT/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[rt-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time Sources</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/RT/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[rt-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Real Time Debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/rt-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/RT/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-sap.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-sap.repo</span></span><br><span class="line"></span><br><span class="line">[sap]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/SAP/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[sap-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP Sources</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAP/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[sap-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP Debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/sap-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAP/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux-saphana.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux-saphana.repo</span></span><br><span class="line"></span><br><span class="line">[saphana]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP HANA</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/SAPHANA/$basearch/os/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[saphana-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP HANA Sources</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAPHANA/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[saphana-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - SAP HANA Debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/saphana-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/SAPHANA/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/almalinux.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># almalinux.repo</span></span><br><span class="line"></span><br><span class="line">[baseos]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/AppStream/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/$releasever/extras/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sources</span></span><br><span class="line">[baseos-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/BaseOS/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/AppStream/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras Source</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras-source</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/extras/Source/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuginfo</span></span><br><span class="line">[baseos-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - BaseOS debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/baseos-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/BaseOS/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[appstream-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - AppStream debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/appstream-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/AppStream/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line"></span><br><span class="line">[extras-debuginfo]</span><br><span class="line">name=AlmaLinux <span class="variable">$releasever</span> - Extras debuginfo</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/<span class="variable">$releasever</span>/extras-debuginfo</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/vault/$releasever/extras/debug/$basearch/</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 Fedora 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_Fedora</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-cisco-openh264.repo &lt;&lt;\EOF</span><br><span class="line">[fedora-cisco-openh264]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> openh264 (From Cisco) - <span class="variable">$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-cisco-openh264-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">enabled=1</span><br><span class="line">metadata_expire=14d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=True</span><br><span class="line"></span><br><span class="line">[fedora-cisco-openh264-debuginfo]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> openh264 (From Cisco) - <span class="variable">$basearch</span> - Debug</span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-cisco-openh264-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=14d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=True</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora.repo &lt;&lt;\EOF</span><br><span class="line">[fedora]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Everything/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">metadata_expire=7d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[fedora-debuginfo]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Everything/$basearch/debug/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[fedora-source]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-updates.repo &lt;&lt;\EOF</span><br><span class="line">[updates]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Updates</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-debuginfo]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Updates - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-debug-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-source]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - Updates Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Everything/SRPMS/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-source-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-modular.repo &lt;&lt;\EOF</span><br><span class="line">[fedora-modular]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Modular/$basearch/os/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-modular-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line"><span class="comment">#metadata_expire=7d</span></span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[fedora-modular-debuginfo]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Modular/$basearch/debug/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-modular-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[fedora-modular-source]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Modular/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-modular-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-updates-modular.repo &lt;&lt;\EOF</span><br><span class="line">[updates-modular]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Updates</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Modular/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-modular-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">countme=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-modular-debuginfo]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Updates - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Modular/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-modular-debug-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-modular-source]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - Updates Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Modular/SRPMS/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-modular-source-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-updates-testing.repo &lt;&lt;\EOF</span><br><span class="line">[updates-testing]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Test Updates</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/testing/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-testing-debuginfo]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Test Updates Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/testing/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-debug-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-testing-source]</span><br><span class="line">name=Fedora <span class="variable">$releasever</span> - Test Updates Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/testing/$releasever/Everything/SRPMS/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-source-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/fedora-updates-testing-modular.repo &lt;&lt;\EOF</span><br><span class="line">[updates-testing-modular]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Test Updates</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/testing/$releasever/Modular/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-modular-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">countme=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-testing-modular-debuginfo]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Test Updates Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Modular/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-modular-debug-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line"></span><br><span class="line">[updates-testing-modular-source]</span><br><span class="line">name=Fedora Modular <span class="variable">$releasever</span> - Test Updates Source</span><br><span class="line"><span class="comment">#baseurl=http://download.example/pub/fedora/linux/updates/$releasever/Modular/SRPMS/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-modular-source-f<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">gpgcheck=1</span><br><span class="line">metadata_expire=6h</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$releasever</span>-<span class="variable">$basearch</span></span><br><span class="line">skip_if_unavailable=False</span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 OpenCloudOS 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_OpenCloudOS</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/OpenCloudOS.repo &lt;&lt;\EOF</span><br><span class="line">[BaseOS]</span><br><span class="line">name=BaseOS <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[AppStream]</span><br><span class="line">name=AppStream <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=extras <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[BaseOS-debuginfo]</span><br><span class="line">name=BaseOS-debuginfo <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[AppStream-debuginfo]</span><br><span class="line">name=AppStream-debuginfo <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[extras-debuginfo]</span><br><span class="line">name=extras-debuginfo <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[BaseOS-<span class="built_in">source</span>]</span><br><span class="line">name=BaseOS-<span class="built_in">source</span> <span class="variable">$releasever</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[AppStream-<span class="built_in">source</span>]</span><br><span class="line">name=AppStream-<span class="built_in">source</span> <span class="variable">$releasever</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line"></span><br><span class="line">[extras-source]</span><br><span class="line">name=extras-source <span class="variable">$releasever</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/extras/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS-9</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/OpenCloudOS-Debuginfo.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># OpenCloudOS-Debuginfo.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: OpenCloudOS &lt;infrastructure@opencloudos.tech&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[BaseOS-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - BaseOS-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[AppStream-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - AppStream-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Extras-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Extras-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Extras/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[HighAvailability-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - HighAvailability-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/HighAvailability/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[PowerTools-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - PowerTools-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/PowerTools/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[ResilientStorage-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - ResilientStorage-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/ResilientStorage/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Plus-debuginfo]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Plus-debuginfo</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Plus/<span class="variable">$basearch</span>/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/OpenCloudOS.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># OpenCloudOS.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: OpenCloudOS &lt;infrastructure@opencloudos.tech&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[BaseOS]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - BaseOS</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[AppStream]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - AppStream</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Extras]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Extras</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Extras/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[HighAvailability]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - HighAvailability</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/HighAvailability/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[PowerTools]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - PowerTools</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/PowerTools/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[ResilientStorage]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - ResilientStorage</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/ResilientStorage/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Plus]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Plus</span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Plus/<span class="variable">$basearch</span>/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/OpenCloudOS-Sources.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment"># OpenCloudOS-Sources.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: OpenCloudOS &lt;infrastructure@opencloudos.tech&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[BaseOS-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Base-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[AppStream-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - AppStream-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Extras-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Extras-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Extras/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[HighAvailability-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - HighAvailability-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/HighAvailability/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[PowerTools-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - PowerTools-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/PowerTools/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[ResilientStorage-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - ResilientStorage-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/ResilientStorage/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line"></span><br><span class="line">[Plus-<span class="built_in">source</span>]</span><br><span class="line">name=OpenCloudOS <span class="variable">$releasever</span> - Plus-<span class="built_in">source</span></span><br><span class="line">baseurl=https://mirrors.opencloudos.tech/opencloudos/<span class="variable">$releasever</span>/Plus/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OpenCloudOS</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 openEuler 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_openEuler</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/openEuler.repo &lt;&lt;\EOF</span><br><span class="line"><span class="comment">#generic-repos is licensed under the Mulan PSL v2.</span></span><br><span class="line"><span class="comment">#You can use this software according to the terms and conditions of the Mulan PSL v2.</span></span><br><span class="line"><span class="comment">#You may obtain a copy of Mulan PSL v2 at:</span></span><br><span class="line"><span class="comment">#    http://license.coscl.org.cn/MulanPSL2</span></span><br><span class="line"><span class="comment">#THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR</span></span><br><span class="line"><span class="comment">#IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT, MERCHANTABILITY OR FIT FOR A PARTICULAR</span></span><br><span class="line"><span class="comment">#PURPOSE.</span></span><br><span class="line"><span class="comment">#See the Mulan PSL v2 for more details.</span></span><br><span class="line"></span><br><span class="line">[OS]</span><br><span class="line">name=OS</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/OS/<span class="variable">$basearch</span>/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/OS&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/OS/<span class="variable">$basearch</span>/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[everything]</span><br><span class="line">name=everything</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/everything/<span class="variable">$basearch</span>/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/everything&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/everything/<span class="variable">$basearch</span>/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[EPOL]</span><br><span class="line">name=EPOL</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/EPOL/main/<span class="variable">$basearch</span>/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/EPOL/main&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/OS/<span class="variable">$basearch</span>/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[debuginfo]</span><br><span class="line">name=debuginfo</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/debuginfo/<span class="variable">$basearch</span>/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/debuginfo&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/debuginfo/<span class="variable">$basearch</span>/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[<span class="built_in">source</span>]</span><br><span class="line">name=<span class="built_in">source</span></span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/source/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="built_in">source</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/source/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[update]</span><br><span class="line">name=update</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/update/<span class="variable">$basearch</span>/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/update&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/OS/<span class="variable">$basearch</span>/RPM-GPG-KEY-openEuler</span><br><span class="line"></span><br><span class="line">[update-source]</span><br><span class="line">name=update-source</span><br><span class="line">baseurl=http://repo.openeuler.org/openEuler-version/update/source/</span><br><span class="line">metalink=https://mirrors.openeuler.org/metalink?repo=<span class="variable">$releasever</span>/update&amp;<span class="built_in">arch</span>=<span class="built_in">source</span></span><br><span class="line">metadata_expire=1h</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://repo.openeuler.org/openEuler-version/source/RPM-GPG-KEY-openEuler</span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 openSUSE 官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_openSUSE</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;leap&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        15.[0-2])</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-non-oss]</span><br><span class="line">name=Debug Repository (Non-OSS)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/distribution/leap/<span class="variable">$releasever</span>/repo/non-oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug]</span><br><span class="line">name=Debug Repository</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-update-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-update-non-oss]</span><br><span class="line">name=Update Repository (Debug, Non-OSS)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/update/leap/<span class="variable">$releasever</span>/non-oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-update]</span><br><span class="line">name=Update Repository (Debug)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/update/leap/<span class="variable">$releasever</span>/oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-non-oss]</span><br><span class="line">name=Non-OSS Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/distribution/leap/<span class="variable">$releasever</span>/repo/non-oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-oss]</span><br><span class="line">name=Main Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-source-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-source-non-oss]</span><br><span class="line">name=Source Repository (Non-OSS)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/source/distribution/leap/<span class="variable">$releasever</span>/repo/non-oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-source.repo &lt;&lt;\EOF</span><br><span class="line">[repo-source]</span><br><span class="line">name=Source Repository</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/source/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-update-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-update-non-oss]</span><br><span class="line">name=Update Repository (Non-Oss)</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/non-oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-update]</span><br><span class="line">name=Main Update Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-backports-debug-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-backports-debug-update]</span><br><span class="line">name=Update repository with updates <span class="keyword">for</span> openSUSE Leap debuginfo packages from openSUSE Backports</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/backports_debug/</span><br><span class="line"><span class="built_in">type</span>=NONE</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-backports-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-backports-update]</span><br><span class="line">name=Update repository of openSUSE Backports</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/backports/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-non-oss]</span><br><span class="line">name=Debug Repository (Non-OSS)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/distribution/leap/<span class="variable">$releasever</span>/repo/non-oss/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug]</span><br><span class="line">name=Debug Repository</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-update-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-update-non-oss]</span><br><span class="line">name=Update Repository (Debug, Non-OSS)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/update/leap/<span class="variable">$releasever</span>/non-oss/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug-update]</span><br><span class="line">name=Update Repository (Debug)</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/update/leap/<span class="variable">$releasever</span>/oss/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-non-oss]</span><br><span class="line">name=Non-OSS Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/distribution/leap/<span class="variable">$releasever</span>/repo/non-oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-oss]</span><br><span class="line">name=Main Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-sle-debug-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-sle-debug-update]</span><br><span class="line">name=Update repository with debuginfo <span class="keyword">for</span> updates from SUSE Linux Enterprise 15</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/update/leap/<span class="variable">$releasever</span>/sle/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-sle-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-sle-update]</span><br><span class="line">name=Update repository with updates from SUSE Linux Enterprise 15</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/sle/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-source.repo &lt;&lt;\EOF</span><br><span class="line">[repo-source]</span><br><span class="line">name=Source Repository</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/source/distribution/leap/<span class="variable">$releasever</span>/repo/oss/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-update-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-update-non-oss]</span><br><span class="line">name=Update Repository (Non-Oss)</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/non-oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-update]</span><br><span class="line">name=Main Update Repository</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/leap/<span class="variable">$releasever</span>/oss/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;tumbleweed&quot;</span>)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-debug.repo &lt;&lt;\EOF</span><br><span class="line">[repo-debug]</span><br><span class="line">name=openSUSE-Tumbleweed-Debug</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/debug/tumbleweed/repo/oss/</span><br><span class="line">path=/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-non-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-non-oss]</span><br><span class="line">name=openSUSE-Tumbleweed-Non-Oss</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/tumbleweed/repo/non-oss/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-openh264.repo &lt;&lt;\EOF</span><br><span class="line">[repo-openh264]</span><br><span class="line">name=Open H.264 Codec (openSUSE Tumbleweed)</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://codecs.opensuse.org/openh264/openSUSE_Tumbleweed</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-oss.repo &lt;&lt;\EOF</span><br><span class="line">[repo-oss]</span><br><span class="line">name=openSUSE-Tumbleweed-Oss</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/tumbleweed/repo/oss/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-source.repo &lt;&lt;\EOF</span><br><span class="line">[repo-source]</span><br><span class="line">name=openSUSE-Tumbleweed-Source</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/source/tumbleweed/repo/oss/</span><br><span class="line">path=/</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_openSUSERepos</span>/repo-update.repo &lt;&lt;\EOF</span><br><span class="line">[repo-update]</span><br><span class="line">name=openSUSE-Tumbleweed-Update</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line">baseurl=http://download.opensuse.org/update/tumbleweed/</span><br><span class="line">path=/</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line">keeppackages=0</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成 EPEL 附加软件包官方 repo 源文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">GenRepoFiles_EPEL</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$&#123;SYSTEM_VERSION_NUMBER:0:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">    9)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel.repo &lt;&lt;\EOF</span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/$releasever/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-testing.repo &lt;&lt;\EOF</span><br><span class="line">[epel-testing]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Testing - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-epel<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line"></span><br><span class="line">[epel-testing-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Testing - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-debug-epel<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-testing-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Testing - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-source-epel<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-next.repo &lt;&lt;\EOF</span><br><span class="line">[epel-next]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/next/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-next-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line"></span><br><span class="line">[epel-next-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/next/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-next-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-next-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/next/$releasever/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-next-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-next-testing.repo &lt;&lt;\EOF</span><br><span class="line">[epel-next-testing]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - Testing - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/next/$releasever/Everything/$basearch/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-testing-next-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line"></span><br><span class="line">[epel-next-testing-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - Testing - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/next/$releasever/Everything/$basearch/debug/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-testing-next-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-next-testing-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> - Next - Testing - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/next/$releasever/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-testing-next-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-cisco-openh264.repo &lt;&lt;\EOF</span><br><span class="line">[epel-cisco-openh264]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> openh264 (From Cisco) - <span class="variable">$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">enabled=1</span><br><span class="line">metadata_expire=14d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">skip_if_unavailable=True</span><br><span class="line"></span><br><span class="line">[epel-cisco-openh264-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> openh264 (From Cisco) - <span class="variable">$basearch</span> - Debug</span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-debug-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=14d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">skip_if_unavailable=True</span><br><span class="line"></span><br><span class="line">[epel-cisco-openh264-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="variable">$releasever</span> openh264 (From Cisco) - <span class="variable">$basearch</span> - Source</span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-source-<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line"><span class="built_in">type</span>=rpm</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=14d</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="variable">$releasever</span></span><br><span class="line">skip_if_unavailable=True</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    8)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel.repo &lt;&lt;\EOF</span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Everything/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Everything/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place it&#x27;s address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-testing.repo &lt;&lt;\EOF</span><br><span class="line">[epel-testing]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - Testing - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Everything/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line"></span><br><span class="line">[epel-testing-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - Testing - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Everything/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-debug-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-testing-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 8 - Testing - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place it&#x27;s address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Everything/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-source-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-modular.repo &lt;&lt;\EOF</span><br><span class="line">[epel-modular]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - <span class="variable">$basearch</span> - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Modular/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line"></span><br><span class="line">[epel-modular-debuginfo]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - <span class="variable">$basearch</span> - Debug - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Modular/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-debug-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-modular-source]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - <span class="variable">$basearch</span> - Source - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place it&#x27;s address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/8/Modular/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-source-8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-testing-modular.repo &lt;&lt;\EOF</span><br><span class="line">[epel-testing-modular]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - Testing - <span class="variable">$basearch</span> - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Modular/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line"></span><br><span class="line">[epel-testing-modular-debuginfo]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - Testing - <span class="variable">$basearch</span> - Debug - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place its address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Modular/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-debug-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-testing-modular-source]</span><br><span class="line"><span class="comment"># This repo has been RETIRED, see https://pagure.io/epel/issue/198 for more details.</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux Modular 8 - Testing - <span class="variable">$basearch</span> - Source - RETIRED</span><br><span class="line"><span class="comment"># It is much more secure to use the metalink, but if you wish to use a local mirror</span></span><br><span class="line"><span class="comment"># place it&#x27;s address here.</span></span><br><span class="line"><span class="comment">#baseurl=https://download.example/pub/epel/testing/8/Modular/source/tree/</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-source-epel8&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;infra=<span class="variable">$infra</span>&amp;content=<span class="variable">$contentdir</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    7)</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel.repo &lt;&lt;\EOF</span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/7/SRPMS</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        <span class="built_in">cat</span> &gt;<span class="variable">$Dir_YumRepos</span>/epel-testing.repo &lt;&lt;\EOF</span><br><span class="line">[epel-testing]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - Testing - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/testing/7/$basearch</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-epel7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line"></span><br><span class="line">[epel-testing-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - Testing - <span class="variable">$basearch</span> - Debug</span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/testing/7/$basearch/debug</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-debug-epel7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">[epel-testing-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - Testing - <span class="variable">$basearch</span> - Source</span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/testing/7/SRPMS</span></span><br><span class="line">metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-source-epel7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 组合函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Combin_Functions</span></span>() &#123;</span><br><span class="line">    PermissionJudgment</span><br><span class="line">    EnvJudgment</span><br><span class="line">    CheckCommandOptions</span><br><span class="line">    StartTitle</span><br><span class="line">    ChooseMirrors</span><br><span class="line">    ChooseWebProtocol</span><br><span class="line">    ChooseInstallEPEL</span><br><span class="line">    CloseFirewall</span><br><span class="line">    BackupOriginalMirrors</span><br><span class="line">    RemoveOriginMirrors</span><br><span class="line">    ChangeMirrors</span><br><span class="line">    UpgradeSoftware</span><br><span class="line">    RunEnd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CommandOptions <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">Combin_Functions</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ChangeMirrors for linux</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>简繁转换器</title>
    <link href="http://example.com/2024/06/03/%E7%AE%80%E7%B9%81%E8%BD%AC%E6%8D%A2%E5%99%A8/"/>
    <id>http://example.com/2024/06/03/%E7%AE%80%E7%B9%81%E8%BD%AC%E6%8D%A2%E5%99%A8/</id>
    <published>2024-06-03T01:25:00.000Z</published>
    <updated>2024-06-03T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简繁转换器"><a href="#简繁转换器" class="headerlink" title="简繁转换器"></a>简繁转换器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox</span><br><span class="line"><span class="keyword">import</span> opencc</span><br><span class="line"></span><br><span class="line">s2t_converter = opencc.OpenCC(<span class="string">&#x27;s2t&#x27;</span>)</span><br><span class="line">t2s_converter = opencc.OpenCC(<span class="string">&#x27;t2s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_text</span>():</span><br><span class="line">    input_text = entry.get(<span class="string">&quot;1.0&quot;</span>, tk.END).strip()</span><br><span class="line">    traditional_text = s2t_converter.convert(input_text)</span><br><span class="line">    output.delete(<span class="string">&quot;1.0&quot;</span>, tk.END)</span><br><span class="line">    output.insert(tk.END, traditional_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_text</span>():</span><br><span class="line">    input_text = entry.get(<span class="string">&quot;1.0&quot;</span>, tk.END).strip()</span><br><span class="line">    simplified_text = t2s_converter.convert(input_text)</span><br><span class="line">    output.delete(<span class="string">&quot;1.0&quot;</span>, tk.END)</span><br><span class="line">    output.insert(tk.END, simplified_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">copy_text</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = output.get(<span class="string">&quot;1.0&quot;</span>, tk.END).strip()</span><br><span class="line">        <span class="keyword">if</span> text:</span><br><span class="line">            root.clipboard_clear()</span><br><span class="line">            root.clipboard_append(text)</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;成功&quot;</span>, <span class="string">&quot;文本已复制到剪贴板！&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            messagebox.showwarning(<span class="string">&quot;警告&quot;</span>, <span class="string">&quot;没有可复制的文本。&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;错误&quot;</span>, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">paste_text</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        clipboard_text = root.clipboard_get()</span><br><span class="line">        entry.delete(<span class="string">&quot;1.0&quot;</span>, tk.END)</span><br><span class="line">        entry.insert(tk.END, clipboard_text)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;错误&quot;</span>, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">&quot;简繁体文本转换器&quot;</span>)</span><br><span class="line"></span><br><span class="line">window_width = <span class="number">800</span></span><br><span class="line">window_height = <span class="number">600</span></span><br><span class="line">screen_width = root.winfo_screenwidth()</span><br><span class="line">screen_height = root.winfo_screenheight()</span><br><span class="line"></span><br><span class="line">x_coordinate = <span class="built_in">int</span>((screen_width - window_width) / <span class="number">2</span>)</span><br><span class="line">y_coordinate = <span class="built_in">int</span>((screen_height - window_height) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">root.geometry(<span class="string">f&quot;<span class="subst">&#123;window_width&#125;</span>x<span class="subst">&#123;window_height&#125;</span>+<span class="subst">&#123;x_coordinate&#125;</span>+<span class="subst">&#123;y_coordinate&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">entry = tk.Text(root)</span><br><span class="line">entry.pack(expand=<span class="literal">True</span>, fill=tk.BOTH, padx=<span class="number">20</span>, pady=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">button_frame = tk.Frame(root)</span><br><span class="line">button_frame.pack(pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">convert_button = tk.Button(button_frame, text=<span class="string">&quot;简体转繁体&quot;</span>, command=convert_text)</span><br><span class="line">convert_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">reverse_button = tk.Button(button_frame, text=<span class="string">&quot;繁体转简体&quot;</span>, command=reverse_text)</span><br><span class="line">reverse_button.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">copy_button = tk.Button(button_frame, text=<span class="string">&quot;复制文本&quot;</span>, command=copy_text)</span><br><span class="line">copy_button.grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">paste_button = tk.Button(button_frame, text=<span class="string">&quot;粘贴文本&quot;</span>, command=paste_text)</span><br><span class="line">paste_button.grid(row=<span class="number">0</span>, column=<span class="number">3</span>, padx=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">output = tk.Text(root)</span><br><span class="line">output.pack(expand=<span class="literal">True</span>, fill=tk.BOTH, padx=<span class="number">20</span>, pady=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">简体和繁体字之间的转换</summary>
    
    
    
    <category term="Python软件" scheme="http://example.com/categories/Python%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="Python软件" scheme="http://example.com/tags/Python%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>密码生成器</title>
    <link href="http://example.com/2024/06/01/%E5%AF%86%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <id>http://example.com/2024/06/01/%E5%AF%86%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/</id>
    <published>2024-06-01T01:25:00.000Z</published>
    <updated>2024-07-29T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="密码生成器"><a href="#密码生成器" class="headerlink" title="密码生成器"></a>密码生成器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox</span><br><span class="line"></span><br><span class="line">SIMILAR_CHARACTERS = <span class="string">&quot;il1Lo0O&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_password</span>(<span class="params">length, use_lowercase, use_uppercase, use_digits, use_special, avoid_similar</span>):</span><br><span class="line">    character_pools = &#123;</span><br><span class="line">        <span class="string">&quot;lowercase&quot;</span>: string.ascii_lowercase,</span><br><span class="line">        <span class="string">&quot;uppercase&quot;</span>: string.ascii_uppercase,</span><br><span class="line">        <span class="string">&quot;digits&quot;</span>: string.digits,</span><br><span class="line">        <span class="string">&quot;special&quot;</span>: string.punctuation</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    selected_pools = []</span><br><span class="line">    <span class="keyword">if</span> use_lowercase:</span><br><span class="line">        selected_pools.append(<span class="string">&quot;lowercase&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> use_uppercase:</span><br><span class="line">        selected_pools.append(<span class="string">&quot;uppercase&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> use_digits:</span><br><span class="line">        selected_pools.append(<span class="string">&quot;digits&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> use_special:</span><br><span class="line">        selected_pools.append(<span class="string">&quot;special&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> avoid_similar:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> character_pools:</span><br><span class="line">            character_pools[key] = <span class="string">&#x27;&#x27;</span>.join(c <span class="keyword">for</span> c <span class="keyword">in</span> character_pools[key] <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> SIMILAR_CHARACTERS)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> selected_pools:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;没有选择任何字符种类！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Ensure each selected pool contributes at least one character</span></span><br><span class="line">    password = [random.choice(character_pools[pool]) <span class="keyword">for</span> pool <span class="keyword">in</span> selected_pools]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fill the rest of the password length with random choices from the combined pool</span></span><br><span class="line">    all_characters = <span class="string">&#x27;&#x27;</span>.join(character_pools[pool] <span class="keyword">for</span> pool <span class="keyword">in</span> selected_pools)</span><br><span class="line">    password.extend(random.choice(all_characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length - <span class="built_in">len</span>(password)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Shuffle the result to avoid predictable patterns</span></span><br><span class="line">    random.shuffle(password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_generate</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        length = <span class="built_in">int</span>(length_var.get())</span><br><span class="line">        count = <span class="built_in">int</span>(count_var.get())</span><br><span class="line">        use_lowercase = lowercase_var.get()</span><br><span class="line">        use_uppercase = uppercase_var.get()</span><br><span class="line">        use_digits = digits_var.get()</span><br><span class="line">        use_special = special_var.get()</span><br><span class="line">        avoid_similar = avoid_similar_var.get()</span><br><span class="line"></span><br><span class="line">        result_text.delete(<span class="number">1.0</span>, tk.END)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">            password = generate_password(length, use_lowercase, use_uppercase, use_digits, use_special, avoid_similar)</span><br><span class="line">            result_text.insert(tk.END, password + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        messagebox.showerror(<span class="string">&quot;输入错误&quot;</span>, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_copy</span>():</span><br><span class="line">    root.clipboard_clear()</span><br><span class="line">    root.clipboard_append(result_text.get(<span class="string">&quot;1.0&quot;</span>, tk.END).strip())</span><br><span class="line">    messagebox.showinfo(<span class="string">&quot;提示&quot;</span>, <span class="string">&quot;密码已复制到剪贴板&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置主窗口</span></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">&quot;密码生成器V2.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使窗口在屏幕中央显示，并占据屏幕的一半</span></span><br><span class="line">screen_width = root.winfo_screenwidth()</span><br><span class="line">screen_height = root.winfo_screenheight()</span><br><span class="line">window_width = <span class="built_in">int</span>(screen_width / <span class="number">2</span>)</span><br><span class="line">window_height = <span class="built_in">int</span>(screen_height / <span class="number">2</span>)</span><br><span class="line">x_cordinate = <span class="built_in">int</span>((screen_width / <span class="number">2</span>) - (window_width / <span class="number">2</span>))</span><br><span class="line">y_cordinate = <span class="built_in">int</span>((screen_height / <span class="number">2</span>) - (window_height / <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">root.geometry(<span class="string">f&quot;<span class="subst">&#123;window_width&#125;</span>x<span class="subst">&#123;window_height&#125;</span>+<span class="subst">&#123;x_cordinate&#125;</span>+<span class="subst">&#123;y_cordinate&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置网格样式</span></span><br><span class="line">root.grid_rowconfigure(<span class="number">0</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_rowconfigure(<span class="number">6</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_columnconfigure(<span class="number">0</span>, weight=<span class="number">1</span>)</span><br><span class="line">root.grid_columnconfigure(<span class="number">1</span>, weight=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 长度输入</span></span><br><span class="line">tk.Label(root, text=<span class="string">&quot;密码长度:&quot;</span>).grid(row=<span class="number">1</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">length_var = tk.StringVar(value=<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">tk.Entry(root, textvariable=length_var).grid(row=<span class="number">1</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 个数输入</span></span><br><span class="line">tk.Label(root, text=<span class="string">&quot;生成密码个数:&quot;</span>).grid(row=<span class="number">2</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">count_var = tk.StringVar(value=<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">tk.Entry(root, textvariable=count_var).grid(row=<span class="number">2</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符种类选择</span></span><br><span class="line">lowercase_var = tk.BooleanVar(value=<span class="literal">True</span>)</span><br><span class="line">tk.Checkbutton(root, text=<span class="string">&quot;小写字母&quot;</span>, variable=lowercase_var).grid(row=<span class="number">3</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"></span><br><span class="line">uppercase_var = tk.BooleanVar(value=<span class="literal">True</span>)</span><br><span class="line">tk.Checkbutton(root, text=<span class="string">&quot;大写字母&quot;</span>, variable=uppercase_var).grid(row=<span class="number">3</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">digits_var = tk.BooleanVar(value=<span class="literal">True</span>)</span><br><span class="line">tk.Checkbutton(root, text=<span class="string">&quot;数字&quot;</span>, variable=digits_var).grid(row=<span class="number">4</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"></span><br><span class="line">special_var = tk.BooleanVar(value=<span class="literal">True</span>)</span><br><span class="line">tk.Checkbutton(root, text=<span class="string">&quot;特殊字符&quot;</span>, variable=special_var).grid(row=<span class="number">4</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">5</span>, sticky=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 避免相似字符</span></span><br><span class="line">avoid_similar_var = tk.BooleanVar(value=<span class="literal">False</span>)</span><br><span class="line">tk.Checkbutton(root, text=<span class="string">&quot;避免相似字符 (如 i, l, 1, L, o, 0, O )&quot;</span>, variable=avoid_similar_var).grid(row=<span class="number">5</span>, column=<span class="number">0</span>,</span><br><span class="line">                                                                                                     columnspan=<span class="number">2</span>,</span><br><span class="line">                                                                                                     padx=<span class="number">10</span>, pady=<span class="number">5</span>,</span><br><span class="line">                                                                                                     sticky=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按钮区</span></span><br><span class="line">btn_frame = tk.Frame(root)</span><br><span class="line">btn_frame.grid(row=<span class="number">6</span>, column=<span class="number">0</span>, columnspan=<span class="number">2</span>, pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">tk.Button(btn_frame, text=<span class="string">&quot;生成密码&quot;</span>, command=on_generate).pack(side=tk.LEFT, padx=<span class="number">10</span>)</span><br><span class="line">tk.Button(btn_frame, text=<span class="string">&quot;一键复制&quot;</span>, command=on_copy).pack(side=tk.RIGHT, padx=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果显示</span></span><br><span class="line">result_text = tk.Text(root, height=<span class="number">10</span>, width=<span class="number">60</span>)</span><br><span class="line">result_text.grid(row=<span class="number">7</span>, column=<span class="number">0</span>, columnspan=<span class="number">2</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行主循环</span></span><br><span class="line">root.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以自由生成密码并一键复制</summary>
    
    
    
    <category term="Python软件" scheme="http://example.com/categories/Python%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="Python软件" scheme="http://example.com/tags/Python%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>图片提取器</title>
    <link href="http://example.com/2024/05/31/%E6%8F%90%E5%8F%96%E5%9B%BE%E7%89%87%E5%99%A8/"/>
    <id>http://example.com/2024/05/31/%E6%8F%90%E5%8F%96%E5%9B%BE%E7%89%87%E5%99%A8/</id>
    <published>2024-05-31T01:25:00.000Z</published>
    <updated>2024-05-31T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="图片提取器"><a href="#图片提取器" class="headerlink" title="图片提取器"></a>图片提取器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> filedialog, messagebox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_images_to_current_dir</span>(<span class="params">current_dir</span>):</span><br><span class="line">    <span class="comment"># 遍历当前目录及其子目录</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(current_dir):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            <span class="comment"># 检查文件扩展名，确保是图片文件（如jpg, jpeg, png, gif等）</span></span><br><span class="line">            <span class="keyword">if</span> file.lower().endswith((<span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.gif&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>, <span class="string">&#x27;.tiff&#x27;</span>)):</span><br><span class="line">                full_file_path = os.path.join(root, file)</span><br><span class="line">                <span class="comment"># 目标路径是在当前目录</span></span><br><span class="line">                target_path = os.path.join(current_dir, file)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果目标文件已经存在，在文件名后面加一个计数来避免覆盖</span></span><br><span class="line">                <span class="keyword">if</span> os.path.exists(target_path):</span><br><span class="line">                    name, ext = os.path.splitext(file)</span><br><span class="line">                    count = <span class="number">1</span></span><br><span class="line">                    target_path = os.path.join(current_dir, <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>_<span class="subst">&#123;count&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">while</span> os.path.exists(target_path):</span><br><span class="line">                        count += <span class="number">1</span></span><br><span class="line">                        target_path = os.path.join(current_dir, <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>_<span class="subst">&#123;count&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 将文件复制到目标路径</span></span><br><span class="line">                shutil.copy2(full_file_path, target_path)</span><br><span class="line"></span><br><span class="line">    messagebox.showinfo(<span class="string">&quot;完成&quot;</span>, <span class="string">&quot;图片文件提取完成。&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">select_directory</span>():</span><br><span class="line">    <span class="comment"># 选择目录</span></span><br><span class="line">    current_dir = filedialog.askdirectory()</span><br><span class="line">    <span class="keyword">if</span> current_dir:</span><br><span class="line">        extract_images_to_current_dir(current_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">center_window_on_screen</span>(<span class="params">window</span>):</span><br><span class="line">    window_width = window.winfo_screenwidth() // <span class="number">2</span></span><br><span class="line">    window_height = window.winfo_screenheight() // <span class="number">2</span></span><br><span class="line">    window_x = window.winfo_screenwidth() // <span class="number">4</span></span><br><span class="line">    window_y = window.winfo_screenheight() // <span class="number">4</span></span><br><span class="line">    window.geometry(<span class="string">f&quot;<span class="subst">&#123;window_width&#125;</span>x<span class="subst">&#123;window_height&#125;</span>+<span class="subst">&#123;window_x&#125;</span>+<span class="subst">&#123;window_y&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主窗口</span></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">&quot;图片提取器&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口大小并居中</span></span><br><span class="line">center_window_on_screen(root)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建按钮来选择目录，并居中显示</span></span><br><span class="line">btn_select_directory = tk.Button(root, text=<span class="string">&quot;选择目录&quot;</span>, command=select_directory)</span><br><span class="line">btn_select_directory.pack(pady=<span class="number">20</span>)</span><br><span class="line">btn_select_directory.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.5</span>, anchor=tk.CENTER)  <span class="comment"># 居中显示按钮</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行Tkinter主循环</span></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以提取选定目录子目录里面的图片到当前目录</summary>
    
    
    
    <category term="Python软件" scheme="http://example.com/categories/Python%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="Python软件" scheme="http://example.com/tags/Python%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Redhat删除/home挂载点&amp;扩展到根</title>
    <link href="http://example.com/2024/05/30/Redhat%E5%88%A0%E9%99%A4home%E6%8C%82%E8%BD%BD%E7%82%B9&amp;%E6%89%A9%E5%B1%95%E5%88%B0%E6%A0%B9/"/>
    <id>http://example.com/2024/05/30/Redhat%E5%88%A0%E9%99%A4home%E6%8C%82%E8%BD%BD%E7%82%B9&amp;%E6%89%A9%E5%B1%95%E5%88%B0%E6%A0%B9/</id>
    <published>2024-05-30T01:25:00.000Z</published>
    <updated>2024-05-30T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redhat删除-home挂载点-扩展到根"><a href="#Redhat删除-home挂载点-扩展到根" class="headerlink" title="Redhat删除&#x2F;home挂载点&amp;扩展到根"></a>Redhat删除&#x2F;home挂载点&amp;扩展到根</h2><ul><li>备份&#x2F;home目录的数据（看情况）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -czvf /root/home_backup.tar.gz /home</span><br></pre></td></tr></table></figure><ul><li>卸载&#x2F;home挂载点</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof +D /home</span><br><span class="line">找到进程ID（PID），然后终止这些进程。例如，假设你找到的某个进程ID是1234：</span><br><span class="line">sudo <span class="built_in">kill</span> -9 1234</span><br><span class="line">umount /home</span><br></pre></td></tr></table></figure><ul><li>禁用并移除逻辑卷</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo lvremove /dev/rhel/home</span><br><span class="line"><span class="comment">#系统会提示你确认删除，输入y并按Enter</span></span><br></pre></td></tr></table></figure><ul><li>扩展根目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#扩展根逻辑卷rhel-root，将之前/home逻辑卷的空间分配给根逻辑卷。首先，分配rhel-home空间到rhel-root，你可以查看VG（Volume Group）信息以确定可用空间（这里假设VG名字是rhel）：</span></span><br><span class="line">sudo vgdisplay</span><br><span class="line">sudo lvextend -l +100%FREE /dev/rhel/root</span><br></pre></td></tr></table></figure><ul><li>调整文件系统大小</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo xfs_growfs /dev/rhel/root</span><br><span class="line"><span class="comment">#也可以确定一下使用的文件系统再操作：df -Th | grep &#x27;/dev/rhel/root&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>创建新的&#x2F;home目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /home</span><br></pre></td></tr></table></figure><ul><li>恢复&#x2F;home数据（看情况）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xzvf /root/home_backup.tar.gz -C /</span><br><span class="line">sudo reboot <span class="comment">#可以不重启</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">删除已有分区，扩展到根目录</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>一些常用的英语口语</title>
    <link href="http://example.com/2024/05/25/%E5%8F%A3%E8%AF%AD/"/>
    <id>http://example.com/2024/05/25/%E5%8F%A3%E8%AF%AD/</id>
    <published>2024-05-25T01:25:00.000Z</published>
    <updated>2024-05-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="点餐类口语"><a href="#点餐类口语" class="headerlink" title="点餐类口语"></a>点餐类口语</h3><table><thead><tr><th>1. Hello, can we have a table for two, please?</th><th>你好，请问我们可以订一个两人桌吗？</th></tr></thead><tbody><tr><td>2. Do you have a reservation?</td><td>您预订了吗？</td></tr><tr><td>3. Would you like to see a menu?</td><td>您想看看菜单吗？</td></tr><tr><td>4. Can I get you something to drink?</td><td>您想喝点什么？</td></tr><tr><td>5. What are today’s specials?</td><td>今天有什么特别推荐菜吗？</td></tr><tr><td>6. Could you tell me more about this dish?</td><td>能告诉我更多关于这道菜吗？</td></tr><tr><td>7. I’ll have the fish and chips, please.</td><td>我要一份炸鱼薯条。</td></tr><tr><td>8. Can I have mine without onions?</td><td>可以不加洋葱吗？</td></tr><tr><td>9. Is this dish suitable for vegetarians?</td><td>这道菜适合素食者吗？</td></tr><tr><td>10. Does this contain any nuts?</td><td>这个里面有坚果吗？</td></tr><tr><td>11. Can I get that to go, please?</td><td>请问我可以外带吗？</td></tr><tr><td>12. I’d like to order a dessert.</td><td>我想点一份甜点。</td></tr><tr><td>13. What desserts do you recommend?</td><td>你推荐哪些甜点？</td></tr><tr><td>14. We’ll have one of each, please.</td><td>我们每种都要一份，请。</td></tr><tr><td>15. Can you split the bill for us?</td><td>能为我们分开账单吗？</td></tr><tr><td>16. Do you accept credit cards?</td><td>你们接受信用卡吗？</td></tr><tr><td>17. Is service included in the bill?</td><td>账单里包含服务费吗？</td></tr><tr><td>18. Could we have some extra napkins, please?</td><td>能给我们多些餐巾纸吗？</td></tr><tr><td>19. Can I have some more water, please?</td><td>能再来点水吗？</td></tr><tr><td>20. I’d like a glass of house red, please.</td><td>我想要一杯红葡萄酒。</td></tr><tr><td>21. Could we get some bread for the table?</td><td>能给我们送点面包吗？</td></tr><tr><td>22. How spicy is this dish?</td><td>这道菜有多辣？</td></tr><tr><td>23. I’m allergic to shellfish, can you accommodate  that?</td><td>我对贝类过敏，你们能注意一下吗？</td></tr><tr><td>24. Can we get the check, please?</td><td>能给我们结账吗？</td></tr><tr><td>25. Can we move to that table?</td><td>我们能移到那张桌子吗？</td></tr><tr><td>26. What do you recommend for first-time visitors?</td><td>你推荐给第一次来的游客什么？</td></tr><tr><td>27. I’d like to start with the soup of the day.</td><td>我想先来一份今日特制的汤。</td></tr><tr><td>28. Can I make a reservation for tomorrow evening?</td><td>我能预订明晚的晚餐吗？</td></tr><tr><td>29. Do you offer any gluten-free options?</td><td>你们提供无麸质选项吗？</td></tr><tr><td>30. I’d like my steak medium-rare, please.</td><td>我的牛排请中熟。</td></tr><tr><td>31. Could we have separate checks, please?</td><td>能给我们分开付账单吗？</td></tr><tr><td>32. What kind of dressing comes with the salad?</td><td>沙拉配什么调味料？</td></tr><tr><td>33. Is there a kids’ menu?</td><td>有儿童菜单吗？</td></tr><tr><td>34. Does this come with a side dish?</td><td>这个配有副菜吗？</td></tr><tr><td>35. Can you make this dish without cheese?</td><td>这道菜可以不加奶酪吗？</td></tr><tr><td>36. Is there a vegetarian option for this?</td><td>这个有素食选项吗？</td></tr><tr><td>37. I’ll have the prawn cocktail to start.</td><td>我先来份明虾开胃菜。</td></tr><tr><td>38. Can we sit outside, please?</td><td>我们能坐在外面吗？</td></tr><tr><td>39. What’s your most popular dish?</td><td>你们最受欢迎的菜是什么？</td></tr><tr><td>40. Are there any vegan dishes on the menu?</td><td>菜单上有纯素菜吗？</td></tr><tr><td>41. How long is the wait for a table?</td><td>等位需要多久？</td></tr><tr><td>42. Could we have a table by the window?</td><td>能给我们安排一个靠窗的桌子吗？</td></tr><tr><td>43. Would you like any appetizers?</td><td>你们想要点开胃菜吗？</td></tr><tr><td>44. I’ll have a pint of lager, please.</td><td>我要一品脱啤酒。</td></tr><tr><td>45. Do you have any non-alcoholic beers?</td><td>你们有无酒精啤酒吗？</td></tr><tr><td>46. Can you make this dish spicier?</td><td>这道菜可以做得更辣一些吗？</td></tr><tr><td>47. Could you recommend a wine to go with this meal?</td><td>你能推荐一款适合这顿饭的葡萄酒吗？</td></tr><tr><td>48. Do you have any daily specials?</td><td>有每日特价菜吗？</td></tr><tr><td>49. Could we have some cutlery, please?</td><td>能给我们送些餐具吗？</td></tr><tr><td>50. Could you bring us some extra plates?</td><td>能给我们带些额外的盘子吗？</td></tr></tbody></table><table><thead><tr><th>0. Could we have a few more minutes to decide?</th><th>我们能再有几分钟来做决定吗？</th></tr></thead><tbody><tr><td>1. Can I see the wine list, please?</td><td>请问我能看一下酒单吗？</td></tr><tr><td>2. I’ll skip the appetizer and go straight to the main  course.</td><td>我跳过开胃菜，直接要主菜。</td></tr><tr><td>3. Do you have a high chair for the baby?</td><td>你们有给宝宝用的高脚椅吗？</td></tr><tr><td>4. I’d like to order the family meal deal.</td><td>我想点家庭套餐。</td></tr><tr><td>5. Is the soup of the day vegetarian?</td><td>今日的汤是素食的吗？</td></tr><tr><td>6. Could we have a jug of tap water, please?</td><td>能给我们一壶自来水吗？</td></tr><tr><td>7. Can I have an extra side of fries?</td><td>我能多要一份薯条吗？</td></tr><tr><td>8. I’d like the chef’s special, please.</td><td>我想要厨师特选，谢谢。</td></tr><tr><td>9. Do you offer takeout?</td><td>你们提供外卖服务吗？</td></tr><tr><td>10. Are all your sauces homemade?</td><td>你们所有的酱料都是自制的吗？</td></tr><tr><td>11. Could we get some more ketchup, please?</td><td>能再给我们一些番茄酱吗？</td></tr><tr><td>12. Can you recommend a dessert wine?</td><td>你能推荐一款餐后甜酒吗？</td></tr><tr><td>13. I’ll try the local specialty.</td><td>我要尝尝当地特色菜。</td></tr><tr><td>14. Can I get this dish with extra spice?</td><td>这道菜我能加辣吗？</td></tr><tr><td>15. Do you serve breakfast all day?</td><td>你们全天供应早餐吗？</td></tr><tr><td>16. What kind of fish is used in the fish and chips?</td><td>炸鱼薯条里用的是什么鱼？</td></tr><tr><td>17. Do you have any dairy-free desserts?</td><td>你们有不含乳制品的甜点吗？</td></tr><tr><td>18. Can you make that a double espresso?</td><td>能给我做成双份意式浓缩咖啡吗？</td></tr><tr><td>19. Is there a corkage fee if we bring our own wine?</td><td>如果我们自带葡萄酒，有开瓶费吗？</td></tr><tr><td>20. Could we get a round of waters for the table?</td><td>能给我们这桌来一轮水吗？</td></tr><tr><td>21. I’d like to start with the garlic bread.</td><td>我想先从蒜蓉面包开始。</td></tr><tr><td>22. Can you make a recommendation for a main course?</td><td>你能为主菜做个推荐吗？</td></tr><tr><td>23. What’s included with the tasting menu?</td><td>品尝菜单里都包括什么？</td></tr><tr><td>24. I’ll have my burger well-done, please.</td><td>我的汉堡要全熟的，谢谢。</td></tr><tr><td>25. Can I substitute the salad for chips?</td><td>我能把沙拉换成薯条吗？</td></tr><tr><td>26. Can we get some extra butter, please?</td><td>能给我们一些额外的黄油吗？</td></tr><tr><td>27. Are the chips cooked in vegetable oil?</td><td>薯条是用植物油炸的吗？</td></tr><tr><td>28. Does the lasagna contain beef?</td><td>千层面里有牛肉吗？</td></tr><tr><td>29. Can I have the sauce on the side?</td><td>能把酱汁放在一边吗？</td></tr><tr><td>30. I’d like a half portion, please.</td><td>我想要半份，谢谢。</td></tr><tr><td>31. Do you have any pale ales?</td><td>你们有淡色艾尔啤酒吗？</td></tr><tr><td>32. What flavors of ice cream do you have?</td><td>你们有什么口味的冰淇淋？</td></tr><tr><td>33. Can we have an order of nachos to start?</td><td>我们能先点一份玉米片吗？</td></tr><tr><td>34. Do you have a set menu for lunch?</td><td>你们午餐有套餐吗？</td></tr><tr><td>35. Could I see the cocktail menu, please?</td><td>请问我能看一下鸡尾酒菜单吗？</td></tr><tr><td>36. Is there a special for today?</td><td>今天有特别推荐吗？</td></tr><tr><td>37. Can I have my pasta with extra cheese?</td><td>我的意大利面能多加点奶酪吗？</td></tr><tr><td>38. Do you serve any organic dishes?</td><td>你们供应有机菜肴吗？</td></tr><tr><td>39. Could you bring the check, please?</td><td>能把账单拿来吗，谢谢？</td></tr><tr><td>40. What’s the soup of the day?</td><td>今天的汤是什么？</td></tr><tr><td>41. Is water complimentary?</td><td>水是免费的吗？</td></tr><tr><td>42. I’d like a small portion, please.</td><td>我想要小份的，谢谢。</td></tr><tr><td>43. Could we have some hot sauce, please?</td><td>能给我们一些辣椒酱吗？</td></tr><tr><td>44. Do you have any gluten-free bread?</td><td>你们有不含麸质的面包吗？</td></tr><tr><td>45. Can I have an extra napkin, please?</td><td>能给我一张额外的餐巾纸吗？</td></tr><tr><td>46. I’ll have a decaf coffee, please.</td><td>我要一杯无咖啡因咖啡，谢谢。</td></tr><tr><td>47. Could I get that with dressing on the side?</td><td>能把调味汁放在一边吗？</td></tr><tr><td>48. Do you have any fresh juices?</td><td>你们有新鲜果汁吗？</td></tr><tr><td>49. Can we have breakfast for dinner?</td><td>我们晚餐能吃早餐吗？</td></tr><tr><td>50. What’s on the cheeseboard today?</td><td>今天的奶酪拼盘里有什么？</td></tr><tr><td>51. I’ll have this red wine by the glass.</td><td>我要一杯这种红葡萄酒。</td></tr><tr><td>52. Could you recommend a good beer?</td><td>你能推荐一款好啤酒吗？</td></tr><tr><td>53. Can you make this dish vegan-friendly?</td><td>这道菜能做成纯素食的吗？</td></tr><tr><td>54. Are the vegetables steamed or sautéed?</td><td>蔬菜是蒸的还是炒的？</td></tr><tr><td>55. Do you offer a senior discount?</td><td>你们提供老年人折扣吗？</td></tr><tr><td>56. Can I get that with a different side?</td><td>我能换成不同的配菜吗？</td></tr><tr><td>57. Do you have any specials today?</td><td>你们今天有什么特别的吗？</td></tr><tr><td>58. Can I have mine with extra gravy?</td><td>我的能多加点肉汁吗？</td></tr><tr><td>59. Could we have a booster seat for the child?</td><td>能给孩子拿一个增高座椅吗？</td></tr><tr><td>60. Do you have any seasonal dishes?</td><td>你们有季节性的菜肴吗？</td></tr><tr><td>61. Can I get a refill on my soda?</td><td>我的苏打水能续杯吗？</td></tr><tr><td>62. Is this dish suitable for someone with a peanut  allergy?</td><td>这道菜对花生过敏的人合适吗？</td></tr><tr><td>63. What’s the catch of the day?</td><td>今天的捕获物是什么？</td></tr><tr><td>64. Could we order dessert?</td><td>我们能点甜点吗？</td></tr><tr><td>65. Do you have frappuccinos?</td><td>你们有星冰乐吗？</td></tr><tr><td>66. Can I have extra limes with my drink?</td><td>我的饮料能多加点青柠吗？</td></tr><tr><td>67. What’s your best vegetarian option?</td><td>你们最好的素食选择是什么？</td></tr><tr><td>68. Do you have any local beers on tap?</td><td>你们有当地的生啤吗？</td></tr><tr><td>69. I’d like to order a cappuccino, please.</td><td>我想点一杯卡布奇诺，谢谢。</td></tr><tr><td>70. Do you have this dish in a smaller size?</td><td>这道菜有小份的吗？</td></tr><tr><td>71. Can we get a side order of vegetables?</td><td>我们能点一份蔬菜配菜吗？</td></tr><tr><td>72. Can I have the chicken grilled instead of fried?</td><td>我的鸡肉能烤而不是炸吗？</td></tr><tr><td>73. Is there a charge for extra sauce?</td><td>额外的酱汁要收费吗？</td></tr><tr><td>74. Could I change my order, please?</td><td>我能改一下我的订单吗？</td></tr><tr><td>75. Are there free refills on coffee?</td><td>咖啡能免费续杯吗？</td></tr><tr><td>76. Can I have the same dish but with different sides?</td><td>我能要同样的菜但换不同的配菜吗？</td></tr><tr><td>77. Do you offer any sugar-free desserts?</td><td>你们提供无糖甜点吗？</td></tr><tr><td>78. Excuse me, there’s a mistake on our bill.</td><td>不好意思，我们的账单有误。</td></tr><tr><td>79. Do you have a happy hour special?</td><td>你们有欢乐时光特价</td></tr><tr><td>80. What kinds of cheeses do you have?</td><td>你们有哪些种类的奶酪？</td></tr><tr><td>81. Can you make sure my order is gluten-free?</td><td>你能确保我的订单不含麸质吗？</td></tr><tr><td>82. Are all the pastries made in-house?</td><td>所有的糕点都是店内制作的吗？</td></tr><tr><td>83. Could you bring us some menus, please?</td><td>能给我们拿些菜单吗，谢谢？</td></tr><tr><td>84. Is it possible to add chicken to my salad?</td><td>我的沙拉能加鸡肉吗？</td></tr><tr><td>85. Could I get this with less sauce, please?</td><td>能给我少放点酱汁吗？</td></tr><tr><td>86. Do you have whole wheat pasta?</td><td>你们有全麦面条吗？</td></tr><tr><td>87. Can I have my dressing on the side?</td><td>能把我的调味汁放在一边吗？</td></tr><tr><td>88. Could you bring the food when it’s ready?</td><td>食物做好能给我们送来吗？</td></tr><tr><td>89. Do you have any non-dairy milk options?</td><td>你们有非乳制品的牛奶选择吗？</td></tr><tr><td>90. Are there vegan options available?</td><td>有纯素食的选择吗？</td></tr><tr><td>91. What’s the spiciest dish you have?</td><td>你们最辣的菜是什么？</td></tr><tr><td>92. Can you make my coffee with almond milk?</td><td>能给我用杏仁奶做咖啡吗？</td></tr><tr><td>93. I’d like to start with the bruschetta.</td><td>我想先从意式烤面包片开始。</td></tr><tr><td>94. Can I have a side of sweet potato fries?</td><td>我能要一份红薯薯条吗？</td></tr><tr><td>95. Is this fish sustainably sourced?</td><td>这鱼是可持续捕捞的吗？</td></tr><tr><td>96. Do you have any craft beers?</td><td>你们有精酿啤酒吗？</td></tr><tr><td>97. Can I get the sauce on the side?</td><td>能把酱汁放在一边吗？</td></tr><tr><td>98. What’s the soup of the day?</td><td>今天的汤是什么？</td></tr><tr><td>99. Do you have any dairy-free options?</td><td>你们有不含乳制品的选择吗？</td></tr></tbody></table><table><thead><tr><th>0. Can I have this to take away?</th><th>我可以把这个带走吗？</th></tr></thead><tbody><tr><td>1. Do you have any dairy-free cream?</td><td>你们有不含乳制品的奶油吗？</td></tr><tr><td>2. What’s today’s pie?</td><td>今天的派是什么？</td></tr><tr><td>3. Do you have any low-carb options?</td><td>你们有低碳水的选择吗？</td></tr><tr><td>4. I’d like to add a side salad to my order.</td><td>我想在我的订单里加一份配菜沙拉。</td></tr><tr><td>5. Can you make this without butter?</td><td>这个可以不加黄油吗？</td></tr><tr><td>6. Can I get a side of avocado?</td><td>我可以要一份牛油果配菜吗？</td></tr><tr><td>7. Could I get a soy milk latte, please?</td><td>能给我来一杯豆奶拿铁吗？</td></tr><tr><td>8. Do you serve sparkling water?</td><td>你们供应苏打水吗？</td></tr><tr><td>9. What time do you stop serving breakfast?</td><td>你们什么时候停止供应早餐？</td></tr><tr><td>10. Can I swap the fries for a salad?</td><td>我可以把薯条换成沙拉吗？</td></tr><tr><td>11. Do you offer any meal deals?</td><td>你们有任何套餐优惠吗？</td></tr><tr><td>12. Can I have this without gluten?</td><td>这个可以不含麸质吗？</td></tr><tr><td>13. What’s the chef’s recommendation?</td><td>厨师推荐什么？</td></tr><tr><td>14. Can we get another round of drinks?</td><td>我们可以再要一轮饮料吗？</td></tr><tr><td>15. Are there any nuts in this dish?</td><td>这道菜里有坚果吗？</td></tr><tr><td>16. Is the meat grass-fed?</td><td>这肉是草饲的吗？</td></tr><tr><td>17. Can I get the topping on the side?</td><td>我可以把配料放在一边吗？</td></tr><tr><td>18. Do you have freshly squeezed juice?</td><td>你们有鲜榨果汁吗？</td></tr><tr><td>19. Are there any specials for today?</td><td>今天有什么特色菜吗？</td></tr><tr><td>20. Do you offer family-style dining?</td><td>你们提供家庭式用餐吗？</td></tr><tr><td>21. Can I mix and match the side dishes?</td><td>我可以混搭配菜吗？</td></tr><tr><td>22. Do you have decaf tea?</td><td>你们有不含咖啡因的茶吗？</td></tr><tr><td>23. Can we get two cups and a pot of tea?</td><td>我们可以要两个杯子和一壶茶吗？</td></tr><tr><td>24. What’s the freshest dish on the menu?</td><td>菜单上最新鲜的菜是什么？</td></tr><tr><td>25. Can I have a side order of fruit?</td><td>我可以要一份水果配菜吗？</td></tr><tr><td>26. Do you serve herbal tea?</td><td>你们供应花草茶吗？</td></tr><tr><td>27. What’s the dessert of the day?</td><td>今天的甜点是什么？</td></tr><tr><td>28. Do you serve breakfast all day?</td><td>你们全天供应早餐吗？</td></tr><tr><td>29. Can we sit in the garden area?</td><td>我们可以坐在花园区域吗？</td></tr><tr><td>30. Do you have any specials on the drinks?</td><td>你们的饮料有什么特别优惠吗？</td></tr><tr><td>31. Can I have my burger without the bun?</td><td>我的汉堡可以不要面包吗？</td></tr><tr><td>32. Do you have any mocktails?</td><td>你们有不含酒精的鸡尾酒吗？</td></tr><tr><td>33. Can I see the menu for specials?</td><td>我可以看一下特色菜的菜单吗？</td></tr><tr><td>34. Do you have any options for diabetics?</td><td>你们有适合糖尿病患者的选择吗？</td></tr><tr><td>35. What cheese is used in this dish?</td><td>这道菜用的是什么奶酪？</td></tr><tr><td>36. Do you have any hot beverages?</td><td>你们有热饮吗？</td></tr><tr><td>37. Can I get dressing on the side?</td><td>我可以把调味料放在一边吗？</td></tr><tr><td>38. Is there a lighter option for this dish?</td><td>这道菜有更清淡的选择吗？</td></tr><tr><td>39. Can I have the kids’ menu, please?</td><td>请给我儿童菜单好吗？</td></tr><tr><td>40. Do you have fresh mint tea?</td><td>你们有新鲜的薄荷茶吗？</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">生活里常用的一些口语</summary>
    
    
    
    <category term="英语" scheme="http://example.com/categories/%E8%8B%B1%E8%AF%AD/"/>
    
    
    <category term="英语" scheme="http://example.com/tags/%E8%8B%B1%E8%AF%AD/"/>
    
  </entry>
  
  <entry>
    <title>Nginx配置防盗链</title>
    <link href="http://example.com/2024/05/16/Nginx%E9%85%8D%E7%BD%AE%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE/"/>
    <id>http://example.com/2024/05/16/Nginx%E9%85%8D%E7%BD%AE%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE/</id>
    <published>2024-05-16T01:25:00.000Z</published>
    <updated>2024-05-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nginx配置防盗链"><a href="#Nginx配置防盗链" class="headerlink" title="Nginx配置防盗链"></a>Nginx配置防盗链</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">防盗链其实就是防止别的站点来引用你的资源, 占用你的流量</span><br></pre></td></tr></table></figure><p>在了解<code>nginx</code> 防盗链之前先了解一下什么是HTTP的头信息<code>Referer</code>,当浏览器访问网站的时候,一般会带上<code>Referer</code>,告诉后端该是从哪个页面过来的。<br><code>nginx</code>的防盗链功能基于<code>HTTP</code>协议的<code>Referer</code>机制,通过判断<code>Referer</code>对来源进行 识别和判断作出一定的处理<br><code>nginx</code>会通就过查看<code>referer</code>自动和<code>valid_referers</code>后面的内容进行匹配，如果匹配到了就将<code>invalid_referer</code> 变量置为1 ,如果没有匹配到 ， 则将<code>invalid_referer</code>变量置为0 , 匹配的过程中不区分大小写。</p><h2 id="一、配置盗链网站"><a href="#一、配置盗链网站" class="headerlink" title="一、配置盗链网站"></a>一、配置盗链网站</h2><ul><li>1.启动一台<code>nginx</code>虚拟机，配置两个网站</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/vhosts.conf</span><br></pre></td></tr></table></figure><p>添加以下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site1.test.com;</span><br><span class="line">    root /var/wwwroot/site1;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site2.test.com;</span><br><span class="line">    root /var/wwwroot/site2;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>2.在宿主机(windowns)编辑<code>C:\Windows\System32\drivers\etc\hosts</code>文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.147.10      site1.test.com</span><br><span class="line">192.168.147.10      site2.test.com</span><br></pre></td></tr></table></figure><ul><li>3.创建网站根目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /var/wwwroot</span><br><span class="line"><span class="built_in">cd</span> /var/wwwroot</span><br><span class="line"><span class="built_in">mkdir</span> site1</span><br><span class="line"><span class="built_in">mkdir</span> site2</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&lt;h1&gt;site1&lt;/h1&gt;&lt;img src=&#x27;1.jpg&#x27;&gt;&quot;</span> &gt;&gt; site1/index.html</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&lt;h1&gt;site2&lt;/h1&gt;&lt;img src=&#x27;http://site1.test.com/1.jpg&#x27;&gt;&quot;</span> &gt;&gt; site2/index.html</span><br></pre></td></tr></table></figure><ul><li><p>4.将<code>1.jpg</code>上传到<code>/var/wwwroot/site1</code>目录</p></li><li><p>5.启动<code>nginx</code>服务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br><span class="line">netstat -anpt | grep nginx</span><br></pre></td></tr></table></figure><ul><li>6.防火墙放通80端口（我默认关闭防火墙）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><ul><li>7.在宿主机访问</li></ul><p><code>http://site1.test.com</code></p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/PixPin_2024-05-31_14-26-36.png" alt="PixPin_2024-05-31_14-26-36" style="zoom:80%;" /><p><code>http://site2.test.com</code></p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240531142947372.png" alt="image-20240531142947372" style="zoom:80%;" /><h2 id="二、配置site1-test-com防盗链"><a href="#二、配置site1-test-com防盗链" class="headerlink" title="二、配置site1.test.com防盗链"></a>二、配置site1.test.com防盗链</h2><ul><li>1.编辑<code>nginx</code>配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site1.test.com;</span><br><span class="line">    root /var/wwwroot/site1;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.(jpg|png|gif|jpeg)$ &#123;</span><br><span class="line">        valid_referers site1.test.com;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">            <span class="built_in">return</span> 403;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site2.test.com;</span><br><span class="line">    root /var/wwwroot/site2;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#valid_referers site1.test.com;:这条指令检查请求来源，即用户从哪个页面跳转过来。这里只允许 site1.test.com 作为有效来源。</span></span><br><span class="line"><span class="comment">#if ($invalid_referer) &#123; return 403; &#125;: 如果来源不是 site1.test.com，则返回 403 禁止访问的错误。</span></span><br></pre></td></tr></table></figure><ul><li>2.重启<code>nginx</code>服务</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure><ul><li>3.在宿主机访问</li></ul><p>清除浏览器缓存，访问<code>http://site2.test.com</code></p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240531143239151.png" alt="image-20240531143239151"></p><p><em>可见，防盗链配置起到了作用</em></p><h2 id="三、配置防盗链返回其他资源"><a href="#三、配置防盗链返回其他资源" class="headerlink" title="三、配置防盗链返回其他资源"></a>三、配置防盗链返回其他资源</h2><ul><li>1.编辑<code>nginx</code>配置文件</li></ul><p>增加一个虚拟主机，对防盗链保护的资源进行重写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site1.test.com;</span><br><span class="line">    root /var/wwwroot/site1;</span><br><span class="line">    index index.html;</span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ \.(jpg|png|gif|jpeg)$ &#123;</span><br><span class="line">        valid_referers site1.test.com;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">            rewrite ^/ http://site3.test.com/notfound.jpg;</span><br><span class="line">            <span class="comment">#return 403;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site2.test.com;</span><br><span class="line">    root /var/wwwroot/site2;</span><br><span class="line">    index index.html;</span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name site3.test.com;</span><br><span class="line">    root /var/wwwroot/site3;</span><br><span class="line">    index index.html;</span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>解释</strong></p><p><code>location ~ \\.(jpg|png|gif|jpeg)$ &#123;&#125;</code>为设置防盗链的文件类型，使用竖线<code>|</code>分隔。<code>valid\_referers site1.test.com \*.</code>nginx<code>.org;</code>为白名单，使用空格分隔，可以使用<code>\*</code>进行泛域名设置。<code>if ($invalid\_referer) &#123;&#125;</code>为判断是否符合白名单，不符合白名单将执行{}内的内容。<code>rewrite ^/ http://site3.test.com/notfound.jpg;</code>为重写资源，如果不合符白名单，则重写为该地址。<code>return 403;</code>代表返回的状态码为403。</p><ul><li>2.建立<code>site3</code>根目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/wwwroot</span><br><span class="line"><span class="built_in">mkdir</span> site3</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&lt;h1&gt;site3&lt;/h1&gt;&lt;img src=&#x27;notfound.jpg&#x27;&gt;&quot;</span> &gt;&gt; site3/index.html</span><br></pre></td></tr></table></figure><ul><li><p>3.上传<code>notfound.jpg</code>文件至<code>/var/wwwroot/site3</code>目录</p></li><li><p>4.重启<code>nginx</code>服务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure><ul><li>5.在宿主机编辑<code>C:\Windows\System32\drivers\etc\hosts</code>文件</li></ul><p>增加对<code>site3.test.com</code>的映射</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.147.10      site1.test.com</span><br><span class="line">192.168.147.10      site2.test.com</span><br><span class="line">192.168.147.10      site3.test.com</span><br></pre></td></tr></table></figure><ul><li>6.在宿主机访问<code>http://site2.test.com</code></li></ul><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240531145409607.png" alt="image-20240531145409607"></p><p>可以看到，在<code>site2</code>中盗用的<code>site1</code>的<code>1.jpg</code>文件，被重定向到了<code>site3</code>上的<code>notfound.jpg</code>文件</p>]]></content>
    
    
    <summary type="html">Nginx配置防盗链</summary>
    
    
    
    <category term="Nginx" scheme="http://example.com/categories/Nginx/"/>
    
    
    <category term="Nginx" scheme="http://example.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>红帽系主机信息每日巡检脚本</title>
    <link href="http://example.com/2024/05/08/redhat%E7%B3%BBLinux%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/05/08/redhat%E7%B3%BBLinux%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC/</id>
    <published>2024-05-08T01:25:00.000Z</published>
    <updated>2024-05-08T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="红帽系主机信息每日巡检脚本"><a href="#红帽系主机信息每日巡检脚本" class="headerlink" title="红帽系主机信息每日巡检脚本"></a>红帽系主机信息每日巡检脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#主机信息每日巡检</span></span><br><span class="line"></span><br><span class="line">IPADDR=$(ifconfig ens160|grep <span class="string">&#x27;inet addr&#x27;</span>|awk -F <span class="string">&#x27;[ :]&#x27;</span> <span class="string">&#x27;&#123;print $13&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#环境变量PATH没设好，在cron里执行时有很多命令会找不到</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">[ $(<span class="built_in">id</span> -u) -gt 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;请用root用户执行此脚本！&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">centosVersion=$(awk <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span> /etc/redhat-release)</span><br><span class="line">VERSION=<span class="string">&quot;2024-03-16&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#日志相关</span></span><br><span class="line">PROGPATH=`<span class="built_in">echo</span> <span class="variable">$0</span> | sed -e <span class="string">&#x27;s,[\\/][^\\/][^\\/]*$,,&#x27;</span>`</span><br><span class="line">[ -f <span class="variable">$PROGPATH</span> ] &amp;&amp; PROGPATH=<span class="string">&quot;.&quot;</span></span><br><span class="line">LOGPATH=<span class="string">&quot;<span class="variable">$PROGPATH</span>/log&quot;</span></span><br><span class="line">[ -e <span class="variable">$LOGPATH</span> ] || <span class="built_in">mkdir</span> <span class="variable">$LOGPATH</span></span><br><span class="line">RESULTFILE=<span class="string">&quot;<span class="variable">$LOGPATH</span>/HostDailyCheck-<span class="variable">$IPADDR</span>-`date +%Y%m%d`.txt&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义报表的全局变量</span></span><br><span class="line">report_DateTime=<span class="string">&quot;&quot;</span> <span class="comment">#日期 ok</span></span><br><span class="line">report_Hostname=<span class="string">&quot;&quot;</span> <span class="comment">#主机名 ok</span></span><br><span class="line">report_OSRelease=<span class="string">&quot;&quot;</span> <span class="comment">#发行版本 ok</span></span><br><span class="line">report_Kernel=<span class="string">&quot;&quot;</span> <span class="comment">#内核 ok</span></span><br><span class="line">report_Language=<span class="string">&quot;&quot;</span> <span class="comment">#语言/编码 ok</span></span><br><span class="line">report_LastReboot=<span class="string">&quot;&quot;</span> <span class="comment">#最近启动时间 ok</span></span><br><span class="line">report_Uptime=<span class="string">&quot;&quot;</span> <span class="comment">#运行时间（天） ok</span></span><br><span class="line">report_CPUs=<span class="string">&quot;&quot;</span> <span class="comment">#CPU数量 ok</span></span><br><span class="line">report_CPUType=<span class="string">&quot;&quot;</span> <span class="comment">#CPU类型 ok</span></span><br><span class="line">report_Arch=<span class="string">&quot;&quot;</span> <span class="comment">#CPU架构 ok</span></span><br><span class="line">report_MemTotal=<span class="string">&quot;&quot;</span> <span class="comment">#内存总容量(MB) ok</span></span><br><span class="line">report_MemFree=<span class="string">&quot;&quot;</span> <span class="comment">#内存剩余(MB) ok</span></span><br><span class="line">report_MemUsedPercent=<span class="string">&quot;&quot;</span> <span class="comment">#内存使用率% ok</span></span><br><span class="line">report_DiskTotal=<span class="string">&quot;&quot;</span> <span class="comment">#硬盘总容量(GB) ok</span></span><br><span class="line">report_DiskFree=<span class="string">&quot;&quot;</span> <span class="comment">#硬盘剩余(GB) ok</span></span><br><span class="line">report_DiskUsedPercent=<span class="string">&quot;&quot;</span> <span class="comment">#硬盘使用率% ok</span></span><br><span class="line">report_InodeTotal=<span class="string">&quot;&quot;</span> <span class="comment">#Inode总量 ok</span></span><br><span class="line">report_InodeFree=<span class="string">&quot;&quot;</span> <span class="comment">#Inode剩余 ok</span></span><br><span class="line">report_InodeUsedPercent=<span class="string">&quot;&quot;</span> <span class="comment">#Inode使用率 ok</span></span><br><span class="line">report_IP=<span class="string">&quot;&quot;</span> <span class="comment">#IP地址 ok</span></span><br><span class="line">report_MAC=<span class="string">&quot;&quot;</span> <span class="comment">#MAC地址 ok</span></span><br><span class="line">report_Gateway=<span class="string">&quot;&quot;</span> <span class="comment">#默认网关 ok</span></span><br><span class="line">report_DNS=<span class="string">&quot;&quot;</span> <span class="comment">#DNS ok</span></span><br><span class="line">report_Listen=<span class="string">&quot;&quot;</span> <span class="comment">#监听 ok</span></span><br><span class="line">report_Selinux=<span class="string">&quot;&quot;</span> <span class="comment">#Selinux ok</span></span><br><span class="line">report_Firewall=<span class="string">&quot;&quot;</span> <span class="comment">#防火墙 ok</span></span><br><span class="line">report_USERs=<span class="string">&quot;&quot;</span> <span class="comment">#用户 ok</span></span><br><span class="line">report_USEREmptyPassword=<span class="string">&quot;&quot;</span> <span class="comment">#空密码用户 ok</span></span><br><span class="line">report_USERTheSameUID=<span class="string">&quot;&quot;</span> <span class="comment">#相同ID的用户 ok </span></span><br><span class="line">report_PasswordExpiry=<span class="string">&quot;&quot;</span> <span class="comment">#密码过期（天） ok</span></span><br><span class="line">report_RootUser=<span class="string">&quot;&quot;</span> <span class="comment">#root用户 ok</span></span><br><span class="line">report_Sudoers=<span class="string">&quot;&quot;</span> <span class="comment">#sudo授权 ok</span></span><br><span class="line">report_SSHAuthorized=<span class="string">&quot;&quot;</span> <span class="comment">#SSH信任主机 ok</span></span><br><span class="line">report_SSHDProtocolVersion=<span class="string">&quot;&quot;</span> <span class="comment">#SSH协议版本 ok</span></span><br><span class="line">report_SSHDPermitRootLogin=<span class="string">&quot;&quot;</span> <span class="comment">#允许root远程登录 ok</span></span><br><span class="line">report_DefunctProsess=<span class="string">&quot;&quot;</span> <span class="comment">#僵尸进程数量 ok</span></span><br><span class="line">report_SelfInitiatedService=<span class="string">&quot;&quot;</span> <span class="comment">#自启动服务数量 ok</span></span><br><span class="line">report_SelfInitiatedProgram=<span class="string">&quot;&quot;</span> <span class="comment">#自启动程序数量 ok</span></span><br><span class="line">report_RuningService=<span class="string">&quot;&quot;</span> <span class="comment">#运行中服务数 ok</span></span><br><span class="line">report_Crontab=<span class="string">&quot;&quot;</span> <span class="comment">#计划任务数 ok</span></span><br><span class="line">report_Syslog=<span class="string">&quot;&quot;</span> <span class="comment">#日志服务 ok</span></span><br><span class="line">report_SNMP=<span class="string">&quot;&quot;</span> <span class="comment">#SNMP OK</span></span><br><span class="line">report_NTP=<span class="string">&quot;&quot;</span> <span class="comment">#NTP ok</span></span><br><span class="line">report_JDK=<span class="string">&quot;&quot;</span> <span class="comment">#JDK版本 ok</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">version</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统巡检脚本：Version <span class="variable">$VERSION</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getCpuStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ CPU检查 #############################&quot;</span></span><br><span class="line">Physical_CPUs=$(grep <span class="string">&quot;physical id&quot;</span> /proc/cpuinfo| <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">Virt_CPUs=$(grep <span class="string">&quot;processor&quot;</span> /proc/cpuinfo | <span class="built_in">wc</span> -l)</span><br><span class="line">CPU_Kernels=$(grep <span class="string">&quot;cores&quot;</span> /proc/cpuinfo|<span class="built_in">uniq</span>| awk -F <span class="string">&#x27;: &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">CPU_Type=$(grep <span class="string">&quot;model name&quot;</span> /proc/cpuinfo | awk -F <span class="string">&#x27;: &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span>)</span><br><span class="line">CPU_Arch=$(<span class="built_in">uname</span> -m)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;物理CPU个数:<span class="variable">$Physical_CPUs</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;逻辑CPU个数:<span class="variable">$Virt_CPUs</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;每CPU核心数:<span class="variable">$CPU_Kernels</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; CPU型号:<span class="variable">$CPU_Type</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; CPU架构:<span class="variable">$CPU_Arch</span>&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_CPUs=<span class="variable">$Virt_CPUs</span> <span class="comment">#CPU数量</span></span><br><span class="line">report_CPUType=<span class="variable">$CPU_Type</span> <span class="comment">#CPU类型</span></span><br><span class="line">report_Arch=<span class="variable">$CPU_Arch</span> <span class="comment">#CPU架构</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getMemStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 内存检查 ############################&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$centosVersion</span> &lt; 7 ]];<span class="keyword">then</span></span><br><span class="line">free -h</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">free -h</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">MemTotal=$(grep MemTotal /proc/meminfo| awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>) <span class="comment">#KB</span></span><br><span class="line">MemFree=$(grep MemFree /proc/meminfo| awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>) <span class="comment">#KB</span></span><br><span class="line"><span class="built_in">let</span> MemUsed=MemTotal-MemFree</span><br><span class="line">MemPercent=$(awk <span class="string">&quot;BEGIN &#123;if(<span class="variable">$MemTotal</span>==0)&#123;printf 100&#125;else&#123;printf \&quot;%.2f\&quot;,<span class="variable">$MemUsed</span>*100/<span class="variable">$MemTotal</span>&#125;&#125;&quot;</span>)</span><br><span class="line">report_MemTotal=<span class="string">&quot;<span class="subst">$((MemTotal/1024)</span>)&quot;</span><span class="string">&quot;MB&quot;</span> <span class="comment">#内存总容量(MB)</span></span><br><span class="line">report_MemFree=<span class="string">&quot;<span class="subst">$((MemFree/1024)</span>)&quot;</span><span class="string">&quot;MB&quot;</span> <span class="comment">#内存剩余(MB)</span></span><br><span class="line">report_MemUsedPercent=<span class="string">&quot;<span class="subst">$(awk <span class="string">&quot;BEGIN &#123;if(<span class="variable">$MemTotal</span>==0)&#123;printf 100&#125;else&#123;printf \&quot;%.2f\&quot;,<span class="variable">$MemUsed</span>*100/<span class="variable">$MemTotal</span>&#125;&#125;&quot;</span>)</span>&quot;</span><span class="string">&quot;%&quot;</span> <span class="comment">#内存使用率%</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getDiskStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 磁盘检查 ############################&quot;</span></span><br><span class="line"><span class="built_in">df</span> -hiP | sed <span class="string">&#x27;s/Mounted on/Mounted/&#x27;</span>&gt; /tmp/inode</span><br><span class="line"><span class="built_in">df</span> -hTP | sed <span class="string">&#x27;s/Mounted on/Mounted/&#x27;</span>&gt; /tmp/disk </span><br><span class="line"><span class="built_in">join</span> /tmp/disk /tmp/inode | awk <span class="string">&#x27;&#123;print $1,$2,&quot;|&quot;,$3,$4,$5,$6,&quot;|&quot;,$8,$9,$10,$11,&quot;|&quot;,$12&#125;&#x27;</span>| column -t</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">diskdata=$(<span class="built_in">df</span> -TP | sed <span class="string">&#x27;1d&#x27;</span> | awk <span class="string">&#x27;$2!=&quot;tmpfs&quot;&#123;print&#125;&#x27;</span>) <span class="comment">#KB</span></span><br><span class="line">disktotal=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$diskdata</span>&quot;</span> | awk <span class="string">&#x27;&#123;total+=$3&#125;END&#123;print total&#125;&#x27;</span>) <span class="comment">#KB</span></span><br><span class="line">diskused=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$diskdata</span>&quot;</span> | awk <span class="string">&#x27;&#123;total+=$4&#125;END&#123;print total&#125;&#x27;</span>) <span class="comment">#KB</span></span><br><span class="line">diskfree=$((disktotal-diskused)) <span class="comment">#KB</span></span><br><span class="line">diskusedpercent=$(<span class="built_in">echo</span> <span class="variable">$disktotal</span> <span class="variable">$diskused</span> | awk <span class="string">&#x27;&#123;if($1==0)&#123;printf 100&#125;else&#123;printf &quot;%.2f&quot;,$2*100/$1&#125;&#125;&#x27;</span>) </span><br><span class="line">inodedata=$(<span class="built_in">df</span> -iTP | sed <span class="string">&#x27;1d&#x27;</span> | awk <span class="string">&#x27;$2!=&quot;tmpfs&quot;&#123;print&#125;&#x27;</span>)</span><br><span class="line">inodetotal=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$inodedata</span>&quot;</span> | awk <span class="string">&#x27;&#123;total+=$3&#125;END&#123;print total&#125;&#x27;</span>)</span><br><span class="line">inodeused=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$inodedata</span>&quot;</span> | awk <span class="string">&#x27;&#123;total+=$4&#125;END&#123;print total&#125;&#x27;</span>)</span><br><span class="line">inodefree=$((inodetotal-inodeused))</span><br><span class="line">inodeusedpercent=$(<span class="built_in">echo</span> <span class="variable">$inodetotal</span> <span class="variable">$inodeused</span> | awk <span class="string">&#x27;&#123;if($1==0)&#123;printf 100&#125;else&#123;printf &quot;%.2f&quot;,$2*100/$1&#125;&#125;&#x27;</span>)</span><br><span class="line">report_DiskTotal=$((disktotal/<span class="number">1024</span>/<span class="number">1024</span>))<span class="string">&quot;GB&quot;</span> <span class="comment">#硬盘总容量(GB)</span></span><br><span class="line">report_DiskFree=$((diskfree/<span class="number">1024</span>/<span class="number">1024</span>))<span class="string">&quot;GB&quot;</span> <span class="comment">#硬盘剩余(GB)</span></span><br><span class="line">report_DiskUsedPercent=<span class="string">&quot;<span class="variable">$diskusedpercent</span>&quot;</span><span class="string">&quot;%&quot;</span> <span class="comment">#硬盘使用率%</span></span><br><span class="line">report_InodeTotal=$((inodetotal/<span class="number">1000</span>))<span class="string">&quot;K&quot;</span> <span class="comment">#Inode总量</span></span><br><span class="line">report_InodeFree=$((inodefree/<span class="number">1000</span>))<span class="string">&quot;K&quot;</span> <span class="comment">#Inode剩余</span></span><br><span class="line">report_InodeUsedPercent=<span class="string">&quot;<span class="variable">$inodeusedpercent</span>&quot;</span><span class="string">&quot;%&quot;</span> <span class="comment">#Inode使用率%</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getSystemStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 系统检查 ############################&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -e /etc/sysconfig/i18n ];<span class="keyword">then</span></span><br><span class="line">default_LANG=<span class="string">&quot;<span class="subst">$(grep <span class="string">&quot;LANG=&quot;</span> /etc/sysconfig/i18n | grep -v <span class="string">&quot;^#&quot;</span> | awk -F &#x27;<span class="string">&quot;&#x27; &#x27;&#123;print <span class="variable">$2</span>&#125;&#x27;)&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">else</span></span></span><br><span class="line"><span class="subst"><span class="string">default_LANG=$LANG</span></span></span><br><span class="line"><span class="subst"><span class="string">fi</span></span></span><br><span class="line"><span class="subst"><span class="string">export LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">Release=$(cat /etc/redhat-release 2&gt;/dev/null)</span></span></span><br><span class="line"><span class="string">Kernel=<span class="subst">$(uname -r)</span></span></span><br><span class="line"><span class="string">OS=<span class="subst">$(uname -o)</span></span></span><br><span class="line"><span class="string">Hostname=<span class="subst">$(uname -n)</span></span></span><br><span class="line"><span class="string">SELinux=<span class="subst">$(/usr/sbin/sestatus | grep <span class="string">&quot;SELinux status: &quot;</span> | awk &#x27;&#123;print $3&#125;&#x27;)</span></span></span><br><span class="line"><span class="string">LastReboot=<span class="subst">$(who -b | awk &#x27;&#123;print $3,$4&#125;&#x27;)</span></span></span><br><span class="line"><span class="string">uptime=<span class="subst">$(uptime | sed &#x27;s/.*up \([^,]*\), .*/\1/&#x27;)</span></span></span><br><span class="line"><span class="string">echo &quot;</span> 系统：<span class="variable">$OS</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 发行版本：<span class="variable">$Release</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 内核：<span class="variable">$Kernel</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 主机名：<span class="variable">$Hostname</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> SELinux：<span class="variable">$SELinux</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>语言/编码：<span class="variable">$default_LANG</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 当前时间：$(<span class="built_in">date</span> +<span class="string">&#x27;%F %T&#x27;</span>)<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 最后启动：<span class="variable">$LastReboot</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> 运行时间：<span class="variable">$uptime</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">#报表信息</span></span><br><span class="line"><span class="string">report_DateTime=<span class="subst">$(date +<span class="string">&quot;%F %T&quot;</span>)</span> #日期</span></span><br><span class="line"><span class="string">report_Hostname=&quot;</span><span class="variable">$Hostname</span><span class="string">&quot; #主机名</span></span><br><span class="line"><span class="string">report_OSRelease=&quot;</span><span class="variable">$Release</span><span class="string">&quot; #发行版本</span></span><br><span class="line"><span class="string">report_Kernel=&quot;</span><span class="variable">$Kernel</span><span class="string">&quot; #内核</span></span><br><span class="line"><span class="string">report_Language=&quot;</span><span class="variable">$default_LANG</span><span class="string">&quot; #语言/编码</span></span><br><span class="line"><span class="string">report_LastReboot=&quot;</span><span class="variable">$LastReboot</span><span class="string">&quot; #最近启动时间</span></span><br><span class="line"><span class="string">report_Uptime=&quot;</span><span class="variable">$uptime</span><span class="string">&quot; #运行时间（天）</span></span><br><span class="line"><span class="string">report_Selinux=&quot;</span><span class="variable">$SELinux</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">export LANG=&quot;</span><span class="variable">$default_LANG</span><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function getServiceStatus()&#123;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="comment">############################ 服务检查 ############################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$centosVersion</span> &gt; 7 ]];<span class="keyword">then</span></span><br><span class="line">conf=$(systemctl list-unit-files --<span class="built_in">type</span>=service --state=enabled --no-pager | grep <span class="string">&quot;enabled&quot;</span>)</span><br><span class="line">process=$(systemctl list-units --<span class="built_in">type</span>=service --state=running --no-pager | grep <span class="string">&quot;.service&quot;</span>)</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_SelfInitiatedService=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$conf</span>&quot;</span> | wc -l)</span>&quot;</span> <span class="comment">#自启动服务数量</span></span><br><span class="line">report_RuningService=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$process</span>&quot;</span> | wc -l)</span>&quot;</span> <span class="comment">#运行中服务数量</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#conf=$(/sbin/chkconfig | grep -E &quot;:on|:启用&quot;)</span></span><br><span class="line">conf=$(systemctl list-unit-files --<span class="built_in">type</span>=service --state=enabled --no-pager | grep <span class="string">&quot;enabled&quot;</span>)</span><br><span class="line">process=$(systemctl list-units --<span class="built_in">type</span>=service --state=running --no-pager | grep <span class="string">&quot;.service&quot;</span>)</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_SelfInitiatedService=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$conf</span>&quot;</span> | wc -l)</span>&quot;</span> <span class="comment">#自启动服务数量</span></span><br><span class="line">report_RuningService=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$process</span>&quot;</span> | wc -l)</span>&quot;</span> <span class="comment">#运行中服务数量</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;服务配置&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$conf</span>&quot;</span> | column -t</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;正在运行的服务&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$process</span>&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getAutoStartStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 自启动检查 ##########################&quot;</span></span><br><span class="line">conf=$(grep -v <span class="string">&quot;^#&quot;</span> /etc/rc.d/rc.local| sed <span class="string">&#x27;/^$/d&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$conf</span>&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_SelfInitiatedProgram=<span class="string">&quot;<span class="subst">$(echo $conf | wc -l)</span>&quot;</span> <span class="comment">#自启动程序数量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getLoginStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 登录检查 ############################&quot;</span></span><br><span class="line">last | <span class="built_in">head</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getNetworkStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 网络检查 ############################&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$centosVersion</span> &lt; 7 ]];<span class="keyword">then</span></span><br><span class="line">/sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#ip a</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(ip <span class="built_in">link</span> | grep BROADCAST | awk -F: <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>);<span class="keyword">do</span> ip add show <span class="variable">$i</span> | grep -E <span class="string">&quot;BROADCAST|global&quot;</span>| awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27; &#x27;</span> ;<span class="built_in">echo</span> <span class="string">&quot;&quot;</span> ;<span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">GATEWAY=$(ip route | grep default | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">DNS=$(grep nameserver /etc/resolv.conf| grep -v <span class="string">&quot;#&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;,&#x27;</span> | sed <span class="string">&#x27;s/,$//&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;网关：<span class="variable">$GATEWAY</span> &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; DNS：<span class="variable">$DNS</span>&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk <span class="string">&#x27;&#123;print $NF,$2&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;,&#x27;</span> | sed <span class="string">&#x27;s/,$//&#x27;</span>)</span><br><span class="line">MAC=$(ip <span class="built_in">link</span> | grep -v <span class="string">&quot;LOOPBACK\|loopback&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | sed <span class="string">&#x27;N;s/\n//&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;,&#x27;</span> | sed <span class="string">&#x27;s/,$//&#x27;</span>)</span><br><span class="line">report_IP=<span class="string">&quot;<span class="variable">$IP</span>&quot;</span> <span class="comment">#IP地址</span></span><br><span class="line">report_MAC=<span class="variable">$MAC</span> <span class="comment">#MAC地址</span></span><br><span class="line">report_Gateway=<span class="string">&quot;<span class="variable">$GATEWAY</span>&quot;</span> <span class="comment">#默认网关</span></span><br><span class="line">report_DNS=<span class="string">&quot;<span class="variable">$DNS</span>&quot;</span> <span class="comment">#DNS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getListenStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 监听检查 ############################&quot;</span></span><br><span class="line">TCPListen=$(ss -ntul | column -t)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$TCPListen</span>&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_Listen=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$TCPListen</span>&quot;</span>| sed &#x27;1d&#x27; | awk &#x27;/tcp/ &#123;print $5&#125;&#x27; | awk -F: &#x27;&#123;print $NF&#125;&#x27; | sort | uniq | wc -l)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getCronStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 计划任务检查 ########################&quot;</span></span><br><span class="line">Crontab=0</span><br><span class="line"><span class="keyword">for</span> shell <span class="keyword">in</span> $(grep -v <span class="string">&quot;/sbin/nologin&quot;</span> /etc/shells);<span class="keyword">do</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(grep <span class="string">&quot;<span class="variable">$shell</span>&quot;</span> /etc/passwd| awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>);<span class="keyword">do</span></span><br><span class="line">crontab -l -u <span class="variable">$user</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">status=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$status</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$user</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line">crontab -l -u <span class="variable">$user</span></span><br><span class="line"><span class="built_in">let</span> Crontab=Crontab+$(crontab -l -u <span class="variable">$user</span> | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#计划任务</span></span><br><span class="line">find /etc/cron* -<span class="built_in">type</span> f | xargs -i <span class="built_in">ls</span> -l &#123;&#125; | column -t</span><br><span class="line"><span class="built_in">let</span> Crontab=Crontab+$(find /etc/cron* -<span class="built_in">type</span> f | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_Crontab=<span class="string">&quot;<span class="variable">$Crontab</span>&quot;</span> <span class="comment">#计划任务数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getHowLongAgo</span></span>()&#123;</span><br><span class="line"><span class="comment"># 计算一个时间戳离现在有多久了</span></span><br><span class="line">datetime=<span class="string">&quot;$*&quot;</span></span><br><span class="line">[ -z <span class="string">&quot;<span class="variable">$datetime</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;错误的参数：getHowLongAgo() $*&quot;</span></span><br><span class="line">Timestamp=$(<span class="built_in">date</span> +%s -d <span class="string">&quot;<span class="variable">$datetime</span>&quot;</span>) <span class="comment">#转化为时间戳</span></span><br><span class="line">Now_Timestamp=$(<span class="built_in">date</span> +%s)</span><br><span class="line">Difference_Timestamp=$((<span class="variable">$Now_Timestamp</span>-<span class="variable">$Timestamp</span>))</span><br><span class="line">days=0;hours=0;minutes=0;</span><br><span class="line">sec_in_day=$((<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>));</span><br><span class="line">sec_in_hour=$((<span class="number">60</span>*<span class="number">60</span>));</span><br><span class="line">sec_in_minute=60</span><br><span class="line"><span class="keyword">while</span> (( $((<span class="variable">$Difference_Timestamp</span>-<span class="variable">$sec_in_day</span>)) &gt; 1 ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> Difference_Timestamp=Difference_Timestamp-sec_in_day</span><br><span class="line"><span class="built_in">let</span> days++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">while</span> (( $((<span class="variable">$Difference_Timestamp</span>-<span class="variable">$sec_in_hour</span>)) &gt; 1 ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> Difference_Timestamp=Difference_Timestamp-sec_in_hour</span><br><span class="line"><span class="built_in">let</span> hours++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$days</span> 天 <span class="variable">$hours</span> 小时前&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getUserLastLogin</span></span>()&#123;</span><br><span class="line"><span class="comment"># 获取用户最近一次登录的时间，含年份</span></span><br><span class="line"><span class="comment"># 很遗憾last命令不支持显示年份，只有&quot;last -t YYYYMMDDHHMMSS&quot;表示某个时间之间的登录，我</span></span><br><span class="line"><span class="comment"># 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户</span></span><br><span class="line"><span class="comment"># 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。</span></span><br><span class="line">username=<span class="variable">$1</span></span><br><span class="line">: <span class="variable">$&#123;username:=&quot;`whoami`&quot;&#125;</span></span><br><span class="line">thisYear=$(<span class="built_in">date</span> +%Y)</span><br><span class="line">oldesYear=$(last | <span class="built_in">tail</span> -n1 | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span>(( <span class="variable">$thisYear</span> &gt;= <span class="variable">$oldesYear</span>));<span class="keyword">do</span></span><br><span class="line">loginBeforeToday=$(last <span class="variable">$username</span> | grep <span class="variable">$username</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">loginBeforeNewYearsDayOfThisYear=$(last <span class="variable">$username</span> -t <span class="variable">$thisYear</span><span class="string">&quot;0101000000&quot;</span> | grep <span class="variable">$username</span> | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$loginBeforeToday</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;从未登录过&quot;</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$loginBeforeToday</span> -gt <span class="variable">$loginBeforeNewYearsDayOfThisYear</span> ];<span class="keyword">then</span></span><br><span class="line">lastDateTime=$(last -i <span class="variable">$username</span> | <span class="built_in">head</span> -n1 | awk <span class="string">&#x27;&#123;for(i=4;i&lt;(NF-2);i++)printf&quot;%s &quot;,$i&#125;&#x27;</span>)<span class="string">&quot; <span class="variable">$thisYear</span>&quot;</span> <span class="comment">#格式如: Sat Nov 2 20:33 2015</span></span><br><span class="line">lastDateTime=$(<span class="built_in">date</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span> -d <span class="string">&quot;<span class="variable">$lastDateTime</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lastDateTime</span>&quot;</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">thisYear=$((thisYear-<span class="number">1</span>))</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getUserStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 用户检查 ############################&quot;</span></span><br><span class="line"><span class="comment">#/etc/passwd 最后修改时间</span></span><br><span class="line">pwdfile=<span class="string">&quot;<span class="subst">$(cat /etc/passwd)</span>&quot;</span></span><br><span class="line">Modify=$(<span class="built_in">stat</span> /etc/passwd | grep Modify | <span class="built_in">tr</span> <span class="string">&#x27;.&#x27;</span> <span class="string">&#x27; &#x27;</span> | awk <span class="string">&#x27;&#123;print $2,$3&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/passwd 最后修改时间：<span class="variable">$Modify</span> (<span class="subst">$(getHowLongAgo $Modify)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;特权用户&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line">RootUser=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>);<span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">id</span> -u <span class="variable">$user</span>) -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$user</span>&quot;</span></span><br><span class="line">RootUser=<span class="string">&quot;<span class="variable">$RootUser</span>,<span class="variable">$user</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;用户列表&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line">USERs=0</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(</span></span></span><br><span class="line"><span class="subst"><span class="string">echo <span class="string">&quot;用户名 UID GID HOME SHELL 最后一次登录&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">for shell in $(grep -v <span class="string">&quot;/sbin/nologin&quot;</span> /etc/shells)</span>;do</span></span><br><span class="line"><span class="string">for username in <span class="subst">$(grep <span class="string">&quot;<span class="variable">$shell</span>&quot;</span> /etc/passwd| awk -F: &#x27;&#123;print $1&#125;&#x27;)</span>;do</span></span><br><span class="line"><span class="string">userLastLogin=&quot;</span>$(getUserLastLogin <span class="variable">$username</span>)<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="variable">$pwdfile</span><span class="string">&quot; | grep -w &quot;</span><span class="variable">$username</span><span class="string">&quot; |grep -w &quot;</span><span class="variable">$shell</span><span class="string">&quot;| awk -F: -v lastlogin=&quot;</span>$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$userLastLogin</span>&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;_&#x27;</span>)<span class="string">&quot; &#x27;&#123;print <span class="variable">$1</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$6</span>,<span class="variable">$7</span>,lastlogin&#125;&#x27;</span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string">let USERs=USERs+<span class="subst">$(echo <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | grep <span class="string">&quot;<span class="variable">$shell</span>&quot;</span>| wc -l)</span></span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string">)&quot;</span> | column -t</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;空密码用户&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------&quot;</span></span><br><span class="line">USEREmptyPassword=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> shell <span class="keyword">in</span> $(grep -v <span class="string">&quot;/sbin/nologin&quot;</span> /etc/shells);<span class="keyword">do</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | grep <span class="string">&quot;<span class="variable">$shell</span>&quot;</span> | <span class="built_in">cut</span> -d: -f1);<span class="keyword">do</span></span><br><span class="line">r=$(awk -F: <span class="string">&#x27;$2==&quot;!!&quot;&#123;print $1&#125;&#x27;</span> /etc/shadow | grep -w <span class="variable">$user</span>)</span><br><span class="line"><span class="keyword">if</span> [ ! -z <span class="variable">$r</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$r</span></span><br><span class="line">USEREmptyPassword=<span class="string">&quot;<span class="variable">$USEREmptyPassword</span>,&quot;</span><span class="variable">$r</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;相同ID的用户&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------&quot;</span></span><br><span class="line">USERTheSameUID=<span class="string">&quot;&quot;</span></span><br><span class="line">UIDs=$(<span class="built_in">cut</span> -d: -f3 /etc/passwd | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | awk <span class="string">&#x27;$1&gt;1&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> uid <span class="keyword">in</span> <span class="variable">$UIDs</span>;<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$uid</span>&quot;</span>;</span><br><span class="line">USERTheSameUID=<span class="string">&quot;<span class="variable">$uid</span>&quot;</span></span><br><span class="line">r=$(awk -F: <span class="string">&#x27;ORS=&quot;&quot;;$3==&#x27;</span><span class="string">&quot;<span class="variable">$uid</span>&quot;</span><span class="string">&#x27;&#123;print &quot;:&quot;,$1&#125;&#x27;</span> /etc/passwd)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$r</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">USERTheSameUID=<span class="string">&quot;<span class="variable">$USERTheSameUID</span> <span class="variable">$r</span>,&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_USERs=<span class="string">&quot;<span class="variable">$USERs</span>&quot;</span> <span class="comment">#用户</span></span><br><span class="line">report_USEREmptyPassword=$(<span class="built_in">echo</span> <span class="variable">$USEREmptyPassword</span> | sed <span class="string">&#x27;s/^,//&#x27;</span>) </span><br><span class="line">report_USERTheSameUID=$(<span class="built_in">echo</span> <span class="variable">$USERTheSameUID</span> | sed <span class="string">&#x27;s/,$//&#x27;</span>) </span><br><span class="line">report_RootUser=$(<span class="built_in">echo</span> <span class="variable">$RootUser</span> | sed <span class="string">&#x27;s/^,//&#x27;</span>) <span class="comment">#特权用户</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getPasswordStatus &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 密码检查 ############################&quot;</span></span><br><span class="line">pwdfile=<span class="string">&quot;<span class="subst">$(cat /etc/passwd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密码过期检查&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------&quot;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> shell <span class="keyword">in</span> $(grep -v <span class="string">&quot;/sbin/nologin&quot;</span> /etc/shells);<span class="keyword">do</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | grep <span class="string">&quot;<span class="variable">$shell</span>&quot;</span> | <span class="built_in">cut</span> -d: -f1);<span class="keyword">do</span></span><br><span class="line">get_expiry_date=$(/usr/bin/chage -l <span class="variable">$user</span> | grep <span class="string">&#x27;Password expires&#x27;</span> | <span class="built_in">cut</span> -d: -f2)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$get_expiry_date</span> = <span class="string">&#x27; never&#x27;</span> || <span class="variable">$get_expiry_date</span> = <span class="string">&#x27;never&#x27;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-15s 永不过期\n&quot;</span> <span class="variable">$user</span></span><br><span class="line">result=<span class="string">&quot;<span class="variable">$result</span>,<span class="variable">$user</span>:never&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">password_expiry_date=$(<span class="built_in">date</span> -d <span class="string">&quot;<span class="variable">$get_expiry_date</span>&quot;</span> <span class="string">&quot;+%s&quot;</span>)</span><br><span class="line">current_date=$(<span class="built_in">date</span> <span class="string">&quot;+%s&quot;</span>)</span><br><span class="line">diff=$((<span class="variable">$password_expiry_date</span>-<span class="variable">$current_date</span>))</span><br><span class="line"><span class="built_in">let</span> DAYS=$((<span class="variable">$diff</span>/(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>)))</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-15s %s天后过期\n&quot;</span> <span class="variable">$user</span> <span class="variable">$DAYS</span></span><br><span class="line">result=<span class="string">&quot;<span class="variable">$result</span>,<span class="variable">$user</span>:<span class="variable">$DAYS</span> days&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">report_PasswordExpiry=$(<span class="built_in">echo</span> <span class="variable">$result</span> | sed <span class="string">&#x27;s/^,//&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密码策略检查&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------&quot;</span></span><br><span class="line">grep -v <span class="string">&quot;#&quot;</span> /etc/login.defs | grep -E <span class="string">&quot;PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getSudoersStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ Sudoers检查 #########################&quot;</span></span><br><span class="line">conf=$(grep -v <span class="string">&quot;^#&quot;</span> /etc/sudoers| grep -v <span class="string">&quot;^Defaults&quot;</span> | sed <span class="string">&#x27;/^$/d&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$conf</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_Sudoers=<span class="string">&quot;<span class="subst">$(echo $conf | wc -l)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getInstalledStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 软件检查 ############################&quot;</span></span><br><span class="line">rpm -qa --last | <span class="built_in">head</span> | column -t </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getProcessStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 进程检查 ############################&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ $(ps -ef | grep defunct | grep -v grep | <span class="built_in">wc</span> -l) -ge 1 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;僵尸进程&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line">ps -ef | <span class="built_in">head</span> -n1</span><br><span class="line">ps -ef | grep defunct | grep -v grep</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;内存占用TOP10&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;PID %MEM RSS COMMAND</span></span><br><span class="line"><span class="string"><span class="subst">$(ps aux | awk &#x27;&#123;print $2, $4, $6, $11&#125;&#x27; | sort -k3rn | head -n 10 )</span>&quot;</span>| column -t </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;CPU占用TOP10&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------&quot;</span></span><br><span class="line">top b -n1 | <span class="built_in">head</span> -17 | <span class="built_in">tail</span> -11</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_DefunctProsess=<span class="string">&quot;<span class="subst">$(ps -ef | grep defunct | grep -v grep|wc -l)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getJDKStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ JDK检查 #############################&quot;</span></span><br><span class="line">java -version 2&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">java -version 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;JAVA_HOME=\&quot;<span class="variable">$JAVA_HOME</span>\&quot;&quot;</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_JDK=<span class="string">&quot;<span class="subst">$(java -version 2&gt;&amp;1 | grep version | awk &#x27;&#123;print $1,$3&#125;&#x27; | tr -d &#x27;<span class="string">&quot;&#x27;)&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">&#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">function getSyslogStatus()</span>&#123;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="comment">############################ syslog检查 ##########################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;服务状态：<span class="subst">$(getState rsyslog)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/rsyslog.conf&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/rsyslog.conf 2&gt;/dev/null | grep -v <span class="string">&quot;^#&quot;</span> | grep -v <span class="string">&quot;^\\$&quot;</span> | sed <span class="string">&#x27;/^$/d&#x27;</span> | column -t</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_Syslog=<span class="string">&quot;<span class="subst">$(getState rsyslog)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getFirewallStatus</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 防火墙检查 ##########################&quot;</span></span><br><span class="line"><span class="comment">#防火墙状态，策略等</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$centosVersion</span> &lt; 7 ]];<span class="keyword">then</span></span><br><span class="line"><span class="comment">#/etc/init.d/iptables status &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line">systemctl status firewalld &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">status=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$status</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">s=<span class="string">&quot;active&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$status</span> -eq 3 ];<span class="keyword">then</span></span><br><span class="line">s=<span class="string">&quot;inactive&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$status</span> -eq 4 ];<span class="keyword">then</span></span><br><span class="line">s=<span class="string">&quot;permission denied&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">s=<span class="string">&quot;unknown&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">s=<span class="string">&quot;<span class="subst">$(getState iptables)</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;iptables: <span class="variable">$s</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/sysconfig/iptables&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/iptables 2&gt;/dev/null</span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_Firewall=<span class="string">&quot;<span class="variable">$s</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getSNMPStatus</span></span>()&#123;</span><br><span class="line"><span class="comment">#SNMP服务状态，配置等</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ SNMP检查 ############################&quot;</span></span><br><span class="line">status=<span class="string">&quot;<span class="subst">$(getState snmpd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;服务状态：<span class="variable">$status</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -e /etc/snmp/snmpd.conf ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/snmp/snmpd.conf&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v <span class="string">&quot;^#&quot;</span> | sed <span class="string">&#x27;/^$/d&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_SNMP=<span class="string">&quot;<span class="subst">$(getState snmpd)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getState</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$centosVersion</span> &lt; 7 ]];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;/etc/init.d/<span class="variable">$1</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ `/etc/init.d/<span class="variable">$1</span> status 2&gt;/dev/null | grep -E <span class="string">&quot;is running|正在运行&quot;</span> | <span class="built_in">wc</span> -l` -ge 1 ];<span class="keyword">then</span></span><br><span class="line">r=<span class="string">&quot;active&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">r=<span class="string">&quot;inactive&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">r=<span class="string">&quot;unknown&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#CentOS 7+</span></span><br><span class="line">r=<span class="string">&quot;<span class="subst">$(systemctl is-active $1 2&gt;&amp;1)</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$r</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getSSHStatus</span></span>()&#123;</span><br><span class="line"><span class="comment">#SSHD服务状态，配置,受信任主机等</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ SSH检查 #############################&quot;</span></span><br><span class="line"><span class="comment">#检查受信任主机</span></span><br><span class="line">pwdfile=<span class="string">&quot;<span class="subst">$(cat /etc/passwd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;服务状态：<span class="subst">$(getState sshd)</span>&quot;</span></span><br><span class="line">Protocol_Version=$(<span class="built_in">cat</span> /etc/ssh/sshd_config | grep Protocol | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SSH协议版本：<span class="variable">$Protocol_Version</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;信任主机&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------&quot;</span></span><br><span class="line">authorized=0</span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | grep /bin/bash | awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>);<span class="keyword">do</span></span><br><span class="line">authorize_file=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pwdfile</span>&quot;</span> | grep -w <span class="variable">$user</span> | awk -F: <span class="string">&#x27;&#123;printf $6&quot;/.ssh/authorized_keys&quot;&#125;&#x27;</span>)</span><br><span class="line">authorized_host=$(<span class="built_in">cat</span> <span class="variable">$authorize_file</span> 2&gt;/dev/null | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;,&#x27;</span> | sed <span class="string">&#x27;s/,$//&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ ! -z <span class="variable">$authorized_host</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$user</span> 授权 \&quot;<span class="variable">$authorized_host</span>\&quot; 无密码访问&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">let</span> authorized=authorized+$(<span class="built_in">cat</span> <span class="variable">$authorize_file</span> 2&gt;/dev/null | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>|<span class="built_in">wc</span> -l)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;是否允许ROOT远程登录&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------------&quot;</span></span><br><span class="line">config=$(<span class="built_in">cat</span> /etc/ssh/sshd_config | grep PermitRootLogin)</span><br><span class="line">firstChar=<span class="variable">$&#123;config:0:1&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$firstChar</span> == <span class="string">&quot;#&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">PermitRootLogin=<span class="string">&quot;yes&quot;</span> <span class="comment">#默认是允许ROOT远程登录的</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">PermitRootLogin=$(<span class="built_in">echo</span> <span class="variable">$config</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PermitRootLogin <span class="variable">$PermitRootLogin</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/ssh/sshd_config&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/ssh/sshd_config | grep -v <span class="string">&quot;^#&quot;</span> | sed <span class="string">&#x27;/^$/d&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_SSHAuthorized=<span class="string">&quot;<span class="variable">$authorized</span>&quot;</span> <span class="comment">#SSH信任主机</span></span><br><span class="line">report_SSHDProtocolVersion=<span class="string">&quot;<span class="variable">$Protocol_Version</span>&quot;</span> <span class="comment">#SSH协议版本</span></span><br><span class="line">report_SSHDPermitRootLogin=<span class="string">&quot;<span class="variable">$PermitRootLogin</span>&quot;</span> <span class="comment">#允许root远程登录</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getNTPStatus</span></span>()&#123;</span><br><span class="line"><span class="comment">#NTP服务状态，当前时间，配置等</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ NTP检查 #############################&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -e /etc/ntp.conf ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;服务状态：<span class="subst">$(getState ntpd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/ntp.conf&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/ntp.conf 2&gt;/dev/null | grep -v <span class="string">&quot;^#&quot;</span> | sed <span class="string">&#x27;/^$/d&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#报表信息</span></span><br><span class="line">report_NTP=<span class="string">&quot;<span class="subst">$(getState ntpd)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">uploadHostDailyCheckReport</span></span>()&#123;</span><br><span class="line">json=<span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">\&quot;DateTime\&quot;:\&quot;<span class="variable">$report_DateTime</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Hostname\&quot;:\&quot;<span class="variable">$report_Hostname</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;OSRelease\&quot;:\&quot;<span class="variable">$report_OSRelease</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Kernel\&quot;:\&quot;<span class="variable">$report_Kernel</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Language\&quot;:\&quot;<span class="variable">$report_Language</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;LastReboot\&quot;:\&quot;<span class="variable">$report_LastReboot</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Uptime\&quot;:\&quot;<span class="variable">$report_Uptime</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;CPUs\&quot;:\&quot;<span class="variable">$report_CPUs</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;CPUType\&quot;:\&quot;<span class="variable">$report_CPUType</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Arch\&quot;:\&quot;<span class="variable">$report_Arch</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;MemTotal\&quot;:\&quot;<span class="variable">$report_MemTotal</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;MemFree\&quot;:\&quot;<span class="variable">$report_MemFree</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;MemUsedPercent\&quot;:\&quot;<span class="variable">$report_MemUsedPercent</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;DiskTotal\&quot;:\&quot;<span class="variable">$report_DiskTotal</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;DiskFree\&quot;:\&quot;<span class="variable">$report_DiskFree</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;DiskUsedPercent\&quot;:\&quot;<span class="variable">$report_DiskUsedPercent</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;InodeTotal\&quot;:\&quot;<span class="variable">$report_InodeTotal</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;InodeFree\&quot;:\&quot;<span class="variable">$report_InodeFree</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;InodeUsedPercent\&quot;:\&quot;<span class="variable">$report_InodeUsedPercent</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;IP\&quot;:\&quot;<span class="variable">$report_IP</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;MAC\&quot;:\&quot;<span class="variable">$report_MAC</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Gateway\&quot;:\&quot;<span class="variable">$report_Gateway</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;DNS\&quot;:\&quot;<span class="variable">$report_DNS</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Listen\&quot;:\&quot;<span class="variable">$report_Listen</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Selinux\&quot;:\&quot;<span class="variable">$report_Selinux</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Firewall\&quot;:\&quot;<span class="variable">$report_Firewall</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;USERs\&quot;:\&quot;<span class="variable">$report_USERs</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;USEREmptyPassword\&quot;:\&quot;<span class="variable">$report_USEREmptyPassword</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;USERTheSameUID\&quot;:\&quot;<span class="variable">$report_USERTheSameUID</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;PasswordExpiry\&quot;:\&quot;<span class="variable">$report_PasswordExpiry</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;RootUser\&quot;:\&quot;<span class="variable">$report_RootUser</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Sudoers\&quot;:\&quot;<span class="variable">$report_Sudoers</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SSHAuthorized\&quot;:\&quot;<span class="variable">$report_SSHAuthorized</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SSHDProtocolVersion\&quot;:\&quot;<span class="variable">$report_SSHDProtocolVersion</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SSHDPermitRootLogin\&quot;:\&quot;<span class="variable">$report_SSHDPermitRootLogin</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;DefunctProsess\&quot;:\&quot;<span class="variable">$report_DefunctProsess</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SelfInitiatedService\&quot;:\&quot;<span class="variable">$report_SelfInitiatedService</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SelfInitiatedProgram\&quot;:\&quot;<span class="variable">$report_SelfInitiatedProgram</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;RuningService\&quot;:\&quot;<span class="variable">$report_RuningService</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Crontab\&quot;:\&quot;<span class="variable">$report_Crontab</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;Syslog\&quot;:\&quot;<span class="variable">$report_Syslog</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;SNMP\&quot;:\&quot;<span class="variable">$report_SNMP</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;NTP\&quot;:\&quot;<span class="variable">$report_NTP</span>\&quot;,</span></span><br><span class="line"><span class="string">\&quot;JDK\&quot;:\&quot;<span class="variable">$report_JDK</span>\&quot;</span></span><br><span class="line"><span class="string">&#125;&quot;</span></span><br><span class="line"><span class="comment">#echo &quot;$json&quot; </span></span><br><span class="line">curl -l -H <span class="string">&quot;Content-type: application/json&quot;</span> -X POST -d <span class="string">&quot;<span class="variable">$json</span>&quot;</span> <span class="string">&quot;<span class="variable">$uploadHostDailyCheckReportApi</span>&quot;</span> 2&gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getchage_file_24h</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;############################ 文件检查 #############################&quot;</span></span><br><span class="line">    check2=$(find / -name <span class="string">&#x27;*.sh&#x27;</span> -mtime -1)</span><br><span class="line">check21=$(find / -name <span class="string">&#x27;*.asp&#x27;</span> -mtime -1)</span><br><span class="line">check22=$(find / -name <span class="string">&#x27;*.php&#x27;</span> -mtime -1)</span><br><span class="line">check23=$(find / -name <span class="string">&#x27;*.aspx&#x27;</span> -mtime -1)</span><br><span class="line">check24=$(find / -name <span class="string">&#x27;*.jsp&#x27;</span> -mtime -1)</span><br><span class="line">check25=$(find / -name <span class="string">&#x27;*.html&#x27;</span> -mtime -1)</span><br><span class="line">check26=$(find / -name <span class="string">&#x27;*.htm&#x27;</span> -mtime -1)</span><br><span class="line">check9=$(find / -name core -<span class="built_in">exec</span> <span class="built_in">ls</span> -l &#123;&#125; \;)</span><br><span class="line">check10=$(<span class="built_in">cat</span> /etc/crontab)</span><br><span class="line">check12=$(<span class="built_in">ls</span> -alt /usr/bin | <span class="built_in">head</span> -10)</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">############################查看所有被修改过的文件返回最近24小时内的############################</span></span><br><span class="line"><span class="string">$&#123;check2&#125;</span></span><br><span class="line"><span class="string">$&#123;check21&#125;</span></span><br><span class="line"><span class="string">$&#123;check22&#125;</span></span><br><span class="line"><span class="string">$&#123;check23&#125;</span></span><br><span class="line"><span class="string">$&#123;check24&#125;</span></span><br><span class="line"><span class="string">$&#123;check25&#125;</span></span><br><span class="line"><span class="string">$&#123;check26&#125;</span></span><br><span class="line"><span class="string">$&#123;line&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">############################检查定时文件的完整性############################</span></span><br><span class="line"><span class="string">$&#123;check10&#125;</span></span><br><span class="line"><span class="string">$&#123;line&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">############################查看系统命令是否被替换############################</span></span><br><span class="line"><span class="string">$&#123;check12&#125;</span></span><br><span class="line"><span class="string">$&#123;line&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check</span></span>()&#123;</span><br><span class="line">version</span><br><span class="line">getSystemStatus</span><br><span class="line">getCpuStatus</span><br><span class="line">getMemStatus</span><br><span class="line">getDiskStatus</span><br><span class="line">getNetworkStatus</span><br><span class="line">getListenStatus</span><br><span class="line">getProcessStatus</span><br><span class="line">getServiceStatus</span><br><span class="line">getAutoStartStatus</span><br><span class="line">getLoginStatus</span><br><span class="line">getCronStatus</span><br><span class="line">getUserStatus</span><br><span class="line">getPasswordStatus</span><br><span class="line">getSudoersStatus</span><br><span class="line">getJDKStatus</span><br><span class="line">getFirewallStatus</span><br><span class="line">getSSHStatus</span><br><span class="line">getSyslogStatus</span><br><span class="line">getSNMPStatus</span><br><span class="line">getNTPStatus</span><br><span class="line">getInstalledStatus</span><br><span class="line">getchage_file_24h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行检查并保存检查结果</span></span><br><span class="line">check &gt; <span class="variable">$RESULTFILE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;检查结果：<span class="variable">$RESULTFILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;`date &quot;</span>+%Y-%m-%d %H:%M:%S<span class="string">&quot;` 红帽平台巡检报告&quot;</span>  | mail -a <span class="variable">$RESULTFILE</span> -s <span class="string">&quot;红帽平台巡检报告&quot;</span> <span class="built_in">test</span>@163.com</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">红帽系主机信息每日巡检脚本，有瑕疵，其他系统或者需要定制请自行修改</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>系统健康检查脚本（基础版）</title>
    <link href="http://example.com/2024/05/04/%E7%B3%BB%E7%BB%9F%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/"/>
    <id>http://example.com/2024/05/04/%E7%B3%BB%E7%BB%9F%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%EF%BC%89/</id>
    <published>2024-05-04T01:25:00.000Z</published>
    <updated>2024-05-04T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="系统健康检查脚本"><a href="#系统健康检查脚本" class="headerlink" title="系统健康检查脚本"></a>系统健康检查脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">##---------- 目的 : 快速检查并报告 Linux 系统的健康状态。----------##</span></span><br><span class="line"><span class="comment">##---------- 测试环境 : RHEL8/7/6/, SLES/SLED 15/12/11, Ubuntu20/18/16, CentOS-----------## </span></span><br><span class="line"><span class="comment">##---------- Boss6(Debian) 及其变体。它可能也适用于其他变体，但未经测试。 -----##</span></span><br><span class="line"><span class="comment">##-----注意: 此脚本需要 root 权限，否则可以使用 sudo 运行脚本 -------##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 mpstat 命令是否存在，如果不存在则安装 sysstat 软件包</span></span><br><span class="line"><span class="built_in">command</span> -v mpstat &gt;/dev/null 2&gt;&amp;1 || &#123; </span><br><span class="line">  <span class="built_in">echo</span> &gt;&amp;2 <span class="string">&quot;mpstat 命令未找到，正在尝试安装 sysstat 软件包...&quot;</span>; </span><br><span class="line"></span><br><span class="line">  <span class="comment"># 判断发行版并使用相应的包管理器安装</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">command</span> -v apt-get &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    sudo apt-get update &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">    sudo apt-get install -y sysstat &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> <span class="built_in">command</span> -v yum &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    sudo yum install -y sysstat &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> <span class="built_in">command</span> -v dnf &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    sudo dnf install -y sysstat &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> &gt;&amp;2 <span class="string">&quot;不支持的软件包管理器，请手动安装 sysstat 软件包.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> &gt;&amp;2 <span class="string">&quot;sysstat 软件包安装完成.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#------使用的变量------#</span></span><br><span class="line">S=<span class="string">&quot;************************************&quot;</span></span><br><span class="line">D=<span class="string">&quot;-------------------------------------&quot;</span></span><br><span class="line">COLOR=<span class="string">&quot;y&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取挂载点信息，过滤出ext4、ext3、xfs等文件系统，并排序</span></span><br><span class="line">MOUNT=$(mount|egrep -iw <span class="string">&quot;ext4|ext3|xfs|gfs|gfs2|btrfs&quot;</span>|grep -v <span class="string">&quot;loop&quot;</span>|<span class="built_in">sort</span> -u -t<span class="string">&#x27; &#x27;</span> -k1,2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件系统使用情况，过滤掉tmpfs等临时文件系统，并排序</span></span><br><span class="line">FS_USAGE=$(<span class="built_in">df</span> -PThl -x tmpfs -x iso9660 -x devtmpfs -x squashfs|awk <span class="string">&#x27;!seen[$1]++&#x27;</span>|<span class="built_in">sort</span> -k6n|<span class="built_in">tail</span> -n +2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取inode使用情况，过滤掉tmpfs等临时文件系统，并排序</span></span><br><span class="line">IUSAGE=$(<span class="built_in">df</span> -iPThl -x tmpfs -x iso9660 -x devtmpfs -x squashfs|awk <span class="string">&#x27;!seen[$1]++&#x27;</span>|<span class="built_in">sort</span> -k6n|<span class="built_in">tail</span> -n +2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置颜色变量</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$COLOR</span> == y ]; <span class="keyword">then</span></span><br><span class="line">&#123;</span><br><span class="line"> GCOLOR=<span class="string">&quot;\e[47;32m ------ OK/健康 \e[0m&quot;</span> <span class="comment"># 绿色</span></span><br><span class="line"> WCOLOR=<span class="string">&quot;\e[43;31m ------ 警告 \e[0m&quot;</span> <span class="comment"># 黄色</span></span><br><span class="line"> CCOLOR=<span class="string">&quot;\e[47;31m ------ 严重 \e[0m&quot;</span> <span class="comment"># 红色</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"> GCOLOR=<span class="string">&quot; ------ OK/健康 &quot;</span></span><br><span class="line"> WCOLOR=<span class="string">&quot; ------ 警告 &quot;</span></span><br><span class="line"> CCOLOR=<span class="string">&quot; ------ 严重 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$S</span>&quot;</span> <span class="comment"># 打印分隔符</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\t系统健康状态&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$S</span>&quot;</span> <span class="comment"># 打印分隔符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------打印操作系统详细信息--------#</span></span><br><span class="line"><span class="comment"># 获取主机名</span></span><br><span class="line">hostname -f &amp;&gt; /dev/null &amp;&amp; <span class="built_in">printf</span> <span class="string">&quot;主机名 : <span class="subst">$(hostname -f)</span>&quot;</span> || <span class="built_in">printf</span> <span class="string">&quot;主机名 : <span class="subst">$(hostname -s)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取操作系统版本信息</span></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&quot;\n操作系统 : &quot;</span></span><br><span class="line">[ -f /etc/os-release ] &amp;&amp; <span class="built_in">echo</span> $(egrep -w <span class="string">&quot;NAME|VERSION&quot;</span> /etc/os-release|awk -F= <span class="string">&#x27;&#123; print $2 &#125;&#x27;</span>|sed <span class="string">&#x27;s/&quot;//g&#x27;</span>) || <span class="built_in">cat</span> /etc/system-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取内核版本</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;内核版本 :&quot;</span> $(<span class="built_in">uname</span> -r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取操作系统架构</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;系统架构 :&quot;</span>$(<span class="built_in">arch</span> | grep x86_64 &amp;&gt; /dev/null) &amp;&amp; <span class="built_in">printf</span> <span class="string">&quot; 64 位操作系统\n&quot;</span>  || <span class="built_in">printf</span> <span class="string">&quot; 32 位操作系统\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------打印系统运行时间-------#</span></span><br><span class="line">UPTIME=$(<span class="built_in">uptime</span>) <span class="comment"># 获取系统运行时间</span></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&quot;系统运行时间 : &quot;</span></span><br><span class="line"><span class="comment"># 判断运行时间是否超过一天</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$UPTIME</span>|grep day &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 未超过一天，则判断是否超过一小时</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$UPTIME</span>|grep -w min &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> -en <span class="string">&quot;<span class="subst">$(echo $UPTIME|awk &#x27;&#123;print $2<span class="string">&quot; by &quot;</span>$3&#125;&#x27;|sed -e &#x27;s/,.*//g&#x27;)</span> 分钟&quot;</span> \</span><br><span class="line"> || <span class="built_in">echo</span> -en <span class="string">&quot;<span class="subst">$(echo $UPTIME|awk &#x27;&#123;print $2<span class="string">&quot; by &quot;</span>$3<span class="string">&quot; &quot;</span>$4&#125;&#x27;|sed -e &#x27;s/,.*//g&#x27;)</span> 小时&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 超过一天，则打印天数和小时数</span></span><br><span class="line">  <span class="built_in">echo</span> -en $(<span class="built_in">echo</span> <span class="variable">$UPTIME</span>|awk <span class="string">&#x27;&#123;print $2&quot; by &quot;$3&quot; &quot;$4&quot; &quot;$5&quot; 小时&quot;&#125;&#x27;</span>|sed -e <span class="string">&#x27;s/,//g&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印当前系统日期和时间</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n当前系统日期 &amp; 时间 : &quot;</span>$(<span class="built_in">date</span> +%c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查是否有只读文件系统--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n正在检查只读文件系统&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 检查是否有挂载为只读模式的文件系统</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MOUNT</span>&quot;</span>|grep -w ro &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\n.....找到只读文件系统&quot;</span>|| <span class="built_in">echo</span> -e <span class="string">&quot;.....未找到只读文件系统。 &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查当前挂载的文件系统--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查当前挂载的文件系统&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印所有挂载的文件系统</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MOUNT</span>&quot;</span>|column -t</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查所有挂载文件系统的磁盘使用情况--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查挂载文件系统的磁盘使用情况&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;( 0-85% = OK/健康,  85-95% = 警告,  95-100% = 严重 )&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;挂载文件系统使用率 (已用百分比):\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件系统名称和使用率</span></span><br><span class="line">COL1=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FS_USAGE</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $1 &quot; &quot;$7&#125;&#x27;</span>)</span><br><span class="line">COL2=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FS_USAGE</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span>|sed -e <span class="string">&#x27;s/%//g&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据使用率设置颜色</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL2</span>&quot;</span>); <span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$i</span> -ge 95 ]; <span class="keyword">then</span></span><br><span class="line">    COL3=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$CCOLOR</span>\n<span class="variable">$COL3</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率大于等于95%，设置为红色</span></span><br><span class="line">  <span class="keyword">elif</span> [[ <span class="variable">$i</span> -ge 85 &amp;&amp; <span class="variable">$i</span> -lt 95 ]]; <span class="keyword">then</span></span><br><span class="line">    COL3=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$WCOLOR</span>\n<span class="variable">$COL3</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率大于等于85%小于95%，设置为黄色</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    COL3=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$GCOLOR</span>\n<span class="variable">$COL3</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率小于85%，设置为绿色</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序并打印结果</span></span><br><span class="line">COL3=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL3</span>&quot;</span>|<span class="built_in">sort</span> -k1n)</span><br><span class="line"><span class="built_in">paste</span>  &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL1</span>&quot;</span>) &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL3</span>&quot;</span>) -d<span class="string">&#x27; &#x27;</span>|column -t</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查是否有僵尸进程--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查僵尸进程&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 查找状态为Z的进程</span></span><br><span class="line">ps -eo <span class="built_in">stat</span>|grep -w Z 1&gt;&amp;2 &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? == 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 如果找到僵尸进程，则打印数量和详细信息</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;系统上的僵尸进程数量为 :&quot;</span> $(ps -eo <span class="built_in">stat</span>|grep -w Z|<span class="built_in">wc</span> -l)</span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\n  找到的每个僵尸进程的详细信息   &quot;</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;  <span class="variable">$D</span>&quot;</span></span><br><span class="line">  ZPROC=$(ps -eo <span class="built_in">stat</span>,pid|grep -w Z|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ZPROC</span>&quot;</span>); <span class="keyword">do</span></span><br><span class="line">      ps -o pid,ppid,user,<span class="built_in">stat</span>,args -p <span class="variable">$i</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 否则打印未找到僵尸进程</span></span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;系统上未找到僵尸进程。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查inode使用情况--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查 INode 使用情况&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;( 0-85% = OK/健康,  85-95% = 警告,  95-100% = 严重 )&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;INode 使用率 (已用百分比):\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件系统名称和inode使用率</span></span><br><span class="line">COL11=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IUSAGE</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $1&quot; &quot;$7&#125;&#x27;</span>)</span><br><span class="line">COL22=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IUSAGE</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span>|sed -e <span class="string">&#x27;s/%//g&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据inode使用率设置颜色</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL22</span>&quot;</span>); <span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> [[ <span class="variable">$i</span> = *[[:digit:]]* ]]; <span class="keyword">then</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$i</span> -ge 95 ]; <span class="keyword">then</span></span><br><span class="line">    COL33=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$CCOLOR</span>\n<span class="variable">$COL33</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率大于等于95%，设置为红色</span></span><br><span class="line">  <span class="keyword">elif</span> [[ <span class="variable">$i</span> -ge 85 &amp;&amp; <span class="variable">$i</span> -lt 95 ]]; <span class="keyword">then</span></span><br><span class="line">    COL33=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$WCOLOR</span>\n<span class="variable">$COL33</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率大于等于85%小于95%，设置为黄色</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    COL33=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% <span class="variable">$GCOLOR</span>\n<span class="variable">$COL33</span>&quot;</span>)</span>&quot;</span> <span class="comment"># 使用率小于85%，设置为绿色</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    COL33=<span class="string">&quot;<span class="subst">$(echo -e $i<span class="string">&quot;% (Inode 百分比详细信息不可用)\n<span class="variable">$COL33</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序并打印结果</span></span><br><span class="line">COL33=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL33</span>&quot;</span>|<span class="built_in">sort</span> -k1n)</span><br><span class="line"><span class="built_in">paste</span>  &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL11</span>&quot;</span>) &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$COL33</span>&quot;</span>) -d<span class="string">&#x27; &#x27;</span>|column -t</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查SWAP使用情况--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查 SWAP 详细信息&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印总SWAP内存大小</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;总 SWAP 内存 (MiB) : &quot;</span>$(grep -w SwapTotal /proc/meminfo|awk <span class="string">&#x27;&#123;print $2/1024&#125;&#x27;</span>)<span class="string">&quot;, (GiB) : &quot;</span>\</span><br><span class="line">$(grep -w SwapTotal /proc/meminfo|awk <span class="string">&#x27;&#123;print $2/1024/1024&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># 打印空闲SWAP内存大小</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;空闲 SWAP 内存 (MiB) : &quot;</span>$(grep -w SwapFree /proc/meminfo|awk <span class="string">&#x27;&#123;print $2/1024&#125;&#x27;</span>)<span class="string">&quot;, (GiB) : &quot;</span>\</span><br><span class="line">$(grep -w SwapFree /proc/meminfo|awk <span class="string">&#x27;&#123;print $2/1024/1024&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查处理器使用情况 (当前数据)--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查处理器使用情况&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n当前处理器使用情况汇总 :\n&quot;</span></span><br><span class="line"><span class="comment"># 打印处理器使用情况</span></span><br><span class="line">mpstat|<span class="built_in">tail</span> -2</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------检查负载均衡 (当前数据)--------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n正在检查负载均衡&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印负载均衡情况</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;当前负载均衡 : <span class="subst">$(uptime|grep -o <span class="string">&quot;load average.*&quot;</span>|awk &#x27;&#123;print $3<span class="string">&quot; &quot;</span> $4<span class="string">&quot; &quot;</span> $5&#125;&#x27;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------打印最近3次重启事件 (如果可用)----#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n最近 3 次重启事件&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印最近3次重启事件</span></span><br><span class="line">last -x 2&gt; /dev/null|grep reboot 1&gt; /dev/null &amp;&amp; /usr/bin/last -x 2&gt; /dev/null|grep reboot|<span class="built_in">head</span> -3 || \</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;没有记录重启事件。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------打印最近3次关机事件 (如果可用)-----#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n最近 3 次关机事件&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印最近3次关机事件</span></span><br><span class="line">last -x 2&gt; /dev/null|grep shutdown 1&gt; /dev/null &amp;&amp; /usr/bin/last -x 2&gt; /dev/null|grep shutdown|<span class="built_in">head</span> -3 || \</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;没有记录关机事件。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------打印占用内存和CPU资源最多的5个进程线程---------#</span></span><br><span class="line"><span class="comment">#--------排除当前运行的程序hwlist----------#</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n占用内存资源最多的 5 个进程&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印占用内存资源最多的5个进程</span></span><br><span class="line">ps -eo pmem,pid,ppid,user,<span class="built_in">stat</span>,args --<span class="built_in">sort</span>=-pmem|grep -v $$|<span class="built_in">head</span> -6|sed <span class="string">&#x27;s/$/\n/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n占用 CPU 资源最多的 5 个进程&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;$D<span class="variable">$D</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印占用CPU资源最多的5个进程</span></span><br><span class="line">ps -eo pcpu,pid,ppid,user,<span class="built_in">stat</span>,args --<span class="built_in">sort</span>=-pcpu|grep -v $$|<span class="built_in">head</span> -6|sed <span class="string">&#x27;s/$/\n/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印提示信息</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;注意:- 如果以上任何字段标记为 \&quot;blank\&quot; 或 \&quot;NONE\&quot; 或 \&quot;UNKNOWN\&quot; 或 \&quot;Not Available\&quot; 或 \&quot;Not Specified\&quot;</span></span><br><span class="line"><span class="string">这意味着系统中没有这些字段的值，或者该值可能不可用，</span></span><br><span class="line"><span class="string">或者由于获取详细信息时出错而被抑制。&quot;</span></span><br></pre></td></tr></table></figure><ul><li>部分效果截图<br><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/PixPin_2024-05-28_16-16-51.png"></li></ul>]]></content>
    
    
    <summary type="html">RHEL8/7/6/,SLES/SLED 15/12/11,Ubuntu20/18/16,CentOS经过测试，其余的自行测试</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>IP质量检测脚本</title>
    <link href="http://example.com/2024/05/03/ip%E8%B4%A8%E9%87%8F%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/05/03/ip%E8%B4%A8%E9%87%8F%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC/</id>
    <published>2024-05-03T01:25:00.000Z</published>
    <updated>2024-05-03T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IP质量检测脚本"><a href="#IP质量检测脚本" class="headerlink" title="IP质量检测脚本"></a>IP质量检测脚本</h2><p>源项目：<a href="https://github.com/xykt/IPQuality">IPQuality</a></p><p><strong>支持OS&#x2F;Platform：Ubuntu | Debian | Linux Mint | Fedora | Red Hat Enterprise Linux (RHEL) | CentOS | Arch Linux | Manjaro | Alpine Linux | AlmaLinux | Rocky Linux</strong></p><ul><li>中英文双语言支持</li><li>支持IPv4&#x2F;IPv6双栈查询</li><li>精美排版，直观显示，多终端单屏优化展示，便于截图分享</li><li>基础信息、IP类型、风险评分、风险因子、流媒体解锁、邮局检测六大模块</li><li>基础数据源自<em>Maxmind</em>数据库</li><li>风险信息 <em>IPinfo &#x2F; ipregistry &#x2F; ipapi &#x2F; AbuseIPDB &#x2F; IP2LOCATION &#x2F; IPQS &#x2F; DB-IP &#x2F; SCAMALYTICS &#x2F; IPWHOIS</em> 多数据库整合</li><li>流媒体及AI多个服务商 <em>TikTok &#x2F; Disney+ &#x2F; Netflix &#x2F; Youtube &#x2F; AmazonPrimeVideo &#x2F; Spotify &#x2F; ChatGPT</em> 解锁及解锁类型检测</li><li>多邮局服务商 <em>Gmail &#x2F; Outlook &#x2F; Yahoo &#x2F; Apple &#x2F; QQ &#x2F; Mail.ru &#x2F; AOL &#x2F; GMX &#x2F; Mail.com &#x2F; 163 &#x2F; Sohu &#x2F; Sina</em> 连通性检测</li><li>IP地址黑名单400+数据库检测</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">script_version=<span class="string">&quot;v2024-05-17&quot;</span></span><br><span class="line">Font_B=<span class="string">&quot;\033[1m&quot;</span></span><br><span class="line">Font_D=<span class="string">&quot;\033[2m&quot;</span></span><br><span class="line">Font_I=<span class="string">&quot;\033[3m&quot;</span></span><br><span class="line">Font_U=<span class="string">&quot;\033[4m&quot;</span></span><br><span class="line">Font_Black=<span class="string">&quot;\033[30m&quot;</span></span><br><span class="line">Font_Red=<span class="string">&quot;\033[31m&quot;</span></span><br><span class="line">Font_Green=<span class="string">&quot;\033[32m&quot;</span></span><br><span class="line">Font_Yellow=<span class="string">&quot;\033[33m&quot;</span></span><br><span class="line">Font_Blue=<span class="string">&quot;\033[34m&quot;</span></span><br><span class="line">Font_Purple=<span class="string">&quot;\033[35m&quot;</span></span><br><span class="line">Font_Cyan=<span class="string">&quot;\033[36m&quot;</span></span><br><span class="line">Font_White=<span class="string">&quot;\033[37m&quot;</span></span><br><span class="line">Back_Black=<span class="string">&quot;\033[40m&quot;</span></span><br><span class="line">Back_Red=<span class="string">&quot;\033[41m&quot;</span></span><br><span class="line">Back_Green=<span class="string">&quot;\033[42m&quot;</span></span><br><span class="line">Back_Yellow=<span class="string">&quot;\033[43m&quot;</span></span><br><span class="line">Back_Blue=<span class="string">&quot;\033[44m&quot;</span></span><br><span class="line">Back_Purple=<span class="string">&quot;\033[45m&quot;</span></span><br><span class="line">Back_Cyan=<span class="string">&quot;\033[46m&quot;</span></span><br><span class="line">Back_White=<span class="string">&quot;\033[47m&quot;</span></span><br><span class="line">Font_Suffix=<span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">Font_LineClear=<span class="string">&quot;\033[2K&quot;</span></span><br><span class="line"><span class="built_in">declare</span> IP=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> IPhide</span><br><span class="line"><span class="built_in">declare</span> LANG=<span class="string">&quot;cn&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -A maxmind</span><br><span class="line"><span class="built_in">declare</span> -A ipinfo</span><br><span class="line"><span class="built_in">declare</span> -A scamalytics</span><br><span class="line"><span class="built_in">declare</span> -A ipregistry</span><br><span class="line"><span class="built_in">declare</span> -A ipapi</span><br><span class="line"><span class="built_in">declare</span> -A abuseipdb</span><br><span class="line"><span class="built_in">declare</span> -A ip2location</span><br><span class="line"><span class="built_in">declare</span> -A dbip</span><br><span class="line"><span class="built_in">declare</span> -A ipwhois</span><br><span class="line"><span class="built_in">declare</span> -A ipdata</span><br><span class="line"><span class="built_in">declare</span> -A ipqs</span><br><span class="line"><span class="built_in">declare</span> -A tiktok</span><br><span class="line"><span class="built_in">declare</span> -A disney</span><br><span class="line"><span class="built_in">declare</span> -A netflix</span><br><span class="line"><span class="built_in">declare</span> -A youtube</span><br><span class="line"><span class="built_in">declare</span> -A amazon</span><br><span class="line"><span class="built_in">declare</span> -A spotify</span><br><span class="line"><span class="built_in">declare</span> -A chatgpt</span><br><span class="line"><span class="built_in">declare</span> IPV4</span><br><span class="line"><span class="built_in">declare</span> IPV6</span><br><span class="line"><span class="built_in">declare</span> IPV4work=0</span><br><span class="line"><span class="built_in">declare</span> IPV6work=0</span><br><span class="line"><span class="built_in">declare</span> IPV4test=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> IPV6test=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> ERRORcode=0</span><br><span class="line"><span class="built_in">declare</span> shelp</span><br><span class="line"><span class="built_in">declare</span> -A swarn</span><br><span class="line"><span class="built_in">declare</span> -A sinfo</span><br><span class="line"><span class="built_in">declare</span> -A shead</span><br><span class="line"><span class="built_in">declare</span> -A sbasic</span><br><span class="line"><span class="built_in">declare</span> -A stype</span><br><span class="line"><span class="built_in">declare</span> -A sscore</span><br><span class="line"><span class="built_in">declare</span> -A sfactor</span><br><span class="line"><span class="built_in">declare</span> -A smedia</span><br><span class="line"><span class="built_in">declare</span> -A smail</span><br><span class="line"><span class="built_in">declare</span> -A stail</span><br><span class="line"><span class="built_in">declare</span> ibar=0</span><br><span class="line"><span class="built_in">declare</span> bar_pid</span><br><span class="line"><span class="built_in">declare</span> ibar_step=0</span><br><span class="line"><span class="built_in">declare</span> main_pid=$$</span><br><span class="line"><span class="built_in">declare</span> PADDING=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> useNIC=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> usePROXY=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> CurlARG=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">declare</span> UA_Browser</span><br><span class="line"><span class="built_in">declare</span> Media_Cookie=$(curl <span class="variable">$CurlARG</span> -s --retry 3 --max-time 10 <span class="string">&quot;https://raw.githubusercontent.com/xykt/IPQuality/main/ref/cookies.txt&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> IATA_Database=<span class="string">&quot;https://raw.githubusercontent.com/xykt/IPQuality/main/ref/iata-icao.csv&quot;</span></span><br><span class="line">shelp_lines=(</span><br><span class="line"><span class="string">&quot;IP QUALITY CHECK SCRIPT&quot;</span></span><br><span class="line"><span class="string">&quot;Usage: bash &lt;(curl -sL IP.Check.Place) [-4] [-6] [-l cn|en|jp|es|de|fr|ru|pt]&quot;</span></span><br><span class="line"><span class="string">&quot;            -4                            Test IPv4&quot;</span></span><br><span class="line"><span class="string">&quot;            -6                            Test IPv6&quot;</span></span><br><span class="line"><span class="string">&quot;            -l cn|en|jp|es|de|fr|ru|pt    Specify script language&quot;</span>)</span><br><span class="line">shelp=$(<span class="built_in">printf</span> <span class="string">&quot;%s\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;shelp_lines[@]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">set_language</span></span>()&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$LANG</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;en&quot;</span>|<span class="string">&quot;jp&quot;</span>|<span class="string">&quot;es&quot;</span>|<span class="string">&quot;de&quot;</span>|<span class="string">&quot;fr&quot;</span>|<span class="string">&quot;ru&quot;</span>|<span class="string">&quot;pt&quot;</span>)swarn[1]=<span class="string">&quot;ERROR: Unsupported parameters!&quot;</span></span><br><span class="line">swarn[2]=<span class="string">&quot;ERROR: IP address format error!&quot;</span></span><br><span class="line">swarn[3]=<span class="string">&quot;ERROR: Dependent programs are missing. Please run as root or install sudo!&quot;</span></span><br><span class="line">swarn[4]=<span class="string">&quot;ERROR: Parameter -4 conflicts with -i or -6!&quot;</span></span><br><span class="line">swarn[6]=<span class="string">&quot;ERROR: Parameter -6 conflicts with -i or -4!&quot;</span></span><br><span class="line">swarn[7]=<span class="string">&quot;ERROR: The specified network interface is invalid or does not exist!&quot;</span></span><br><span class="line">swarn[8]=<span class="string">&quot;ERROR: The specified proxy parameter is invalid or not working!&quot;</span></span><br><span class="line">swarn[40]=<span class="string">&quot;ERROR: IPv4 is not available!&quot;</span></span><br><span class="line">swarn[60]=<span class="string">&quot;ERROR: IPv6 is not available!&quot;</span></span><br><span class="line">sinfo[database]=<span class="string">&quot;Checking IP database &quot;</span></span><br><span class="line">sinfo[media]=<span class="string">&quot;Checking stream media &quot;</span></span><br><span class="line">sinfo[ai]=<span class="string">&quot;Checking AI provider &quot;</span></span><br><span class="line">sinfo[mail]=<span class="string">&quot;Connecting Email server &quot;</span></span><br><span class="line">sinfo[dnsbl]=<span class="string">&quot;Checking Blacklist database &quot;</span></span><br><span class="line">sinfo[ldatabase]=21</span><br><span class="line">sinfo[lmedia]=22</span><br><span class="line">sinfo[lai]=21</span><br><span class="line">sinfo[lmail]=24</span><br><span class="line">sinfo[ldnsbl]=28</span><br><span class="line">shead[title]=<span class="string">&quot;IP QUALITY CHECK REPORT: &quot;</span></span><br><span class="line">shead[ver]=<span class="string">&quot;Version: <span class="variable">$script_version</span>&quot;</span></span><br><span class="line">shead[bash]=<span class="string">&quot;bash &lt;(curl -sL IP.Check.Place)&quot;</span></span><br><span class="line">shead[git]=<span class="string">&quot;https://github.com/xykt/IPQuality&quot;</span></span><br><span class="line">shead[time]=$(<span class="built_in">date</span> -u +<span class="string">&quot;Report Time: %Y-%m-%d %H:%M:%S UTC&quot;</span>)</span><br><span class="line">shead[ltitle]=25</span><br><span class="line">shead[ptime]=$(<span class="built_in">printf</span> <span class="string">&#x27;%7s&#x27;</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">sbasic[title]=<span class="string">&quot;1. Basic Information (<span class="variable">$&#123;Font_I&#125;</span>Maxmind Database<span class="variable">$Font_Suffix</span>)&quot;</span></span><br><span class="line">sbasic[asn]=<span class="string">&quot;ASN:                    &quot;</span></span><br><span class="line">sbasic[noasn]=<span class="string">&quot;Not Assigned&quot;</span></span><br><span class="line">sbasic[org]=<span class="string">&quot;Organization:           &quot;</span></span><br><span class="line">sbasic[location]=<span class="string">&quot;Location:               &quot;</span></span><br><span class="line">sbasic[map]=<span class="string">&quot;Map:                    &quot;</span></span><br><span class="line">sbasic[city]=<span class="string">&quot;City:                   &quot;</span></span><br><span class="line">sbasic[country]=<span class="string">&quot;Actual Region:          &quot;</span></span><br><span class="line">sbasic[regcountry]=<span class="string">&quot;Registered Region:      &quot;</span></span><br><span class="line">sbasic[continent]=<span class="string">&quot;Continent:              &quot;</span></span><br><span class="line">sbasic[timezone]=<span class="string">&quot;Time Zone:              &quot;</span></span><br><span class="line">sbasic[<span class="built_in">type</span>]=<span class="string">&quot;IP Type:                &quot;</span></span><br><span class="line">sbasic[type0]=<span class="string">&quot; Geo-consistent &quot;</span></span><br><span class="line">sbasic[type1]=<span class="string">&quot; Geo-discrepant &quot;</span></span><br><span class="line">stype[business]=<span class="string">&quot; $Back_Yellow$Font_White<span class="variable">$Font_B</span> Business <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">stype[isp]=<span class="string">&quot;   $Back_Green$Font_White<span class="variable">$Font_B</span> ISP <span class="variable">$Font_Suffix</span>    &quot;</span></span><br><span class="line">stype[hosting]=<span class="string">&quot; $Back_Red$Font_White<span class="variable">$Font_B</span> Hosting <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">stype[education]=<span class="string">&quot;$Back_Yellow$Font_White<span class="variable">$Font_B</span> Education <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">stype[government]=<span class="string">&quot;$Back_Yellow$Font_White<span class="variable">$Font_B</span> Government <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">stype[banking]=<span class="string">&quot; $Back_Yellow$Font_White<span class="variable">$Font_B</span> Banking <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">stype[organization]=<span class="string">&quot;$Back_Yellow$Font_White<span class="variable">$&#123;Font_B&#125;</span>Organization<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">stype[military]=<span class="string">&quot; $Back_Yellow$Font_White<span class="variable">$Font_B</span> Military <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">stype[library]=<span class="string">&quot; $Back_Yellow$Font_White<span class="variable">$Font_B</span> Library <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">stype[cdn]=<span class="string">&quot;   $Back_Red$Font_White<span class="variable">$Font_B</span> CDN <span class="variable">$Font_Suffix</span>    &quot;</span></span><br><span class="line">stype[lineisp]=<span class="string">&quot; $Back_Green$Font_White<span class="variable">$Font_B</span> Line ISP <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">stype[mobile]=<span class="string">&quot;$Back_Green$Font_White<span class="variable">$Font_B</span> Mobile ISP <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">stype[spider]=<span class="string">&quot;$Back_Red$Font_White<span class="variable">$Font_B</span> Web Spider <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">stype[reserved]=<span class="string">&quot; $Back_Yellow$Font_White<span class="variable">$Font_B</span> Reserved <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">stype[other]=<span class="string">&quot;  $Back_Yellow$Font_White<span class="variable">$Font_B</span> Other <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[title]=<span class="string">&quot;2. IP Type&quot;</span></span><br><span class="line">stype[db]=<span class="string">&quot;Database:  &quot;</span></span><br><span class="line">stype[usetype]=<span class="string">&quot;Usage:     &quot;</span></span><br><span class="line">stype[comtype]=<span class="string">&quot;Company:   &quot;</span></span><br><span class="line">sscore[verylow]=<span class="string">&quot;$Font_Green<span class="variable">$&#123;Font_B&#125;</span>VeryLow<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[low]=<span class="string">&quot;$Font_Green<span class="variable">$&#123;Font_B&#125;</span>Low<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[medium]=<span class="string">&quot;$Font_Yellow<span class="variable">$&#123;Font_B&#125;</span>Medium<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[high]=<span class="string">&quot;$Font_Red<span class="variable">$&#123;Font_B&#125;</span>High<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[veryhigh]=<span class="string">&quot;$Font_Red<span class="variable">$&#123;Font_B&#125;</span>VeryHigh<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[elevated]=<span class="string">&quot;$Font_Yellow<span class="variable">$&#123;Font_B&#125;</span>Elevated<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[suspicious]=<span class="string">&quot;$Font_Yellow<span class="variable">$&#123;Font_B&#125;</span>Suspicious<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[risky]=<span class="string">&quot;$Font_Red<span class="variable">$&#123;Font_B&#125;</span>Risky<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[highrisk]=<span class="string">&quot;$Font_Red<span class="variable">$&#123;Font_B&#125;</span>HighRisk<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[dos]=<span class="string">&quot;$Font_Red<span class="variable">$&#123;Font_B&#125;</span>DoS<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[colon]=<span class="string">&quot;: &quot;</span></span><br><span class="line">sscore[title]=<span class="string">&quot;3. Risk Score&quot;</span></span><br><span class="line">sscore[range]=<span class="string">&quot;<span class="variable">$&#123;Font_Cyan&#125;</span>Levels:         $Font_I$Font_White<span class="variable">$&#123;Back_Green&#125;</span>VeryLow     Low <span class="variable">$Back_Yellow</span>     Medium     <span class="variable">$Back_Red</span> High   VeryHigh<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[title]=<span class="string">&quot;4. Risk Factors&quot;</span></span><br><span class="line">sfactor[<span class="built_in">factor</span>]=<span class="string">&quot;DB:  &quot;</span></span><br><span class="line">sfactor[countrycode]=<span class="string">&quot;Region: &quot;</span></span><br><span class="line">sfactor[proxy]=<span class="string">&quot;Proxy:  &quot;</span></span><br><span class="line">sfactor[tor]=<span class="string">&quot;Tor:    &quot;</span></span><br><span class="line">sfactor[vpn]=<span class="string">&quot;VPN:    &quot;</span></span><br><span class="line">sfactor[server]=<span class="string">&quot;Server: &quot;</span></span><br><span class="line">sfactor[abuser]=<span class="string">&quot;Abuser: &quot;</span></span><br><span class="line">sfactor[robot]=<span class="string">&quot;Robot:  &quot;</span></span><br><span class="line">sfactor[<span class="built_in">yes</span>]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span> Yes<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[no]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span> No <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[na]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span> N/A<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[<span class="built_in">yes</span>]=<span class="string">&quot;  $Back_Green<span class="variable">$Font_White</span> Yes <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[no]=<span class="string">&quot; $Back_Red<span class="variable">$Font_White</span> Block <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[bad]=<span class="string">&quot;$Back_Red<span class="variable">$Font_White</span> Failed <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[pending]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> Pending <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[cn]=<span class="string">&quot; $Back_Red<span class="variable">$Font_White</span> China <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[noprem]=<span class="string">&quot;$Back_Red<span class="variable">$Font_White</span> NoPrem. <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[org]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> NF.Only <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[web]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> WebOnly <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[app]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> APPOnly <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[idc]=<span class="string">&quot;  $Back_Yellow<span class="variable">$Font_White</span> IDC <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[native]=<span class="string">&quot;$Back_Green<span class="variable">$Font_White</span> Native <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[dns]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> ViaDNS <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[nodata]=<span class="string">&quot;         &quot;</span></span><br><span class="line">smedia[title]=<span class="string">&quot;5. Accessibility check for media and AI services&quot;</span></span><br><span class="line">smedia[meida]=<span class="string">&quot;Service: &quot;</span></span><br><span class="line">smedia[status]=<span class="string">&quot;Status:  &quot;</span></span><br><span class="line">smedia[region]=<span class="string">&quot;Region:  &quot;</span></span><br><span class="line">smedia[<span class="built_in">type</span>]=<span class="string">&quot;Type:    &quot;</span></span><br><span class="line">smail[title]=<span class="string">&quot;6. Email service availability and blacklist detection&quot;</span></span><br><span class="line">smail[port]=<span class="string">&quot;Local Port 25: &quot;</span></span><br><span class="line">smail[<span class="built_in">yes</span>]=<span class="string">&quot;<span class="variable">$&#123;Font_Green&#125;</span>Available<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smail[no]=<span class="string">&quot;<span class="variable">$&#123;Font_Red&#125;</span>Blocked<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smail[provider]=<span class="string">&quot;Conn: &quot;</span></span><br><span class="line">smail[dnsbl]=<span class="string">&quot;DNSBL database: &quot;</span></span><br><span class="line">smail[available]=<span class="string">&quot;$Font_Suffix<span class="variable">$&#123;Font_Cyan&#125;</span>Active <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[clean]=<span class="string">&quot;$Font_Suffix<span class="variable">$&#123;Font_Green&#125;</span>Clean <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[marked]=<span class="string">&quot;$Font_Suffix<span class="variable">$&#123;Font_Yellow&#125;</span>Marked <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[blacklisted]=<span class="string">&quot;$Font_Suffix<span class="variable">$&#123;Font_Red&#125;</span>Blacklisted <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">stail[stoday]=<span class="string">&quot;Script runs today: &quot;</span></span><br><span class="line">stail[stotal]=<span class="string">&quot;; Total: &quot;</span></span><br><span class="line">stail[thanks]=<span class="string">&quot;. Thanks for running xy scripts!&quot;</span></span><br><span class="line">stail[<span class="built_in">link</span>]=<span class="string">&quot;<span class="variable">$&#123;Font_I&#125;</span>Report Link: <span class="variable">$Font_U</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;cn&quot;</span>)swarn[1]=<span class="string">&quot;错误：不支持的参数！&quot;</span></span><br><span class="line">swarn[2]=<span class="string">&quot;错误：IP地址格式错误！&quot;</span></span><br><span class="line">swarn[3]=<span class="string">&quot;错误：未安装依赖程序，请以root执行此脚本，或者安装sudo命令！&quot;</span></span><br><span class="line">swarn[4]=<span class="string">&quot;错误：参数-4与-i/-6冲突！&quot;</span></span><br><span class="line">swarn[6]=<span class="string">&quot;错误：参数-6与-i/-4冲突！&quot;</span></span><br><span class="line">swarn[7]=<span class="string">&quot;错误：指定的网卡不存在！&quot;</span></span><br><span class="line">swarn[8]=<span class="string">&quot;错误: 指定的代理服务器不可用！&quot;</span></span><br><span class="line">swarn[40]=<span class="string">&quot;错误：IPV4不可用！&quot;</span></span><br><span class="line">swarn[60]=<span class="string">&quot;错误：IPV6不可用！&quot;</span></span><br><span class="line">sinfo[database]=<span class="string">&quot;正在检测IP数据库 &quot;</span></span><br><span class="line">sinfo[media]=<span class="string">&quot;正在检测流媒体服务商 &quot;</span></span><br><span class="line">sinfo[ai]=<span class="string">&quot;正在检测AI服务商 &quot;</span></span><br><span class="line">sinfo[mail]=<span class="string">&quot;正在连接邮件服务商 &quot;</span></span><br><span class="line">sinfo[dnsbl]=<span class="string">&quot;正在检测黑名单数据库 &quot;</span></span><br><span class="line">sinfo[ldatabase]=17</span><br><span class="line">sinfo[lmedia]=21</span><br><span class="line">sinfo[lai]=17</span><br><span class="line">sinfo[lmail]=19</span><br><span class="line">sinfo[ldnsbl]=21</span><br><span class="line">shead[title]=<span class="string">&quot;IP质量体检报告：&quot;</span></span><br><span class="line">shead[ver]=<span class="string">&quot;脚本版本：<span class="variable">$script_version</span>&quot;</span></span><br><span class="line">shead[bash]=<span class="string">&quot;bash &lt;(curl -sL IP.Check.Place)&quot;</span></span><br><span class="line">shead[git]=<span class="string">&quot;https://github.com/xykt/IPQuality&quot;</span></span><br><span class="line">shead[time]=$(TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> <span class="built_in">date</span> +<span class="string">&quot;报告时间：%Y-%m-%d %H:%M:%S CST&quot;</span>)</span><br><span class="line">shead[ltitle]=16</span><br><span class="line">shead[ptime]=$(<span class="built_in">printf</span> <span class="string">&#x27;%8s&#x27;</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">sbasic[title]=<span class="string">&quot;一、基础信息（<span class="variable">$&#123;Font_I&#125;</span>Maxmind 数据库<span class="variable">$Font_Suffix</span>）&quot;</span></span><br><span class="line">sbasic[asn]=<span class="string">&quot;自治系统号：            &quot;</span></span><br><span class="line">sbasic[noasn]=<span class="string">&quot;未分配&quot;</span></span><br><span class="line">sbasic[org]=<span class="string">&quot;组织：                  &quot;</span></span><br><span class="line">sbasic[location]=<span class="string">&quot;坐标：                  &quot;</span></span><br><span class="line">sbasic[map]=<span class="string">&quot;地图：                  &quot;</span></span><br><span class="line">sbasic[city]=<span class="string">&quot;城市：                  &quot;</span></span><br><span class="line">sbasic[country]=<span class="string">&quot;使用地：                &quot;</span></span><br><span class="line">sbasic[regcountry]=<span class="string">&quot;注册地：                &quot;</span></span><br><span class="line">sbasic[continent]=<span class="string">&quot;洲际：                  &quot;</span></span><br><span class="line">sbasic[timezone]=<span class="string">&quot;时区：                  &quot;</span></span><br><span class="line">sbasic[<span class="built_in">type</span>]=<span class="string">&quot;IP类型：                &quot;</span></span><br><span class="line">sbasic[type0]=<span class="string">&quot; 原生IP &quot;</span></span><br><span class="line">sbasic[type1]=<span class="string">&quot; 广播IP &quot;</span></span><br><span class="line">stype[business]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 商业 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[isp]=<span class="string">&quot;   $Back_Green$Font_White<span class="variable">$Font_B</span> 家宽 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[hosting]=<span class="string">&quot;   $Back_Red$Font_White<span class="variable">$Font_B</span> 机房 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[education]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 教育 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[government]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 政府 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[banking]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 银行 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[organization]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 组织 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[military]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 军队 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[library]=<span class="string">&quot;  $Back_Yellow$Font_White<span class="variable">$Font_B</span> 图书馆 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">stype[cdn]=<span class="string">&quot;   $Back_Red$Font_White<span class="variable">$Font_B</span> CDN <span class="variable">$Font_Suffix</span>    &quot;</span></span><br><span class="line">stype[lineisp]=<span class="string">&quot;   $Back_Green$Font_White<span class="variable">$Font_B</span> 家宽 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[mobile]=<span class="string">&quot;   $Back_Green$Font_White<span class="variable">$Font_B</span> 手机 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[spider]=<span class="string">&quot;   $Back_Red$Font_White<span class="variable">$Font_B</span> 蜘蛛 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[reserved]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 保留 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[other]=<span class="string">&quot;   $Back_Yellow$Font_White<span class="variable">$Font_B</span> 其他 <span class="variable">$Font_Suffix</span>   &quot;</span></span><br><span class="line">stype[title]=<span class="string">&quot;二、IP类型属性&quot;</span></span><br><span class="line">stype[db]=<span class="string">&quot;数据库：   &quot;</span></span><br><span class="line">stype[usetype]=<span class="string">&quot;使用类型： &quot;</span></span><br><span class="line">stype[comtype]=<span class="string">&quot;公司类型： &quot;</span></span><br><span class="line">sscore[verylow]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span>极低风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[low]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span>低风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[medium]=<span class="string">&quot;$Font_Yellow<span class="variable">$Font_B</span>中风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[high]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span>高风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[veryhigh]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span>极高风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[elevated]=<span class="string">&quot;$Font_Yellow<span class="variable">$Font_B</span>较高风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[suspicious]=<span class="string">&quot;$Font_Yellow<span class="variable">$Font_B</span>可疑IP<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[risky]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span>存在风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[highrisk]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span>高风险<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[dos]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span>建议封禁<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sscore[colon]=<span class="string">&quot;：&quot;</span></span><br><span class="line">sscore[title]=<span class="string">&quot;三、风险评分&quot;</span></span><br><span class="line">sscore[range]=<span class="string">&quot;<span class="variable">$Font_Cyan</span>风险等级：      $Font_I$Font_White<span class="variable">$Back_Green</span>极低         低 <span class="variable">$Back_Yellow</span>      中等      <span class="variable">$Back_Red</span> 高         极高<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[title]=<span class="string">&quot;四、风险因子&quot;</span></span><br><span class="line">sfactor[<span class="built_in">factor</span>]=<span class="string">&quot;库： &quot;</span></span><br><span class="line">sfactor[countrycode]=<span class="string">&quot;地区：  &quot;</span></span><br><span class="line">sfactor[proxy]=<span class="string">&quot;代理：  &quot;</span></span><br><span class="line">sfactor[tor]=<span class="string">&quot;Tor：   &quot;</span></span><br><span class="line">sfactor[vpn]=<span class="string">&quot;VPN：   &quot;</span></span><br><span class="line">sfactor[server]=<span class="string">&quot;服务器：&quot;</span></span><br><span class="line">sfactor[abuser]=<span class="string">&quot;滥用：  &quot;</span></span><br><span class="line">sfactor[robot]=<span class="string">&quot;机器人：&quot;</span></span><br><span class="line">sfactor[<span class="built_in">yes</span>]=<span class="string">&quot;$Font_Red<span class="variable">$Font_B</span> 是 <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[no]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span> 否 <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">sfactor[na]=<span class="string">&quot;$Font_Green<span class="variable">$Font_B</span> 无 <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smedia[<span class="built_in">yes</span>]=<span class="string">&quot; $Back_Green<span class="variable">$Font_White</span> 解锁 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[no]=<span class="string">&quot; $Back_Red<span class="variable">$Font_White</span> 屏蔽 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[bad]=<span class="string">&quot; $Back_Red<span class="variable">$Font_White</span> 失败 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[pending]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> 待支持 <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[cn]=<span class="string">&quot; $Back_Red<span class="variable">$Font_White</span> 中国 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[noprem]=<span class="string">&quot;$Back_Red<span class="variable">$Font_White</span> 禁会员 <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[org]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> 仅自制 <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[web]=<span class="string">&quot;$Back_Yellow<span class="variable">$Font_White</span> 仅网页 <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[app]=<span class="string">&quot; $Back_Yellow<span class="variable">$Font_White</span> 仅APP <span class="variable">$Font_Suffix</span> &quot;</span></span><br><span class="line">smedia[idc]=<span class="string">&quot; $Back_Yellow<span class="variable">$Font_White</span> 机房 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[native]=<span class="string">&quot; $Back_Green<span class="variable">$Font_White</span> 原生 <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[dns]=<span class="string">&quot;  $Back_Yellow<span class="variable">$Font_White</span> DNS <span class="variable">$Font_Suffix</span>  &quot;</span></span><br><span class="line">smedia[nodata]=<span class="string">&quot;         &quot;</span></span><br><span class="line">smedia[title]=<span class="string">&quot;五、流媒体及AI服务解锁检测&quot;</span></span><br><span class="line">smedia[meida]=<span class="string">&quot;服务商： &quot;</span></span><br><span class="line">smedia[status]=<span class="string">&quot;状态：   &quot;</span></span><br><span class="line">smedia[region]=<span class="string">&quot;地区：   &quot;</span></span><br><span class="line">smedia[<span class="built_in">type</span>]=<span class="string">&quot;方式：   &quot;</span></span><br><span class="line">smail[title]=<span class="string">&quot;六、邮局连通性及黑名单检测&quot;</span></span><br><span class="line">smail[port]=<span class="string">&quot;本地25端口：&quot;</span></span><br><span class="line">smail[<span class="built_in">yes</span>]=<span class="string">&quot;<span class="variable">$Font_Green</span>可用<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smail[no]=<span class="string">&quot;<span class="variable">$Font_Red</span>阻断<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">smail[provider]=<span class="string">&quot;通信：&quot;</span></span><br><span class="line">smail[dnsbl]=<span class="string">&quot;IP地址黑名单数据库：&quot;</span></span><br><span class="line">smail[available]=<span class="string">&quot;$Font_Suffix<span class="variable">$Font_Cyan</span>有效 <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[clean]=<span class="string">&quot;$Font_Suffix<span class="variable">$Font_Green</span>正常 <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[marked]=<span class="string">&quot;$Font_Suffix<span class="variable">$Font_Yellow</span>已标记 <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line">smail[blacklisted]=<span class="string">&quot;$Font_Suffix<span class="variable">$Font_Red</span>黑名单 <span class="variable">$Font_B</span>&quot;</span></span><br><span class="line"><span class="comment">#stail[stoday]=&quot;脚本今日运行次数：&quot;</span></span><br><span class="line"><span class="comment">#stail[stotal]=&quot;；总运行次数：&quot;</span></span><br><span class="line"><span class="comment">#stail[thanks]=&quot;。感谢使用xy系列脚本！&quot;</span></span><br><span class="line">stail[<span class="built_in">link</span>]=<span class="string">&quot;<span class="variable">$Font_I</span>报告链接：<span class="variable">$Font_U</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)<span class="built_in">echo</span> -ne <span class="string">&quot;ERROR: Language not supported!&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">countRunTimes</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">mktemp</span> -u --suffix=RRC &amp;&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">count_file=$(<span class="built_in">mktemp</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">count_file=$(<span class="built_in">mktemp</span> --suffix=RRC)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">RunTimes=$(curl <span class="variable">$CurlARG</span> -s --max-time 10 <span class="string">&quot;https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fip.check.place&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=hits&amp;edge_flat=false&quot;</span> &gt;<span class="string">&quot;<span class="variable">$count_file</span>&quot;</span>)</span><br><span class="line">stail[today]=$(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$count_file</span>&quot;</span>|<span class="built_in">tail</span> -3|<span class="built_in">head</span> -n 1|awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span>)</span><br><span class="line">stail[total]=$(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$count_file</span>&quot;</span>|<span class="built_in">tail</span> -3|<span class="built_in">head</span> -n 1|awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_progress_bar</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> bar=<span class="string">&quot;⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏&quot;</span></span><br><span class="line"><span class="built_in">local</span> n=<span class="string">&quot;<span class="variable">$&#123;#bar&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">sleep</span> 0.1;<span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">kill</span> -0 <span class="variable">$main_pid</span> 2&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$Font_B</span>[<span class="variable">$IP</span>]# $1$Font_Cyan$Font_B<span class="subst">$(printf &#x27;%*s&#x27; <span class="string">&quot;<span class="variable">$2</span>&quot;</span> &#x27;&#x27;|tr &#x27; &#x27; &#x27;.&#x27;)</span> <span class="variable">$&#123;bar:ibar++%n:1&#125;</span> <span class="subst">$(printf &#x27;%02d%%&#x27; $ibar_step)</span> <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">kill_progress_bar</span></span>()&#123;</span><br><span class="line"><span class="built_in">kill</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span> 2&gt;/dev/null&amp;&amp;<span class="built_in">echo</span> -ne <span class="string">&quot;\r&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">install_dependencies</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> ! jq --version &gt;/dev/null 2&gt;&amp;1||! curl --version &gt;/dev/null 2&gt;&amp;1||! bc --version &gt;/dev/null 2&gt;&amp;1||! nc -h &gt;/dev/null 2&gt;&amp;1||! dig -v &gt;/dev/null 2&gt;&amp;1||! ip -Version &gt;/dev/null 2&gt;&amp;1;<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Detecting Linux distribution...&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/os-release ];<span class="keyword">then</span></span><br><span class="line">. /etc/os-release</span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">id</span> -u) -ne 0 ]&amp;&amp;! <span class="built_in">command</span> -v sudo &gt;/dev/null 2&gt;&amp;1;<span class="keyword">then</span></span><br><span class="line">ERRORcode=3</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$ID</span> <span class="keyword">in</span></span><br><span class="line">ubuntu|debian|linuxmint)install_packages <span class="string">&quot;apt&quot;</span> <span class="string">&quot;apt-get install -y&quot;</span></span><br><span class="line">;;</span><br><span class="line">fedora|rhel|centos|almalinux|rocky)<span class="keyword">if</span></span><br><span class="line">[ <span class="string">&quot;<span class="subst">$(echo $VERSION_ID|cut -d &#x27;.&#x27; -f1)</span>&quot;</span> -ge 8 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">install_packages <span class="string">&quot;dnf&quot;</span> <span class="string">&quot;dnf install -y&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">install_packages <span class="string">&quot;yum&quot;</span> <span class="string">&quot;yum install -y&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line"><span class="built_in">arch</span>|manjaro)install_packages <span class="string">&quot;pacman&quot;</span> <span class="string">&quot;pacman -S --noconfirm&quot;</span></span><br><span class="line">;;</span><br><span class="line">alpine)install_packages <span class="string">&quot;apk&quot;</span> <span class="string">&quot;apk add&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)<span class="built_in">echo</span> <span class="string">&quot;Unsupported distribution: <span class="variable">$ID</span>&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$PREFIX</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">install_packages <span class="string">&quot;pkg&quot;</span> <span class="string">&quot;pkg install&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Cannot detect distribution because /etc/os-release is missing.&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">install_packages</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> package_manager=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> install_command=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Using package manager: <span class="variable">$package_manager</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">id</span> -u) -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> usesudo=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">local</span> usesudo=<span class="string">&quot;sudo&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$package_manager</span> <span class="keyword">in</span></span><br><span class="line">apt)<span class="variable">$usesudo</span> apt update</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$install_command</span> jq curl bc netcat-openbsd dnsutils iproute2</span><br><span class="line">;;</span><br><span class="line">dnf)<span class="variable">$usesudo</span> dnf install epel-release -y</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$package_manager</span> makecache</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$install_command</span> jq curl bc nmap-ncat bind-utils iproute</span><br><span class="line">;;</span><br><span class="line">yum)<span class="variable">$usesudo</span> yum install epel-release -y</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$package_manager</span> makecache</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$install_command</span> jq curl bc nmap-ncat bind-utils iproute</span><br><span class="line">;;</span><br><span class="line">pacman)<span class="variable">$usesudo</span> pacman -Sy</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$install_command</span> jq curl bc gnu-netcat bind-tools iproute2</span><br><span class="line">;;</span><br><span class="line">apk)<span class="variable">$usesudo</span> apk update</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$install_command</span> jq curl bc netcat-openbsd grep bind-tools iproute2</span><br><span class="line">;;</span><br><span class="line">pkg)<span class="variable">$usesudo</span> <span class="variable">$package_manager</span> update</span><br><span class="line"><span class="variable">$usesudo</span> <span class="variable">$package_manager</span> <span class="variable">$install_command</span> jq curl bc netcat dnsutils iproute</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">declare</span> -A browsers=(</span><br><span class="line">[Chrome]=<span class="string">&quot;87.0.4280.66 88.0.4324.150 89.0.4389.82&quot;</span></span><br><span class="line">[Firefox]=<span class="string">&quot;83.0 84.0 85.0&quot;</span></span><br><span class="line">[Edge]=<span class="string">&quot;88.0.705.50 89.0.774.57&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">generate_random_user_agent</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> browsers_keys=(<span class="variable">$&#123;!browsers[@]&#125;</span>)</span><br><span class="line"><span class="built_in">local</span> random_browser_index=$((RANDOM%<span class="variable">$&#123;#browsers_keys[@]&#125;</span>))</span><br><span class="line"><span class="built_in">local</span> browser=<span class="variable">$&#123;browsers_keys[random_browser_index]&#125;</span></span><br><span class="line"><span class="built_in">local</span> versions=(<span class="variable">$&#123;browsers[$browser]&#125;</span>)</span><br><span class="line"><span class="built_in">local</span> random_version_index=$((RANDOM%<span class="variable">$&#123;#versions[@]&#125;</span>))</span><br><span class="line"><span class="built_in">local</span> version=<span class="variable">$&#123;versions[random_version_index]&#125;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$browser</span> <span class="keyword">in</span></span><br><span class="line">Chrome)UA_Browser=<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/<span class="variable">$version</span> Safari/537.36&quot;</span></span><br><span class="line">;;</span><br><span class="line">Firefox)UA_Browser=<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:<span class="variable">$&#123;version%%.*&#125;</span>) Gecko/20100101 Firefox/<span class="variable">$version</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">Edge)UA_Browser=<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/<span class="variable">$&#123;version%.*&#125;</span>.0.0 Safari/537.36 Edg/<span class="variable">$version</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">is_valid_ipv4</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$1</span> =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">IPV4work=1</span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">IPV4work=0</span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">is_private_ipv4</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> ip_address=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$ip_address</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$ip_address</span> =~ ^10\. ]]||[[ <span class="variable">$ip_address</span> =~ ^172\.(1[6-9]|2[0-9]|3[0-1])\. ]]||[[ <span class="variable">$ip_address</span> =~ ^192\.168\. ]]||[[ <span class="variable">$ip_address</span> =~ ^127\. ]]||[[ <span class="variable">$ip_address</span> =~ ^0\. ]]||[[ <span class="variable">$ip_address</span> =~ ^22[4-9]\. ]]||[[ <span class="variable">$ip_address</span> =~ ^23[0-9]\. ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">get_ipv4</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> response</span><br><span class="line">IPV4=$(ip -4 addr show|grep global|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|<span class="built_in">cut</span> -d <span class="string">&#x27;/&#x27;</span> -f1|<span class="built_in">head</span> -n 1)</span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$IPV4</span> ]];<span class="keyword">then</span></span><br><span class="line">IPV4=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">local</span> API_NET=(<span class="string">&quot;myip.check.place&quot;</span> <span class="string">&quot;ipv4.ip.sb&quot;</span> <span class="string">&quot;ipget.net&quot;</span> <span class="string">&quot;ip.ping0.cc&quot;</span> <span class="string">&quot;https://ip4.seeip.org&quot;</span> <span class="string">&quot;https://api.my-ip.io/ip&quot;</span> <span class="string">&quot;https://ipv4.icanhazip.com&quot;</span> <span class="string">&quot;api.ipify.org&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;API_NET[@]&#125;</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">response=$(curl <span class="variable">$CurlARG</span> -s4 --max-time 8 <span class="string">&quot;<span class="variable">$p</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ $? -eq 0 &amp;&amp; ! <span class="variable">$response</span> =~ error ]];<span class="keyword">then</span></span><br><span class="line">IPV4=<span class="string">&quot;<span class="variable">$response</span>&quot;</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">hide_ipv4</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$1</span> ]];<span class="keyword">then</span></span><br><span class="line">IFS=<span class="string">&#x27;.&#x27;</span> <span class="built_in">read</span> -r -a ip_parts &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">IPhide=<span class="string">&quot;<span class="variable">$&#123;ip_parts[0]&#125;</span>.<span class="variable">$&#123;ip_parts[1]&#125;</span>.*.*&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">IPhide=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">is_valid_ipv6</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$1</span> =~ ^(([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">7</span>,<span class="number">7</span>&#125;[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">7</span>&#125;:|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">6</span>&#125;:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">5</span>&#125;(:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">2</span>&#125;|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">4</span>&#125;(:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">3</span>&#125;|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">3</span>&#125;(:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">4</span>&#125;|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">2</span>&#125;(:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">5</span>&#125;|[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:((:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">6</span>&#125;)|:((:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">1</span>,<span class="number">7</span>&#125;|:)|fe80:(:[<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">0</span>,<span class="number">4</span>&#125;)&#123;<span class="number">0</span>,<span class="number">4</span>&#125;%[<span class="number">0</span>-<span class="number">9</span>a-zA-Z]&#123;<span class="number">1</span>,&#125;|::(ffff(:<span class="number">0</span>&#123;<span class="number">1</span>,<span class="number">4</span>&#125;)&#123;<span class="number">0</span>,<span class="number">1</span>&#125;:)&#123;<span class="number">0</span>,<span class="number">1</span>&#125;((<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>]|(<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]|<span class="number">1</span>&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])\.)&#123;<span class="number">3</span>,<span class="number">3</span>&#125;(<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>]|(<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]|<span class="number">1</span>&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])|([<span class="number">0</span>-<span class="number">9</span>a-fA-F]&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:)&#123;<span class="number">1</span>,<span class="number">4</span>&#125;:((<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>]|(<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]|<span class="number">1</span>&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])\.)&#123;<span class="number">3</span>,<span class="number">3</span>&#125;(<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>]|(<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]|<span class="number">1</span>&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>])&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span>-<span class="number">9</span>]))$ ]];<span class="keyword">then</span></span><br><span class="line">IPV6work=1</span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">IPV6work=0</span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">is_private_ipv6</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> address=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$address</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$address</span> =~ ^fe80: ]]||[[ <span class="variable">$address</span> =~ ^fc00: ]]||[[ <span class="variable">$address</span> =~ ^fd00: ]]||[[ <span class="variable">$address</span> =~ ^2001:db8: ]]||[[ <span class="variable">$address</span> == ::1 ]]||[[ <span class="variable">$address</span> =~ ^::ffff: ]]||[[ <span class="variable">$address</span> =~ ^2002: ]]||[[ <span class="variable">$address</span> =~ ^2001: ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">get_ipv6</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> response</span><br><span class="line">IPV6=$(ip -6 addr show|grep global|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|<span class="built_in">cut</span> -d <span class="string">&#x27;/&#x27;</span> -f1|<span class="built_in">head</span> -n 1)</span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$IPV6</span> ]];<span class="keyword">then</span></span><br><span class="line">IPV6=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">local</span> API_NET=(<span class="string">&quot;myip.check.place&quot;</span> <span class="string">&quot;ipv6.ip.sb&quot;</span> <span class="string">&quot;https://ipget.net&quot;</span> <span class="string">&quot;ipv6.ping0.cc&quot;</span> <span class="string">&quot;https://api.my-ip.io/ip&quot;</span> <span class="string">&quot;https://ipv6.icanhazip.com&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;API_NET[@]&#125;</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">response=$(curl <span class="variable">$CurlARG</span> -s6k --max-time 8 <span class="string">&quot;<span class="variable">$p</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ $? -eq 0 &amp;&amp; ! <span class="variable">$response</span> =~ error ]];<span class="keyword">then</span></span><br><span class="line">IPV6=<span class="string">&quot;<span class="variable">$response</span>&quot;</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">hide_ipv6</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$1</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> expanded_ip=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span>|sed <span class="string">&#x27;s/::/:0000:0000:0000:0000:0000:0000:0000:0000:/g&#x27;</span>|<span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f1-8)</span><br><span class="line">IFS=<span class="string">&#x27;:&#x27;</span> <span class="built_in">read</span> -r -a ip_parts &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$expanded_ip</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$&#123;#ip_parts[@]&#125;</span> -lt 8 ];<span class="keyword">do</span></span><br><span class="line">ip_parts+=(0000)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IPhide=<span class="string">&quot;<span class="variable">$&#123;ip_parts[0]:-0&#125;</span>:<span class="variable">$&#123;ip_parts[1]:-0&#125;</span>:<span class="variable">$&#123;ip_parts[2]:-0&#125;</span>:*:*:*:*:*&quot;</span></span><br><span class="line">IPhide=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IPhide</span>&quot;</span>|sed <span class="string">&#x27;s/:0\&#123;1,\&#125;/:/g&#x27;</span>|sed <span class="string">&#x27;s/::\+/:/g&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">IPhide=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">calculate_display_width</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> string=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> length=0</span><br><span class="line"><span class="built_in">local</span> char</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>; i&lt;<span class="variable">$&#123;#string&#125;</span>; i++));<span class="keyword">do</span></span><br><span class="line">char=<span class="variable">$&#123;string:i:1&#125;</span></span><br><span class="line"><span class="keyword">if</span> LC_CTYPE=C <span class="built_in">printf</span> <span class="string">&#x27;%s&#x27;</span> <span class="string">&quot;<span class="variable">$char</span>&quot;</span>|grep -qP <span class="string">&#x27;[\x80-\xFF]&#x27;</span>;<span class="keyword">then</span></span><br><span class="line">length=$((length+<span class="number">2</span>))</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">length=$((length+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$length</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">calc_padding</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> input_text=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> total_width=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">local</span> title_length=$(calculate_display_width <span class="string">&quot;<span class="variable">$input_text</span>&quot;</span>)</span><br><span class="line"><span class="built_in">local</span> left_padding=$(((total_width-title_length)/<span class="number">2</span>))</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$left_padding</span> -gt 0 ]];<span class="keyword">then</span></span><br><span class="line">PADDING=$(<span class="built_in">printf</span> <span class="string">&#x27;%*s&#x27;</span> <span class="variable">$left_padding</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">PADDING=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">generate_dms</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> lat=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> lon=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$lat</span> || <span class="variable">$lat</span> == <span class="string">&quot;null&quot;</span> || -z <span class="variable">$lon</span> || <span class="variable">$lon</span> == <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="function"><span class="title">convert_single</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> coord=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> direction=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">local</span> fixed_coord=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$coord</span>&quot;</span>|sed <span class="string">&#x27;s/\.$/.0/&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> degrees=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$fixed_coord</span>&quot;</span>|<span class="built_in">cut</span> -d<span class="string">&#x27;.&#x27;</span> -f1)</span><br><span class="line"><span class="built_in">local</span> fractional=<span class="string">&quot;0.<span class="subst">$(echo <span class="string">&quot;<span class="variable">$fixed_coord</span>&quot;</span>|cut -d&#x27;.&#x27; -f2)</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> minutes=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$fractional</span> * 60&quot;</span>|bc -l|<span class="built_in">cut</span> -d<span class="string">&#x27;.&#x27;</span> -f1)</span><br><span class="line"><span class="built_in">local</span> seconds_fractional=<span class="string">&quot;0.<span class="subst">$(echo <span class="string">&quot;<span class="variable">$fractional</span> * 60&quot;</span>|bc -l|cut -d&#x27;.&#x27; -f2)</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> seconds=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$seconds_fractional</span> * 60&quot;</span>|bc -l|awk <span class="string">&#x27;&#123;printf &quot;%.0f&quot;, $1&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$degrees</span>°<span class="variable">$minutes</span>′<span class="variable">$seconds</span>″<span class="variable">$direction</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">local</span> lat_dir=<span class="string">&#x27;N&#x27;</span></span><br><span class="line"><span class="keyword">if</span> [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lat</span> &lt; 0&quot;</span>|bc -l) -eq 1 ]];<span class="keyword">then</span></span><br><span class="line">lat_dir=<span class="string">&#x27;S&#x27;</span></span><br><span class="line">lat=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lat</span> * -1&quot;</span>|bc -l)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> lon_dir=<span class="string">&#x27;E&#x27;</span></span><br><span class="line"><span class="keyword">if</span> [[ $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lon</span> &lt; 0&quot;</span>|bc -l) -eq 1 ]];<span class="keyword">then</span></span><br><span class="line">lon_dir=<span class="string">&#x27;W&#x27;</span></span><br><span class="line">lon=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lon</span> * -1&quot;</span>|bc -l)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> lat_dms=$(convert_single <span class="variable">$lat</span> <span class="variable">$lat_dir</span>)</span><br><span class="line"><span class="built_in">local</span> lon_dms=$(convert_single <span class="variable">$lon</span> <span class="variable">$lon_dir</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$lon_dms</span>, <span class="variable">$lat_dms</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">generate_googlemap_url</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> lat=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> lon=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">local</span> radius=<span class="variable">$3</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$lat</span> || <span class="variable">$lat</span> == <span class="string">&quot;null&quot;</span> || -z <span class="variable">$lon</span> || <span class="variable">$lon</span> == <span class="string">&quot;null&quot;</span> || -z <span class="variable">$radius</span> || <span class="variable">$radius</span> == <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> zoom_level=15</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$radius</span> -gt 1000 ]];<span class="keyword">then</span></span><br><span class="line">zoom_level=12</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$radius</span> -gt 500 ]];<span class="keyword">then</span></span><br><span class="line">zoom_level=13</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$radius</span> -gt 250 ]];<span class="keyword">then</span></span><br><span class="line">zoom_level=14</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;https://check.place/<span class="variable">$lat</span>,<span class="variable">$lon</span>,<span class="variable">$zoom_level</span>,<span class="variable">$LANG</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_maxmind</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Maxmind <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">maxmind=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -Ls -m 10 <span class="string">&quot;https://ipinfo.check.place/<span class="variable">$IP</span>?lang=<span class="variable">$LANG</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">maxmind[asn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.ASN.AutonomousSystemNumber&#x27;</span>)</span><br><span class="line">maxmind[org]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.ASN.AutonomousSystemOrganization&#x27;</span>)</span><br><span class="line">maxmind[city]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Name&#x27;</span>)</span><br><span class="line">maxmind[post]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.PostalCode&#x27;</span>)</span><br><span class="line">maxmind[lat]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Latitude&#x27;</span>)</span><br><span class="line">maxmind[lon]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Longitude&#x27;</span>)</span><br><span class="line">maxmind[rad]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.AccuracyRadius&#x27;</span>)</span><br><span class="line">maxmind[dms]=$(generate_dms <span class="string">&quot;<span class="variable">$&#123;maxmind[lat]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[lon]&#125;</span>&quot;</span>)</span><br><span class="line">maxmind[map]=$(generate_googlemap_url <span class="string">&quot;<span class="variable">$&#123;maxmind[lat]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[lon]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[rad]&#125;</span>&quot;</span>)</span><br><span class="line">maxmind[continentcode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Continent.Code&#x27;</span>)</span><br><span class="line">maxmind[continent]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Continent.Name&#x27;</span>)</span><br><span class="line">maxmind[citycountrycoad]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Country.IsoCode&#x27;</span>)</span><br><span class="line">maxmind[citycountry]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Country.Name&#x27;</span>)</span><br><span class="line">maxmind[timezone]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Location.TimeZone&#x27;</span>)</span><br><span class="line">maxmind[subcode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;if .City.Subdivisions | length &gt; 0 then .City.Subdivisions[0].IsoCode else &quot;N/A&quot; end&#x27;</span>)</span><br><span class="line">maxmind[sub]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;if .City.Subdivisions | length &gt; 0 then .City.Subdivisions[0].Name else &quot;N/A&quot; end&#x27;</span>)</span><br><span class="line">maxmind[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.IsoCode&#x27;</span>)</span><br><span class="line">maxmind[country]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.Name&#x27;</span>)</span><br><span class="line">maxmind[regcountrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.RegisteredCountry.IsoCode&#x27;</span>)</span><br><span class="line">maxmind[regcountry]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.RegisteredCountry.Name&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$LANG</span> != <span class="string">&quot;en&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> backup_response=$(curl <span class="variable">$CurlARG</span> -s -m 10 <span class="string">&quot;http://ipinfo.check.place/<span class="variable">$IP</span>?lang=en&quot;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[asn]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[asn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.ASN.AutonomousSystemNumber&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[org]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[org]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.ASN.AutonomousSystemOrganization&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[city]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[city]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Name&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[post]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[post]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.PostalCode&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[lat]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[lat]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Latitude&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[lon]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[lon]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Longitude&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[rad]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[rad]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.AccuracyRadius&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[continentcode]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[continentcode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Continent.Code&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[continent]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[continent]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Continent.Name&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[citycountrycoad]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[citycountrycoad]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Country.IsoCode&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[citycountry]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[citycountry]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Country.Name&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[timezone]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[timezone]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.City.Location.TimeZone&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[subcode]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[subcode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;if .City.Subdivisions | length &gt; 0 then .City.Subdivisions[0].IsoCode else &quot;N/A&quot; end&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[sub]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[sub]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;if .City.Subdivisions | length &gt; 0 then .City.Subdivisions[0].Name else &quot;N/A&quot; end&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[countrycode]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.IsoCode&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[country]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[country]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.Name&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[regcountrycode]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[regcountrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.RegisteredCountry.IsoCode&#x27;</span>)</span><br><span class="line">[[ <span class="variable">$&#123;maxmind[regcountry]&#125;</span> == <span class="string">&quot;null&quot;</span> ]]&amp;&amp;maxmind[regcountry]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$backup_response</span>&quot;</span>|jq -r <span class="string">&#x27;.Country.RegisteredCountry.Name&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;maxmind[lat]&#125;</span> != <span class="string">&quot;null&quot;</span> &amp;&amp; <span class="variable">$&#123;maxmind[lon]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">maxmind[dms]=$(generate_dms <span class="string">&quot;<span class="variable">$&#123;maxmind[lat]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[lon]&#125;</span>&quot;</span>)</span><br><span class="line">maxmind[map]=$(generate_googlemap_url <span class="string">&quot;<span class="variable">$&#123;maxmind[lat]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[lon]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;maxmind[rad]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">maxmind[dms]=<span class="string">&quot;null&quot;</span></span><br><span class="line">maxmind[map]=<span class="string">&quot;null&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipinfo</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>IPinfo <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">7</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipinfo=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -Ls -m 10 <span class="string">&quot;https://ipinfo.io/widget/demo/<span class="variable">$IP</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipinfo[usetype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.asn.type&#x27;</span>)</span><br><span class="line">ipinfo[comtype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.company.type&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipinfo[usetype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipinfo[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipinfo[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipinfo[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipinfo[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipinfo[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipinfo[comtype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipinfo[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipinfo[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipinfo[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipinfo[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipinfo[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">ipinfo[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.country&#x27;</span>)</span><br><span class="line">ipinfo[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.privacy.proxy&#x27;</span>)</span><br><span class="line">ipinfo[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.privacy.tor&#x27;</span>)</span><br><span class="line">ipinfo[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.privacy.vpn&#x27;</span>)</span><br><span class="line">ipinfo[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.privacy.hosting&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_scamalytics</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>SCAMALYTICS <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">12</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">scamalytics=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -H <span class="string">&quot;Referer: https://scamalytics.com&quot;</span> -m 10 <span class="string">&quot;https://scamalytics.com/ip/<span class="variable">$IP</span>&quot;</span>)</span><br><span class="line">[[ -z <span class="variable">$RESPONSE</span> ]]&amp;&amp;<span class="built_in">return</span> 1</span><br><span class="line"><span class="built_in">local</span> tmpscore=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -oP <span class="string">&#x27;(?&lt;=&gt;Fraud Score: )[^&lt;]+&#x27;</span>)</span><br><span class="line">scamalytics[score]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tmpscore</span>&quot;</span>|bc)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;scamalytics[score]&#125;</span> -lt 25 ]];<span class="keyword">then</span></span><br><span class="line">scamalytics[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[low]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;scamalytics[score]&#125;</span> -lt 50 ]];<span class="keyword">then</span></span><br><span class="line">scamalytics[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[medium]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;scamalytics[score]&#125;</span> -lt 75 ]];<span class="keyword">then</span></span><br><span class="line">scamalytics[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[high]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;scamalytics[score]&#125;</span> -ge 75 ]];<span class="keyword">then</span></span><br><span class="line">scamalytics[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[veryhigh]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">scamalytics[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&quot;&lt;th&gt;Country Code&lt;/th&gt;&quot;</span>|awk -F<span class="string">&#x27;&lt;/?td&gt;&#x27;</span> <span class="string">&#x27;/&lt;td&gt;/ &#123;print $2&#125;&#x27;</span>)</span><br><span class="line">scamalytics[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Anonymizing VPN&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">scamalytics[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Tor Exit Node&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">scamalytics[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Server&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">scamalytics[proxy1]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Public Proxy&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">scamalytics[proxy2]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Web Proxy&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">scamalytics[proxy]=<span class="string">&quot;true&quot;</span></span><br><span class="line">[[ <span class="variable">$&#123;scamalytics[proxy1]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;scamalytics[proxy2]&#125;</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;scamalytics[proxy]=<span class="string">&quot;false&quot;</span></span><br><span class="line">scamalytics[robot]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|grep -A1 <span class="string">&#x27;Search Engine Robot&#x27;</span>|<span class="built_in">tail</span> -n1|grep -oP <span class="string">&#x27;&gt;(Yes|No)&lt;&#x27;</span>|sed <span class="string">&#x27;s/&gt;Yes&lt;/true/;s/&gt;No&lt;/false/&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipregistry</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>ipregistry <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">11</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipregistry=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://ipinfo.check.place/<span class="variable">$IP</span>?db=ipregistry&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipregistry[usetype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.connection.type&#x27;</span>)</span><br><span class="line">ipregistry[comtype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.company.type&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipregistry[usetype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;government&quot;</span>)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipregistry[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipregistry[comtype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;government&quot;</span>)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipregistry[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">ipregistry[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.location.country.code&#x27;</span>)</span><br><span class="line">ipregistry[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_proxy&#x27;</span>)</span><br><span class="line">ipregistry[tor1]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_tor&#x27;</span>)</span><br><span class="line">ipregistry[tor2]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_tor_exit&#x27;</span>)</span><br><span class="line">ipregistry[tor]=<span class="string">&quot;true&quot;</span></span><br><span class="line">[[ <span class="variable">$&#123;ipregistry[tor1]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ipregistry[tor2]&#125;</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;ipregistry[tor]=<span class="string">&quot;false&quot;</span></span><br><span class="line">ipregistry[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_vpn&#x27;</span>)</span><br><span class="line">ipregistry[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_cloud_provider&#x27;</span>)</span><br><span class="line">ipregistry[abuser]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.is_abuser&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipapi</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>ipapi <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">6</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipapi=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://api.ipapi.is/?q=<span class="variable">$IP</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipapi[usetype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.asn.type&#x27;</span>)</span><br><span class="line">ipapi[comtype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.company.type&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipapi[usetype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;government&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;banking&quot;</span>)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[banking]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipapi[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipapi[comtype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;business&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;isp&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[isp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;hosting&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;education&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;government&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;banking&quot;</span>)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[banking]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ipapi[scomtype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">[[ -z <span class="variable">$RESPONSE</span> ]]&amp;&amp;<span class="built_in">return</span> 1</span><br><span class="line">ipapi[scoretext]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.company.abuser_score&#x27;</span>)</span><br><span class="line">ipapi[scorenum]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[scoretext]&#125;</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">ipapi[risktext]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[scoretext]&#125;</span>&quot;</span>|awk -F<span class="string">&#x27;[()]&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">ipapi[score]=$(awk <span class="string">&quot;BEGIN &#123;printf \&quot;%.2f%%\&quot;, <span class="variable">$&#123;ipapi[scorenum]&#125;</span> * 100&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ipapi[risktext]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;Very Low&quot;</span>)ipapi[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[verylow]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Low&quot;</span>)ipapi[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[low]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Elevated&quot;</span>)ipapi[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[elevated]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;High&quot;</span>)ipapi[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[high]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Very High&quot;</span>)ipapi[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[veryhigh]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">ipapi[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.location.country_code&#x27;</span>)</span><br><span class="line">ipapi[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_proxy&#x27;</span>)</span><br><span class="line">ipapi[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_tor&#x27;</span>)</span><br><span class="line">ipapi[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_vpn&#x27;</span>)</span><br><span class="line">ipapi[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_datacenter&#x27;</span>)</span><br><span class="line">ipapi[abuser]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_abuser&#x27;</span>)</span><br><span class="line">ipapi[robot]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.is_crawler&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_abuseipdb</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>AbuseIPDB <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">10</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">abuseipdb=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://ipinfo.check.place/<span class="variable">$IP</span>?db=abuseipdb&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">abuseipdb[usetype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.usageType&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;abuseipdb[usetype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;Commercial&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Data Center/Web Hosting/Transit&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;University/College/School&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Government&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;banking&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[banking]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Organization&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[organization]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Military&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[military]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Library&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[library]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Content Delivery Network&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[cdn]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Fixed Line ISP&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[lineisp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Mobile ISP&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[mobile]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Search Engine Spider&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[spider]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;Reserved&quot;</span>)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[reserved]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)abuseipdb[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">abuseipdb[score]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.data.abuseConfidenceScore&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;abuseipdb[score]&#125;</span> -lt 25 ]];<span class="keyword">then</span></span><br><span class="line">abuseipdb[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[low]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;abuseipdb[score]&#125;</span> -lt 75 ]];<span class="keyword">then</span></span><br><span class="line">abuseipdb[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[high]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;abuseipdb[score]&#125;</span> -ge 75 ]];<span class="keyword">then</span></span><br><span class="line">abuseipdb[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[dos]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ip2location</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>IP2LOCATION <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">12</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ip2location=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 -H <span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36&quot;</span> -H <span class="string">&quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span> -H <span class="string">&quot;Accept-Language: en-US,en;q=0.9&quot;</span> <span class="string">&quot;https://www.ip2location.io/<span class="variable">$IP</span>&quot;</span>|sed -n <span class="string">&#x27;/&lt;code/,/&lt;\/code&gt;/p&#x27;</span>|sed -e <span class="string">&#x27;s/&lt;[^&gt;]*&gt;//g&#x27;</span>|sed <span class="string">&#x27;s/^[\t]*//&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ip2location[usetype]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.usage_type&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;ip2location[usetype]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;COM&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[business]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;DCH&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[hosting]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;EDU&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[education]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;GOV&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[government]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;ORG&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[organization]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;MIL&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[military]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;LIB&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[library]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;CDN&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[cdn]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;ISP&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[lineisp]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;MOB&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[mobile]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;SES&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[spider]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;RSV&quot;</span>)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[reserved]&#125;</span>&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)ip2location[susetype]=<span class="string">&quot;<span class="variable">$&#123;stype[other]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">ip2location[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.country_code&#x27;</span>)</span><br><span class="line">ip2location[proxy1]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_public_proxy&#x27;</span>)</span><br><span class="line">ip2location[proxy2]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_web_proxy&#x27;</span>)</span><br><span class="line">ip2location[proxy]=<span class="string">&quot;true&quot;</span></span><br><span class="line">[[ <span class="variable">$&#123;ip2location[proxy1]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ip2location[proxy2]&#125;</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;ip2location[proxy]=<span class="string">&quot;false&quot;</span></span><br><span class="line">ip2location[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_tor&#x27;</span>)</span><br><span class="line">ip2location[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_vpn&#x27;</span>)</span><br><span class="line">ip2location[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_data_center&#x27;</span>)</span><br><span class="line">ip2location[abuser]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_spammer&#x27;</span>)</span><br><span class="line">ip2location[robot1]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_web_crawler&#x27;</span>)</span><br><span class="line">ip2location[robot2]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_scanner&#x27;</span>)</span><br><span class="line">ip2location[robot3]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy.is_botnet&#x27;</span>)</span><br><span class="line">ip2location[robot]=<span class="string">&quot;true&quot;</span></span><br><span class="line">[[ <span class="variable">$&#123;ip2location[robot1]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ip2location[robot2]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ip2location[robot3]&#125;</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;ip2location[robot]=<span class="string">&quot;false&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_dbip</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>DB-IP <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">6</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">dbip=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://db-ip.com/demo/home.php?s=<span class="variable">$IP</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">dbip[risktext]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.demoInfo.threatLevel&#x27;</span>)</span><br><span class="line"><span class="built_in">shopt</span> -s nocasematch</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;dbip[risktext]&#125;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;low&quot;</span>)dbip[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[low]&#125;</span>&quot;</span></span><br><span class="line">dbip[score]=0</span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;medium&quot;</span>)dbip[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[medium]&#125;</span>&quot;</span></span><br><span class="line">dbip[score]=50</span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;high&quot;</span>)dbip[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[high]&#125;</span>&quot;</span></span><br><span class="line">dbip[score]=100</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">shopt</span> -u nocasematch</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipwhois</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>IPWHOIS <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipwhois=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://ipwhois.io/widget?ip=<span class="variable">$IP</span>&amp;lang=en&quot;</span> --compressed \</span><br><span class="line">-H <span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Accept: */*&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Connection: keep-alive&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Referer: https://ipwhois.io/&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Sec-Fetch-Dest: empty&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Sec-Fetch-Mode: cors&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Sec-Fetch-Site: same-origin&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;TE: trailers&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipwhois[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.country_code&#x27;</span>)</span><br><span class="line">ipwhois[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.proxy&#x27;</span>)</span><br><span class="line">ipwhois[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.tor&#x27;</span>)</span><br><span class="line">ipwhois[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.vpn&#x27;</span>)</span><br><span class="line">ipwhois[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.security.hosting&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipdata</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>ipdata <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">7</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipdata=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://ipinfo.check.place/<span class="variable">$IP</span>?db=ipdata&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipdata[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.country_code&#x27;</span>)</span><br><span class="line">ipdata[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_proxy&#x27;</span>)</span><br><span class="line">ipdata[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_tor&#x27;</span>)</span><br><span class="line">ipdata[server]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_datacenter&#x27;</span>)</span><br><span class="line">ipdata[abuser1]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_threat&#x27;</span>)</span><br><span class="line">ipdata[abuser2]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_known_abuser&#x27;</span>)</span><br><span class="line">ipdata[abuser3]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.threat.is_known_attacker&#x27;</span>)</span><br><span class="line">ipdata[abuser]=<span class="string">&quot;true&quot;</span></span><br><span class="line">[[ <span class="variable">$&#123;ipdata[abuser1]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ipdata[abuser2]&#125;</span> == <span class="string">&quot;false&quot;</span> &amp;&amp; <span class="variable">$&#123;ipdata[abuser3]&#125;</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;ipdata[abuser]=<span class="string">&quot;false&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">db_ipqs</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[database]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>IPQS <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">5</span>-<span class="variable">$&#123;sinfo[ldatabase]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">ipqs=()</span><br><span class="line"><span class="built_in">local</span> RESPONSE=$(curl <span class="variable">$CurlARG</span> -sL -m 10 <span class="string">&quot;https://ipinfo.check.place/<span class="variable">$IP</span>?db=ipqualityscore&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1||RESPONSE=<span class="string">&quot;&quot;</span></span><br><span class="line">ipqs[score]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.fraud_score&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;ipqs[score]&#125;</span> -lt 75 ]];<span class="keyword">then</span></span><br><span class="line">ipqs[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[low]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;ipqs[score]&#125;</span> -lt 85 ]];<span class="keyword">then</span></span><br><span class="line">ipqs[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[suspicious]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;ipqs[score]&#125;</span> -lt 90 ]];<span class="keyword">then</span></span><br><span class="line">ipqs[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[risky]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;ipqs[score]&#125;</span> -ge 90 ]];<span class="keyword">then</span></span><br><span class="line">ipqs[risk]=<span class="string">&quot;<span class="variable">$&#123;sscore[highrisk]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">ipqs[countrycode]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.country_code&#x27;</span>)</span><br><span class="line">ipqs[proxy]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.proxy&#x27;</span>)</span><br><span class="line">ipqs[tor]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.tor&#x27;</span>)</span><br><span class="line">ipqs[vpn]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.vpn&#x27;</span>)</span><br><span class="line">ipqs[abuser]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.recent_abuse&#x27;</span>)</span><br><span class="line">ipqs[robot]=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$RESPONSE</span>&quot;</span>|jq -r <span class="string">&#x27;.bot_status&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_ip_valide</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> IPPattern=<span class="string">&#x27;^(\&lt;([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\&gt;\.)&#123;3&#125;\&lt;([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\&gt;$&#x27;</span></span><br><span class="line">IP=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="keyword">for</span> special_ip <span class="keyword">in</span> <span class="variable">$&#123;special_ips[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line"><span class="built_in">local</span> ret=$(<span class="built_in">echo</span> <span class="variable">$IP</span>|grep <span class="variable">$special_ip</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$ret</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$IP</span> =~ <span class="variable">$IPPattern</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">calc_ip_net</span></span>()&#123;</span><br><span class="line">sip=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">snetmask=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">check_ip_valide <span class="string">&quot;<span class="variable">$sip</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> ipFIELD1=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$sip</span>&quot;</span>|<span class="built_in">cut</span> -d. -f1)</span><br><span class="line"><span class="built_in">local</span> ipFIELD2=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$sip</span>&quot;</span>|<span class="built_in">cut</span> -d. -f2)</span><br><span class="line"><span class="built_in">local</span> ipFIELD3=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$sip</span>&quot;</span>|<span class="built_in">cut</span> -d. -f3)</span><br><span class="line"><span class="built_in">local</span> ipFIELD4=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$sip</span>&quot;</span>|<span class="built_in">cut</span> -d. -f4)</span><br><span class="line"><span class="built_in">local</span> netmaskFIELD1=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$snetmask</span>&quot;</span>|<span class="built_in">cut</span> -d. -f1)</span><br><span class="line"><span class="built_in">local</span> netmaskFIELD2=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$snetmask</span>&quot;</span>|<span class="built_in">cut</span> -d. -f2)</span><br><span class="line"><span class="built_in">local</span> netmaskFIELD3=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$snetmask</span>&quot;</span>|<span class="built_in">cut</span> -d. -f3)</span><br><span class="line"><span class="built_in">local</span> netmaskFIELD4=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$snetmask</span>&quot;</span>|<span class="built_in">cut</span> -d. -f4)</span><br><span class="line"><span class="built_in">local</span> tmpret1=$((ipFIELD1&amp;netmaskFIELD1))</span><br><span class="line"><span class="built_in">local</span> tmpret2=$((ipFIELD2&amp;netmaskFIELD2))</span><br><span class="line"><span class="built_in">local</span> tmpret3=$((ipFIELD3&amp;netmaskFIELD3))</span><br><span class="line"><span class="built_in">local</span> tmpret4=$((ipFIELD4&amp;netmaskFIELD4))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tmpret1</span>.<span class="variable">$tmpret2</span>.<span class="variable">$tmpret3</span>.<span class="variable">$tmpret4</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Check_DNS_IP</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;1#*[0-9].[0-9]&#125;</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$1</span>&quot;</span> 255.0.0.0)</span>&quot;</span> == <span class="string">&quot;10.0.0.0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$1</span>&quot;</span> 255.240.0.0)</span>&quot;</span> == <span class="string">&quot;172.16.0.0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$1</span>&quot;</span> 255.255.0.0)</span>&quot;</span> == <span class="string">&quot;169.254.0.0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$1</span>&quot;</span> 255.255.0.0)</span>&quot;</span> == <span class="string">&quot;192.168.0.0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$1</span>&quot;</span> 255.255.255.0)</span>&quot;</span> == <span class="string">&quot;<span class="subst">$(calc_ip_net <span class="string">&quot;<span class="variable">$2</span>&quot;</span> 255.255.255.0)</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;<span class="variable">$&#123;1#*[0-9a-fA-F]:*&#125;</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:3&#125;</span>&quot;</span> == <span class="string">&quot;fe8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:3&#125;</span>&quot;</span> == <span class="string">&quot;FE8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;fc&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;FC&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;fd&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;FD&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;ff&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;1:0:2&#125;</span>&quot;</span> == <span class="string">&quot;FF&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Check_DNS_1</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> resultdns=$(nslookup <span class="variable">$1</span>)</span><br><span class="line"><span class="built_in">local</span> resultinlines=(<span class="variable">$&#123;resultdns//$&#x27;\n&#x27;/ &#125;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;resultinlines[*]&#125;</span>;<span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$i</span> == <span class="string">&quot;Name:&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> resultdnsindex=$((resultindex+<span class="number">3</span>))</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> resultindex=$((resultindex+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> $(Check_DNS_IP <span class="variable">$&#123;resultinlines[$resultdnsindex]&#125;</span> <span class="variable">$&#123;resultinlines[1]&#125;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Check_DNS_2</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> resultdnstext=$(dig <span class="variable">$1</span>|grep <span class="string">&quot;ANSWER:&quot;</span>)</span><br><span class="line"><span class="built_in">local</span> resultdnstext=<span class="variable">$&#123;resultdnstext#*&quot;ANSWER: &quot;&#125;</span></span><br><span class="line"><span class="built_in">local</span> resultdnstext=<span class="variable">$&#123;resultdnstext%&quot;, AUTHORITY:&quot;*&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$resultdnstext</span>&quot;</span> == <span class="string">&quot;0&quot;</span> ]||[ <span class="string">&quot;<span class="variable">$resultdnstext</span>&quot;</span> == <span class="string">&quot;1&quot;</span> ]||[ <span class="string">&quot;<span class="variable">$resultdnstext</span>&quot;</span> == <span class="string">&quot;2&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Check_DNS_3</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> resultdnstext=$(dig <span class="string">&quot;test$RANDOM<span class="variable">$RANDOM</span>.<span class="variable">$1</span>&quot;</span>|grep <span class="string">&quot;ANSWER:&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test$RANDOM<span class="variable">$RANDOM</span>.<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> resultdnstext=<span class="variable">$&#123;resultdnstext#*&quot;ANSWER: &quot;&#125;</span></span><br><span class="line"><span class="built_in">local</span> resultdnstext=<span class="variable">$&#123;resultdnstext%&quot;, AUTHORITY:&quot;*&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$resultdnstext</span>&quot;</span> == <span class="string">&quot;0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Get_Unlock_Type</span></span>()&#123;</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> -ne 0 ];<span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;0&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;smedia[dns]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;smedia[native]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_TikTok</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>TikTok <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">7</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">tiktok=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;tiktok.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> Ftmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -sL -m 10 <span class="string">&quot;https://www.tiktok.com/&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$Ftmpresult</span> == <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">tiktok[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">tiktok[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">tiktok[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> FRegion=$(<span class="built_in">echo</span> <span class="variable">$Ftmpresult</span>|grep <span class="string">&#x27;&quot;region&quot;:&#x27;</span>|sed <span class="string">&#x27;s/.*&quot;region&quot;//&#x27;</span>|<span class="built_in">cut</span> -f2 -d<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$FRegion</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">tiktok[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">tiktok[uregion]=<span class="string">&quot;  [<span class="variable">$FRegion</span>]   &quot;</span></span><br><span class="line">tiktok[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> STmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -sL -m 10 -H <span class="string">&quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span> -H <span class="string">&quot;Accept-Encoding: gzip&quot;</span> -H <span class="string">&quot;Accept-Language: en&quot;</span> <span class="string">&quot;https://www.tiktok.com&quot;</span>|gunzip 2&gt;/dev/null)</span><br><span class="line"><span class="built_in">local</span> SRegion=$(<span class="built_in">echo</span> <span class="variable">$STmpresult</span>|grep <span class="string">&#x27;&quot;region&quot;:&#x27;</span>|sed <span class="string">&#x27;s/.*&quot;region&quot;//&#x27;</span>|<span class="built_in">cut</span> -f2 -d<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$SRegion</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">tiktok[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[idc]&#125;</span>&quot;</span></span><br><span class="line">tiktok[uregion]=<span class="string">&quot;  [<span class="variable">$SRegion</span>]   &quot;</span></span><br><span class="line">tiktok[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tiktok[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">tiktok[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">tiktok[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_DisneyPlus</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Disney+ <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">disney=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;disneyplus.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result2=$(Check_DNS_2 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result2</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> PreAssertion=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -s --max-time 10 -X POST <span class="string">&quot;https://disney.api.edge.bamgrid.com/devices&quot;</span> -H <span class="string">&quot;authorization: Bearer ZGlzbmV5JmJyb3dzZXImMS4wLjA.Cu56AgSfBTDag5NiRA81oLHkDZfu5L3CKadnefEAY84&quot;</span> -H <span class="string">&quot;content-type: application/json; charset=UTF-8&quot;</span> -d <span class="string">&#x27;&#123;&quot;deviceFamily&quot;:&quot;browser&quot;,&quot;applicationRuntime&quot;:&quot;chrome&quot;,&quot;deviceProfile&quot;:&quot;windows&quot;,&quot;attributes&quot;:&#123;&#125;&#125;&#x27;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$PreAssertion</span> == <span class="string">&quot;curl&quot;</span>* ]]&amp;&amp;[[ <span class="variable">$1</span> == <span class="string">&quot;6&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$PreAssertion</span> == <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> ! (<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PreAssertion</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1&amp;&amp;<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$TokenContent</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1);<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> assertion=$(<span class="built_in">echo</span> <span class="variable">$PreAssertion</span>|jq -r <span class="string">&#x27;.assertion&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> PreDisneyCookie=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$Media_Cookie</span>&quot;</span>|sed -n <span class="string">&#x27;1p&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> disneycookie=$(<span class="built_in">echo</span> <span class="variable">$PreDisneyCookie</span>|sed <span class="string">&quot;s/DISNEYASSERTION/<span class="variable">$assertion</span>/g&quot;</span>)</span><br><span class="line"><span class="built_in">local</span> TokenContent=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -s --max-time 10 -X POST <span class="string">&quot;https://disney.api.edge.bamgrid.com/token&quot;</span> -H <span class="string">&quot;authorization: Bearer ZGlzbmV5JmJyb3dzZXImMS4wLjA.Cu56AgSfBTDag5NiRA81oLHkDZfu5L3CKadnefEAY84&quot;</span> -d <span class="string">&quot;<span class="variable">$disneycookie</span>&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="built_in">local</span> isBanned=$(<span class="built_in">echo</span> <span class="variable">$TokenContent</span>|jq -r <span class="string">&#x27;select(.error_description == &quot;forbidden-location&quot;) | .error_description&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> is403=$(<span class="built_in">echo</span> <span class="variable">$TokenContent</span>|grep <span class="string">&#x27;403 ERROR&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$isBanned</span>&quot;</span> ]||[ -n <span class="string">&quot;<span class="variable">$is403</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> fakecontent=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$Media_Cookie</span>&quot;</span>|sed -n <span class="string">&#x27;8p&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> refreshToken=$(<span class="built_in">echo</span> <span class="variable">$TokenContent</span>|jq -r <span class="string">&#x27;.refresh_token&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> disneycontent=$(<span class="built_in">echo</span> <span class="variable">$fakecontent</span>|sed <span class="string">&quot;s/ILOVEDISNEY/<span class="variable">$refreshToken</span>/g&quot;</span>)</span><br><span class="line"><span class="built_in">local</span> tmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -X POST -sSL --max-time 10 <span class="string">&quot;https://disney.api.edge.bamgrid.com/graph/v1/device/graphql&quot;</span> -H <span class="string">&quot;authorization: ZGlzbmV5JmJyb3dzZXImMS4wLjA.Cu56AgSfBTDag5NiRA81oLHkDZfu5L3CKadnefEAY84&quot;</span> -d <span class="string">&quot;<span class="variable">$disneycontent</span>&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> ! (<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tmpresult</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1);<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> previewcheck=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> -s -o /dev/null -L --max-time 10 -w <span class="string">&#x27;%&#123;url_effective&#125;\n&#x27;</span> <span class="string">&quot;https://disneyplus.com&quot;</span>|grep preview)</span><br><span class="line"><span class="built_in">local</span> isUnabailable=$(<span class="built_in">echo</span> <span class="variable">$previewcheck</span>|grep <span class="string">&#x27;unavailable&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> region=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|jq -r <span class="string">&#x27;.extensions.sdk.session.location.countryCode&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> inSupportedLocation=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|jq -r <span class="string">&#x27;.extensions.sdk.session.inSupportedLocation&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$region</span> == <span class="string">&quot;JP&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;  [JP]   &quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ]&amp;&amp;[[ <span class="variable">$inSupportedLocation</span> == <span class="string">&quot;false&quot;</span> ]]&amp;&amp;[ -z <span class="string">&quot;<span class="variable">$isUnabailable</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[pending]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$isUnavailable</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ]&amp;&amp;[[ <span class="variable">$inSupportedLocation</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -z <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">disney[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">disney[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">disney[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_Netflix</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Netflix <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">netflix=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;netflix.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result2=$(Check_DNS_2 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result2</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> result1=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -fsLI -X GET --write-out %&#123;http_code&#125; --output /dev/null --max-time 10 --tlsv1.3 <span class="string">&quot;https://www.netflix.com/title/81280792&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="built_in">local</span> result2=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -fsLI -X GET --write-out %&#123;http_code&#125; --output /dev/null --max-time 10 --tlsv1.3 <span class="string">&quot;https://www.netflix.com/title/70143836&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="built_in">local</span> regiontmp=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -fSsI -X GET --max-time 10 --write-out %&#123;redirect_url&#125; --output /dev/null --tlsv1.3 <span class="string">&quot;https://www.netflix.com/login&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$regiontmp</span> == <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> region=$(<span class="built_in">echo</span> <span class="variable">$regiontmp</span>|<span class="built_in">cut</span> -d <span class="string">&#x27;/&#x27;</span> -f4|<span class="built_in">cut</span> -d <span class="string">&#x27;-&#x27;</span> -f1|<span class="built_in">tr</span> [:lower:] [:upper:])</span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$region</span> ]];<span class="keyword">then</span></span><br><span class="line">region=<span class="string">&quot;US&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$result1</span> == <span class="string">&quot;404&quot;</span> ]]&amp;&amp;[[ <span class="variable">$result2</span> == <span class="string">&quot;404&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[org]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$result1</span> == <span class="string">&quot;403&quot;</span> ]]&amp;&amp;[[ <span class="variable">$result2</span> == <span class="string">&quot;403&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$result1</span> == <span class="string">&quot;200&quot;</span> ]]||[[ <span class="variable">$result2</span> == <span class="string">&quot;200&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$result1</span> == <span class="string">&quot;000&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">netflix[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">netflix[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">netflix[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_YouTube_Premium</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Youtube <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">youtube=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;www.youtube.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> tmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --max-time 10 -sSL -H <span class="string">&quot;Accept-Language: en&quot;</span> -b <span class="string">&quot;YSC=BiCUU3-5Gdk; CONSENT=YES+cb.20220301-11-p0.en+FX+700; GPS=1; VISITOR_INFO1_LIVE=4VwPMkB7W5A; PREF=tz=Asia.Shanghai; _gcl_au=1.1.1809531354.1646633279&quot;</span> <span class="string">&quot;https://www.youtube.com/premium&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$tmpresult</span> == <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> isCN=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|grep <span class="string">&#x27;www.google.cn&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$isCN</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[cn]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;  <span class="variable">$Font_Red</span>[CN]<span class="variable">$Font_Green</span>   &quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> isNotAvailable=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|grep <span class="string">&#x27;Premium is not available in your country&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> region=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|sed -n <span class="string">&#x27;s/.*&quot;contentRegion&quot;:&quot;\([^&quot;]*\)&quot;.*/\1/p&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> isAvailable=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|grep <span class="string">&#x27;ad-free&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$isNotAvailable</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[noprem]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$isAvailable</span>&quot;</span> ]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -z <span class="string">&quot;<span class="variable">$region</span>&quot;</span> ]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$isAvailable</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">youtube[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">youtube[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">youtube[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_PrimeVideo_Region</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Amazon <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">7</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">amazon=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;www.primevideo.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> tmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -sL --max-time 10 <span class="string">&quot;https://www.primevideo.com&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$tmpresult</span> == <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">amazon[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">amazon[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">amazon[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> result=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|grep <span class="string">&#x27;&quot;currentTerritory&quot;:&#x27;</span>|sed <span class="string">&#x27;s/.*currentTerritory//&#x27;</span>|<span class="built_in">cut</span> -f3 -d<span class="string">&#x27;&quot;&#x27;</span>|<span class="built_in">head</span> -n 1)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$result</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">amazon[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">amazon[uregion]=<span class="string">&quot;  [<span class="variable">$result</span>]   &quot;</span></span><br><span class="line">amazon[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">amazon[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">amazon[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">amazon[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">MediaUnlockTest_Spotify</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[media]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>Spotify <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[lmedia]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">spotify=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;spclient.wg.spotify.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result3</span>)</span><br><span class="line"><span class="built_in">local</span> tmpresult=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> --user-agent <span class="string">&quot;<span class="variable">$UA_Browser</span>&quot;</span> -s --max-time 10 -X POST <span class="string">&quot;https://spclient.wg.spotify.com/signup/public/v1/account&quot;</span> -d <span class="string">&quot;birth_day=11&amp;birth_month=11&amp;birth_year=2000&amp;collect_personal_info=undefined&amp;creation_flow=&amp;creation_point=https%3A%2F%2Fwww.spotify.com%2Fhk-en%2F&amp;displayname=Gay%20Lord&amp;gender=male&amp;iagree=1&amp;key=a1e486e2729f46d6bb368d6b2bcda326&amp;platform=www&amp;referrer=&amp;send-email=0&amp;thirdpartyemail=0&amp;identifier_token=AgE6YTvEzkReHNfJpO114514&quot;</span> -H <span class="string">&quot;Accept-Language: en&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tmpresult</span>&quot;</span>|jq . &gt;/dev/null 2&gt;&amp;1;<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> region=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|jq -r <span class="string">&#x27;.country&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> isLaunched=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|jq -r <span class="string">&#x27;.is_country_launched&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> StatusCode=$(<span class="built_in">echo</span> <span class="variable">$tmpresult</span>|jq -r <span class="string">&#x27;.status&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$tmpresult</span>&quot;</span> = <span class="string">&quot;000&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">spotify[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">spotify[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">spotify[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$StatusCode</span>&quot;</span> = <span class="string">&quot;320&quot;</span> ]||[ <span class="string">&quot;<span class="variable">$StatusCode</span>&quot;</span> = <span class="string">&quot;120&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">spotify[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">spotify[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">spotify[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$StatusCode</span>&quot;</span> = <span class="string">&quot;311&quot;</span> ]&amp;&amp;[ <span class="string">&quot;<span class="variable">$isLaunched</span>&quot;</span> = <span class="string">&quot;true&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">spotify[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">spotify[uregion]=<span class="string">&quot;  [<span class="variable">$region</span>]   &quot;</span></span><br><span class="line">spotify[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">spotify[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">spotify[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">spotify[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">spotify[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">spotify[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">spotify[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">OpenAITest</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[ai]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>ChatGPT <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">8</span>-<span class="variable">$&#123;sinfo[lai]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">chatgpt=()</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;chat.openai.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result1=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result2=$(Check_DNS_2 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result3=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;ios.chat.openai.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result4=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result5=$(Check_DNS_2 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result6=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> checkunlockurl=<span class="string">&quot;api.openai.com&quot;</span></span><br><span class="line"><span class="built_in">local</span> result7=$(Check_DNS_1 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> result8=$(Check_DNS_3 <span class="variable">$checkunlockurl</span>)</span><br><span class="line"><span class="built_in">local</span> resultunlocktype=$(Get_Unlock_Type <span class="variable">$result1</span> <span class="variable">$result2</span> <span class="variable">$result3</span> <span class="variable">$result4</span> <span class="variable">$result5</span> <span class="variable">$result6</span> <span class="variable">$result7</span> <span class="variable">$result8</span>)</span><br><span class="line"><span class="built_in">local</span> tmpresult1=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> -sS --max-time 10 <span class="string">&#x27;https://api.openai.com/compliance/cookie_requirements&#x27;</span> -H <span class="string">&#x27;authority: api.openai.com&#x27;</span> -H <span class="string">&#x27;accept: */*&#x27;</span> -H <span class="string">&#x27;accept-language: zh-CN,zh;q=0.9&#x27;</span> -H <span class="string">&#x27;authorization: Bearer null&#x27;</span> -H <span class="string">&#x27;content-type: application/json&#x27;</span> -H <span class="string">&#x27;origin: https://platform.openai.com&#x27;</span> -H <span class="string">&#x27;referer: https://platform.openai.com/&#x27;</span> -H <span class="string">&#x27;sec-ch-ua: &quot;Microsoft Edge&quot;;v=&quot;119&quot;, &quot;Chromium&quot;;v=&quot;119&quot;, &quot;Not?A_Brand&quot;;v=&quot;24&quot;&#x27;</span> -H <span class="string">&#x27;sec-ch-ua-mobile: ?0&#x27;</span> -H <span class="string">&#x27;sec-ch-ua-platform: &quot;Windows&quot;&#x27;</span> -H <span class="string">&#x27;sec-fetch-dest: empty&#x27;</span> -H <span class="string">&#x27;sec-fetch-mode: cors&#x27;</span> -H <span class="string">&#x27;sec-fetch-site: same-site&#x27;</span> -H <span class="string">&#x27;user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0&#x27;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="built_in">local</span> tmpresult2=$(curl <span class="variable">$CurlARG</span> -<span class="variable">$1</span> -sS --max-time 10 <span class="string">&#x27;https://ios.chat.openai.com/&#x27;</span> -H <span class="string">&#x27;authority: ios.chat.openai.com&#x27;</span> -H <span class="string">&#x27;accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#x27;</span> -H <span class="string">&#x27;accept-language: zh-CN,zh;q=0.9&#x27;</span> -H <span class="string">&#x27;sec-ch-ua: &quot;Microsoft Edge&quot;;v=&quot;119&quot;, &quot;Chromium&quot;;v=&quot;119&quot;, &quot;Not?A_Brand&quot;;v=&quot;24&quot;&#x27;</span> -H <span class="string">&#x27;sec-ch-ua-mobile: ?0&#x27;</span> -H <span class="string">&#x27;sec-ch-ua-platform: &quot;Windows&quot;&#x27;</span> -H <span class="string">&#x27;sec-fetch-dest: document&#x27;</span> -H <span class="string">&#x27;sec-fetch-mode: navigate&#x27;</span> -H <span class="string">&#x27;sec-fetch-site: none&#x27;</span> -H <span class="string">&#x27;sec-fetch-user: ?1&#x27;</span> -H <span class="string">&#x27;upgrade-insecure-requests: 1&#x27;</span> -H <span class="string">&#x27;user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0&#x27;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="built_in">local</span> result1=$(<span class="built_in">echo</span> <span class="variable">$tmpresult1</span>|grep unsupported_country)</span><br><span class="line"><span class="built_in">local</span> result2=$(<span class="built_in">echo</span> <span class="variable">$tmpresult2</span>|grep VPN)</span><br><span class="line"><span class="built_in">local</span> countryCode=<span class="string">&quot;<span class="subst">$(curl $CurlARG --max-time 10 -sS https://chat.openai.com/cdn-cgi/trace 2&gt;&amp;1|grep <span class="string">&quot;loc=&quot;</span>|awk -F= &#x27;&#123;print $2&#125;&#x27;)</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$result2</span>&quot;</span> ]&amp;&amp;[ -z <span class="string">&quot;<span class="variable">$result1</span>&quot;</span> ]&amp;&amp;[[ <span class="variable">$tmpresult1</span> != <span class="string">&quot;curl&quot;</span>* ]]&amp;&amp;[[ <span class="variable">$tmpresult2</span> != <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[yes]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;  [<span class="variable">$countryCode</span>]   &quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$result2</span>&quot;</span> ]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$result1</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -z <span class="string">&quot;<span class="variable">$result1</span>&quot;</span> ]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$result2</span>&quot;</span> ]&amp;&amp;[[ <span class="variable">$tmpresult1</span> != <span class="string">&quot;curl&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[web]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;  [<span class="variable">$countryCode</span>]   &quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="variable">$result1</span>&quot;</span> ]&amp;&amp;[ -z <span class="string">&quot;<span class="variable">$result2</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[app]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;  [<span class="variable">$countryCode</span>]   &quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$resultunlocktype</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$tmpresult1</span> == <span class="string">&quot;curl&quot;</span>* ]]&amp;&amp;[ -n <span class="string">&quot;<span class="variable">$result2</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[no]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">chatgpt[ustatus]=<span class="string">&quot;<span class="variable">$&#123;smedia[bad]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[uregion]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line">chatgpt[utype]=<span class="string">&quot;<span class="variable">$&#123;smedia[nodata]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_local_port_25</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> host=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> port=<span class="variable">$2</span></span><br><span class="line">nc -z -w5 <span class="variable">$host</span> <span class="variable">$port</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">smail[<span class="built_in">local</span>]=1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">smail[<span class="built_in">local</span>]=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">get_sorted_mx_records</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> domain=<span class="variable">$1</span></span><br><span class="line">dig +short MX <span class="variable">$domain</span>|<span class="built_in">sort</span> -n|<span class="built_in">head</span> -1|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_email_service</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> service=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">local</span> port=25</span><br><span class="line"><span class="built_in">local</span> expected_response=<span class="string">&quot;220&quot;</span></span><br><span class="line"><span class="built_in">local</span> domain=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">local</span> host=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">local</span> response=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">local</span> success=<span class="string">&quot;false&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$service</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;Gmail&quot;</span>)domain=<span class="string">&quot;gmail.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;Outlook&quot;</span>)domain=<span class="string">&quot;outlook.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;Yahoo&quot;</span>)domain=<span class="string">&quot;yahoo.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;Apple&quot;</span>)domain=<span class="string">&quot;me.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;QQ&quot;</span>)domain=<span class="string">&quot;qq.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;MailRU&quot;</span>)domain=<span class="string">&quot;mail.ru&quot;</span>;;</span><br><span class="line"><span class="string">&quot;AOL&quot;</span>)domain=<span class="string">&quot;aol.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;GMX&quot;</span>)domain=<span class="string">&quot;gmx.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;MailCOM&quot;</span>)domain=<span class="string">&quot;mail.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;163&quot;</span>)domain=<span class="string">&quot;163.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;Sohu&quot;</span>)domain=<span class="string">&quot;sohu.com&quot;</span>;;</span><br><span class="line"><span class="string">&quot;Sina&quot;</span>)domain=<span class="string">&quot;sina.com&quot;</span>;;</span><br><span class="line">*)<span class="built_in">return</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$host</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> mx_hosts=($(get_sorted_mx_records <span class="variable">$domain</span>))</span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;mx_hosts[@]&#125;</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">response=$(<span class="built_in">timeout</span> 4 bash -c <span class="string">&quot;echo -e &#x27;QUIT\r\n&#x27; | nc -w4 <span class="variable">$host</span> <span class="variable">$port</span> 2&gt;&amp;1&quot;</span>)</span><br><span class="line">smail_response[<span class="variable">$service</span>]=<span class="variable">$response</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$response</span> == *<span class="string">&quot;<span class="variable">$expected_response</span>&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">success=<span class="string">&quot;true&quot;</span></span><br><span class="line">smail[<span class="variable">$service</span>]=<span class="string">&quot;$Back_Green$Font_White$Font_B$service<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">response=$(<span class="built_in">timeout</span> 4 bash -c <span class="string">&quot;echo -e &#x27;QUIT\r\n&#x27; | nc -w4 <span class="variable">$host</span> <span class="variable">$port</span> 2&gt;&amp;1&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$response</span> == *<span class="string">&quot;<span class="variable">$expected_response</span>&quot;</span>* ]];<span class="keyword">then</span></span><br><span class="line">success=<span class="string">&quot;true&quot;</span></span><br><span class="line">smail[<span class="variable">$service</span>]=<span class="string">&quot;$Back_Green$Font_White$Font_B$service<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$success</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">smail[<span class="variable">$service</span>]=<span class="string">&quot;$Back_Red$Font_White$Font_B$service<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_mail</span></span>()&#123;</span><br><span class="line">check_local_port_25 <span class="string">&quot;localhost&quot;</span> 25</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;smail[local]&#125;</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line">services=(<span class="string">&quot;Gmail&quot;</span> <span class="string">&quot;Outlook&quot;</span> <span class="string">&quot;Yahoo&quot;</span> <span class="string">&quot;Apple&quot;</span> <span class="string">&quot;QQ&quot;</span> <span class="string">&quot;MailRU&quot;</span> <span class="string">&quot;AOL&quot;</span> <span class="string">&quot;GMX&quot;</span> <span class="string">&quot;MailCOM&quot;</span> <span class="string">&quot;163&quot;</span> <span class="string">&quot;Sohu&quot;</span> <span class="string">&quot;Sina&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;services[@]&#125;</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[mail]&#125;</span>$Font_I<span class="variable">$service</span> <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step+=<span class="number">3</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">1</span>-<span class="variable">$&#123;#service&#125;</span>-<span class="variable">$&#123;sinfo[lmail]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line">check_email_service <span class="variable">$service</span></span><br><span class="line">kill_progress_bar</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_dnsbl_parallel</span></span>()&#123;</span><br><span class="line">ip_to_check=<span class="variable">$1</span></span><br><span class="line">parallel_jobs=<span class="variable">$2</span></span><br><span class="line">smail[t]=0</span><br><span class="line">smail[c]=0</span><br><span class="line">smail[m]=0</span><br><span class="line">smail[b]=0</span><br><span class="line">reversed_ip=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip_to_check</span>&quot;</span>|awk -F. <span class="string">&#x27;&#123;print $4&quot;.&quot;$3&quot;.&quot;$2&quot;.&quot;$1&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> total=0</span><br><span class="line"><span class="built_in">local</span> clean=0</span><br><span class="line"><span class="built_in">local</span> blacklisted=0</span><br><span class="line"><span class="built_in">local</span> other=0</span><br><span class="line">curl <span class="variable">$CurlARG</span> -s <span class="string">&quot;https://raw.githubusercontent.com/xykt/IPQuality/main/ref/dnsbl.list&quot;</span>|<span class="built_in">sort</span> -u|xargs -P <span class="string">&quot;<span class="variable">$parallel_jobs</span>&quot;</span> -I &#123;&#125; bash -c <span class="string">&quot;result=\$(dig +short \&quot;<span class="variable">$reversed_ip</span>.&#123;&#125;\&quot; A); if [[ -z \&quot;\$result\&quot; ]]; then echo &#x27;Clean&#x27;; elif [[ \&quot;\$result\&quot; == &#x27;127.0.0.2&#x27; ]]; then echo &#x27;Blacklisted&#x27;; else echo &#x27;Other&#x27;; fi&quot;</span>|&#123;</span><br><span class="line"><span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line;<span class="keyword">do</span></span><br><span class="line">((total++))</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;Clean&quot;</span>)((clean++));;</span><br><span class="line"><span class="string">&quot;Blacklisted&quot;</span>)((blacklisted++));;</span><br><span class="line">*)((other++))</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">smail[t]=<span class="string">&quot;<span class="variable">$total</span>&quot;</span></span><br><span class="line">smail[c]=<span class="string">&quot;<span class="variable">$clean</span>&quot;</span></span><br><span class="line">smail[m]=<span class="string">&quot;<span class="variable">$other</span>&quot;</span></span><br><span class="line">smail[b]=<span class="string">&quot;<span class="variable">$blacklisted</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;$Font_Cyan<span class="variable">$&#123;smail[dnsbl]&#125;</span>  <span class="variable">$&#123;smail[available]&#125;</span><span class="variable">$&#123;smail[t]&#125;</span>   <span class="variable">$&#123;smail[clean]&#125;</span><span class="variable">$&#123;smail[c]&#125;</span>   <span class="variable">$&#123;smail[marked]&#125;</span><span class="variable">$&#123;smail[m]&#125;</span>   <span class="variable">$&#123;smail[blacklisted]&#125;</span><span class="variable">$&#123;smail[b]&#125;</span><span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_dnsbl</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> temp_info=<span class="string">&quot;$Font_Cyan$Font_B<span class="variable">$&#123;sinfo[dnsbl]&#125;</span> <span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line">((ibar_step=<span class="number">95</span>))</span><br><span class="line">show_progress_bar <span class="string">&quot;<span class="variable">$temp_info</span>&quot;</span> $((<span class="number">40</span>-<span class="number">1</span>-<span class="variable">$&#123;sinfo[ldnsbl]&#125;</span>))&amp;</span><br><span class="line">bar_pid=<span class="string">&quot;$!&quot;</span>&amp;&amp;<span class="built_in">disown</span> <span class="string">&quot;<span class="variable">$bar_pid</span>&quot;</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;kill_progress_bar&quot;</span> RETURN</span><br><span class="line">smail[sdnsbl]=$(check_dnsbl_parallel <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> 50)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_head</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="subst">$(printf &#x27;%72s&#x27;|tr &#x27; &#x27; &#x27;#&#x27;)</span>\n&quot;</span></span><br><span class="line">calc_padding <span class="string">&quot;<span class="subst">$(printf &#x27;%*s&#x27; <span class="string">&quot;<span class="variable">$&#123;shead[ltitle]&#125;</span>&quot;</span> &#x27;&#x27;)</span><span class="variable">$IPhide</span>&quot;</span> 72</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$PADDING$Font_B<span class="variable">$&#123;shead[title]&#125;</span>$Font_Cyan$IPhide<span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line">calc_padding <span class="string">&quot;<span class="variable">$&#123;shead[bash]&#125;</span>&quot;</span> 72</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$PADDING<span class="variable">$&#123;shead[bash]&#125;</span>\n&quot;</span></span><br><span class="line">calc_padding <span class="string">&quot;<span class="variable">$&#123;shead[git]&#125;</span>&quot;</span> 72</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$PADDING$Font_U<span class="variable">$&#123;shead[git]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;shead[ptime]&#125;</span><span class="variable">$&#123;shead[time]&#125;</span>  <span class="variable">$&#123;shead[ver]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="subst">$(printf &#x27;%72s&#x27;|tr &#x27; &#x27; &#x27;#&#x27;)</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_basic</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;sbasic[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[asn]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[asn]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[asn]&#125;</span><span class="variable">$&#123;Font_Green&#125;</span>AS<span class="variable">$&#123;maxmind[asn]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[org]&#125;</span>$Font_Green<span class="variable">$&#123;maxmind[org]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[asn]&#125;</span><span class="variable">$&#123;sbasic[noasn]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;maxmind[dms]&#125;</span> != <span class="string">&quot;null&quot;</span> &amp;&amp; <span class="variable">$&#123;maxmind[map]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[location]&#125;</span>$Font_Green<span class="variable">$&#123;maxmind[dms]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[map]&#125;</span>$Font_U$Font_Green<span class="variable">$&#123;maxmind[map]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">local</span> city_info=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[sub]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[sub]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">city_info+=<span class="string">&quot;<span class="variable">$&#123;maxmind[sub]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[city]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[city]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">[[ -n <span class="variable">$city_info</span> ]]&amp;&amp;city_info+=<span class="string">&quot;, &quot;</span></span><br><span class="line">city_info+=<span class="string">&quot;<span class="variable">$&#123;maxmind[city]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[post]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[post]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">[[ -n <span class="variable">$city_info</span> ]]&amp;&amp;city_info+=<span class="string">&quot;, &quot;</span></span><br><span class="line">city_info+=<span class="string">&quot;<span class="variable">$&#123;maxmind[post]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$city_info</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[city]&#125;</span>$Font_Green$city_info<span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[countrycode]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[countrycode]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[country]&#125;</span><span class="variable">$Font_Green</span>[<span class="variable">$&#123;maxmind[countrycode]&#125;</span>]<span class="variable">$&#123;maxmind[country]&#125;</span><span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[continentcode]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[continentcode]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;<span class="variable">$Font_Green</span>, [<span class="variable">$&#123;maxmind[continentcode]&#125;</span>]<span class="variable">$&#123;maxmind[continent]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [[ -n <span class="variable">$&#123;maxmind[continentcode]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[continentcode]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[continent]&#125;</span><span class="variable">$Font_Green</span>[<span class="variable">$&#123;maxmind[continentcode]&#125;</span>]<span class="variable">$&#123;maxmind[continent]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[regcountrycode]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[regcountrycode]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[regcountry]&#125;</span><span class="variable">$Font_Green</span>[<span class="variable">$&#123;maxmind[regcountrycode]&#125;</span>]<span class="variable">$&#123;maxmind[regcountry]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[timezone]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[timezone]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[timezone]&#125;</span>$Font_Green<span class="variable">$&#123;maxmind[timezone]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;maxmind[countrycode]&#125;</span> &amp;&amp; <span class="variable">$&#123;maxmind[countrycode]&#125;</span> != <span class="string">&quot;null&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;maxmind[countrycode]&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;maxmind[regcountrycode]&#125;</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[type]&#125;</span>$Back_Green$Font_B$Font_White<span class="variable">$&#123;sbasic[type0]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sbasic[type]&#125;</span>$Back_Red$Font_B$Font_White<span class="variable">$&#123;sbasic[type1]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_type</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;stype[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;stype[db]&#125;</span><span class="variable">$Font_I</span>   IPinfo    ipregistry    ipapi     AbuseIPDB  IP2LOCATION <span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;stype[usetype]&#125;</span>$Font_Suffix<span class="variable">$&#123;ipinfo[susetype]&#125;</span><span class="variable">$&#123;ipregistry[susetype]&#125;</span><span class="variable">$&#123;ipapi[susetype]&#125;</span><span class="variable">$&#123;abuseipdb[susetype]&#125;</span><span class="variable">$&#123;ip2location[susetype]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;stype[comtype]&#125;</span>$Font_Suffix<span class="variable">$&#123;ipinfo[scomtype]&#125;</span><span class="variable">$&#123;ipregistry[susetype]&#125;</span><span class="variable">$&#123;ipapi[susetype]&#125;</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">sscore_text</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> text=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> p2=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">local</span> p3=<span class="variable">$3</span></span><br><span class="line"><span class="built_in">local</span> p4=<span class="variable">$4</span></span><br><span class="line"><span class="built_in">local</span> p5=<span class="variable">$5</span></span><br><span class="line"><span class="built_in">local</span> p6=<span class="variable">$6</span></span><br><span class="line"><span class="built_in">local</span> tmplen</span><br><span class="line"><span class="built_in">local</span> tmp</span><br><span class="line"><span class="keyword">if</span> ((p2&gt;=p4));<span class="keyword">then</span></span><br><span class="line">tmplen=$((<span class="number">49</span>+<span class="number">15</span>*(p2-p4)/(p5-p4)-p6))</span><br><span class="line"><span class="keyword">elif</span> ((p2&gt;=p3));<span class="keyword">then</span></span><br><span class="line">tmplen=$((<span class="number">33</span>+<span class="number">16</span>*(p2-p3)/(p4-p3)-p6))</span><br><span class="line"><span class="keyword">elif</span> ((p2&gt;=<span class="number">0</span>));<span class="keyword">then</span></span><br><span class="line">tmplen=$((<span class="number">17</span>+<span class="number">16</span>*p2/p3-p6))</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmplen=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp=$(<span class="built_in">printf</span> <span class="string">&#x27;%*s&#x27;</span> <span class="variable">$tmplen</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">local</span> total_length=<span class="variable">$&#123;#tmp&#125;</span></span><br><span class="line"><span class="built_in">local</span> text_length=<span class="variable">$&#123;#text&#125;</span></span><br><span class="line"><span class="built_in">local</span> tmp1=<span class="string">&quot;<span class="variable">$&#123;tmp:1:total_length-text_length&#125;</span><span class="variable">$text</span>|&quot;</span></span><br><span class="line">sscore[text1]=<span class="string">&quot;<span class="variable">$&#123;tmp1:1:16-p6&#125;</span>&quot;</span></span><br><span class="line">sscore[text2]=<span class="string">&quot;<span class="variable">$&#123;tmp1:17-p6:16&#125;</span>&quot;</span></span><br><span class="line">sscore[text3]=<span class="string">&quot;<span class="variable">$&#123;tmp1:33-p6:16&#125;</span>&quot;</span></span><br><span class="line">sscore[text4]=<span class="string">&quot;<span class="variable">$&#123;tmp1:49-p6&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_score</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;sscore[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;sscore[range]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;scamalytics[score]&#125;</span> ]];<span class="keyword">then</span></span><br><span class="line">sscore_text <span class="string">&quot;<span class="variable">$&#123;scamalytics[score]&#125;</span>&quot;</span> <span class="variable">$&#123;scamalytics[score]&#125;</span> 25 50 100 13</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;Font_Cyan&#125;</span>SCAMALYTICS<span class="variable">$&#123;sscore[colon]&#125;</span>$Font_White$Font_B<span class="variable">$&#123;sscore[text1]&#125;</span>$Back_Green<span class="variable">$&#123;sscore[text2]&#125;</span>$Back_Yellow<span class="variable">$&#123;sscore[text3]&#125;</span>$Back_Red<span class="variable">$&#123;sscore[text4]&#125;</span>$Font_Suffix<span class="variable">$&#123;scamalytics[risk]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$&#123;ipapi[score]&#125;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> tmp_score=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[scorenum]&#125;</span> * 10000 / 1&quot;</span>|bc)</span><br><span class="line">sscore_text <span class="string">&quot;<span class="variable">$&#123;ipapi[score]&#125;</span>&quot;</span> <span class="variable">$tmp_score</span> 85 300 10000 7</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;Font_Cyan&#125;</span>ipapi<span class="variable">$&#123;sscore[colon]&#125;</span>$Font_White$Font_B<span class="variable">$&#123;sscore[text1]&#125;</span>$Back_Green<span class="variable">$&#123;sscore[text2]&#125;</span>$Back_Yellow<span class="variable">$&#123;sscore[text3]&#125;</span>$Back_Red<span class="variable">$&#123;sscore[text4]&#125;</span>$Font_Suffix<span class="variable">$&#123;ipapi[risk]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sscore_text <span class="string">&quot;<span class="variable">$&#123;abuseipdb[score]&#125;</span>&quot;</span> <span class="variable">$&#123;abuseipdb[score]&#125;</span> 25 25 100 11</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;Font_Cyan&#125;</span>AbuseIPDB<span class="variable">$&#123;sscore[colon]&#125;</span>$Font_White$Font_B<span class="variable">$&#123;sscore[text1]&#125;</span>$Back_Green<span class="variable">$&#123;sscore[text2]&#125;</span>$Back_Yellow<span class="variable">$&#123;sscore[text3]&#125;</span>$Back_Red<span class="variable">$&#123;sscore[text4]&#125;</span>$Font_Suffix<span class="variable">$&#123;abuseipdb[risk]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;ipqs[score]&#125;</span>&quot;</span> ]&amp;&amp;[ <span class="string">&quot;<span class="variable">$&#123;ipqs[score]&#125;</span>&quot;</span> != <span class="string">&quot;null&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">sscore_text <span class="string">&quot;<span class="variable">$&#123;ipqs[score]&#125;</span>&quot;</span> <span class="variable">$&#123;ipqs[score]&#125;</span> 75 85 100 6</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;Font_Cyan&#125;</span>IPQS<span class="variable">$&#123;sscore[colon]&#125;</span>$Font_White$Font_B<span class="variable">$&#123;sscore[text1]&#125;</span>$Back_Green<span class="variable">$&#123;sscore[text2]&#125;</span>$Back_Yellow<span class="variable">$&#123;sscore[text3]&#125;</span>$Back_Red<span class="variable">$&#123;sscore[text4]&#125;</span>$Font_Suffix<span class="variable">$&#123;ipqs[risk]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sscore_text <span class="string">&quot; &quot;</span> <span class="variable">$&#123;dbip[score]&#125;</span> 33 66 100 7</span><br><span class="line">[[ -n <span class="variable">$&#123;dbip[risk]&#125;</span> ]]&amp;&amp;<span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;Font_Cyan&#125;</span>DB-IP<span class="variable">$&#123;sscore[colon]&#125;</span>$Font_White$Font_B<span class="variable">$&#123;sscore[text1]&#125;</span>$Back_Green<span class="variable">$&#123;sscore[text2]&#125;</span>$Back_Yellow<span class="variable">$&#123;sscore[text3]&#125;</span>$Back_Red<span class="variable">$&#123;sscore[text4]&#125;</span>$Font_Suffix<span class="variable">$&#123;dbip[risk]&#125;</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">format_factor</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> tmp_txt=<span class="string">&quot;  &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$1</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$1</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#1&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$1</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$2</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$2</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#2&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$2</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$3</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$3</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#3&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$3</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$4</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$4</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#4&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$4</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$5</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$5</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#5&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$5</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$6</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$6</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#6&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$6</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$7</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$7</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#7&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$7</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;    &quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$8</span> == <span class="string">&quot;true&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[yes]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$8</span> == <span class="string">&quot;false&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[no]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$&#123;#8&#125;</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$Font_Green</span>[<span class="variable">$8</span>]<span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">tmp_txt+=<span class="string">&quot;<span class="variable">$&#123;sfactor[na]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tmp_txt</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_factor</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> tmp_factor=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;sfactor[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[factor]&#125;</span><span class="variable">$&#123;Font_I&#125;</span>IP2LOCATION ipapi ipregistry IPQS SCAMALYTICS ipdata IPinfo IPWHOIS<span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[countrycode]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[countrycode]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[countrycode]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[proxy]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[proxy]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[proxy]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[tor]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[tor]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[tor]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[vpn]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[vpn]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[vpn]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[server]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[server]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[server]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[abuser]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[abuser]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[abuser]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">tmp_factor=$(format_factor <span class="string">&quot;<span class="variable">$&#123;ip2location[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipapi[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipregistry[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipqs[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;scamalytics[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipdata[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipinfo[robot]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;ipwhois[robot]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;sfactor[robot]&#125;</span>$Font_Suffix<span class="variable">$tmp_factor</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_media</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;smedia[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smedia[meida]&#125;</span><span class="variable">$Font_I</span> TikTok   Disney+  Netflix Youtube  AmazonPV  Spotify  ChatGPT <span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smedia[status]&#125;</span><span class="variable">$&#123;tiktok[ustatus]&#125;</span><span class="variable">$&#123;disney[ustatus]&#125;</span><span class="variable">$&#123;netflix[ustatus]&#125;</span><span class="variable">$&#123;youtube[ustatus]&#125;</span><span class="variable">$&#123;amazon[ustatus]&#125;</span><span class="variable">$&#123;spotify[ustatus]&#125;</span><span class="variable">$&#123;chatgpt[ustatus]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smedia[region]&#125;</span>$Font_Green<span class="variable">$&#123;tiktok[uregion]&#125;</span><span class="variable">$&#123;disney[uregion]&#125;</span><span class="variable">$&#123;netflix[uregion]&#125;</span><span class="variable">$&#123;youtube[uregion]&#125;</span><span class="variable">$&#123;amazon[uregion]&#125;</span><span class="variable">$&#123;spotify[uregion]&#125;</span><span class="variable">$&#123;chatgpt[uregion]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smedia[type]&#125;</span><span class="variable">$&#123;tiktok[utype]&#125;</span><span class="variable">$&#123;disney[utype]&#125;</span><span class="variable">$&#123;netflix[utype]&#125;</span><span class="variable">$&#123;youtube[utype]&#125;</span><span class="variable">$&#123;amazon[utype]&#125;</span><span class="variable">$&#123;spotify[utype]&#125;</span><span class="variable">$&#123;chatgpt[utype]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_mail</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;smail[title]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;smail[local]&#125;</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smail[port]&#125;</span>$Font_Suffix<span class="variable">$&#123;smail[yes]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smail[provider]&#125;</span><span class="variable">$Font_Suffix</span>&quot;</span></span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;services[@]&#125;</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;<span class="variable">$&#123;smail[$service]&#125;</span> &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_Cyan<span class="variable">$&#123;smail[port]&#125;</span>$Font_Suffix<span class="variable">$&#123;smail[no]&#125;</span>\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[[ <span class="variable">$1</span> -eq 4 ]]&amp;&amp;<span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;smail[sdnsbl]&#125;</span>\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_tail</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="subst">$(printf &#x27;%72s&#x27;|tr &#x27; &#x27; &#x27;=&#x27;)</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_I<span class="variable">$&#123;stail[stoday]&#125;</span><span class="variable">$&#123;stail[today]&#125;</span><span class="variable">$&#123;stail[stotal]&#125;</span><span class="variable">$&#123;stail[total]&#125;</span><span class="variable">$&#123;stail[thanks]&#125;</span> <span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">get_opts</span></span>()&#123;</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&quot;i:l:x:h46&quot;</span> opt;<span class="keyword">do</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">4)<span class="keyword">if</span></span><br><span class="line">[[ <span class="variable">$IPV4test</span> == <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$IPV6test</span> == <span class="string">&quot;&quot;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">IPV4test=<span class="variable">$IPV4</span></span><br><span class="line">[[ <span class="variable">$IPV4work</span> -eq 0 ]]&amp;&amp;ERRORcode=40</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ERRORcode=4</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">6)<span class="keyword">if</span></span><br><span class="line">[[ <span class="variable">$IPV4test</span> == <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$IPV6test</span> == <span class="string">&quot;&quot;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">IPV6test=<span class="variable">$IPV6</span></span><br><span class="line">[[ <span class="variable">$IPV6work</span> -eq 0 ]]&amp;&amp;ERRORcode=60</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ERRORcode=6</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">h)show_help</span><br><span class="line">;;</span><br><span class="line">i)iface=<span class="string">&quot;<span class="variable">$OPTARG</span>&quot;</span></span><br><span class="line">useNIC=<span class="string">&quot; --interface <span class="variable">$iface</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="variable">$iface</span> &amp;&amp; -d <span class="string">&quot;/sys/class/net/<span class="variable">$iface</span>&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">useNIC=<span class="string">&quot; --interface <span class="variable">$iface</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ERRORcode=7</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">l)LANG=<span class="variable">$OPTARG</span></span><br><span class="line">;;</span><br><span class="line">x)xproxy=<span class="string">&quot;<span class="variable">$OPTARG</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$xproxy</span> ]]||! curl -sL -x <span class="string">&quot;<span class="variable">$xproxy</span>&quot;</span> --connect-timeout 5 --max-time 10 https://myip.check.place -o /dev/null;<span class="keyword">then</span></span><br><span class="line">ERRORcode=8</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">usePROXY=<span class="string">&quot; -x <span class="variable">$xproxy</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">\?)ERRORcode=1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">CurlARG=<span class="string">&quot;$useNIC<span class="variable">$usePROXY</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">show_help</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$shelp</span>\n&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_IP</span></span>()&#123;</span><br><span class="line">IP=<span class="variable">$1</span></span><br><span class="line">ibar_step=0</span><br><span class="line">[[ <span class="variable">$2</span> -eq 4 ]]&amp;&amp;hide_ipv4 <span class="variable">$IP</span></span><br><span class="line">[[ <span class="variable">$2</span> -eq 6 ]]&amp;&amp;hide_ipv6 <span class="variable">$IP</span></span><br><span class="line">db_maxmind</span><br><span class="line">db_ipinfo</span><br><span class="line">db_scamalytics</span><br><span class="line">db_ipregistry</span><br><span class="line">db_ipapi</span><br><span class="line">db_abuseipdb</span><br><span class="line">db_ip2location</span><br><span class="line">db_dbip</span><br><span class="line">db_ipwhois</span><br><span class="line">db_ipdata</span><br><span class="line">db_ipqs</span><br><span class="line">MediaUnlockTest_TikTok <span class="variable">$2</span></span><br><span class="line">MediaUnlockTest_DisneyPlus <span class="variable">$2</span></span><br><span class="line">MediaUnlockTest_Netflix <span class="variable">$2</span></span><br><span class="line">MediaUnlockTest_YouTube_Premium <span class="variable">$2</span></span><br><span class="line">MediaUnlockTest_PrimeVideo_Region <span class="variable">$2</span></span><br><span class="line">MediaUnlockTest_Spotify <span class="variable">$2</span></span><br><span class="line">OpenAITest <span class="variable">$2</span></span><br><span class="line">check_mail</span><br><span class="line">[[ <span class="variable">$2</span> -eq 4 ]]&amp;&amp;check_dnsbl <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> 50</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;<span class="variable">$Font_LineClear</span>&quot;</span></span><br><span class="line"><span class="built_in">local</span> ip_report=$(show_head</span><br><span class="line">show_basic</span><br><span class="line">show_type</span><br><span class="line">show_score</span><br><span class="line">show_factor</span><br><span class="line">show_media</span><br><span class="line">show_mail <span class="variable">$2</span></span><br><span class="line">show_tail)</span><br><span class="line"><span class="built_in">local</span> report_link=$(curl -<span class="variable">$2</span> -s -X POST http://upload.check.place -d <span class="string">&quot;type=ip&quot;</span> --data-urlencode <span class="string">&quot;content=<span class="variable">$ip_report</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$ip_report</span>\n&quot;</span></span><br><span class="line">[[ <span class="variable">$report_link</span> == *<span class="string">&quot;https&quot;</span>* ]]&amp;&amp;<span class="built_in">echo</span> -ne <span class="string">&quot;\r<span class="variable">$&#123;stail[link]&#125;</span>$report_link<span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">install_dependencies</span><br><span class="line">generate_random_user_agent</span><br><span class="line">countRunTimes</span><br><span class="line">get_ipv4</span><br><span class="line">get_ipv6</span><br><span class="line">is_valid_ipv4 <span class="variable">$IPV4</span></span><br><span class="line">is_valid_ipv6 <span class="variable">$IPV6</span></span><br><span class="line">get_opts <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">set_language</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$ERRORcode</span> -ne 0 ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -ne <span class="string">&quot;\r$Font_B$Font_Red<span class="variable">$&#123;swarn[$ERRORcode]&#125;</span><span class="variable">$Font_Suffix</span>\n&quot;</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$ERRORcode</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">clear</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$IPV4test</span> == <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$IPV6test</span> == <span class="string">&quot;&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">[[ <span class="variable">$IPV4work</span> -ne 0 ]]&amp;&amp;IPV4test=<span class="variable">$IPV4</span></span><br><span class="line">[[ <span class="variable">$IPV6work</span> -ne 0 ]]&amp;&amp;IPV6test=<span class="variable">$IPV6</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[[ -n <span class="variable">$IPV4test</span> ]]&amp;&amp;check_IP <span class="string">&quot;<span class="variable">$IPV4test</span>&quot;</span> 4</span><br><span class="line">[[ -n <span class="variable">$IPV6test</span> ]]&amp;&amp;check_IP <span class="string">&quot;<span class="variable">$IPV6test</span>&quot;</span> 6</span><br></pre></td></tr></table></figure><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h5 id="默认双栈检测："><a href="#默认双栈检测：" class="headerlink" title="默认双栈检测："></a>默认双栈检测：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place)</span><br></pre></td></tr></table></figure><h5 id="只检测IPv4结果："><a href="#只检测IPv4结果：" class="headerlink" title="只检测IPv4结果："></a>只检测IPv4结果：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -4</span><br></pre></td></tr></table></figure><h5 id="只检测IPv6结果："><a href="#只检测IPv6结果：" class="headerlink" title="只检测IPv6结果："></a>只检测IPv6结果：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -6</span><br></pre></td></tr></table></figure><h5 id="指定检测网卡："><a href="#指定检测网卡：" class="headerlink" title="指定检测网卡："></a>指定检测网卡：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -i eth0</span><br></pre></td></tr></table></figure><h5 id="指定代理服务器："><a href="#指定代理服务器：" class="headerlink" title="指定代理服务器："></a>指定代理服务器：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -x http://username:password@proxyserver:port</span><br><span class="line">bash &lt;(curl -Ls IP.Check.Place) -x https://username:password@proxyserver:port</span><br><span class="line">bash &lt;(curl -Ls IP.Check.Place) -x socks5://username:password@socksproxy:port</span><br></pre></td></tr></table></figure><h5 id="选择脚本语言为英文："><a href="#选择脚本语言为英文：" class="headerlink" title="选择脚本语言为英文："></a>选择脚本语言为英文：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -l en</span><br></pre></td></tr></table></figure><h5 id="基础信息多语言支持："><a href="#基础信息多语言支持：" class="headerlink" title="基础信息多语言支持："></a>基础信息多语言支持：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ls IP.Check.Place) -l jp|es|de|fr|ru|pt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一个开源的IP质量检测脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>show-busy-java-threads</title>
    <link href="http://example.com/2024/05/01/show-busy-java-threads/"/>
    <id>http://example.com/2024/05/01/show-busy-java-threads/</id>
    <published>2024-05-01T01:25:00.000Z</published>
    <updated>2024-05-01T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="show-busy-java-threads"><a href="#show-busy-java-threads" class="headerlink" title="show-busy-java-threads"></a><strong>show-busy-java-threads</strong></h1><h2 id="原版脚本"><a href="#原版脚本" class="headerlink" title="原版脚本"></a>原版脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># @Function</span></span><br><span class="line"><span class="comment"># Find out the highest cpu consumed threads of java, and print the stack of these threads.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @Usage</span></span><br><span class="line"><span class="comment">#   $ ./show-busy-java-threads.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">readonly</span> PROG=`<span class="built_in">basename</span> <span class="variable">$0</span>`</span><br><span class="line"><span class="built_in">readonly</span> -a COMMAND_LINE=(<span class="string">&quot;<span class="variable">$0</span>&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">Usage: $&#123;PROG&#125; [OPTION]...</span></span><br><span class="line"><span class="string">Find out the highest cpu consumed threads of java, and print the stack of these threads.</span></span><br><span class="line"><span class="string">Example: $&#123;PROG&#125; -c 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">    -p, --pid       find out the highest cpu consumed threads from the specifed java process,</span></span><br><span class="line"><span class="string">                    default from all java process.</span></span><br><span class="line"><span class="string">    -c, --count     set the thread count to show, default is 5</span></span><br><span class="line"><span class="string">    -h, --help      display this help and exit</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">readonly</span> ARGS=`getopt -n <span class="string">&quot;<span class="variable">$PROG</span>&quot;</span> -a -o c:p:h -l count:,pid:,<span class="built_in">help</span> -- <span class="string">&quot;<span class="variable">$@</span>&quot;</span>`</span><br><span class="line">[ $? -ne 0 ] &amp;&amp; usage 1</span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">&quot;<span class="variable">$&#123;ARGS&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    -c|--count)</span><br><span class="line">        count=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span> 2</span><br><span class="line">        ;;</span><br><span class="line">    -p|--pid)</span><br><span class="line">        pid=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span> 2</span><br><span class="line">        ;;</span><br><span class="line">    -h|--<span class="built_in">help</span>)</span><br><span class="line">        usage</span><br><span class="line">        ;;</span><br><span class="line">    --)</span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">count=<span class="variable">$&#123;count:-5&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">redEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="comment"># if stdout is console, turn on color output.</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;31m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">yellowEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="comment"># if stdout is console, turn on color output.</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;33m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">blueEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="comment"># if stdout is console, turn on color output.</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;36m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the existence of jstack command!</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> jstack &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    [ -z <span class="string">&quot;<span class="variable">$JAVA_HOME</span>&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;Error: jstack not found on PATH!&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    ! [ -f <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/jstack&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;Error: jstack not found on PATH and <span class="variable">$JAVA_HOME</span>/bin/jstack file does NOT exists!&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    ! [ -x <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/jstack&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;Error: jstack not found on PATH and <span class="variable">$JAVA_HOME</span>/bin/jstack is NOT executalbe!&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">readonly</span> uuid=`<span class="built_in">date</span> +%s`_<span class="variable">$&#123;RANDOM&#125;</span>_$$</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cleanupWhenExit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">rm</span> /tmp/<span class="variable">$&#123;uuid&#125;</span>_* &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;cleanupWhenExit&quot;</span> EXIT</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">printStackOfThreads</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> line</span><br><span class="line">    <span class="built_in">local</span> count=1</span><br><span class="line">    <span class="keyword">while</span> IFS=<span class="string">&quot; &quot;</span> <span class="built_in">read</span> -a line ; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">local</span> pid=<span class="variable">$&#123;line[0]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> threadId=<span class="variable">$&#123;line[1]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> threadId0x=<span class="string">&quot;0x`printf %x <span class="variable">$&#123;threadId&#125;</span>`&quot;</span></span><br><span class="line">        <span class="built_in">local</span> user=<span class="variable">$&#123;line[2]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> pcpu=<span class="variable">$&#123;line[4]&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">local</span> jstackFile=/tmp/<span class="variable">$&#123;uuid&#125;</span>_<span class="variable">$&#123;pid&#125;</span></span><br><span class="line"></span><br><span class="line">        [ ! -f <span class="string">&quot;<span class="variable">$&#123;jstackFile&#125;</span>&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;user&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;USER&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                    jstack <span class="variable">$&#123;pid&#125;</span> &gt; <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">if</span> [ <span class="variable">$UID</span> == 0 ]; <span class="keyword">then</span></span><br><span class="line">                        sudo -u <span class="variable">$&#123;user&#125;</span> jstack <span class="variable">$&#123;pid&#125;</span> &gt; <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        redEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)] Fail to jstack Busy(<span class="variable">$&#123;pcpu&#125;</span>%) thread(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>) stack of java process(<span class="variable">$&#123;pid&#125;</span>) under user(<span class="variable">$&#123;user&#125;</span>).&quot;</span></span><br><span class="line">                        redEcho <span class="string">&quot;User of java process(<span class="variable">$user</span>) is not current user(<span class="variable">$USER</span>), need sudo to run again:&quot;</span></span><br><span class="line">                        yellowEcho <span class="string">&quot;    sudo <span class="variable">$&#123;COMMAND_LINE[@]&#125;</span>&quot;</span></span><br><span class="line">                        <span class="built_in">echo</span></span><br><span class="line">                        <span class="built_in">continue</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            &#125; || &#123;</span><br><span class="line">                redEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)] Fail to jstack Busy(<span class="variable">$&#123;pcpu&#125;</span>%) thread(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>) stack of java process(<span class="variable">$&#123;pid&#125;</span>) under user(<span class="variable">$&#123;user&#125;</span>).&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">rm</span> <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        blueEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)] Busy(<span class="variable">$&#123;pcpu&#125;</span>%) thread(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>) stack of java process(<span class="variable">$&#123;pid&#125;</span>) under user(<span class="variable">$&#123;user&#125;</span>):&quot;</span></span><br><span class="line">        sed <span class="string">&quot;/nid=<span class="variable">$&#123;threadId0x&#125;</span> /,/^$/p&quot;</span> -n <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ps -Leo pid,lwp,user,<span class="built_in">comm</span>,pcpu --no-headers | &#123;</span><br><span class="line">    [ -z <span class="string">&quot;<span class="variable">$&#123;pid&#125;</span>&quot;</span> ] &amp;&amp;</span><br><span class="line">    awk <span class="string">&#x27;$4==&quot;java&quot;&#123;print $0&#125;&#x27;</span> ||</span><br><span class="line">    awk -v <span class="string">&quot;pid=<span class="variable">$&#123;pid&#125;</span>&quot;</span> <span class="string">&#x27;$1==pid,$4==&quot;java&quot;&#123;print $0&#125;&#x27;</span></span><br><span class="line">&#125; | <span class="built_in">sort</span> -k5 -r -n | <span class="built_in">head</span> --lines <span class="string">&quot;<span class="variable">$&#123;count&#125;</span>&quot;</span> | printStackOfThreads</span><br></pre></td></tr></table></figure><h2 id="注释版"><a href="#注释版" class="headerlink" title="注释版"></a>注释版</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># @Function</span></span><br><span class="line"><span class="comment"># 查找占用CPU最多的Java线程，并打印这些线程的堆栈。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @Usage</span></span><br><span class="line"><span class="comment">#   $ ./show-busy-java-threads.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义脚本名和命令行参数数组</span></span><br><span class="line"><span class="built_in">readonly</span> PROG=`<span class="built_in">basename</span> <span class="variable">$0</span>`</span><br><span class="line"><span class="built_in">readonly</span> -a COMMAND_LINE=(<span class="string">&quot;<span class="variable">$0</span>&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用说明函数</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">Usage: $&#123;PROG&#125; [OPTION]...</span></span><br><span class="line"><span class="string">查找占用CPU最多的Java线程，并打印这些线程的堆栈。</span></span><br><span class="line"><span class="string">示例: $&#123;PROG&#125; -c 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">选项:</span></span><br><span class="line"><span class="string">    -p, --pid       从指定的Java进程中查找CPU使用最高的线程，</span></span><br><span class="line"><span class="string">                    默认从所有Java进程中查找。</span></span><br><span class="line"><span class="string">    -c, --count     设置要显示的线程数，默认为5</span></span><br><span class="line"><span class="string">    -h, --help      显示此帮助信息并退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析命令行参数</span></span><br><span class="line"><span class="built_in">readonly</span> ARGS=`getopt -n <span class="string">&quot;<span class="variable">$PROG</span>&quot;</span> -a -o c:p:h -l count:,pid:,<span class="built_in">help</span> -- <span class="string">&quot;<span class="variable">$@</span>&quot;</span>`</span><br><span class="line">[ $? -ne 0 ] &amp;&amp; usage 1</span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">&quot;<span class="variable">$&#123;ARGS&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环处理每个选项</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    -c|--count)</span><br><span class="line">        count=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span> 2</span><br><span class="line">        ;;</span><br><span class="line">    -p|--pid)</span><br><span class="line">        pid=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span> 2</span><br><span class="line">        ;;</span><br><span class="line">    -h|--<span class="built_in">help</span>)</span><br><span class="line">        usage</span><br><span class="line">        ;;</span><br><span class="line">    --)</span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">count=<span class="variable">$&#123;count:-5&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印颜色函数</span></span><br><span class="line"><span class="function"><span class="title">redEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;31m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">yellowEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;33m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">blueEcho</span></span>() &#123;</span><br><span class="line">    [ -c /dev/stdout ] &amp;&amp; &#123;</span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[1;36m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">    &#125; || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查jstack命令是否存在</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> jstack &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    [ -z <span class="string">&quot;<span class="variable">$JAVA_HOME</span>&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;错误: 路径上未找到jstack！&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    ! [ -f <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/jstack&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;错误: 路径上未找到jstack并且<span class="variable">$JAVA_HOME</span>/bin/jstack文件不存在！&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    ! [ -x <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/jstack&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">        redEcho <span class="string">&quot;错误: 路径上未找到jstack并且<span class="variable">$JAVA_HOME</span>/bin/jstack不可执行！&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建唯一标识符</span></span><br><span class="line"><span class="built_in">readonly</span> uuid=`<span class="built_in">date</span> +%s`_<span class="variable">$&#123;RANDOM&#125;</span>_$$</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出时清理临时文件的函数</span></span><br><span class="line"><span class="function"><span class="title">cleanupWhenExit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">rm</span> /tmp/<span class="variable">$&#123;uuid&#125;</span>_* &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;cleanupWhenExit&quot;</span> EXIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印线程堆栈的函数</span></span><br><span class="line"><span class="function"><span class="title">printStackOfThreads</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> line</span><br><span class="line">    <span class="built_in">local</span> count=1</span><br><span class="line">    <span class="keyword">while</span> IFS=<span class="string">&quot; &quot;</span> <span class="built_in">read</span> -a line ; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">local</span> pid=<span class="variable">$&#123;line[0]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> threadId=<span class="variable">$&#123;line[1]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> threadId0x=<span class="string">&quot;0x`printf %x <span class="variable">$&#123;threadId&#125;</span>`&quot;</span></span><br><span class="line">        <span class="built_in">local</span> user=<span class="variable">$&#123;line[2]&#125;</span></span><br><span class="line">        <span class="built_in">local</span> pcpu=<span class="variable">$&#123;line[4]&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">local</span> jstackFile=/tmp/<span class="variable">$&#123;uuid&#125;</span>_<span class="variable">$&#123;pid&#125;</span></span><br><span class="line"></span><br><span class="line">        [ ! -f <span class="string">&quot;<span class="variable">$&#123;jstackFile&#125;</span>&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;user&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;USER&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                    jstack <span class="variable">$&#123;pid&#125;</span> &gt; <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">if</span> [ <span class="variable">$UID</span> == 0 ]; <span class="keyword">then</span></span><br><span class="line">                        sudo -u <span class="variable">$&#123;user&#125;</span> jstack <span class="variable">$&#123;pid&#125;</span> &gt; <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        redEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)]  获取忙碌(<span class="variable">$&#123;pcpu&#125;</span>%)线程(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>)堆栈的java进程(<span class="variable">$&#123;pid&#125;</span>)失败。&quot;</span></span><br><span class="line">                        redEcho <span class="string">&quot;Java进程的用户(<span class="variable">$user</span>)并不是当前用户(<span class="variable">$USER</span>)，需要使用sudo再次运行：&quot;</span></span><br><span class="line">                        yellowEcho <span class="string">&quot;    sudo <span class="variable">$&#123;COMMAND_LINE[@]&#125;</span>&quot;</span></span><br><span class="line">                        <span class="built_in">echo</span></span><br><span class="line">                        <span class="built_in">continue</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            &#125; || &#123;</span><br><span class="line">                redEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)]  获取忙碌(<span class="variable">$&#123;pcpu&#125;</span>%)线程(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>)堆栈的java进程(<span class="variable">$&#123;pid&#125;</span>)失败。&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">rm</span> <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        blueEcho <span class="string">&quot;[<span class="subst">$((count++)</span>)] 忙碌(<span class="variable">$&#123;pcpu&#125;</span>%)线程(<span class="variable">$&#123;threadId&#125;</span>/<span class="variable">$&#123;threadId0x&#125;</span>)的堆栈信息，java进程(<span class="variable">$&#123;pid&#125;</span>)，用户(<span class="variable">$&#123;user&#125;</span>):&quot;</span></span><br><span class="line">        sed <span class="string">&quot;/nid=<span class="variable">$&#123;threadId0x&#125;</span> /,/^$/p&quot;</span> -n <span class="variable">$&#123;jstackFile&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主命令，查找并打印高CPU使用线程的堆栈</span></span><br><span class="line">ps -Leo pid,lwp,user,<span class="built_in">comm</span>,pcpu --no-headers | &#123;</span><br><span class="line">    [ -z <span class="string">&quot;<span class="variable">$&#123;pid&#125;</span>&quot;</span> ] &amp;&amp;</span><br><span class="line">    awk <span class="string">&#x27;$4==&quot;java&quot;&#123;print $0&#125;&#x27;</span> ||</span><br><span class="line">    awk -v <span class="string">&quot;pid=<span class="variable">$&#123;pid&#125;</span>&quot;</span> <span class="string">&#x27;$1==pid,$4==&quot;java&quot;&#123;print $0&#125;&#x27;</span></span><br><span class="line">&#125; | <span class="built_in">sort</span> -k5 -r -n | <span class="built_in">head</span> --lines <span class="string">&quot;<span class="variable">$&#123;count&#125;</span>&quot;</span> | printStackOfThreads</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">查看占用较高的java线程的脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>域控管理常用脚本</title>
    <link href="http://example.com/2024/05/01/%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2024/05/01/%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86/</id>
    <published>2024-05-01T01:25:00.000Z</published>
    <updated>2024-09-11T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="域控管理常用脚本"><a href="#域控管理常用脚本" class="headerlink" title="域控管理常用脚本"></a>域控管理常用脚本</h2><h3 id="1-批量创建用户-永不过期版"><a href="#1-批量创建用户-永不过期版" class="headerlink" title="1.批量创建用户(永不过期版)"></a>1.批量创建用户(永不过期版)</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入 CSV 文件，注意csv文件的编码和多余行，这个版本的账户默认为永不过期</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\user.csv&quot;</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置域控信息</span></span><br><span class="line"><span class="variable">$domainController</span> = <span class="string">&quot;juneyaoair.com&quot;</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=juneyaoair,DC=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历 CSV 文件中的每一行</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 从 CSV 中获取用户信息</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$user</span>.Username</span><br><span class="line">    <span class="variable">$firstname</span> = <span class="variable">$user</span>.FirstName</span><br><span class="line">    <span class="variable">$lastname</span> = <span class="variable">$user</span>.LastName</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$user</span>.Password</span><br><span class="line">    <span class="variable">$pager</span> = <span class="variable">$user</span>.Pager  <span class="comment"># 假设 CSV 有一个名为 Pager 的列</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将密码转换为安全字符串</span></span><br><span class="line">    <span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拼接姓名得到显示名称</span></span><br><span class="line">    <span class="variable">$displayName</span> = <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置邮箱地址</span></span><br><span class="line">    <span class="variable">$emailAddress</span> = <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建用户，添加显示名称和邮箱</span></span><br><span class="line">    <span class="built_in">New-ADUser</span> <span class="literal">-SamAccountName</span> <span class="variable">$username</span> `</span><br><span class="line">               <span class="literal">-UserPrincipalName</span> <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-Name</span> <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-GivenName</span> <span class="variable">$firstname</span> `</span><br><span class="line">               <span class="literal">-Surname</span> <span class="variable">$lastname</span> `</span><br><span class="line">               <span class="literal">-DisplayName</span> <span class="variable">$displayName</span> `</span><br><span class="line">               <span class="literal">-EmailAddress</span> <span class="variable">$emailAddress</span> `</span><br><span class="line">               <span class="literal">-AccountPassword</span> <span class="variable">$securePassword</span> `</span><br><span class="line">               <span class="literal">-CannotChangePassword</span> <span class="variable">$false</span> `</span><br><span class="line">               <span class="literal">-PasswordNeverExpires</span> <span class="variable">$false</span> `</span><br><span class="line">               <span class="literal">-Enabled</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-OtherAttributes</span> <span class="selector-tag">@</span>&#123;<span class="string">&#x27;pager&#x27;</span>=<span class="variable">$pager</span>&#125; `</span><br><span class="line">               <span class="literal">-Path</span> <span class="variable">$ou</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>对应CSV文件结构</li></ul><table><thead><tr><th align="center">Username</th><th align="center">LastName</th><th align="center">FirstName</th><th align="center">Password</th><th align="center">Pager</th></tr></thead></table><h3 id="2-批量创建用户-指定过期时间"><a href="#2-批量创建用户-指定过期时间" class="headerlink" title="2.批量创建用户(指定过期时间)"></a>2.批量创建用户(指定过期时间)</h3><ul><li>注意修改自己的OU等信息</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下面是可以指定账户过期时间的版本</span></span><br><span class="line"><span class="comment"># 导入 CSV 文件</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\user.csv&quot;</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置域控信息</span></span><br><span class="line"><span class="variable">$domainController</span> = <span class="string">&quot;juneyaoair.com&quot;</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=juneyaoair,DC=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历 CSV 文件中的每一行</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 从 CSV 中获取用户信息</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$user</span>.Username</span><br><span class="line">    <span class="variable">$firstname</span> = <span class="variable">$user</span>.FirstName</span><br><span class="line">    <span class="variable">$lastname</span> = <span class="variable">$user</span>.LastName</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$user</span>.Password</span><br><span class="line">    <span class="variable">$pager</span> = <span class="variable">$user</span>.Pager <span class="comment"># 假设 CSV 有一个名为 Pager 的列</span></span><br><span class="line">    <span class="variable">$accountExpirationDate</span> = <span class="variable">$user</span>.ExpirationDate <span class="comment"># 从 CSV 读取账户过期时间</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将密码转换为安全字符串</span></span><br><span class="line">    <span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拼接姓名得到显示名称</span></span><br><span class="line">    <span class="variable">$displayName</span> = <span class="string">&quot;<span class="variable">$lastname</span><span class="variable">$firstname</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置邮箱地址</span></span><br><span class="line">    <span class="variable">$emailAddress</span> = <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$accountExpirationDate</span> = <span class="variable">$user</span>.ExpirationDate</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (![<span class="built_in">string</span>]::IsNullOrEmpty(<span class="variable">$accountExpirationDate</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 转换为 DateTime 对象</span></span><br><span class="line">        <span class="variable">$expirationDate</span> = [<span class="built_in">datetime</span>]::ParseExact(<span class="variable">$accountExpirationDate</span>, <span class="string">&#x27;yyyy-MM-dd&#x27;</span>, <span class="variable">$null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添一天确保在指定时区的次日结束过期</span></span><br><span class="line">        <span class="variable">$expirationDate</span> = <span class="variable">$expirationDate</span>.AddDays(<span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Warning</span> <span class="string">&quot;无法解析用户 <span class="variable">$username</span> 的过期日期: &#x27;<span class="variable">$accountExpirationDate</span>&#x27;&quot;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建用户，添加显示名称、邮箱和账户过期时间</span></span><br><span class="line">    <span class="built_in">New-ADUser</span> <span class="literal">-SamAccountName</span> <span class="variable">$username</span> `</span><br><span class="line">               <span class="literal">-UserPrincipalName</span> <span class="string">&quot;<span class="variable">$username</span>@<span class="variable">$domainController</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-Name</span> <span class="string">&quot;<span class="variable">$displayName</span>&quot;</span> `</span><br><span class="line">               <span class="literal">-GivenName</span> <span class="variable">$firstname</span> `</span><br><span class="line">               <span class="literal">-Surname</span> <span class="variable">$lastname</span> `</span><br><span class="line">               <span class="literal">-DisplayName</span> <span class="variable">$displayName</span> `</span><br><span class="line">               <span class="literal">-EmailAddress</span> <span class="variable">$emailAddress</span> `</span><br><span class="line">               <span class="literal">-AccountPassword</span> <span class="variable">$securePassword</span> `</span><br><span class="line">               <span class="literal">-PasswordNeverExpires</span> <span class="variable">$false</span> `</span><br><span class="line">               <span class="literal">-CannotChangePassword</span> <span class="variable">$false</span> `</span><br><span class="line">               <span class="literal">-AccountExpirationDate</span> <span class="variable">$expirationDate</span> `</span><br><span class="line">               <span class="literal">-Enabled</span> <span class="variable">$true</span> `</span><br><span class="line">               <span class="literal">-OtherAttributes</span> <span class="selector-tag">@</span>&#123;<span class="string">&#x27;pager&#x27;</span>=<span class="variable">$pager</span>&#125; `</span><br><span class="line">               <span class="literal">-Path</span> <span class="variable">$ou</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>对应CSV文件结构</li></ul><table><thead><tr><th align="center">Username</th><th align="center">LastName</th><th align="center">FirstName</th><th align="center">Password</th><th align="center">Pager</th><th align="center">ExpirationDate</th></tr></thead></table><h3 id="3-批量修改账户过期时间"><a href="#3-批量修改账户过期时间" class="headerlink" title="3.批量修改账户过期时间"></a>3.批量修改账户过期时间</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\modify.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 解析日期并加上一天</span></span><br><span class="line">    <span class="variable">$expiredate</span> = [<span class="built_in">DateTime</span>]::ParseExact(<span class="variable">$_</span>.expiredate, <span class="string">&quot;yyyy-MM-dd&quot;</span>, <span class="variable">$null</span>).AddDays(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">Set-ADUser</span> <span class="variable">$_</span>.username <span class="literal">-AccountExpirationDate</span> <span class="variable">$expiredate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>对应CSV文件结构</li></ul><table><thead><tr><th align="center">username</th><th align="center">expiredate</th></tr></thead></table><h3 id="4-指定账户永不过期"><a href="#4-指定账户永不过期" class="headerlink" title="4.指定账户永不过期"></a>4.指定账户永不过期</h3><ul><li>有一个username列</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\modify.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 设置用户账户为永不过期</span></span><br><span class="line">    <span class="built_in">Set-ADUser</span> <span class="variable">$_</span>.username <span class="literal">-AccountExpirationDate</span> <span class="variable">$null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-批量修改密码"><a href="#5-批量修改密码" class="headerlink" title="5.批量修改密码"></a>5.批量修改密码</h3><ul><li>csv要有一个sAMAccountName和password列</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userlist</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\modpass.csv&quot;</span></span><br><span class="line"><span class="variable">$missingUsers</span> = <span class="selector-tag">@</span>()  <span class="comment"># 创建一个空数组来存储缺失的用户</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$userlist</span>) &#123;</span><br><span class="line">    <span class="comment"># 使用 dsquery 检查用户是否存在</span></span><br><span class="line">    <span class="variable">$userDN</span> = dsquery user <span class="literal">-samid</span> <span class="variable">$user</span>.sAMAccountName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$userDN</span>) &#123;</span><br><span class="line">        <span class="comment"># 如果用户存在，修改密码</span></span><br><span class="line">        dsmod user <span class="variable">$userDN</span> <span class="literal">-pwd</span> <span class="variable">$user</span>.password</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment"># 如果用户不存在，将其添加到缺失用户列表</span></span><br><span class="line">        <span class="variable">$missingUsers</span> += <span class="variable">$user</span>.sAMAccountName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出缺失的用户</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$missingUsers</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;以下用户在域控中不存在：&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">    <span class="variable">$missingUsers</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Write-Host</span> <span class="variable">$_</span> &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;所有用户均已成功更新密码。&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-设置密码是否永不过期"><a href="#6-设置密码是否永不过期" class="headerlink" title="6.设置密码是否永不过期"></a>6.设置密码是否永不过期</h3><ul><li>单个用户或者全部</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&#x27;Name -like &quot;*&quot;&#x27;</span> | <span class="built_in">Set-ADUser</span> <span class="literal">-PasswordNeverExpires</span> <span class="variable">$false</span></span><br></pre></td></tr></table></figure><ul><li>指定用户</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Username</span><br><span class="line">user1</span><br><span class="line">user2</span><br><span class="line">user3</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;C:\users.csv&quot;</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="built_in">Get-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span>.Username | <span class="built_in">Set-ADUser</span> <span class="literal">-PasswordNeverExpires</span> <span class="variable">$false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-批量删除用户"><a href="#7-批量删除用户" class="headerlink" title="7.批量删除用户"></a>7.批量删除用户</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\deleteusers.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 删除用户账户</span></span><br><span class="line">    <span class="built_in">Remove-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$_</span>.username <span class="literal">-Confirm</span>:<span class="variable">$False</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-批量修改用户登录名"><a href="#8-批量修改用户登录名" class="headerlink" title="8.批量修改用户登录名"></a>8.批量修改用户登录名</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="string">&quot;C:\username.csv&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="comment"># 获取当前用户的详细信息</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&quot;SamAccountName -eq &#x27;<span class="variable">$</span>(<span class="variable">$_</span>.OldUsername)&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="comment"># 如果用户存在，则同时更新其 sAMAccountName、UserPrincipalName 和 mail</span></span><br><span class="line">        <span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span> <span class="literal">-SamAccountName</span> <span class="variable">$_</span>.NewSamAccountName <span class="literal">-UserPrincipalName</span> <span class="variable">$_</span>.NewUserPrincipalName <span class="literal">-EmailAddress</span> <span class="variable">$_</span>.NewUserPrincipalName</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Updated usernames and email for <span class="variable">$</span>(<span class="variable">$user</span>.Name): sAMAccountName to <span class="variable">$</span>(<span class="variable">$_</span>.NewSamAccountName), UserPrincipalName and EmailAddress to <span class="variable">$</span>(<span class="variable">$_</span>.NewUserPrincipalName)&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$_</span>.OldUsername) not found.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>结构如下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OldUsername,NewSamAccountName,NewUserPrincipalName</span><br><span class="line">zhangdaniu,lierniu,lierniu@domain.com</span><br></pre></td></tr></table></figure><h3 id="9-批量允许用户可修改密码"><a href="#9-批量允许用户可修改密码" class="headerlink" title="9.批量允许用户可修改密码"></a>9.批量允许用户可修改密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置成true,原来状态是不允许的，就可以变成允许，因为域控写的是，“用户不能更改密码”</span></span><br><span class="line">Username,CanChangePassword</span><br><span class="line">pjt_zhanglinyan,<span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定CSV文件路径</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\passwd.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从CSV文件读取用户数据</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 获取AD用户对象</span></span><br><span class="line">        <span class="variable">$adUser</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span>.Username <span class="literal">-Properties</span> CannotChangePassword</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据CSV文件设置&#x27;CannotChangePassword&#x27;属性</span></span><br><span class="line">        <span class="variable">$canChangePassword</span> = <span class="keyword">if</span> (<span class="variable">$user</span>.CanChangePassword <span class="operator">-eq</span> <span class="string">&#x27;true&#x27;</span>) &#123;<span class="variable">$false</span>&#125; <span class="keyword">else</span> &#123;<span class="variable">$true</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新AD用户对象的属性</span></span><br><span class="line">        <span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$user</span>.Username <span class="literal">-CannotChangePassword</span> <span class="variable">$canChangePassword</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;已更新用户 <span class="variable">$</span>(<span class="variable">$user</span>.Username) 的密码修改设置。&quot;</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;无法更新用户 <span class="variable">$</span>(<span class="variable">$user</span>.Username) 的设置。错误: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-批量禁用域账户"><a href="#10-批量禁用域账户" class="headerlink" title="10.批量禁用域账户"></a>10.批量禁用域账户</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Active Directory模块，如果未安装可能需要先安装RSAT工具</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定CSV文件路径</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\aban.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从CSV文件中读取用户名</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每一个用户名，并尝试禁用对应的AD账户</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 获取AD用户对象</span></span><br><span class="line">    <span class="variable">$adUser</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&quot;SamAccountName -eq &#x27;<span class="variable">$</span>(<span class="variable">$user</span>.Username)&#x27;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果用户存在，则禁用账户</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$adUser</span>) &#123;</span><br><span class="line">        <span class="built_in">Disable-ADAccount</span> <span class="literal">-Identity</span> <span class="variable">$adUser</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$user</span>.Username) has been disabled.&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;User <span class="variable">$</span>(<span class="variable">$user</span>.Username) not found.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-批量添加部门属性"><a href="#11-批量添加部门属性" class="headerlink" title="11.批量添加部门属性"></a>11.批量添加部门属性</h3><ul><li>csv结构</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UserName,Department</span><br><span class="line">user1,HR</span><br><span class="line">user2,Finance</span><br><span class="line">user3,IT</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将这里的路径替换为你的CSV文件的绝对路径</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\你的文件夹路径\file.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取CSV文件</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历CSV文件中的每一行，为用户更新Department属性</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 获取用户的Distinguished Name (DN)</span></span><br><span class="line">    <span class="variable">$userDN</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&quot;SamAccountName -eq &#x27;<span class="variable">$</span>(<span class="variable">$user</span>.UserName)&#x27;&quot;</span> | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> DistinguishedName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$userDN</span>) &#123;</span><br><span class="line">        <span class="comment"># 更新用户的Department属性</span></span><br><span class="line">        <span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="variable">$userDN</span> <span class="literal">-Department</span> <span class="variable">$user</span>.Department</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;已更新 <span class="variable">$</span>(<span class="variable">$user</span>.UserName) 的部门为: <span class="variable">$</span>(<span class="variable">$user</span>.Department)&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;未找到用户 <span class="variable">$</span>(<span class="variable">$user</span>.UserName) 。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-查询用户密码到期时间"><a href="#12-查询用户密码到期时间" class="headerlink" title="12.查询用户密码到期时间"></a>12.查询用户密码到期时间</h3><ul><li>单个用户</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保您已经导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取用户的用户名</span></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;YourUsername&quot;</span> <span class="comment"># 将YourUsername替换成实际的用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询并显示密码到期时间</span></span><br><span class="line"><span class="built_in">Get-AdUser</span> <span class="variable">$username</span> <span class="literal">-Properties</span> <span class="string">&quot;DisplayName&quot;</span>, <span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span> |</span><br><span class="line"><span class="built_in">Select-Object</span> <span class="literal">-Property</span> <span class="string">&quot;DisplayName&quot;</span>, <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;PasswordExpiryDate&quot;</span>;Expression=&#123;[<span class="built_in">datetime</span>]::FromFileTime(<span class="variable">$_</span>.<span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>按照指定OU查询用户密码到期时间，只保存到csv，不显示在控制台</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保您已经导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定要查询的组织单位（OU）</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=juneyaoair,DC=com&quot;</span>  <span class="comment"># 将OU路径替换成你实际的组织单位路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询OU下的所有用户，并显示密码到期时间</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * <span class="literal">-SearchBase</span> <span class="variable">$ou</span> <span class="literal">-Properties</span> DisplayName, msDS<span class="literal">-UserPasswordExpiryTimeComputed</span> |</span><br><span class="line">    <span class="built_in">Select-Object</span> DisplayName, <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;PasswordExpiryDate&quot;</span>;Expression=&#123;[<span class="built_in">datetime</span>]::FromFileTime(<span class="variable">$_</span>.<span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果保存到CSV文件</span></span><br><span class="line"><span class="variable">$users</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\output.csv&quot;</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;查询结果已保存到 D:\output.csv 文件中。&quot;</span></span><br></pre></td></tr></table></figure><ul><li>按照指定OU查询用户密码到期时间，只在控制台显示</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保您已经导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定要查询的组织单位（OU）</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=juneyaoair,DC=com&quot;</span>  <span class="comment"># 将OU路径替换成你实际的组织单位路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询OU下的所有用户，并显示密码到期时间、显示名称和登录名</span></span><br><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * <span class="literal">-SearchBase</span> <span class="variable">$ou</span> <span class="literal">-Properties</span> DisplayName, SamAccountName, msDS<span class="literal">-UserPasswordExpiryTimeComputed</span> |</span><br><span class="line"><span class="built_in">Select-Object</span> SamAccountName, DisplayName, <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;PasswordExpiryDate&quot;</span>;Expression=&#123;[<span class="built_in">datetime</span>]::FromFileTime(<span class="variable">$_</span>.<span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>查询整个域控用户的密码到期时间，保存到csv中</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询整个域中的所有用户的密码到期时间以及密码是否永不过期，并对没有DisplayName的使用sAMAccountName填充</span></span><br><span class="line"><span class="built_in">Get-AdUser</span> <span class="literal">-Filter</span> * <span class="literal">-Properties</span> <span class="string">&quot;DisplayName&quot;</span>, <span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span>, <span class="string">&quot;PasswordNeverExpires&quot;</span>, <span class="string">&quot;sAMAccountName&quot;</span>, <span class="string">&quot;Enabled&quot;</span> |</span><br><span class="line"><span class="built_in">Select-Object</span> <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;DisplayName&quot;</span>;Expression=&#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">string</span>]::IsNullOrWhiteSpace(<span class="variable">$_</span>.DisplayName)) &#123;</span><br><span class="line">        <span class="variable">$_</span>.sAMAccountName  <span class="comment"># 如果DisplayName为空，则使用sAMAccountName作为替代</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$_</span>.DisplayName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125;,</span><br><span class="line"><span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;LoginName&quot;</span>;Expression=&#123;</span><br><span class="line">    <span class="variable">$_</span>.sAMAccountName  <span class="comment"># 添加sAMAccountName作为登录名</span></span><br><span class="line">&#125;&#125;,</span><br><span class="line"><span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;PasswordExpiryDate&quot;</span>;Expression=&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_</span>.PasswordNeverExpires) &#123;</span><br><span class="line">        <span class="string">&quot;永不过期&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="built_in">datetime</span>]::FromFileTime(<span class="variable">$_</span>.<span class="string">&quot;msDS-UserPasswordExpiryTimeComputed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125;,</span><br><span class="line"><span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;PasswordNeverExpires&quot;</span>;Expression=&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_</span>.PasswordNeverExpires) &#123;</span><br><span class="line">        <span class="string">&quot;是&quot;</span> </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">&quot;否&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125;,</span><br><span class="line"><span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;AccountStatus&quot;</span>;Expression=&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_</span>.Enabled <span class="operator">-eq</span> <span class="variable">$false</span>) &#123;</span><br><span class="line">        <span class="string">&quot;已禁用&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">&quot;正常&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125; |</span><br><span class="line"><span class="built_in">Sort-Object</span> PasswordExpiryDate | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;C:\path\to\your\output.csv&quot;</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="13-用户批量加组"><a href="#13-用户批量加组" class="headerlink" title="13.用户批量加组"></a>13.用户批量加组</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">User,Groups</span><br><span class="line">user1,<span class="string">&quot;数据仓库管理系统(TCN),收益辅助系统,运行网,精准营销平台,航班动态,合同管理系统管理&quot;</span></span><br><span class="line">user2,<span class="string">&quot;收益辅助系统,精准营销平台&quot;</span></span><br><span class="line">user3,<span class="string">&quot;数据仓库管理系统(TCN),运行网,航班动态&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CSV 文件路径</span></span><br><span class="line"><span class="variable">$csvFilePath</span> = <span class="string">&quot;D:\user_groups.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取CSV文件中的内容</span></span><br><span class="line"><span class="variable">$userGroups</span> = <span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvFilePath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历每个用户和其组</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$userGroups</span>) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$item</span>.User</span><br><span class="line">    <span class="variable">$groups</span> = <span class="variable">$item</span>.Groups <span class="operator">-split</span> <span class="string">&#x27;,&#x27;</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="variable">$_</span>.Trim() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查用户是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> &#123;SamAccountName <span class="operator">-eq</span> <span class="variable">$user</span>&#125;) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$group</span> <span class="keyword">in</span> <span class="variable">$groups</span>) &#123;</span><br><span class="line">            <span class="variable">$cleanGroup</span> = <span class="variable">$group</span>.Trim()  <span class="comment"># 去除组名前后的空格</span></span><br><span class="line">            <span class="comment"># 检查组是否存在</span></span><br><span class="line">            <span class="variable">$existingGroup</span> = <span class="built_in">Get-ADGroup</span> <span class="literal">-Filter</span> &#123;SamAccountName <span class="operator">-eq</span> <span class="variable">$cleanGroup</span>&#125; <span class="literal">-ErrorAction</span> SilentlyContinue</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$existingGroup</span> <span class="operator">-ne</span> <span class="variable">$null</span>) &#123;</span><br><span class="line">                <span class="comment"># 检查用户是否已经是组成员</span></span><br><span class="line">                <span class="variable">$isMember</span> = <span class="built_in">Get-ADGroupMember</span> <span class="literal">-Identity</span> <span class="variable">$cleanGroup</span> <span class="literal">-Recursive</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.SamAccountName <span class="operator">-eq</span> <span class="variable">$user</span> &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$isMember</span> <span class="operator">-eq</span> <span class="variable">$null</span>) &#123;</span><br><span class="line">                    <span class="comment"># 添加用户到组</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="built_in">Add-ADGroupMember</span> <span class="literal">-Identity</span> <span class="variable">$cleanGroup</span> <span class="literal">-Members</span> <span class="variable">$user</span> <span class="literal">-ErrorAction</span> Stop</span><br><span class="line">                        <span class="built_in">Write-Output</span> <span class="string">&quot;用户 <span class="variable">$user</span> 已成功添加到组 <span class="variable">$cleanGroup</span>。&quot;</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                        <span class="built_in">Write-Output</span> <span class="string">&quot;无法将用户 <span class="variable">$user</span> 添加到组 <span class="variable">$cleanGroup</span>。错误: <span class="variable">$_</span>&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">Write-Output</span> <span class="string">&quot;用户 <span class="variable">$user</span> 已经在组 <span class="variable">$cleanGroup</span> 中，跳过添加操作。&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">Write-Output</span> <span class="string">&quot;组 <span class="variable">$cleanGroup</span> 不存在。无法添加用户 <span class="variable">$user</span>。&quot;</span></span><br><span class="line">                <span class="comment"># 如果允许的话，可以添加创建组的逻辑</span></span><br><span class="line">                <span class="comment"># New-ADGroup -Name $cleanGroup -GroupScope Global -GroupCategory Security</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;用户 <span class="variable">$user</span> 不存在。无法添加到任何组。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-查询域控中的DNS记录"><a href="#14-查询域控中的DNS记录" class="headerlink" title="14.查询域控中的DNS记录"></a>14.查询域控中的DNS记录</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DNS记录获取脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互式输入参数</span></span><br><span class="line"><span class="variable">$DomainController</span> = <span class="built_in">Read-Host</span> <span class="string">&quot;请输入域控制器名称 (例如: DC01.yourdomain.com)&quot;</span></span><br><span class="line"><span class="variable">$ZoneName</span> = <span class="built_in">Read-Host</span> <span class="string">&quot;请输入DNS区域名称 (例如: yourdomain.com)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 CSV 文件路径</span></span><br><span class="line"><span class="variable">$timestamp</span> = <span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;yyyyMMdd_HHmmss&quot;</span></span><br><span class="line"><span class="variable">$csvPath</span> = <span class="string">&quot;C:\DNS_Records_<span class="variable">$ZoneName</span>`_<span class="variable">$timestamp</span>.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否已加载DNSServer模块，如果没有则尝试导入</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="built_in">Get-Module</span> <span class="literal">-Name</span> DnsServer <span class="literal">-ListAvailable</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> DnsServer <span class="literal">-ErrorAction</span> Stop</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;无法导入DNSServer模块。请确保你有足够的权限并且已安装RSAT工具。&quot;</span></span><br><span class="line">        <span class="built_in">Read-Host</span> <span class="string">&quot;按Enter键退出&quot;</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个数组来存储记录</span></span><br><span class="line"><span class="variable">$csvRecords</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取DNS记录</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;正在从 <span class="variable">$DomainController</span> 获取 <span class="variable">$ZoneName</span> 的DNS记录...&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">    <span class="variable">$dnsRecords</span> = <span class="built_in">Get-DnsServerResourceRecord</span> <span class="literal">-ZoneName</span> <span class="variable">$ZoneName</span> <span class="literal">-ComputerName</span> <span class="variable">$DomainController</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 输出记录并添加到 CSV 数组</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$record</span> <span class="keyword">in</span> <span class="variable">$dnsRecords</span>) &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;----------------------------------------&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;主机名: <span class="variable">$</span>(<span class="variable">$record</span>.HostName)&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;记录类型: <span class="variable">$</span>(<span class="variable">$record</span>.RecordType)&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;TTL: <span class="variable">$</span>(<span class="variable">$record</span>.TimeToLive)&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$csvRecord</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            HostName = <span class="variable">$record</span>.HostName</span><br><span class="line">            RecordType = <span class="variable">$record</span>.RecordType</span><br><span class="line">            TTL = <span class="variable">$record</span>.TimeToLive</span><br><span class="line">            <span class="keyword">Data</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 根据记录类型输出不同的详细信息</span></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$record</span>.RecordType) &#123;</span><br><span class="line">            <span class="string">&quot;A&quot;</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="variable">$record</span>.RecordData.IPv4Address.ToString()</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;IP地址: <span class="variable">$data</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;CNAME&quot;</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="variable">$record</span>.RecordData.HostNameAlias</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;别名: <span class="variable">$data</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;MX&quot;</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="string">&quot;邮件服务器: <span class="variable">$</span>(<span class="variable">$record</span>.RecordData.MailExchange), 优先级: <span class="variable">$</span>(<span class="variable">$record</span>.RecordData.Preference)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="variable">$data</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;NS&quot;</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="variable">$record</span>.RecordData.NameServer</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;名称服务器: <span class="variable">$data</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;SOA&quot;</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="string">&quot;主要名称服务器: <span class="variable">$</span>(<span class="variable">$record</span>.RecordData.PrimaryServer), 管理员邮箱: <span class="variable">$</span>(<span class="variable">$record</span>.RecordData.ResponsiblePerson)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="variable">$data</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">            default &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="variable">$record</span>.RecordData.ToString()</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;数据: <span class="variable">$data</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                <span class="variable">$csvRecord</span>.Data = <span class="variable">$data</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$csvRecords</span> += <span class="variable">$csvRecord</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将记录导出到 CSV 文件</span></span><br><span class="line">    <span class="variable">$csvRecords</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`nDNS记录已保存到文件: <span class="variable">$csvPath</span>&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Error</span> <span class="string">&quot;获取DNS记录时发生错误: <span class="variable">$_</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;`n脚本执行完毕。&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line"><span class="built_in">Read-Host</span> <span class="string">&quot;按Enter键退出&quot;</span></span><br></pre></td></tr></table></figure><h3 id="15-查询密码永不过期的用户"><a href="#15-查询密码永不过期的用户" class="headerlink" title="15.查询密码永不过期的用户"></a>15.查询密码永不过期的用户</h3><ul><li>查询某个组</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pso</span> = <span class="built_in">Get-ADGroup</span> <span class="literal">-Identity</span> <span class="string">&quot;总裁室PSO&quot;</span></span><br><span class="line"><span class="variable">$psoDistinguishedName</span> = <span class="variable">$pso</span>.DistinguishedName</span><br><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> &#123;PasswordNeverExpires <span class="operator">-eq</span> <span class="variable">$true</span> <span class="operator">-and</span> MemberOf <span class="operator">-eq</span> <span class="variable">$psoDistinguishedName</span>&#125; <span class="literal">-Properties</span> PasswordNeverExpires | <span class="built_in">Select-Object</span>  UserPrincipalName | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\总裁室PSO.csv&quot;</span> <span class="literal">-NoTypeInformation</span></span><br></pre></td></tr></table></figure><ul><li>查询所有指定的组</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取以特定字符串结尾的 PSO 组</span></span><br><span class="line"><span class="variable">$psoGroups</span> = <span class="built_in">Get-ADGroup</span> <span class="literal">-Filter</span> &#123;Name <span class="operator">-like</span> <span class="string">&quot;*PSO&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$psoGroups</span>.Count <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;未找到以 &#x27;*PSO&#x27; 结尾的组。&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$psoGroup</span> <span class="keyword">in</span> <span class="variable">$psoGroups</span>) &#123;</span><br><span class="line">        <span class="variable">$psoDistinguishedName</span> = <span class="variable">$psoGroup</span>.DistinguishedName</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;正在查询组 <span class="variable">$</span>(<span class="variable">$psoGroup</span>.Name) 中的用户...&quot;</span></span><br><span class="line">        <span class="variable">$users</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> &#123;PasswordNeverExpires <span class="operator">-eq</span> <span class="variable">$true</span> <span class="operator">-and</span> MemberOf <span class="operator">-eq</span> <span class="variable">$psoDistinguishedName</span>&#125; <span class="literal">-Properties</span> PasswordNeverExpires</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$users</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;找到以下用户：&quot;</span></span><br><span class="line">            <span class="variable">$users</span> | <span class="built_in">Select-Object</span> Name, UserPrincipalName | <span class="built_in">Format-Table</span> <span class="literal">-AutoSize</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 导出到 CSV 文件</span></span><br><span class="line">            <span class="variable">$users</span> | <span class="built_in">Select-Object</span> Name, UserPrincipalName | <span class="built_in">Export-Csv</span> <span class="literal">-Append</span> <span class="literal">-Path</span> <span class="string">&quot;D:\users.csv&quot;</span> <span class="literal">-NoTypeInformation</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;未找到符合条件的用户。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>获取域控中所有密码永不过期的</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> &#123;PasswordNeverExpires <span class="operator">-eq</span> <span class="variable">$true</span>&#125; <span class="literal">-Properties</span> sAMAccountName | <span class="built_in">Select-Object</span> sAMAccountName | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\PasswordNeverExpiresUsers.csv&quot;</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br></pre></td></tr></table></figure><h3 id="16-批量取消密码永不过期和下次登陆必须修改密码"><a href="#16-批量取消密码永不过期和下次登陆必须修改密码" class="headerlink" title="16.批量取消密码永不过期和下次登陆必须修改密码"></a>16.批量取消密码永不过期和下次登陆必须修改密码</h3><ul><li>稳妥的方法</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 CSV 文件中读取用户名单</span></span><br><span class="line"><span class="variable">$users</span> = Import-Csv -Path <span class="string">&quot;D:\PasswordNeverExpiresUsers.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个用户并取消密码永不过期设置</span></span><br><span class="line">foreach (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 使用 sAMAccountName 作为用户标识</span></span><br><span class="line">    <span class="variable">$adUser</span> = Get-ADUser -Identity <span class="variable">$user</span>.sAMAccountName -Properties PasswordNeverExpires, PasswordLastSet</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$adUser</span>.PasswordNeverExpires -eq <span class="variable">$false</span>) &#123;</span><br><span class="line">        <span class="comment"># 如果密码永不过期属性已经是 false，跳过该用户</span></span><br><span class="line">        Write-Host <span class="string">&quot;用户 <span class="subst">$($user.sAMAccountName)</span> 的密码永不过期设置已是 false，跳过。&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断用户是否需要在下次登录时更改密码</span></span><br><span class="line">    <span class="variable">$changePasswordAtLogon</span> = <span class="variable">$adUser</span>.PasswordLastSet -eq <span class="variable">$null</span></span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        <span class="comment"># 设置密码永不过期为 false，同时保持下次登录时必须更改密码的原有值</span></span><br><span class="line">        Set-ADUser -Identity <span class="variable">$user</span>.sAMAccountName -PasswordNeverExpires <span class="variable">$false</span> -ChangePasswordAtLogon <span class="variable">$changePasswordAtLogon</span></span><br><span class="line">        <span class="comment"># 输出成功信息</span></span><br><span class="line">        Write-Host <span class="string">&quot;成功取消用户 <span class="subst">$($user.sAMAccountName)</span> 的密码永不过期设置。&quot;</span></span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">        <span class="comment"># 输出错误信息</span></span><br><span class="line">        Write-Host <span class="string">&quot;无法取消用户 <span class="subst">$($user.sAMAccountName)</span> 的密码永不过期设置：<span class="subst">$($_.Exception.Message)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>简单粗暴的全局修改，不推荐(有些公共账户或者特殊账户)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取所有密码永不过期的用户</span></span><br><span class="line"><span class="variable">$users</span> = Get-ADUser -Filter &#123;PasswordNeverExpires -eq <span class="variable">$true</span>&#125; -Properties sAMAccountName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个用户并取消密码永不过期设置</span></span><br><span class="line">foreach (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    Set-ADUser -Identity <span class="variable">$user</span> -PasswordNeverExpires <span class="variable">$false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="取消下次登陆必须修改密码"><a href="#取消下次登陆必须修改密码" class="headerlink" title="取消下次登陆必须修改密码"></a>取消下次登陆必须修改密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 CSV 文件中读取用户名单</span></span><br><span class="line"><span class="variable">$users</span> = Import-Csv -Path <span class="string">&quot;D:\UsersToChangePassword.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个用户并设置下次登录时必须更改密码为 false</span></span><br><span class="line">foreach (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="comment"># 使用 sAMAccountName 作为用户标识</span></span><br><span class="line">    try &#123;</span><br><span class="line">        Set-ADUser -Identity <span class="variable">$user</span>.sAMAccountName -ChangePasswordAtLogon <span class="variable">$false</span></span><br><span class="line">        <span class="comment"># 输出成功信息</span></span><br><span class="line">        Write-Host <span class="string">&quot;成功将用户 <span class="subst">$($user.sAMAccountName)</span> 的下次登录时必须更改密码设置为 false。&quot;</span></span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">        <span class="comment"># 输出错误信息</span></span><br><span class="line">        Write-Host <span class="string">&quot;无法将用户 <span class="subst">$($user.sAMAccountName)</span> 的下次登录时必须更改密码设置为 false：<span class="subst">$($_.Exception.Message)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-查询用户账户到期时间"><a href="#17-查询用户账户到期时间" class="headerlink" title="17.查询用户账户到期时间"></a>17.查询用户账户到期时间</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询账户到期时间，并保存到csv中</span></span><br><span class="line"><span class="comment"># 确保您已经导入Active Directory模块</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定要查询的组织单位（OU）</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=juneyaoair,DC=com&quot;</span>  <span class="comment"># 将OU路径替换成你实际的组织单位路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询OU下的所有用户，并显示账户过期时间、显示名称和登录名，然后保存到CSV文件</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * <span class="literal">-SearchBase</span> <span class="variable">$ou</span> <span class="literal">-Properties</span> DisplayName, SamAccountName, AccountExpirationDate |</span><br><span class="line">    <span class="built_in">Select-Object</span> SamAccountName, DisplayName, <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;AccountExpirationDate&quot;</span>;Expression=&#123;<span class="variable">$_</span>.AccountExpirationDate&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果保存到CSV文件，以UTF-8编码（无BOM）</span></span><br><span class="line"><span class="variable">$users</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\output.csv&quot;</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;查询结果已保存到 D:\output.csv 文件中，使用UTF-8编码。&quot;</span></span><br></pre></td></tr></table></figure><h3 id="18-检查路径文件是否存在"><a href="#18-检查路径文件是否存在" class="headerlink" title="18.检查路径文件是否存在"></a>18.检查路径文件是否存在</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检查路径文件是否存在</span></span><br><span class="line"><span class="comment"># 定义文件路径</span></span><br><span class="line"><span class="variable">$filePath</span> = <span class="string">&quot;D:\matched_paths.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$filePath</span>)) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Error: File <span class="variable">$filePath</span> not found.&quot;</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件内容到数组</span></span><br><span class="line"><span class="variable">$paths</span> = <span class="built_in">Get-Content</span> <span class="literal">-Path</span> <span class="variable">$filePath</span> <span class="literal">-ErrorAction</span> Stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环检查每个路径是否存在</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$path</span> <span class="keyword">in</span> <span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$path</span>) &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Path exists: <span class="variable">$path</span>&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Path does not exist: <span class="variable">$path</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-删除路径文件"><a href="#19-删除路径文件" class="headerlink" title="19.删除路径文件"></a>19.删除路径文件</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除路径文件</span></span><br><span class="line"><span class="comment"># 定义文本文件路径</span></span><br><span class="line"><span class="variable">$filePath</span> = <span class="string">&quot;D:\matched_paths.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$filePath</span>)) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Error: File <span class="variable">$filePath</span> not found.&quot;</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件内容到数组</span></span><br><span class="line"><span class="variable">$paths</span> = <span class="built_in">Get-Content</span> <span class="literal">-Path</span> <span class="variable">$filePath</span> <span class="literal">-ErrorAction</span> Stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量删除所有路径指向的文件或目录</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">Remove-Item</span> <span class="literal">-LiteralPath</span> <span class="variable">$paths</span> <span class="literal">-Force</span> <span class="literal">-ErrorAction</span> Stop</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;All items deleted successfully.&quot;</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Error: <span class="variable">$_</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20-查询用户总数"><a href="#20-查询用户总数" class="headerlink" title="20.查询用户总数"></a>20.查询用户总数</h3><ul><li>powershell版</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * | <span class="built_in">Measure-Object</span> | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> Count</span><br></pre></td></tr></table></figure><ul><li>cmd版，要有域控管理器</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f %d <span class="keyword">in</span> (&#x27;dsquery user &quot;dc=juneyaoair,dc=com&quot; -limit <span class="number">0</span> ^| <span class="built_in">find</span> /v /c &quot;&quot;&#x27;) <span class="keyword">do</span> @<span class="built_in">echo</span> 用户总数: %d</span><br></pre></td></tr></table></figure><h3 id="21-查询组名和数量"><a href="#21-查询组名和数量" class="headerlink" title="21.查询组名和数量"></a>21.查询组名和数量</h3><ul><li>查询特定的组</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADGroup</span> <span class="literal">-Filter</span> &#123;Name <span class="operator">-like</span> <span class="string">&quot;VPN-*&quot;</span>&#125; <span class="comment">#以VPN-开头的组</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-ADGroup</span> <span class="literal">-Filter</span> &#123;Name <span class="operator">-like</span> <span class="string">&quot;VPN-*&quot;</span>&#125; | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> SamAccountName</span><br></pre></td></tr></table></figure><ul><li>所有组的名称和数量</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取所有的组对象</span></span><br><span class="line"><span class="variable">$groups</span> = <span class="built_in">Get-ADGroup</span> <span class="literal">-Filter</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出组的数量</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;总共有 <span class="variable">$</span>(<span class="variable">$groups</span>.Count) 个组。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将组的名字和SamAccountName输出到CSV文件中</span></span><br><span class="line"><span class="variable">$groups</span> | <span class="built_in">Select-Object</span> Name, SamAccountName | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;D:\AllGroups.csv&quot;</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br></pre></td></tr></table></figure><h3 id="22-导出用户到csv"><a href="#22-导出用户到csv" class="headerlink" title="22.导出用户到csv"></a>22.导出用户到csv</h3><ul><li>导出所有用户</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置导出文件的路径</span></span><br><span class="line"><span class="variable">$outputFile</span> = <span class="string">&quot;C:\AllUserLogins.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有用户</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * <span class="literal">-Property</span> SamAccountName, DisplayName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个数组来存储结果</span></span><br><span class="line"><span class="variable">$results</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个用户并将他们的登录名和显示名添加到结果数组中</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="variable">$results</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">        SamAccountName = <span class="variable">$user</span>.SamAccountName</span><br><span class="line">        DisplayName    = <span class="variable">$user</span>.DisplayName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果导出到CSV文件</span></span><br><span class="line"><span class="variable">$results</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="variable">$outputFile</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;导出完成：<span class="variable">$outputFile</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>指定OU导出</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置导出文件的路径</span></span><br><span class="line"><span class="variable">$outputFile</span> = <span class="string">&quot;C:\AllUserLogins.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定要导出用户的OU的DN</span></span><br><span class="line"><span class="variable">$ou</span> = <span class="string">&quot;OU=外部公司,DC=testad,DC=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取OU中的所有用户</span></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> * <span class="literal">-SearchBase</span> <span class="variable">$ou</span> <span class="literal">-Property</span> SamAccountName, DisplayName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个数组来存储结果</span></span><br><span class="line"><span class="variable">$results</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个用户并将他们的登录名和显示名添加到结果数组中</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span> <span class="keyword">in</span> <span class="variable">$users</span>) &#123;</span><br><span class="line">    <span class="variable">$results</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">        SamAccountName = <span class="variable">$user</span>.SamAccountName</span><br><span class="line">        DisplayName    = <span class="variable">$user</span>.DisplayName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果导出到CSV文件</span></span><br><span class="line"><span class="variable">$results</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="variable">$outputFile</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;导出完成：<span class="variable">$outputFile</span>&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">域控的一些常见场景的管理脚本</summary>
    
    
    
    <category term="WinServer" scheme="http://example.com/categories/WinServer/"/>
    
    <category term="域控" scheme="http://example.com/categories/WinServer/%E5%9F%9F%E6%8E%A7/"/>
    
    
    <category term="域控" scheme="http://example.com/tags/%E5%9F%9F%E6%8E%A7/"/>
    
    <category term="powershell" scheme="http://example.com/tags/powershell/"/>
    
    <category term="AD" scheme="http://example.com/tags/AD/"/>
    
  </entry>
  
  <entry>
    <title>Linux针对大量log日志快速定位错误</title>
    <link href="http://example.com/2024/04/29/linux%E5%A4%A7%E9%87%8F%E6%97%A5%E5%BF%97%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%94%99%E8%AF%AF/"/>
    <id>http://example.com/2024/04/29/linux%E5%A4%A7%E9%87%8F%E6%97%A5%E5%BF%97%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%94%99%E8%AF%AF/</id>
    <published>2024-04-29T01:25:00.000Z</published>
    <updated>2024-04-29T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux针对大量log日志快速定位错误"><a href="#Linux针对大量log日志快速定位错误" class="headerlink" title="Linux针对大量log日志快速定位错误"></a>Linux针对大量log日志快速定位错误</h1><h2 id="针对大量log日志快速定位错误"><a href="#针对大量log日志快速定位错误" class="headerlink" title="针对大量log日志快速定位错误"></a>针对大量log日志快速定位错误</h2><p>动态查看日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f catalina.ou</span><br></pre></td></tr></table></figure><p>从头打开日志文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> catalina.ou</span><br></pre></td></tr></table></figure><p>可以使用 <code>&gt;nanjiangtest.txt</code> 输出某个新日志去查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># cat -n catalina.out |grep 717892466 &gt;nanjiangtest.txt</span></span><br></pre></td></tr></table></figure><h2 id="tail-head简单命令使用："><a href="#tail-head简单命令使用：" class="headerlink" title="tail&#x2F;head简单命令使用："></a>tail&#x2F;head简单命令使用：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># tail -n number catalina.out 查询日志尾部最后number行的日志</span></span><br><span class="line">        [root@yesky logs]<span class="comment"># tail -n +number catalina.out 查询number行之后的所有日志</span></span><br><span class="line">        [root@yesky logs]<span class="comment"># head -n number catalina.out 查询日志文件中的前number行日志</span></span><br><span class="line">        [root@yesky logs]<span class="comment"># head -n -number catalina.out 查询日志文件除了最后number行的其他所有日志</span></span><br></pre></td></tr></table></figure><h4 id="第一种方式（根据关键字查找出行号）："><a href="#第一种方式（根据关键字查找出行号）：" class="headerlink" title="第一种方式（根据关键字查找出行号）："></a>第一种方式（根据关键字查找出行号）：</h4><p>用grep拿到的日志很少，我们需要查看附近的日志。我是这样做的，首先: <code>cat -n test.log | grep “关键词”</code> 得到关键日志的行号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># cat -n catalina.out |grep 717892466</span></span><br><span class="line">13230539        [11:07 17:47:11] INFO nanjiang:Edit Old Article：717892466-2020-11-07 17:47:11</span><br><span class="line">13230593        [11:07 17:47:15] INFO nanjiangSave Article ID IS：717892466</span><br><span class="line">13230595        717892466 article.getDisplayTime()1 = 2020-11-07 16:25:11</span><br><span class="line">13230596        717892466 article.getDisplayTime()2 = 2020-11-07 16:25:11</span><br><span class="line">13230601        [11:07 17:47:15] INFO 南江 10.10.10.39  edit    article 717892466       编辑文章</span><br></pre></td></tr></table></figure><p><strong>「cat -n catalina.out|tail -n +13230539|head -n 10」</strong></p><ul><li><code>tail -n +13230539</code>表示查询13230539行之后的日志</li><li><code>head -n 10</code>则表示在前面的查询结果里再查前10条记录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># cat -n catalina.out |tail -n +13230539|head -n 10</span></span><br><span class="line">13230539        [11:07 17:47:11] INFO nanjiang:Edit Old Article：717892466-2020-11-07 17:47:11</span><br><span class="line">13230540        [11:07 17:47:11] INFO Takes:2 ms class com.tmg.cms.manager.dao.article.impl.ArticleContentDaoImpl       getListByArticleId      [NzE3ODkyNDY2]       [int]</span><br><span class="line">13230541        [11:07 17:47:11] INFO Takes:1 ms class com.tmg.cms.manager.dao.resourceImage.impl.ResourceImageDaoImpl  load    </span><br><span class="line">13230542        [11:07 17:47:11] INFO Takes:0 ms class com.tmg.cms.manager.dao.resourceImage.impl.ResourceImageDaoImpl  load    </span><br><span class="line">13230543        [11:07 17:47:11] INFO Takes:1 ms class com.tmg.cms.manager.dao.resourceImage.impl.ResourceImageDaoImpl  load    </span><br><span class="line">13230544        [11:07 17:47:11] INFO article.getImage3：/uploadImages/2020/312/02/3NXCRK4U3589_2.jpg</span><br><span class="line">13230545        [11:07 17:47:11] INFO Takes:0 ms class com.tmg.cms.manager.dao.resourceImage.impl.ResourceImageDaoImpl  load   </span><br><span class="line">13230546        [11:07 17:47:11] INFO Takes:2 ms class com.tmg.cms.manager.dao.privilege.impl.UserDaoImpl       getUserByid     </span><br><span class="line">13230547        [11:07 17:47:11] INFO Takes:57 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl     selectSitemapWithoutAudit       [MQ==]  [int]</span><br><span class="line">13230548        [11:07 17:47:11] INFO Takes:5 ms class com.tmg.cms.manager.dao.forbidword.impl.ForbidwordDaoImpl        getForbidwordBysiteid   [MjI=]  [int]</span><br></pre></td></tr></table></figure><h4 id="第二种方式：查看指定时间段内的日志"><a href="#第二种方式：查看指定时间段内的日志" class="headerlink" title="第二种方式：查看指定时间段内的日志"></a>第二种方式：查看指定时间段内的日志</h4><p>首先要进行范围时间段内日志查询先查看是否在当前日之内存在，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;11:07 18:29:20&#x27;</span> catalina.outgrep <span class="string">&#x27;11:07 18:31:11&#x27;</span> catalina.out</span><br></pre></td></tr></table></figure><p>时间范围内的查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/11:07 18:29:20/,/11:07 18:31:11/p&#x27;</span> catalina.out sed -n <span class="string">&#x27;/11:07 18:29:/,/11:07 18:31:/p&#x27;</span> catalina.out</span><br></pre></td></tr></table></figure><h4 id="第三种方式：查看日志中特定字符的匹配数目"><a href="#第三种方式：查看日志中特定字符的匹配数目" class="headerlink" title="第三种方式：查看日志中特定字符的匹配数目"></a>第三种方式：查看日志中特定字符的匹配数目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># grep &#x27;1175109632&#x27; catalina.out | wc -l154</span></span><br></pre></td></tr></table></figure><h4 id="第四种方式：查询最后number行，并查找关键字“结果”"><a href="#第四种方式：查询最后number行，并查找关键字“结果”" class="headerlink" title="第四种方式：查询最后number行，并查找关键字“结果”"></a>第四种方式：查询最后number行，并查找关键字“结果”</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># tail -n 20 catalina.out | grep &#x27;INFO Takes:1&#x27;</span></span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.config.impl.ConfigInfoDaoImpl load </span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTkwOTQ5] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI0] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI3] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzA5NA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [Mzc4Mg==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [OTM1MA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MTE5MDMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTQ2MzQw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTg2NzYy] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzYyMjA=] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.configModule.impl.ConfigModuleDaoImpl getPersonMenuList</span><br></pre></td></tr></table></figure><h4 id="第五种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红"><a href="#第五种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红" class="headerlink" title="第五种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红"></a>第五种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># tail -n 20 catalina.out | grep &#x27;INFO Takes:1&#x27; --color</span></span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.config.impl.ConfigInfoDaoImpl load </span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTkwOTQ5] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI0] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI3] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzA5NA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [Mzc4Mg==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [OTM1MA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MTE5MDMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTQ2MzQw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTg2NzYy] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzYyMjA=] [int]</span><br></pre></td></tr></table></figure><h4 id="第六种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红，上下扩展两行"><a href="#第六种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红，上下扩展两行" class="headerlink" title="第六种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红，上下扩展两行"></a>第六种方式：查询最后number行，并查找关键字“结果”并且对结果进行标红，上下扩展两行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># tail -n 20 catalina.out | grep &#x27;INFO Takes:1&#x27; --color -a2</span></span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.article.impl.ArticleContentDaoImpl getArticlePageNum [NzE4MTM2ODky] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.config.impl.ConfigInfoDaoImpl load [com.tmg.cms.manager.model.config.ConfigInfo]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTkwOTQ5] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI0] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI1] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzI3] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzAzNg==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzA5NA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [Mzc4Mg==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [OTM1MA==] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MTE0MjQ4] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MTE4MDc4] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MTE5MDMw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTQ2MzQw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTQ3MTIw] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:0 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTY4OTYx] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [NTg2NzYy] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.sitemap.impl.SitemapDaoImpl getSitemapTop [MzYyMjA=] [int]</span><br><span class="line">[11:11 22:02:51] INFO Takes:1 ms class com.tmg.cms.manager.dao.configModule.impl.ConfigModuleDaoImpl getPersonMenuList [com.tmg.cms.manager.model.config.ConfigPersonMenu]</span><br></pre></td></tr></table></figure><h4 id="第七种方式：分页查看，使用空格翻页-使用more-less"><a href="#第七种方式：分页查看，使用空格翻页-使用more-less" class="headerlink" title="第七种方式：分页查看，使用空格翻页(使用more&#x2F;less)"></a>第七种方式：分页查看，使用空格翻页(使用more&#x2F;less)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yesky logs]<span class="comment"># tail -n 2000 catalina.out | grep &#x27;INFO Takes:1&#x27; --color -a2 | more</span></span><br><span class="line">        [root@yesky logs]<span class="comment"># tail -n 2000 catalina.out | grep &#x27;INFO Takes:1&#x27; --color -a2 | less</span></span><br></pre></td></tr></table></figure><h2 id="附加"><a href="#附加" class="headerlink" title="附加"></a><strong>附加</strong></h2><h5 id="1-全屏导航"><a href="#1-全屏导航" class="headerlink" title="1.全屏导航"></a>1.全屏导航</h5><ul><li><code>ctrl + F</code> - 向前移动一屏</li><li><code>ctrl + B</code> - 向后移动一屏</li><li><code>ctrl + D</code> - 向前移动半屏</li><li><code>ctrl + U</code> - 向后移动半屏</li></ul><h5 id="2-单行导航"><a href="#2-单行导航" class="headerlink" title="2.单行导航"></a>2.单行导航</h5><ul><li><code>j</code> - 向前移动一行</li><li><code>k</code> - 向后移动一行</li></ul><h5 id="3-其它导航"><a href="#3-其它导航" class="headerlink" title="3.其它导航"></a>3.其它导航</h5><ul><li><code>G</code> - 移动到最后一行</li><li><code>g</code> - 移动到第一行</li><li><code>q / ZZ</code> - 退出 less 命令</li></ul>]]></content>
    
    
    <summary type="html">Linux针对大量log日志快速定位错误</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>部分常见Linux命令总结</title>
    <link href="http://example.com/2024/04/28/%E9%83%A8%E5%88%86%E5%B8%B8%E8%A7%81linux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <id>http://example.com/2024/04/28/%E9%83%A8%E5%88%86%E5%B8%B8%E8%A7%81linux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</id>
    <published>2024-04-28T01:25:00.000Z</published>
    <updated>2024-04-28T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="部分常见Linux命令总结"><a href="#部分常见Linux命令总结" class="headerlink" title="部分常见Linux命令总结"></a>部分常见Linux命令总结</h1><h2 id="1-基本命令"><a href="#1-基本命令" class="headerlink" title="1. 基本命令"></a>1. 基本命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -m  <span class="comment">#显示机器的处理器架构</span></span><br><span class="line"><span class="built_in">uname</span> -r <span class="comment">#显示正在使用的内核版本</span></span><br><span class="line">dmidecode -q  <span class="comment">#显示硬件系统部件</span></span><br><span class="line">(SMBIOS / DMI) hdparm -i /dev/hda  <span class="comment">#罗列一个磁盘的架构特性</span></span><br><span class="line">hdparm -tT /dev/sda <span class="comment">#在磁盘上执行测试性读取操作系统信息</span></span><br><span class="line"><span class="built_in">arch</span> <span class="comment">#显示机器的处理器架构</span></span><br><span class="line"><span class="built_in">uname</span> -m <span class="comment">#显示机器的处理器架构</span></span><br><span class="line"><span class="built_in">uname</span> -r <span class="comment">#显示正在使用的内核版本</span></span><br><span class="line">dmidecode -q <span class="comment">#显示硬件系统部件 - (SMBIOS / DMI)</span></span><br><span class="line">hdparm -i /dev/hda <span class="comment">#罗列一个磁盘的架构特性</span></span><br><span class="line">hdparm -tT /dev/sda <span class="comment">#在磁盘上执行测试性读取操作</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo <span class="comment">#显示CPU info的信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/interrupts <span class="comment">#显示中断</span></span><br><span class="line"><span class="built_in">cat</span> /proc/meminfo <span class="comment">#校验内存使用</span></span><br><span class="line"><span class="built_in">cat</span> /proc/swaps <span class="comment">#显示哪些swap被使用</span></span><br><span class="line"><span class="built_in">cat</span> /proc/version <span class="comment">#显示内核的版本</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/dev <span class="comment">#显示网络适配器及统计</span></span><br><span class="line"><span class="built_in">cat</span> /proc/mounts <span class="comment">#显示已加载的文件系统</span></span><br><span class="line">lspci -tv <span class="comment">#罗列 PCI 设备</span></span><br><span class="line">lsusb -tv <span class="comment">#显示 USB 设备</span></span><br><span class="line"><span class="built_in">date</span>  <span class="comment">#显示系统日期</span></span><br><span class="line">cal 2007 <span class="comment">#显示2007年的日历表</span></span><br><span class="line"><span class="built_in">date</span> 041217002007.00 <span class="comment">#设置日期和时间 - 月日时分年.秒</span></span><br><span class="line">clock -w <span class="comment">#将时间修改保存到 BIOS</span></span><br></pre></td></tr></table></figure><h2 id="2-关机"><a href="#2-关机" class="headerlink" title="2. 关机"></a>2. 关机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shutdown -h now <span class="comment">#关闭系统(1)</span></span><br><span class="line">init 0 <span class="comment">#关闭系统(2)</span></span><br><span class="line">telinit 0 <span class="comment">#关闭系统(3)</span></span><br><span class="line">shutdown -h hours:minutes &amp; <span class="comment">#按预定时间关闭系统</span></span><br><span class="line">shutdown -c <span class="comment">#取消按预定时间关闭系统</span></span><br><span class="line">shutdown -r now <span class="comment">#重启(1)</span></span><br><span class="line">reboot <span class="comment">#重启(2)</span></span><br><span class="line"><span class="built_in">logout</span> <span class="comment">#注销</span></span><br></pre></td></tr></table></figure><h2 id="3-文件和目录"><a href="#3-文件和目录" class="headerlink" title="3. 文件和目录"></a>3. 文件和目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home <span class="comment">#进入 &#x27;/ home&#x27; 目录&#x27;</span></span><br><span class="line"><span class="built_in">cd</span> .. <span class="comment">#返回上一级目录</span></span><br><span class="line"><span class="built_in">cd</span> ../..   <span class="comment">#返回上两级目录</span></span><br><span class="line"><span class="built_in">cd</span> <span class="comment">#进入个人的主目录</span></span><br><span class="line"><span class="built_in">cd</span> ~user1 <span class="comment">#进入个人的主目录</span></span><br><span class="line"><span class="built_in">cd</span> - <span class="comment">#返回上次所在的目录</span></span><br><span class="line"><span class="built_in">pwd</span> <span class="comment">#显示工作路径</span></span><br><span class="line"><span class="built_in">ls</span> <span class="comment">#查看目录中的文件</span></span><br><span class="line"><span class="built_in">ls</span> -F <span class="comment">#查看目录中的文件</span></span><br><span class="line"><span class="built_in">ls</span> -l <span class="comment">#显示文件和目录的详细资料</span></span><br><span class="line"><span class="built_in">ls</span> -a <span class="comment">#显示隐藏文件</span></span><br><span class="line"><span class="built_in">ls</span> *[0-9]* <span class="comment">#显示包含数字的文件名和目录名</span></span><br><span class="line">tree <span class="comment">#显示文件和目录由根目录开始的树形结构(1)</span></span><br><span class="line">lstree <span class="comment">#显示文件和目录由根目录开始的树形结构(2)</span></span><br><span class="line"><span class="built_in">mkdir</span> dir1 <span class="comment">#创建一个叫做 &#x27;dir1&#x27; 的目录&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span> dir1 dir2 <span class="comment">#同时创建两个目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp/dir1/dir2 <span class="comment">#创建一个目录树</span></span><br><span class="line"><span class="built_in">rm</span> -f file1 <span class="comment">#删除一个叫做 &#x27;file1&#x27; 的文件&#x27;</span></span><br><span class="line"><span class="built_in">rmdir</span> dir1 <span class="comment">#删除一个叫做 &#x27;dir1&#x27; 的目录&#x27;</span></span><br><span class="line"><span class="built_in">rm</span> -rf dir1 <span class="comment">#删除一个叫做 &#x27;dir1&#x27; 的目录并同时删除其内容</span></span><br><span class="line"><span class="built_in">rm</span> -rf dir1 dir2 <span class="comment">#同时删除两个目录及它们的内容</span></span><br><span class="line"><span class="built_in">mv</span> dir1 new_dir <span class="comment">#重命名/移动 一个目录</span></span><br><span class="line"><span class="built_in">cp</span> file1 file2 <span class="comment">#复制一个文件</span></span><br><span class="line"><span class="built_in">cp</span> <span class="built_in">dir</span>/* . <span class="comment">#复制一个目录下的所有文件到当前工作目录</span></span><br><span class="line"><span class="built_in">cp</span> -a /tmp/dir1 . <span class="comment">#复制一个目录到当前工作目录</span></span><br><span class="line"><span class="built_in">cp</span> -a dir1 dir2 <span class="comment">#复制一个目录</span></span><br><span class="line"><span class="built_in">ln</span> -s file1 lnk1 <span class="comment">#创建一个指向文件或目录的软链接</span></span><br><span class="line"><span class="built_in">ln</span> file1 lnk1 <span class="comment">#创建一个指向文件或目录的物理链接</span></span><br><span class="line"><span class="built_in">touch</span> -t 0712250000 file1 <span class="comment">#修改一个文件或目录的时间戳 - (YYMMDDhhmm)</span></span><br><span class="line">file file1 <span class="comment">#outputs the mime type of the file as text</span></span><br><span class="line">iconv -l 列出已知的编码</span><br><span class="line">iconv -f fromEncoding -t toEncoding inputFile &gt; outputFile <span class="comment">#creates a new from the given input file by assuming it is encoded in fromEncoding and converting it to toEncoding.</span></span><br><span class="line"></span><br><span class="line">find . -maxdepth 1 -name *.jpg -<span class="built_in">print</span> -<span class="built_in">exec</span> convert <span class="string">&quot;&#123;&#125;&quot;</span> -resize 80x60 <span class="string">&quot;thumbs/&#123;&#125;&quot;</span> \; <span class="comment">#batch resize files in the current directory and send them to a thumbnails directory (requires convert from Imagemagick)</span></span><br></pre></td></tr></table></figure><h2 id="4-文件搜索"><a href="#4-文件搜索" class="headerlink" title="4. 文件搜索"></a>4. 文件搜索</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">find / -name file1 <span class="comment">#从 &#x27;/&#x27; 开始进入根文件系统搜索文件和目录</span></span><br><span class="line">find / -user user1 <span class="comment">#搜索属于用户 &#x27;user1&#x27; 的文件和目录</span></span><br><span class="line">find /home/user1 -name \*.bin <span class="comment">#在目录 &#x27;/ home/user1&#x27; 中搜索带有&#x27;.bin&#x27; 结尾的文件</span></span><br><span class="line">find /usr/bin -<span class="built_in">type</span> f -atime +100 <span class="comment">#搜索在过去100天内未被使用过的执行文件</span></span><br><span class="line">find /usr/bin -<span class="built_in">type</span> f -mtime -10 <span class="comment">#搜索在10天内被创建或者修改过的文件</span></span><br><span class="line">find / -name \*.rpm -<span class="built_in">exec</span> <span class="built_in">chmod</span> 755 <span class="string">&#x27;&#123;&#125;&#x27;</span> \; <span class="comment">#搜索以 &#x27;.rpm&#x27; 结尾的文件并定义其权限</span></span><br><span class="line">find / -xdev -name \*.rpm 搜索以 <span class="string">&#x27;.rpm&#x27;</span> <span class="comment">#结尾的文件，忽略光驱、捷盘等可移动设备</span></span><br><span class="line">locate \*.ps 寻找以 <span class="string">&#x27;.ps&#x27;</span> <span class="comment">#结尾的文件 - 先运行 &#x27;updatedb&#x27; 命令</span></span><br><span class="line">whereis halt <span class="comment">#显示一个二进制文件、源码或man的位置</span></span><br><span class="line"><span class="built_in">which</span> halt <span class="comment">#显示一个二进制文件或可执行文件的完整路径</span></span><br></pre></td></tr></table></figure><h2 id="5-挂载一个文件系统"><a href="#5-挂载一个文件系统" class="headerlink" title="5. 挂载一个文件系统"></a>5. 挂载一个文件系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/hda2 /mnt/hda2 <span class="comment">#挂载一个叫做hda2的盘 - 确定目录 &#x27;/ mnt/hda2&#x27; 已经存在</span></span><br><span class="line">umount /dev/hda2 <span class="comment">#卸载一个叫做hda2的盘 - 先从挂载点 &#x27;/ mnt/hda2&#x27; 退出</span></span><br><span class="line">fuser -km /mnt/hda2 <span class="comment">#当设备繁忙时强制卸载</span></span><br><span class="line">umount -n /mnt/hda2 <span class="comment">#运行卸载操作而不写入 /etc/mtab 文件- 当文件为只读或当磁盘写满时非常有用</span></span><br><span class="line">mount /dev/fd0 /mnt/floppy <span class="comment">#挂载一个软盘</span></span><br><span class="line">mount /dev/cdrom /mnt/cdrom <span class="comment">#挂载一个cdrom或dvdrom</span></span><br><span class="line">mount /dev/hdc /mnt/cdrecorder <span class="comment">#挂载一个cdrw或dvdrom</span></span><br><span class="line">mount /dev/hdb /mnt/cdrecorder <span class="comment">#挂载一个cdrw或dvdrom</span></span><br><span class="line">mount -o loop file.iso /mnt/cdrom <span class="comment">#挂载一个文件或ISO镜像文件</span></span><br><span class="line">mount -t vfat /dev/hda5 /mnt/hda5 <span class="comment">#挂载一个Windows FAT32文件系统</span></span><br><span class="line">mount /dev/sda1 /mnt/usbdisk <span class="comment">#挂载一个usb 捷盘或闪存设备</span></span><br><span class="line">mount -t smbfs -o username=user,password=pass //WinClient/share /mnt/share <span class="comment">#挂载一个windows网络共享</span></span><br></pre></td></tr></table></figure><h2 id="6-磁盘空间"><a href="#6-磁盘空间" class="headerlink" title="6. 磁盘空间"></a>6. 磁盘空间</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h <span class="comment">#显示已经挂载的分区列表</span></span><br><span class="line"><span class="built_in">ls</span> -lSr |more <span class="comment">#以尺寸大小排列文件和目录</span></span><br><span class="line"><span class="built_in">du</span> -sh dir1 估算目录 <span class="string">&#x27;dir1&#x27;</span> <span class="comment">#已经使用的磁盘空间&#x27;</span></span><br><span class="line"><span class="built_in">du</span> -sk * | <span class="built_in">sort</span> -rn <span class="comment">#以容量大小为依据依次显示文件和目录的大小</span></span><br><span class="line">rpm -q -a --qf <span class="string">&#x27;%10&#123;SIZE&#125;t%&#123;NAME&#125;n&#x27;</span> | <span class="built_in">sort</span> -k1,1n <span class="comment">#以大小为依据依次显示已安装的rpm包所使用的空间 (fedora, redhat类系统)</span></span><br><span class="line">dpkg-query -W -f=<span class="string">&#x27;$&#123;Installed-Size;10&#125;t$&#123;Package&#125;n&#x27;</span> | <span class="built_in">sort</span> -k1,1n <span class="comment">#以大小为依据显示已安装的deb包所使用的空间 (ubuntu, debian类系统)</span></span><br></pre></td></tr></table></figure><h2 id="7-用户和群组"><a href="#7-用户和群组" class="headerlink" title="7. 用户和群组"></a>7. 用户和群组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">groupadd group_name <span class="comment">#创建一个新用户组</span></span><br><span class="line">groupdel group_name <span class="comment">#删除一个用户组</span></span><br><span class="line">groupmod -n new_group_name old_group_name <span class="comment">#重命名一个用户组</span></span><br><span class="line">useradd -c <span class="string">&quot;Name Surname &quot;</span> -g admin -d /home/user1 -s /bin/bash user1 <span class="comment">#创建一个属于 &quot;admin&quot; 用户组的用户</span></span><br><span class="line">useradd user1 <span class="comment">#创建一个新用户</span></span><br><span class="line">userdel -r user1 <span class="comment">#删除一个用户 ( &#x27;-r&#x27; 排除主目录)</span></span><br><span class="line">usermod -c <span class="string">&quot;User FTP&quot;</span> -g system -d /ftp/user1 -s /bin/nologin user1 <span class="comment">##修改用户属性</span></span><br><span class="line">passwd <span class="comment">#修改口令</span></span><br><span class="line">passwd user1 <span class="comment">#修改一个用户的口令 (只允许root执行)</span></span><br><span class="line">chage -E 2005-12-31 user1 <span class="comment">#设置用户口令的失效期限</span></span><br><span class="line">pwck <span class="comment">#检查 &#x27;/etc/passwd&#x27; 的文件格式和语法修正以及存在的用户</span></span><br><span class="line">grpck <span class="comment">#检查 &#x27;/etc/passwd&#x27; 的文件格式和语法修正以及存在的群组</span></span><br><span class="line">newgrp group_name <span class="comment">#登陆进一个新的群组以改变新创建文件的预设群组</span></span><br></pre></td></tr></table></figure><h2 id="8-文件的权限-使用-“-”-设置权限，使用-“-”-用于取消"><a href="#8-文件的权限-使用-“-”-设置权限，使用-“-”-用于取消" class="headerlink" title="8. 文件的权限 使用 “+” 设置权限，使用 “-” 用于取消"></a>8. 文件的权限 使用 “+” 设置权限，使用 “-” 用于取消</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -lh <span class="comment">#显示权限</span></span><br><span class="line"><span class="built_in">ls</span> /tmp | <span class="built_in">pr</span> -T5 -W<span class="variable">$COLUMNS</span> <span class="comment">#将终端划分成5栏显示</span></span><br><span class="line"><span class="built_in">chmod</span> ugo+rwx directory1 <span class="comment">#设置目录的所有人(u)、群组(g)以及其他人(o)以读（r ）、写(w)和执行(x)的权限</span></span><br><span class="line"><span class="built_in">chmod</span> go-rwx directory1 <span class="comment">#删除群组(g)与其他人(o)对目录的读写执行权限</span></span><br><span class="line"><span class="built_in">chown</span> user1 file1 <span class="comment">#改变一个文件的所有人属性</span></span><br><span class="line"><span class="built_in">chown</span> -R user1 directory1 <span class="comment">#改变一个目录的所有人属性并同时改变改目录下所有文件的属性</span></span><br><span class="line"><span class="built_in">chgrp</span> group1 file1 <span class="comment">#改变文件的群组</span></span><br><span class="line"><span class="built_in">chown</span> user1:group1 file1 <span class="comment">#改变一个文件的所有人和群组属性</span></span><br><span class="line">find / -perm -u+s <span class="comment">#罗列一个系统中所有使用了SUID控制的文件</span></span><br><span class="line"><span class="built_in">chmod</span> u+s /bin/file1 <span class="comment">#设置一个二进制文件的 SUID 位 - 运行该文件的用户也被赋予和所有者同样的权限</span></span><br><span class="line"><span class="built_in">chmod</span> u-s /bin/file1 <span class="comment">#禁用一个二进制文件的 SUID位</span></span><br><span class="line"><span class="built_in">chmod</span> g+s /home/public <span class="comment">#设置一个目录的SGID 位 - 类似SUID ，不过这是针对目录的</span></span><br><span class="line"><span class="built_in">chmod</span> g-s /home/public <span class="comment">#禁用一个目录的 SGID 位</span></span><br><span class="line"><span class="built_in">chmod</span> o+t /home/public <span class="comment">#设置一个文件的 STIKY 位 - 只允许合法所有人删除文件</span></span><br><span class="line"><span class="built_in">chmod</span> o-t /home/public <span class="comment">#禁用一个目录的 STIKY 位</span></span><br><span class="line"><span class="built_in">chmod</span> +x 文件路径 <span class="comment">#为所有者、所属组和其他用户添加执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> -x 文件路径 <span class="comment">#为所有者、所属组和其他用户删除执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> u+x 文件路径 <span class="comment">#为所有者添加执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> g+x 文件路径 <span class="comment">#为所属组添加执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> o+x 文件路径 <span class="comment">#为其他用户添加执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> ug+x 文件路径 <span class="comment">#为所有者、所属组添加执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> =wx 文件路径 <span class="comment">#为所有者、所属组和其他用户添加写、执行的权限，取消读权限</span></span><br><span class="line"><span class="built_in">chmod</span> ug=wx 文件路径 <span class="comment">#为所有者、所属组添加写、执行的权限，取消读权限</span></span><br></pre></td></tr></table></figure><h2 id="9-文件的特殊属性-，使用-“-”-设置权限，使用-“-”-用于取消"><a href="#9-文件的特殊属性-，使用-“-”-设置权限，使用-“-”-用于取消" class="headerlink" title="9. 文件的特殊属性 ，使用 “+” 设置权限，使用 “-” 用于取消"></a>9. 文件的特殊属性 ，使用 “+” 设置权限，使用 “-” 用于取消</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chattr +a file1 <span class="comment">#只允许以追加方式读写文件</span></span><br><span class="line">chattr +c file1 <span class="comment">##允许这个文件能被内核自动压缩/解压</span></span><br><span class="line">chattr +d file1 <span class="comment">#在进行文件系统备份时，dump程序将忽略这个文件</span></span><br><span class="line">chattr +i file1 <span class="comment">#设置成不可变的文件，不能被删除、修改、重命名或者链接</span></span><br><span class="line">chattr +s file1 <span class="comment">#允许一个文件被安全地删除</span></span><br><span class="line">chattr +S file1 <span class="comment">#一旦应用程序对这个文件执行了写操作，使系统立刻把修改的结果写到磁盘</span></span><br><span class="line">chattr +u file1 <span class="comment">#若文件被删除，系统会允许你在以后恢复这个被删除的文件</span></span><br><span class="line">lsattr <span class="comment">#显示特殊的属性</span></span><br></pre></td></tr></table></figure><h2 id="10-打包和压缩文件"><a href="#10-打包和压缩文件" class="headerlink" title="10. 打包和压缩文件"></a>10. 打包和压缩文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">bunzip2 file1.bz2 <span class="comment">#解压一个叫做 &#x27;file1.bz2&#x27;的文件</span></span><br><span class="line">bzip2 file1 <span class="comment">#压缩一个叫做 &#x27;file1&#x27; 的文件</span></span><br><span class="line">gunzip file1.gz <span class="comment">#解压一个叫做 &#x27;file1.gz&#x27;的文件</span></span><br><span class="line">gzip file1 <span class="comment">#压缩一个叫做 &#x27;file1&#x27;的文件</span></span><br><span class="line">gzip -9 file1 <span class="comment">#最大程度压缩</span></span><br><span class="line">rar a file1.rar test_file <span class="comment">#创建一个叫做 &#x27;file1.rar&#x27; 的包</span></span><br><span class="line">rar a file1.rar file1 file2 dir1 <span class="comment">#同时压缩 &#x27;file1&#x27;, &#x27;file2&#x27; 以及目录 &#x27;dir1&#x27;</span></span><br><span class="line">rar x file1.rar <span class="comment">#解压rar包</span></span><br><span class="line">unrar x file1.rar <span class="comment">#解压rar包</span></span><br><span class="line">tar -cvf archive.tar file1 <span class="comment">#创建一个非压缩的 tarball</span></span><br><span class="line">tar -cvf archive.tar file1 file2 dir1 <span class="comment">#创建一个包含了 &#x27;file1&#x27;, &#x27;file2&#x27; 以及 &#x27;dir1&#x27;的档案文件</span></span><br><span class="line">tar -tf archive.tar <span class="comment">#显示一个包中的内容</span></span><br><span class="line">tar -xvf archive.tar <span class="comment">#释放一个包</span></span><br><span class="line">tar -xvf archive.tar -C /tmp <span class="comment">#将压缩包释放到 /tmp目录下</span></span><br><span class="line">tar -cvfj archive.tar.bz2 dir1 <span class="comment">#创建一个bzip2格式的压缩包</span></span><br><span class="line">tar -xvfj archive.tar.bz2 <span class="comment">#解压一个bzip2格式的压缩包</span></span><br><span class="line">tar -cvfz archive.tar.gz dir1 <span class="comment">#创建一个gzip格式的压缩包</span></span><br><span class="line">tar -xvfz archive.tar.gz <span class="comment">#解压一个gzip格式的压缩包</span></span><br><span class="line">zip file1.zip file1 <span class="comment">#创建一个zip格式的压缩包</span></span><br><span class="line">zip -r file1.zip file1 file2 dir1 <span class="comment">#将几个文件和目录同时压缩成一个zip格式的压缩包</span></span><br><span class="line">unzip file1.zip <span class="comment">#解压一个zip格式压缩包</span></span><br></pre></td></tr></table></figure><h2 id="11-RPM-包"><a href="#11-RPM-包" class="headerlink" title="11. RPM 包"></a>11. RPM 包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh package.rpm <span class="comment">#安装一个rpm包</span></span><br><span class="line">rpm -ivh --nodeeps package.rpm <span class="comment">#安装一个rpm包而忽略依赖关系警告</span></span><br><span class="line">rpm -U package.rpm <span class="comment">#更新一个rpm包但不改变其配置文件</span></span><br><span class="line">rpm -F package.rpm <span class="comment">#更新一个确定已经安装的rpm包</span></span><br><span class="line">rpm -e package_name.rpm <span class="comment">#删除一个rpm包</span></span><br><span class="line">rpm -qa <span class="comment">#显示系统中所有已经安装的rpm包</span></span><br><span class="line">rpm -qa | grep httpd <span class="comment">#显示所有名称中包含 &quot;httpd&quot; 字样的rpm包</span></span><br><span class="line">rpm -qi package_name <span class="comment">#获取一个已安装包的特殊信息</span></span><br><span class="line">rpm -qg <span class="string">&quot;System Environment/Daemons&quot;</span> <span class="comment">#显示一个组件的rpm包</span></span><br><span class="line">rpm -ql package_name <span class="comment">#显示一个已经安装的rpm包提供的文件列表</span></span><br><span class="line">rpm -qc package_name <span class="comment">#显示一个已经安装的rpm包提供的配置文件列表</span></span><br><span class="line">rpm -q package_name --whatrequires <span class="comment">#显示与一个rpm包存在依赖关系的列表</span></span><br><span class="line">rpm -q package_name --whatprovides <span class="comment">#显示一个rpm包所占的体积</span></span><br><span class="line">rpm -q package_name --scripts <span class="comment">#显示在安装/删除期间所执行的脚本l</span></span><br><span class="line">rpm -q package_name --changelog <span class="comment">#显示一个rpm包的修改历史</span></span><br><span class="line">rpm -qf /etc/httpd/conf/httpd.conf <span class="comment">#确认所给的文件由哪个rpm包所提供</span></span><br><span class="line">rpm -qp package.rpm -l <span class="comment">#显示由一个尚未安装的rpm包提供的文件列表</span></span><br><span class="line">rpm --import /media/cdrom/RPM-GPG-KEY <span class="comment">#导入公钥数字证书</span></span><br><span class="line">rpm --checksig package.rpm <span class="comment">#确认一个rpm包的完整性</span></span><br><span class="line">rpm -qa gpg-pubkey <span class="comment">#确认已安装的所有rpm包的完整性</span></span><br><span class="line">rpm -V package_name <span class="comment">#检查文件尺寸、 许可、类型、所有者、群组、MD5检查以及最后修改时间</span></span><br><span class="line">rpm -Va <span class="comment">#检查系统中所有已安装的rpm包- 小心使用</span></span><br><span class="line">rpm -Vp package.rpm <span class="comment">#确认一个rpm包还未安装</span></span><br><span class="line">rpm2cpio package.rpm | cpio --extract --make-directories *bin* <span class="comment">#从一个rpm包运行可执行文件</span></span><br><span class="line">rpm -ivh /usr/src/redhat/RPMS/`<span class="built_in">arch</span>`/package.rpm <span class="comment">#从一个rpm源码安装一个构建好的包</span></span><br><span class="line">rpmbuild --rebuild package_name.src.rpm <span class="comment">#从一个rpm源码构建一个 rpm 包</span></span><br></pre></td></tr></table></figure><h2 id="12-YUM-软件包升级器"><a href="#12-YUM-软件包升级器" class="headerlink" title="12. YUM 软件包升级器"></a>12. YUM 软件包升级器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum install package_name <span class="comment">#下载并安装一个rpm包</span></span><br><span class="line">yum localinstall package_name.rpm <span class="comment">#将安装一个rpm包，使用你自己的软件仓库为你解决所有依赖关系</span></span><br><span class="line">yum update package_name.rpm <span class="comment">#更新当前系统中所有安装的rpm包</span></span><br><span class="line">yum update package_name <span class="comment">#更新一个rpm包</span></span><br><span class="line">yum remove package_name <span class="comment">#删除一个rpm包</span></span><br><span class="line">yum list <span class="comment">#列出当前系统中安装的所有包</span></span><br><span class="line">yum search package_name <span class="comment">#在rpm仓库中搜寻软件包</span></span><br><span class="line">yum clean packages <span class="comment">#清理rpm缓存删除下载的包</span></span><br><span class="line">yum clean headers <span class="comment">#删除所有头文件</span></span><br><span class="line">yum clean all <span class="comment">#删除所有缓存的包和头文件</span></span><br></pre></td></tr></table></figure><h2 id="13-deb-包"><a href="#13-deb-包" class="headerlink" title="13. deb 包"></a>13. deb 包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i package.deb <span class="comment">#安装/更新一个 deb 包</span></span><br><span class="line">dpkg -r package_name <span class="comment">#从系统删除一个 deb 包</span></span><br><span class="line">dpkg -l <span class="comment">#显示系统中所有已经安装的 deb 包</span></span><br><span class="line">dpkg -l | grep httpd <span class="comment">#显示所有名称中包含 &quot;httpd&quot; 字样的deb包</span></span><br><span class="line">dpkg -s package_name <span class="comment">#获得已经安装在系统中一个特殊包的信息</span></span><br><span class="line">dpkg -L package_name <span class="comment">#显示系统中已经安装的一个deb包所提供的文件列表</span></span><br><span class="line">dpkg --contents package.deb <span class="comment">#显示尚未安装的一个包所提供的文件列表</span></span><br><span class="line">dpkg -S /bin/ping <span class="comment">#确认所给的文件由哪个deb包提供</span></span><br><span class="line">APT <span class="comment">#软件工具 (Debian, Ubuntu 以及类似系统)</span></span><br><span class="line">apt-get install package_name <span class="comment">#安装/更新一个 deb 包</span></span><br><span class="line">apt-cdrom install package_name <span class="comment">#从光盘安装/更新一个 deb 包</span></span><br><span class="line">apt-get update <span class="comment">#升级列表中的软件包</span></span><br><span class="line">apt-get upgrade <span class="comment">#升级所有已安装的软件</span></span><br><span class="line">apt-get remove package_name <span class="comment">#从系统删除一个deb包</span></span><br><span class="line">apt-get check <span class="comment">#确认依赖的软件仓库正确</span></span><br><span class="line">apt-get clean <span class="comment">#从下载的软件包中清理缓存</span></span><br><span class="line">apt-cache search searched-package <span class="comment">#返回包含所要搜索字符串的软件包名称</span></span><br></pre></td></tr></table></figure><h2 id="14-查看文件内容"><a href="#14-查看文件内容" class="headerlink" title="14. 查看文件内容"></a>14. 查看文件内容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file1 <span class="comment">#从第一个字节开始正向查看文件的内容</span></span><br><span class="line"><span class="built_in">tac</span> file1 <span class="comment">#从最后一行开始反向查看一个文件的内容</span></span><br><span class="line">more file1 <span class="comment">#查看一个长文件的内容</span></span><br><span class="line">less file1 <span class="comment">#类似于 &#x27;more&#x27; 命令，但是它允许在文件中和正向操作一样的反向操作</span></span><br><span class="line"><span class="built_in">head</span> -2 file1 <span class="comment">#查看一个文件的前两行</span></span><br><span class="line"><span class="built_in">tail</span> -2 file1 <span class="comment">#查看一个文件的最后两行</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/messages <span class="comment">#实时查看被添加到一个文件中的内容</span></span><br></pre></td></tr></table></figure><h2 id="15-文本处理"><a href="#15-文本处理" class="headerlink" title="15. 文本处理"></a>15. 文本处理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file1 | <span class="built_in">command</span>( sed, grep, awk, grep, etc...) &gt; result.txt <span class="comment">#合并一个文件的详细说明文本，并将简介写入一个新文件中</span></span><br><span class="line"><span class="built_in">cat</span> file1 | <span class="built_in">command</span>( sed, grep, awk, grep, etc...) &gt;&gt; result.txt <span class="comment">#合并一个文件的详细说明文本，并将简介写入一个已有的文件中</span></span><br><span class="line">grep Aug /var/log/messages <span class="comment">#在文件 &#x27;/var/log/messages&#x27;中查找关键词&quot;Aug&quot;</span></span><br><span class="line">grep ^Aug /var/log/messages <span class="comment">#在文件 &#x27;/var/log/messages&#x27;中查找以&quot;Aug&quot;开始的词汇</span></span><br><span class="line">grep [0-9] /var/log/messages <span class="comment">#选择 &#x27;/var/log/messages&#x27; 文件中所有包含数字的行</span></span><br><span class="line">grep Aug -R /var/log/* <span class="comment">#在目录 &#x27;/var/log&#x27; 及随后的目录中搜索字符串&quot;Aug&quot;</span></span><br><span class="line">sed <span class="string">&#x27;s/stringa1/stringa2/g&#x27;</span> example.txt <span class="comment">#将example.txt文件中的 &quot;string1&quot; 替换成 &quot;string2&quot;</span></span><br><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> example.txt <span class="comment">#从example.txt文件中删除所有空白行</span></span><br><span class="line">sed <span class="string">&#x27;/ *#/d; /^$/d&#x27;</span> example.txt <span class="comment">#从example.txt文件中删除所有注释和空白行</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;esempio&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27;[:lower:]&#x27;</span> <span class="string">&#x27;[:upper:]&#x27;</span> <span class="comment">#合并上下单元格内容</span></span><br><span class="line">sed -e <span class="string">&#x27;1d&#x27;</span> result.txt <span class="comment">#从文件example.txt 中排除第一行</span></span><br><span class="line">sed -n <span class="string">&#x27;/stringa1/p&#x27;</span> <span class="comment">#查看只包含词汇 &quot;string1&quot;的行</span></span><br><span class="line">sed -e <span class="string">&#x27;s/ *$//&#x27;</span> example.txt <span class="comment">#删除每一行最后的空白字符</span></span><br><span class="line">sed -e <span class="string">&#x27;s/stringa1//g&#x27;</span> example.txt <span class="comment">#从文档中只删除词汇 &quot;string1&quot; 并保留剩余全部</span></span><br><span class="line">sed -n <span class="string">&#x27;1,5p;5q&#x27;</span> example.txt <span class="comment">#查看从第一行到第5行内容</span></span><br><span class="line">sed -n <span class="string">&#x27;5p;5q&#x27;</span> example.txt <span class="comment">#查看第5行</span></span><br><span class="line">sed -e <span class="string">&#x27;s/00*/0/g&#x27;</span> example.txt <span class="comment">#用单个零替换多个零</span></span><br><span class="line"><span class="built_in">cat</span> -n file1 <span class="comment">#标示文件的行数</span></span><br><span class="line"><span class="built_in">cat</span> example.txt | awk <span class="string">&#x27;NR%2==1&#x27;</span> <span class="comment">#删除example.txt文件中的所有偶数行</span></span><br><span class="line"><span class="built_in">echo</span> a b c | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="comment">#查看一行第一栏</span></span><br><span class="line"><span class="built_in">echo</span> a b c | awk <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> <span class="comment">#查看一行的第一和第三栏</span></span><br><span class="line"><span class="built_in">paste</span> file1 file2 <span class="comment">#合并两个文件或两栏的内容</span></span><br><span class="line"><span class="built_in">paste</span> -d <span class="string">&#x27;+&#x27;</span> file1 file2 <span class="comment">#合并两个文件或两栏的内容，中间用&quot;+&quot;区分</span></span><br><span class="line"><span class="built_in">sort</span> file1 file2 <span class="comment">#排序两个文件的内容</span></span><br><span class="line"><span class="built_in">sort</span> file1 file2 | <span class="built_in">uniq</span> <span class="comment">#取出两个文件的并集(重复的行只保留一份)</span></span><br><span class="line"><span class="built_in">sort</span> file1 file2 | <span class="built_in">uniq</span> -u <span class="comment">#删除交集，留下其他的行</span></span><br><span class="line"><span class="built_in">sort</span> file1 file2 | <span class="built_in">uniq</span> -d <span class="comment">#取出两个文件的交集(只留下同时存在于两个文件中的文件)</span></span><br><span class="line"><span class="built_in">comm</span> -1 file1 file2 <span class="comment">#比较两个文件的内容只删除 &#x27;file1&#x27; 所包含的内容</span></span><br><span class="line"><span class="built_in">comm</span> -2 file1 file2 <span class="comment">#比较两个文件的内容只删除 &#x27;file2&#x27; 所包含的内容</span></span><br><span class="line"><span class="built_in">comm</span> -3 file1 file2 <span class="comment">#比较两个文件的内容只删除两个文件共有的部分</span></span><br></pre></td></tr></table></figure><h2 id="16-字符设置和文件格式转换"><a href="#16-字符设置和文件格式转换" class="headerlink" title="16. 字符设置和文件格式转换"></a>16. 字符设置和文件格式转换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dos2unix filedos.txt fileunix.txt <span class="comment">#将一个文本文件的格式从MSDOS转换成UNIX</span></span><br><span class="line">unix2dos fileunix.txt filedos.txt <span class="comment">#将一个文本文件的格式从UNIX转换成MSDOS</span></span><br><span class="line">recode ..HTML &lt; page.txt &gt; page.html <span class="comment">#将一个文本文件转换成html</span></span><br><span class="line">recode -l | more <span class="comment">#显示所有允许的转换格式</span></span><br></pre></td></tr></table></figure><h2 id="17-文件系统分析"><a href="#17-文件系统分析" class="headerlink" title="17. 文件系统分析"></a>17. 文件系统分析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">badblocks -v /dev/hda1 <span class="comment">#检查磁盘hda1上的坏磁块</span></span><br><span class="line">fsck /dev/hda1 <span class="comment">#修复/检查hda1磁盘上linux文件系统的完整性</span></span><br><span class="line">fsck.ext2 /dev/hda1 <span class="comment">#修复/检查hda1磁盘上ext2文件系统的完整性</span></span><br><span class="line">e2fsck /dev/hda1 <span class="comment">#修复/检查hda1磁盘上ext2文件系统的完整性</span></span><br><span class="line">e2fsck -j /dev/hda1 <span class="comment">#修复/检查hda1磁盘上ext3文件系统的完整性</span></span><br><span class="line">fsck.ext3 /dev/hda1 <span class="comment">#修复/检查hda1磁盘上ext3文件系统的完整性</span></span><br><span class="line">fsck.vfat /dev/hda1 <span class="comment">#修复/检查hda1磁盘上fat文件系统的完整性</span></span><br><span class="line">fsck.msdos /dev/hda1 <span class="comment">#修复/检查hda1磁盘上dos文件系统的完整性</span></span><br><span class="line">dosfsck /dev/hda1 <span class="comment">#修复/检查hda1磁盘上dos文件系统的完整性</span></span><br></pre></td></tr></table></figure><h2 id="18-初始化一个文件系统"><a href="#18-初始化一个文件系统" class="headerlink" title="18. 初始化一个文件系统"></a>18. 初始化一个文件系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkfs /dev/hda1 <span class="comment">#在hda1分区创建一个文件系统</span></span><br><span class="line">mke2fs /dev/hda1 <span class="comment">#在hda1分区创建一个linux ext2的文件系统</span></span><br><span class="line">mke2fs -j /dev/hda1 <span class="comment">#在hda1分区创建一个linux ext3(日志型)的文件系统</span></span><br><span class="line">mkfs -t vfat 32 -F /dev/hda1 <span class="comment">#创建一个 FAT32 文件系统</span></span><br><span class="line">fdformat -n /dev/fd0 <span class="comment">#格式化一个软盘</span></span><br><span class="line">mkswap /dev/hda3 <span class="comment">#创建一个swap文件系统</span></span><br></pre></td></tr></table></figure><h2 id="19-SWAP-文件系统"><a href="#19-SWAP-文件系统" class="headerlink" title="19. SWAP 文件系统"></a>19. SWAP 文件系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkswap /dev/hda3 <span class="comment">#创建一个swap文件系统</span></span><br><span class="line">swapon /dev/hda3 <span class="comment">#启用一个新的swap文件系统</span></span><br><span class="line">swapon /dev/hda2 /dev/hdb3 <span class="comment">#启用两个swap分区</span></span><br></pre></td></tr></table></figure><h2 id="20-备份"><a href="#20-备份" class="headerlink" title="20. 备份"></a>20. 备份</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dump -0aj -f /tmp/home0.bak /home <span class="comment">#制作一个 &#x27;/home&#x27; 目录的完整备份</span></span><br><span class="line">dump -1aj -f /tmp/home0.bak /home <span class="comment">#制作一个 &#x27;/home&#x27; 目录的交互式备份</span></span><br><span class="line">restore -<span class="keyword">if</span> /tmp/home0.bak <span class="comment">#还原一个交互式备份</span></span><br><span class="line">rsync -rogpav --delete /home /tmp <span class="comment">#同步两边的目录</span></span><br><span class="line">rsync -rogpav -e ssh --delete /home ip_address:/tmp <span class="comment">#通过SSH通道rsync</span></span><br><span class="line">rsync -az -e ssh --delete ip_addr:/home/public /home/local <span class="comment">#通过ssh和压缩将一个远程目录同步到本地目录</span></span><br><span class="line">rsync -az -e ssh --delete /home/local ip_addr:/home/public <span class="comment">#通过ssh和压缩将本地目录同步到远程目录</span></span><br><span class="line"><span class="built_in">dd</span> bs=1M <span class="keyword">if</span>=/dev/hda | gzip | ssh user@ip_addr <span class="string">&#x27;dd of=hda.gz&#x27;</span> <span class="comment">#通过ssh在远程主机上执行一次备份本地磁盘的操作</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/tmp/file1 <span class="comment">#备份磁盘内容到一个文件</span></span><br><span class="line">tar -Puf backup.tar /home/user <span class="comment">#执行一次对 &#x27;/home/user&#x27; 目录的交互式备份操作</span></span><br><span class="line">( <span class="built_in">cd</span> /tmp/local/ &amp;&amp; tar c . ) | ssh -C user@ip_addr <span class="string">&#x27;cd /home/share/ &amp;&amp; tar x -p&#x27;</span> <span class="comment">#通过ssh在远程目录中复制一个目录内容</span></span><br><span class="line">( tar c /home ) | ssh -C user@ip_addr <span class="string">&#x27;cd /home/backup-home &amp;&amp; tar x -p&#x27;</span> <span class="comment">#通过ssh在远程目录中复制一个本地目录</span></span><br><span class="line">tar cf - . | (<span class="built_in">cd</span> /tmp/backup ; tar xf - ) <span class="comment">#本地将一个目录复制到另一个地方，保留原有权限及链接</span></span><br><span class="line">find /home/user1 -name <span class="string">&#x27;*.txt&#x27;</span> | xargs <span class="built_in">cp</span> -av --target-directory=/home/backup/ --parents <span class="comment">#从一个目录查找并复制所有以 &#x27;.txt&#x27; 结尾的文件到另一个目录</span></span><br><span class="line">find /var/log -name <span class="string">&#x27;*.log&#x27;</span> | tar cv --files-from=- | bzip2 &gt; log.tar.bz2 查找所有以 <span class="string">&#x27;.log&#x27;</span> <span class="comment">#结尾的文件并做成一个bzip包</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/hda of=/dev/fd0 bs=512 count=1 <span class="comment">#做一个将 MBR (Master Boot Record)内容复制到软盘的动作</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/fd0 of=/dev/hda bs=512 count=1 <span class="comment">#从已经保存到软盘的备份中恢复MBR内容</span></span><br></pre></td></tr></table></figure><h2 id="21-光盘"><a href="#21-光盘" class="headerlink" title="21. 光盘"></a>21. 光盘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cdrecord -v gracetime=2 dev=/dev/cdrom -eject blank=fast -force <span class="comment">#清空一个可复写的光盘内容</span></span><br><span class="line">mkisofs /dev/cdrom &gt; cd.iso <span class="comment">#在磁盘上创建一个光盘的iso镜像文件</span></span><br><span class="line">mkisofs /dev/cdrom | gzip &gt; cd_iso.gz <span class="comment">#在磁盘上创建一个压缩了的光盘iso镜像文件</span></span><br><span class="line">mkisofs -J -allow-leading-dots -R -V <span class="string">&quot;Label CD&quot;</span> -iso-level 4 -o ./cd.iso data_cd <span class="comment">#创建一个目录的iso镜像文件</span></span><br><span class="line">cdrecord -v dev=/dev/cdrom cd.iso <span class="comment">#刻录一个ISO镜像文件</span></span><br><span class="line">gzip -dc cd_iso.gz | cdrecord dev=/dev/cdrom - <span class="comment">#刻录一个压缩了的ISO镜像文件</span></span><br><span class="line">mount -o loop cd.iso /mnt/iso <span class="comment">#挂载一个ISO镜像文件</span></span><br><span class="line">cd-paranoia -B <span class="comment">#从一个CD光盘转录音轨到 wav 文件中</span></span><br><span class="line">cd-paranoia -- <span class="string">&quot;-3&quot;</span> <span class="comment">#从一个CD光盘转录音轨到 wav 文件中（参数-3）</span></span><br><span class="line">cdrecord --scanbus <span class="comment">#扫描总线以识别scsi通道</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/hdc | <span class="built_in">md5sum</span> <span class="comment">#校验一个设备的md5sum编码，例如一张 CD</span></span><br></pre></td></tr></table></figure><h2 id="22-列出目录内容"><a href="#22-列出目录内容" class="headerlink" title="22. 列出目录内容"></a>22. 列出目录内容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -a：<span class="comment">#显示所有文件（包括隐藏文件）；</span></span><br><span class="line"><span class="built_in">ls</span> -l：<span class="comment">#显示详细信息；</span></span><br><span class="line"><span class="built_in">ls</span> -R：<span class="comment">#递归显示子目录结构；</span></span><br><span class="line"><span class="built_in">ls</span> -ld：<span class="comment">#显示目录和链接信息；</span></span><br><span class="line">ctrl+r：<span class="comment">##历史记录中所搜命令（输入命令中的任意一个字符）；</span></span><br><span class="line"><span class="built_in">pwd</span>:<span class="comment">#显示当前目录</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">部分常见Linux命令总结</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Windows删除指定日期文件</title>
    <link href="http://example.com/2024/04/16/Win%E6%8C%89%E6%97%B6%E9%97%B4%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6/"/>
    <id>http://example.com/2024/04/16/Win%E6%8C%89%E6%97%B6%E9%97%B4%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6/</id>
    <published>2024-04-16T01:25:00.000Z</published>
    <updated>2024-04-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><h3 id="按照月份删除"><a href="#按照月份删除" class="headerlink" title="按照月份删除"></a>按照月份删除</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置要检查的目录，按照月份删除</span></span><br><span class="line"><span class="variable">$archivePath</span> = <span class="string">&quot;C:\arch&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前日期，并减去指定月数，以确定删除的界限</span></span><br><span class="line"><span class="variable">$monthsToSubtract</span> = <span class="number">6</span>  <span class="comment"># 修改为3或其他你需要的月数</span></span><br><span class="line"><span class="variable">$limitDate</span> = (<span class="built_in">Get-Date</span>).AddMonths(-<span class="variable">$monthsToSubtract</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有子文件夹</span></span><br><span class="line"><span class="variable">$folders</span> = <span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="variable">$archivePath</span> <span class="literal">-Directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$folder</span> <span class="keyword">in</span> <span class="variable">$folders</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 获取文件夹的最后修改时间</span></span><br><span class="line">        <span class="variable">$folderLastWriteTime</span> = <span class="variable">$folder</span>.LastWriteTime</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查文件夹的最后修改时间是否早于限定日期</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$folderLastWriteTime</span> <span class="operator">-lt</span> <span class="variable">$limitDate</span>) &#123;</span><br><span class="line">            <span class="comment"># 删除早于指定月数前的文件夹及其内容</span></span><br><span class="line">            <span class="built_in">Remove-Item</span> <span class="literal">-Path</span> <span class="variable">$folder</span>.FullName <span class="literal">-Recurse</span> <span class="literal">-Force</span></span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;已删除: <span class="variable">$</span>(<span class="variable">$folder</span>.FullName)&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;删除文件夹时出错: <span class="variable">$</span>(<span class="variable">$folder</span>.Name)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="按照年份删除"><a href="#按照年份删除" class="headerlink" title="按照年份删除"></a>按照年份删除</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#按照年删除</span></span><br><span class="line"><span class="comment"># 设置要检查的目录</span></span><br><span class="line"><span class="variable">$archivePath</span> = <span class="string">&quot;C:\arch&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前日期，并减去一年，以确定删除的界限</span></span><br><span class="line"><span class="variable">$limitDate</span> = (<span class="built_in">Get-Date</span>).AddYears(<span class="literal">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有子文件夹</span></span><br><span class="line"><span class="variable">$folders</span> = <span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="variable">$archivePath</span> <span class="literal">-Directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$folder</span> <span class="keyword">in</span> <span class="variable">$folders</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 获取文件夹的最后修改时间</span></span><br><span class="line">        <span class="variable">$folderLastWriteTime</span> = <span class="variable">$folder</span>.LastWriteTime</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查文件夹的最后修改时间是否早于限定日期</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$folderLastWriteTime</span> <span class="operator">-lt</span> <span class="variable">$limitDate</span>) &#123;</span><br><span class="line">            <span class="comment"># 删除早于一年前的文件夹及其内容</span></span><br><span class="line">            <span class="built_in">Remove-Item</span> <span class="literal">-Path</span> <span class="variable">$folder</span>.FullName <span class="literal">-Recurse</span> <span class="literal">-Force</span></span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;已删除: <span class="variable">$</span>(<span class="variable">$folder</span>.FullName)&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;删除文件夹时出错: <span class="variable">$</span>(<span class="variable">$folder</span>.Name)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改文件的修改时间"><a href="#修改文件的修改时间" class="headerlink" title="修改文件的修改时间"></a>修改文件的修改时间</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定要检查的根目录</span></span><br><span class="line"><span class="variable">$rootPath</span> = <span class="string">&quot;C:\arch&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定新的修改时间</span></span><br><span class="line"><span class="variable">$newModificationTime</span> = <span class="built_in">Get-Date</span> <span class="string">&quot;2023-06-25 10:00:00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个递归函数来更新目录和文件的修改时间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Update-ModificationTime</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span> (</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$path</span>,</span><br><span class="line">        [<span class="built_in">datetime</span>]<span class="variable">$newTime</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 修改当前目录的修改时间</span></span><br><span class="line">        (<span class="built_in">Get-Item</span> <span class="variable">$path</span>).LastWriteTime = <span class="variable">$newTime</span></span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;目录的修改时间已更新: <span class="variable">$path</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改当前目录下所有文件和子目录的修改时间</span></span><br><span class="line">        <span class="variable">$items</span> = <span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="variable">$path</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$items</span>) &#123;</span><br><span class="line">            (<span class="built_in">Get-Item</span> <span class="variable">$item</span>.FullName).LastWriteTime = <span class="variable">$newTime</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$item</span>.PSIsContainer) &#123;</span><br><span class="line">                <span class="comment"># 递归调用函数修改子目录的修改时间</span></span><br><span class="line">                <span class="built_in">Update-ModificationTime</span> <span class="literal">-path</span> <span class="variable">$item</span>.FullName <span class="literal">-newTime</span> <span class="variable">$newTime</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">Write-Output</span> <span class="string">&quot;文件的修改时间已更新: <span class="variable">$</span>(<span class="variable">$item</span>.FullName)&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;修改 <span class="variable">$path</span> 的时间时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始更新根目录下的所有目录和文件的修改时间</span></span><br><span class="line"><span class="built_in">Update-ModificationTime</span> <span class="literal">-path</span> <span class="variable">$rootPath</span> <span class="literal">-newTime</span> <span class="variable">$newModificationTime</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">删除指定时间以前的文件</summary>
    
    
    
    <category term="WinServer" scheme="http://example.com/categories/WinServer/"/>
    
    
    <category term="WinServer" scheme="http://example.com/tags/WinServer/"/>
    
  </entry>
  
  <entry>
    <title>Python对表格列文本比对</title>
    <link href="http://example.com/2024/04/05/python%E8%A1%A8%E6%A0%BC%E5%88%97%E6%96%87%E6%9C%AC%E5%AF%B9%E6%AF%94/"/>
    <id>http://example.com/2024/04/05/python%E8%A1%A8%E6%A0%BC%E5%88%97%E6%96%87%E6%9C%AC%E5%AF%B9%E6%AF%94/</id>
    <published>2024-04-05T01:25:00.000Z</published>
    <updated>2024-05-27T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python对表格列文本比对"><a href="#Python对表格列文本比对" class="headerlink" title="Python对表格列文本比对"></a>Python对表格列文本比对</h2><h3 id="对比前两列"><a href="#对比前两列" class="headerlink" title="对比前两列"></a>对比前两列</h3><ul><li>并重新排序第二列的顺序与第一列相同</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment">#表格文件格式为第一列数据多，第二列数据少为宜，最后看1、4两列就行</span></span><br><span class="line"><span class="comment"># 读取表格数据</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;feixing.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设第一行就是列名，提取第一和第四列的列名</span></span><br><span class="line">first_column_name = df.columns[<span class="number">0</span>]</span><br><span class="line">second_column_name = df.columns[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取第一列和第二列数据</span></span><br><span class="line">first_column = df[first_column_name]</span><br><span class="line">second_column = df[second_column_name].tolist()  <span class="comment"># 将Pandas序列转为Python的列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化空的新列（相当于第三列）和调整后的第二列</span></span><br><span class="line">duplicates = []</span><br><span class="line">adjusted_second_column = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> first_column:</span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">in</span> second_column:</span><br><span class="line">        <span class="comment"># 找到第二列中相同值的索引，并添加到调整后的第二列</span></span><br><span class="line">        index = second_column.index(value)</span><br><span class="line">        adjusted_second_column.append(second_column[index])</span><br><span class="line">        <span class="keyword">del</span> second_column[index]  <span class="comment"># 删除该元素防止重复计算</span></span><br><span class="line">        duplicates.append(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        duplicates.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        adjusted_second_column.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将剩下的second_column的元素添加到adjusted_second_column列表的末尾</span></span><br><span class="line">adjusted_second_column += second_column</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将重复的资产编号（相当于新的第三列）写入DataFrame</span></span><br><span class="line">df[<span class="string">&#x27;重复值&#x27;</span>] = duplicates</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的Series来存储调整后的第二列数据</span></span><br><span class="line">adjusted_second_series = pd.Series(adjusted_second_column)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将调整后的第二列添加到DataFrame中，列名为“mod_”与原第二列名字的格式</span></span><br><span class="line">df[<span class="string">&#x27;mod_&#x27;</span> + second_column_name] = adjusted_second_series</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存修改后的表格</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;修改后的表格文件.xlsx&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h3 id="多列信息对比填充"><a href="#多列信息对比填充" class="headerlink" title="多列信息对比填充"></a>多列信息对比填充</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取表格数据，一般第一列是需要填充的信息，二三四列是一一对应的信息，最后看五六列，列数可以自行调整</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;1.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动获取前四列的列名</span></span><br><span class="line">col_1, col_2, col_3, col_4 = df.columns[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个字典，将第二列的标识符作为键，第三和第四列的组合作为值</span></span><br><span class="line">identifier_to_info = &#123;k: (v1, v2) <span class="keyword">for</span> k, v1, v2 <span class="keyword">in</span> <span class="built_in">zip</span>(df[col_2], df[col_3], df[col_4])&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化用于存放匹配到的第三和第四列信息的列表</span></span><br><span class="line">info_column = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> df[col_1]:</span><br><span class="line">    <span class="comment"># 在字典中查找对应的第三和第四列信息</span></span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">in</span> identifier_to_info:</span><br><span class="line">        <span class="comment"># 如果找到了匹配，将信息添加到列表中</span></span><br><span class="line">        info_column.append(identifier_to_info[value])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果没有找到匹配，添加空信息</span></span><br><span class="line">        info_column.append((<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据提供的信息自动给第五列和第六列生成列名（示例）</span></span><br><span class="line">new_col_5_name = <span class="string">&#x27;&#123;&#125;的信息&#x27;</span>.<span class="built_in">format</span>(col_3) <span class="comment"># 例如：&quot;第三列的信息&quot;</span></span><br><span class="line">new_col_6_name = <span class="string">&#x27;&#123;&#125;的细节&#x27;</span>.<span class="built_in">format</span>(col_4) <span class="comment"># 例如：&quot;第四列的细节&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表转换为DataFrame的两列，并使用生成的列名</span></span><br><span class="line">df[new_col_5_name], df[new_col_6_name] = <span class="built_in">zip</span>(*info_column)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存修改后的表格</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;修改后的表格文件.xlsx&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h3 id="输出两列的差异数据"><a href="#输出两列的差异数据" class="headerlink" title="输出两列的差异数据"></a>输出两列的差异数据</h3><h4 id="存在于第二列但不在第一列"><a href="#存在于第二列但不在第一列" class="headerlink" title="存在于第二列但不在第一列"></a>存在于第二列但不在第一列</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Excel文件</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;2.xlsx&#x27;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)  <span class="comment"># 假设输入文件名为input.xlsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将第一列和第二列的值分别转为集合</span></span><br><span class="line">set_column1 = <span class="built_in">set</span>(df[<span class="string">&#x27;Column1&#x27;</span>].dropna())</span><br><span class="line">set_column2 = <span class="built_in">set</span>(df[<span class="string">&#x27;Column2&#x27;</span>].dropna())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算第二列独有的元素</span></span><br><span class="line">unique_to_column2 = <span class="built_in">list</span>(set_column2 - set_column1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空列表来存储输出结果</span></span><br><span class="line">difference = [<span class="literal">None</span>] * <span class="built_in">len</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充存在于第二列但不在第一列的值到difference列表中</span></span><br><span class="line"><span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(df[<span class="string">&#x27;Column2&#x27;</span>]):</span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">in</span> unique_to_column2:</span><br><span class="line">        difference[i] = item</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将difference列表添加为新列到DataFrame中</span></span><br><span class="line">df[<span class="string">&#x27;Difference&#x27;</span>] = difference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将修改后的DataFrame写入新的Excel文件</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;output.xlsx&#x27;</span>, index=<span class="literal">False</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="存在于第一列但不在第二列"><a href="#存在于第一列但不在第二列" class="headerlink" title="存在于第一列但不在第二列"></a>存在于第一列但不在第二列</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Excel文件</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;2.xlsx&#x27;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)  <span class="comment"># 假设输入文件名为input.xlsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将第一列和第二列的值分别转为集合</span></span><br><span class="line">set_column1 = <span class="built_in">set</span>(df[<span class="string">&#x27;Column1&#x27;</span>].dropna())</span><br><span class="line">set_column2 = <span class="built_in">set</span>(df[<span class="string">&#x27;Column2&#x27;</span>].dropna())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算第一列独有的元素</span></span><br><span class="line">unique_to_column1 = <span class="built_in">list</span>(set_column1 - set_column2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空列表来存储输出结果</span></span><br><span class="line">difference = [<span class="literal">None</span>] * <span class="built_in">len</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充存在于第一列但不在第二列的值到difference列表中</span></span><br><span class="line"><span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(df[<span class="string">&#x27;Column1&#x27;</span>]):</span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">in</span> unique_to_column1:</span><br><span class="line">        difference[i] = item</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将difference列表添加为新列到DataFrame中</span></span><br><span class="line">df[<span class="string">&#x27;Difference&#x27;</span>] = difference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将修改后的DataFrame写入新的Excel文件</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;output.xlsx&#x27;</span>, index=<span class="literal">False</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">用来比对表格文件列文本并调整顺序的Python脚本</summary>
    
    
    
    <category term="Python脚本" scheme="http://example.com/categories/Python%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Python脚本" scheme="http://example.com/tags/Python%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>查看进程ps top</title>
    <link href="http://example.com/2024/03/25/14.%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8Bps,top/"/>
    <id>http://example.com/2024/03/25/14.%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8Bps,top/</id>
    <published>2024-03-25T01:25:00.000Z</published>
    <updated>2024-03-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="查看进程ps-top"><a href="#查看进程ps-top" class="headerlink" title="查看进程ps top"></a>查看进程ps top</h3><h4 id="ps-静态查看进程"><a href="#ps-静态查看进程" class="headerlink" title="ps 静态查看进程"></a>ps 静态查看进程</h4><p>ps命令就是最基本进程查看命令。使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵尸、哪些进程占用了过多的资源等等。总之大部分信息都是可以通过执行该命令得到。ps是显示瞬间进程的状态，并不动态连续；如果想对进程进行实时监控应该用top命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">    -A ：所有的进程均显示出来，与 -e 具有同样的效用；</span><br><span class="line">    -a ： 显示现行终端机下的所有进程，包括其他用户的进程；</span><br><span class="line">    -u ：以用户为主的进程状态 ；</span><br><span class="line">     x：通常与a这个参数一起使用，可列出较完整信息。</span><br><span class="line">    -w 显示加宽可以显示较多的资讯 </span><br><span class="line">    -au 显示较详细的资讯 </span><br><span class="line">    -aux 显示所有包含其他使用者的行程</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">常用组合：aux</span><br><span class="line">u：以用户为中心组织进程状态信息显示</span><br><span class="line">a：与终端相关的进程；</span><br><span class="line">x：与终端无关的进程；</span><br></pre></td></tr></table></figure><p>au(x) 输出格式 :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@zhangjian ~]#ps aux</span><br><span class="line">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND </span><br><span class="line">USER: 行程拥有者 </span><br><span class="line">PID:进程ID</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">CPU: 占用的 CPU 使用率</span> </span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">MEM: 占用的记忆体(内存)使用率</span> </span><br><span class="line">VSZ: Virtual memory SiZe 虚拟内存集 </span><br><span class="line">RSS: ReSident Size 常驻内存集———其他的都可以放入交换内存中</span><br><span class="line">TTY: 终端的次要装置号码 (minor device number of tty) </span><br><span class="line">STAT: 该行程的状态: </span><br><span class="line">  D: 不可中断的静止 </span><br><span class="line">  R: 正在执行中 </span><br><span class="line">  S: 静止状态 </span><br><span class="line">  T: 暂停执行 </span><br><span class="line">  Z: 不存在但暂时无法消除（僵尸）</span><br><span class="line">      +：前台进程</span><br><span class="line">      l：多线程进程</span><br><span class="line">      N：低优先级进程</span><br><span class="line">      &lt;：高优先级进程</span><br><span class="line">      s：session leader</span><br><span class="line">  X 死掉的进程</span><br><span class="line">  Ss s进程的领导者，父进程</span><br><span class="line">  S&lt; &lt;优先级较高的进程</span><br><span class="line">  SN N优先级较低的进程</span><br><span class="line">  R+ +表示是前台的进程组</span><br><span class="line">  Sl 以线程的方式运行</span><br><span class="line">W: 没有足够的记忆体分页可分配 </span><br><span class="line">L: 有记忆体分页分配并锁在记忆体内 (即时系统或捱A I/O) </span><br><span class="line">START: 行程开始时间 </span><br><span class="line">TIME: 运行占据cpu的累积时长</span><br><span class="line">COMMAND:由哪个命令来启动的相关进程</span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line">常用组合：ps -ef</span><br><span class="line">[root@zhangjian ~]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">-e：显示所有进程</span><br><span class="line">-f：显示完整格式程序信息</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">常用组合：ps -eFH</span><br><span class="line">[root@zhangjian ~]# ps -eFH</span><br><span class="line">UID        PID  PPID  C    SZ   RSS PSR STIME TTY          TIME CMD</span><br><span class="line">-F：显示完成格式的进程信息</span><br><span class="line">-H：以进程层级格式显示进程相关信息</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">常用组合：eo，axo</span><br><span class="line">自定义想要查询的字段值</span><br><span class="line">-eo pid,tid,class,rtprio,ni,pri,psr,pcpu,stat,wchan:14,comm</span><br><span class="line">-axo pid,tid,class,rtprio,ni,pri,psr,pcpu,stat,wcha n:14,comm</span><br><span class="line">ni：nice值</span><br><span class="line">pri：priority，优先级</span><br><span class="line">psr：processor，CPU</span><br><span class="line">rtprio：实时优先级</span><br></pre></td></tr></table></figure><h4 id="ps例子："><a href="#ps例子：" class="headerlink" title="ps例子："></a>ps例子：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhangjian ~]# ps aux --sort %cpu |less # 按照CPU使用率排序,递增</span><br><span class="line">[root@zhangjian ~]# ps aux --sort -%cpu |less #递减</span><br><span class="line"></span><br><span class="line">[root@zhangjian ~]# ps aux --sort rss |less  #按照实际内存使用率排序递增</span><br><span class="line">[root@zhangjian ~]# ps aux --sort -rss |less递减</span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">[root@zhangjian ~]# yum -y install httpd</span><br><span class="line">[root@zhangjian ~]# systemctl start httpd</span><br><span class="line">[root@zhangjian ~]# ps auxf |grep httpd # 按照父子进程层级显示</span><br></pre></td></tr></table></figure><p>自定义显示字段</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhangjian ~]# ps axo user,pid,ppid,%mem,%cpu,command --sort -%cpu |less </span><br></pre></td></tr></table></figure><p>查看指定进程的PID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhangjian ~]# cat /run/sshd.pid</span><br><span class="line">[root@zhangjian ~]# ps aux |grep sshd</span><br><span class="line">[root@zhangjian ~]# pgrep -l sshd</span><br><span class="line">[root@zhangjian ~]# pidof sshd</span><br></pre></td></tr></table></figure><p>查看进程树</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y psmisc</span><br><span class="line">[root@zhangjian ~]# pstree </span><br></pre></td></tr></table></figure><h4 id="注：ps-aux与ps-aux的区别"><a href="#注：ps-aux与ps-aux的区别" class="headerlink" title="注：ps aux与ps -aux的区别"></a>注：ps aux与ps -aux的区别</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请注意&quot;ps -aux&quot;不同于&quot;ps aux&quot;。POSIX和UNIX的标准要求&quot;ps -aux&quot;打印用户名为&quot;x&quot;的用户的所有进程，以及打印所有将由-a选项选择的过程。如果用户名为&quot;x&quot;不存在，ps的将会解释为&quot;ps aux&quot;，而且会打印一个警告。这种行为是为了帮助转换旧脚本和习惯。它是脆弱的，即将更改，因此不应依赖。综上，直接选择使用*aux*。</span><br></pre></td></tr></table></figure><h3 id="top-实时显示进程"><a href="#top-实时显示进程" class="headerlink" title="top 实时显示进程"></a>top 实时显示进程</h3><p><strong>动态显示系统相关资源的管理器，有点类似于windows当中的任务管理器。</strong>top是一个动态显示过程，即可以通过用户按键来不断刷新当前状态。如果在前台执行该命令，它将独占前台，直到用户终止该程序为止。比较准确的说，top命令提供了实时的对系统处理器的状态监视。它将显示系统中CPU最“敏感”的任务列表。该命令可以按CPU使用.内存使用和执行时间对任务进行排序；而且该命令的很多特性都可以通过交互式命令或者在个人定制文件中进行设定。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1．命令格式：</span><br><span class="line">top [参数]</span><br><span class="line">2．命令功能：</span><br><span class="line">显示当前系统正在执行的进程的相关信息，包括进程ID、内存占用率、CPU占用率等</span><br><span class="line">3．命令参数：</span><br><span class="line">-b 批处理</span><br><span class="line">-c 显示完整的治命令</span><br><span class="line">-I 忽略失效过程</span><br><span class="line">-s 保密模式</span><br><span class="line">-S 累积模式</span><br><span class="line">-i&lt;时间&gt; 设置间隔时间</span><br><span class="line">-u&lt;用户名&gt; 指定用户名</span><br><span class="line">-p&lt;进程号&gt; 指定进程</span><br><span class="line">-n&lt;次数&gt; 循环显示的次数</span><br></pre></td></tr></table></figure><h4 id="top显示信息详解"><a href="#top显示信息详解" class="headerlink" title="top显示信息详解"></a>top显示信息详解</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhangsan log]# top</span><br><span class="line">top - 14:06:23 up 70 days, 16:44,  2 users,  load average: 1.25, 1.32, 1.35</span><br><span class="line">Tasks: 206 total,   1 running, 205 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s):  5.9%us,  3.4%sy,  0.0%ni, 90.4%id,  0.0%wa,  0.0%hi,  0.2%si,  0.0%st</span><br><span class="line">Mem:  32949016k total, 14411180k used, 18537836k free,   169884k buffers</span><br><span class="line">Swap: 32764556k total,        0k used, 32764556k free,  3612636k cached</span><br><span class="line"></span><br><span class="line"> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND     </span><br></pre></td></tr></table></figure><h5 id="统计信息区"><a href="#统计信息区" class="headerlink" title="统计信息区"></a>统计信息区</h5><p>前五行是当前系统情况整体的统计信息区。下面我们看每一行信息的具体意义。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">第1行：系统时间、运行时间、登录终端数、系统负载（三个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低）。</span><br><span class="line">14:06:23 — 当前系统时间</span><br><span class="line">up 70 days, 16:44 — 系统已经运行了70天16小时44分钟（在这期间系统没有重启过的吆！）</span><br><span class="line">2 users — 当前有2个用户登录系统</span><br><span class="line">load average: 1.15, 1.42, 1.44 — load average后面的三个数分别是1分钟、5分钟、15分钟的负载情况。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。</span></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第2行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数。</span><br><span class="line">系统现在共有206个进程，其中处于运行中的有1个，205个在休眠（sleep），stoped状态的有0个，zombie状态（僵尸）的有0个。</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第3行：cpu状态信息:用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的资源百分比等。</span><br><span class="line">5.9%us — 用户空间占用CPU的百分比。</span><br><span class="line">3.4% sy — 内核空间占用CPU的百分比。</span><br><span class="line">0.0% ni — 改变过优先级的进程占用CPU的百分比</span><br><span class="line">90.4% id — 空闲CPU百分比</span><br><span class="line">0.0% wa — IO等待占用CPU的百分比</span><br><span class="line">0.0% hi — 硬中断（Hardware IRQ）占用CPU的百分比</span><br><span class="line">0.2% si — 软中断（Software Interrupts）占用CPU的百分比</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在这里CPU的使用比率和windows概念不同，需要理解linux系统用户空间和内核空间的相关知识</span></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第4行：内存状态:物理内存总量、内存使用量、内存空闲量、作为内核缓存的内存量。（buffer和cache之间的区别，cache是提高cpu和内存之间的数据交换速度，buffer是io设备和存储设备之间的缓冲区）</span><br><span class="line">32949016k total — 物理内存总量（32GB）</span><br><span class="line">14411180k used — 使用中的内存总量（14GB）</span><br><span class="line">18537836k free — 空闲内存总量（18GB）</span><br><span class="line">169884k buffers — 缓存的内存量 （169M）</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第5行：swap交换分区信息:虚拟内存总量、虚拟内存使用量、虚拟内存空闲量、已被提前加载的内存量。</span><br><span class="line">32764556k total — 交换区总量（32GB）</span><br><span class="line">0k used — 使用的交换区总量（0K）</span><br><span class="line">32764556k free — 空闲交换区总量（32GB）</span><br><span class="line">3612636k cached — 缓冲的交换区总量（3.6GB）</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果出于习惯去计算可用内存数，这里有个近似的计算公式：第四行的free + 第四行的buffers + 第五行的cached，按这个公式此台服务器的可用内存：18537836k +169884k +3612636k = 22GB左右。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。</span></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第六行，空行。</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">第七行以下：各进程（任务）的状态监控，项目列信息说明如下：</span><br><span class="line">PID — 进程id</span><br><span class="line">USER — 进程所有者</span><br><span class="line">PR — 进程优先级</span><br><span class="line">NI — nice值。负值表示高优先级，正值表示低优先级</span><br><span class="line">VIRT — 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES</span><br><span class="line">RES — 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA</span><br><span class="line">SHR — 共享内存大小，单位kb</span><br><span class="line">S — 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">CPU — 上次更新到现在的CPU时间占用百分比</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">MEM — 进程使用的物理内存百分比</span></span><br><span class="line">TIME+ — 进程使用的CPU时间总计，单位1/100秒</span><br><span class="line">COMMAND — 进程名称（命令名/命令行）</span><br></pre></td></tr></table></figure><h4 id="top交互命令"><a href="#top交互命令" class="headerlink" title="top交互命令"></a>top交互命令</h4><p>在top 命令执行过程中可以使用的一些交互命令。这些命令都是单字母的，如果在命令行中使用了s 选项， 其中一些命令可能会被屏蔽。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">h 显示帮助画面，给出一些简短的命令总结说明</span><br><span class="line">k 终止一个进程。</span><br><span class="line">i 忽略闲置和僵死进程。这是一个开关式命令。</span><br><span class="line">q 退出程序</span><br><span class="line">r 重新安排一个进程的优先级别</span><br><span class="line">S 切换到累计模式</span><br><span class="line">s 改变两次刷新之间的延迟时间（单位为s），如果有小数，就换算成m s。输入0值则系统将不断刷新，默认值是5 s</span><br><span class="line">f或者F 从当前显示中添加或者删除项目</span><br><span class="line">o或者O 改变显示项目的顺序</span><br><span class="line">l 切换显示平均负载和启动时间信息</span><br><span class="line">m 切换显示内存信息</span><br><span class="line">t 切换显示进程和CPU状态信息</span><br><span class="line">c 切换显示命令名称和完整命令行</span><br><span class="line">M 根据驻留内存大小进行排序</span><br><span class="line">P 根据CPU使用百分比大小进行排序</span><br><span class="line">T 根据时间/累计时间进行排序</span><br><span class="line">W 将当前设置写入~/.toprc文件中 </span><br><span class="line">N 以PID的大小排序</span><br><span class="line">R 对排序进行反转</span><br><span class="line">f 自定义显示字段</span><br><span class="line">1 显示所有CPU的负载</span><br><span class="line">&lt; 向前</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">向后</span></span><br><span class="line">z 彩色</span><br></pre></td></tr></table></figure><h4 id="top实例"><a href="#top实例" class="headerlink" title="top实例"></a>top实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top -d 1  #显示进程信息，每个1秒钟刷新一次</span><br><span class="line"></span><br><span class="line">top -p 7097 #显示指定的进程信息</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux查看进程</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>iptables常用命令</title>
    <link href="http://example.com/2024/03/25/iptables%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/"/>
    <id>http://example.com/2024/03/25/iptables%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/</id>
    <published>2024-03-25T01:25:00.000Z</published>
    <updated>2024-03-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="iptables常用命令"><a href="#iptables常用命令" class="headerlink" title="iptables常用命令"></a>iptables常用命令</h1><h3 id="iptables简介"><a href="#iptables简介" class="headerlink" title="iptables简介"></a>iptables简介</h3><p><code>iptables</code> 是一个在 <code>Linux</code> 操作系统上用于配置 <code>IPv4</code> 数据包过滤规则的工具。它允许系统管理员控制数据包如何流经网络接口，可以用于设置防火墙规则、网络地址转换（<code>NAT</code>）以及数据包审计等功能。通过配置 <code>iptables</code>，管理员可以定义允许或拒绝特定类型的流量通过服务器，从而增强网络安全性，并实现网络流量的控制和管理。iptables 非常灵活，可以根据网络包的源地址、目标地址、端口号等多种条件进行过滤和转发</p><ul><li>iptables语法构成:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t 表名  链名 条件  -j  控制类型</span><br><span class="line"><span class="comment">#不指定表名时，默认指filter表</span></span><br><span class="line"><span class="comment">#不指定链名时，默认指表内的所有链</span></span><br><span class="line"><span class="comment">#除非设置链的默认策略，否则必须指定匹配条件#选项、链名、控制类型使用大写字母，其余均为小写字母</span></span><br></pre></td></tr></table></figure><ul><li>常见动作类型：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ACCEPT:允许通过</span><br><span class="line">DROP:直接丢弃，不给出任何回应</span><br><span class="line">REJECT:拒绝通过，必要时会给出提示</span><br><span class="line">LOG:记录日志信息，然后传给下一条规则继续匹配</span><br><span class="line">SNAT:修改数据包源地址</span><br><span class="line">DNAT：修改数据包目的地址</span><br><span class="line">EDIRECT:重定向</span><br></pre></td></tr></table></figure><ul><li>常见通用匹配条件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">协议匹配：-p  协议名</span><br><span class="line">地址匹配：-s 源地址、-d目的地址</span><br><span class="line">接口匹配：-i 入站网卡、-o出站网卡</span><br></pre></td></tr></table></figure><h3 id="实用例子"><a href="#实用例子" class="headerlink" title="实用例子"></a>实用例子</h3><p>1）查询当前规则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/20240730153900.png" style="zoom:67%;" /><p>2）创建自定义链路表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -N my-rule</span><br><span class="line"></span><br><span class="line"><span class="comment">#再用iptables -nvL查一下，就出现了</span></span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240730154249164.png" alt="image-20240730154249164"></p><p>3）在添加的自定义链路中写入规则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许源地址为192.168.10.6的用户访问我的22端口</span></span><br><span class="line">iptables -A my-rule -s 192.168.10.6 -p tcp --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#拒绝访问22端口</span></span><br><span class="line">iptables -A my-rule  -p tcp --dport 22 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#在入口流量方向调用自定义防火墙链路表</span></span><br><span class="line">iptables -A INPUT -j my-rule</span><br></pre></td></tr></table></figure><blockquote><p>在另一台主机远程连接测试效果,只允许192.168.10.6进行访问，其他客户端向22端口发起的连接都会被拒绝掉</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]<span class="comment"># ssh root@192.168.10.39</span></span><br><span class="line">ssh: connect to host 192.168.10.39 port 22: Connection timed out</span><br></pre></td></tr></table></figure><p>4）删除规则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL --line-number</span><br><span class="line"><span class="comment">#删除my-rule表中序号为2的规则iptables -D my-rule 2</span></span><br></pre></td></tr></table></figure><p>5）丢弃请求与拒绝请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当用户访问80端口时直接将请求丢弃</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j DROP</span><br></pre></td></tr></table></figure><p>由于是直接把请求丢弃，直到超时才会回显失败信息</p><p>配置规则为拒绝</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j REJECT</span><br></pre></td></tr></table></figure><p>此时在客户端进行访问时会立即得到拒绝连接的回显</p><p>6）允许主机通过icmp协议访问其他设备，但是其他设备不能通过icmp访问我</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type 3 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icmp -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见ICMP消息类型</span></span><br><span class="line">Echo Request (Type 8)：用于发送请求并等待 Echo Reply 响应。</span><br><span class="line">Echo Reply (Type 0)：对 Echo Request 进行回应。</span><br><span class="line">Destination Unreachable (Type 3)：目的地不可达的报文类型，包括以下子类型：</span><br><span class="line">Network Unreachable (Code 0)：目标网络不可达。</span><br><span class="line">Host Unreachable (Code 1)：目标主机不可达。</span><br><span class="line">Protocol Unreachable (Code 2)：目标协议不可达。</span><br><span class="line">Port Unreachable (Code 3)：目标端口不可达。</span><br><span class="line">Fragmentation Needed and Don<span class="string">&#x27;t Fragment was Set (Code 4)：需要进行分片但不允许分片。</span></span><br><span class="line"><span class="string">Source Route Failed (Code 5)：源路由失败。</span></span><br><span class="line"><span class="string">Redirect (Type 5)：重定向报文类型，用于告诉发送方其路由表中的一个更佳路径。</span></span><br><span class="line"><span class="string">Time Exceeded (Type 11)：超时报文类型，包括以下子类型：</span></span><br><span class="line"><span class="string">Time to Live Exceeded in Transit (Code 0)：传输过程中的 TTL（Time to Live）超时。</span></span><br><span class="line"><span class="string">Fragment Reassembly Time Exceeded (Code 1)：分片重组超时。</span></span><br><span class="line"><span class="string">Parameter Problem (Type 12)：参数问题报文类型，用于指示 IP 报文头部的问题。</span></span><br></pre></td></tr></table></figure><p>7）批量放行或拒绝多个端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-m multiport 表示启用多端口匹配模块，以便可以匹配多个目的端口</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dport 20,21,80 -j DROP</span><br></pre></td></tr></table></figure><p>8）批量放行或拒绝一个连续的IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-m iprange 表示使用 iprange 模块进行 IP 范围匹配。</span></span><br><span class="line">iptables -I INPUT -m iprange --src-range 192.168.10.1-192.168.10.100 -j ACCEPT</span><br></pre></td></tr></table></figure><p>9）针对mac地址做限制</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-m mac 表示使用 mac 模块进行 MAC 地址匹配</span></span><br><span class="line">iptables -I INPUT -m mac --mac-source 00:0c:29:ac:77:f5 -j DROP</span><br></pre></td></tr></table></figure><p>10）连接状态匹配</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NEW：新建连接。</span><br><span class="line">ESTABLISHED：已建立连接。</span><br><span class="line">RELATED：与已建立连接相关的数据包，如 FTP 数据传输过程中的控制连接和数据连接。</span><br><span class="line">INVALID：无效的数据包，无法被识别为任何已知连接状态的数据包。</span><br><span class="line">UNTRACKED：未被追踪的数据包。</span><br></pre></td></tr></table></figure><blockquote><p>放行已建立的连接，丢弃新连接</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-I 从最上方插入规则，-A 从最下方插入规则</span></span><br><span class="line">iptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -j DROP</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">iptables常用命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>install_redis</title>
    <link href="http://example.com/2024/03/25/%E5%AE%89%E8%A3%85redis%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/25/%E5%AE%89%E8%A3%85redis%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-25T01:25:00.000Z</published>
    <updated>2024-03-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">VERSION=redis-6.2.9</span><br><span class="line">PASSWORD=123456</span><br><span class="line">INSTALL_DIR=/opt/app/redis</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">color</span></span>() &#123;</span><br><span class="line">    RES_COL=60</span><br><span class="line">    MOVE_TO_COL=<span class="string">&quot;echo -en \\033[<span class="variable">$&#123;RES_COL&#125;</span>G&quot;</span></span><br><span class="line">    SETCOLOR_SUCCESS=<span class="string">&quot;echo -en \\033[1;32m&quot;</span></span><br><span class="line">    SETCOLOR_FAILURE=<span class="string">&quot;echo -en \\033[1;31m&quot;</span></span><br><span class="line">    SETCOLOR_WARNING=<span class="string">&quot;echo -en \\033[1;33m&quot;</span></span><br><span class="line">    SETCOLOR_NORMAL=<span class="string">&quot;echo -en \E[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&amp; <span class="variable">$MOVE_TO_COL</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;[&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> = <span class="string">&quot;success&quot;</span> -o <span class="string">&quot;<span class="variable">$2</span>&quot;</span> = <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_SUCCESS&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot;  OK  &quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> = <span class="string">&quot;failure&quot;</span> -o <span class="string">&quot;<span class="variable">$2</span>&quot;</span> = <span class="string">&quot;1&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_FAILURE&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot;FAILED&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_WARNING&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot;WARNING&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;SETCOLOR_NORMAL&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;]&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_dependencies</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        yum -y install gcc jemalloc-devel tar wget || &#123; color <span class="string">&quot;安装软件包失败，请检查网络配置&quot;</span> 1; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">command</span> -v apt-get &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        apt-get update</span><br><span class="line">        apt-get -y install gcc libjemalloc-dev make wget tar || &#123; color <span class="string">&quot;安装软件包失败，请检查网络配置&quot;</span> 1; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        color <span class="string">&quot;不支持的系统类型&quot;</span> 1</span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">download_redis</span></span>() &#123;</span><br><span class="line">    wget http://download.redis.io/releases/<span class="variable">$&#123;VERSION&#125;</span>.tar.gz || &#123; color <span class="string">&quot;Redis 源码下载失败&quot;</span> 1; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    tar xf <span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;VERSION&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">compile_redis</span></span>() &#123;</span><br><span class="line">    make -j 2 PREFIX=<span class="variable">$&#123;INSTALL_DIR&#125;</span> install &amp;&amp; color <span class="string">&quot;Redis 编译安装完成&quot;</span> 0 || &#123; color <span class="string">&quot;Redis 编译安装失败&quot;</span> 1; <span class="built_in">exit</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$&#123;INSTALL_DIR&#125;</span>/bin/redis-* /usr/bin/</span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="variable">$&#123;INSTALL_DIR&#125;</span>/&#123;etc,<span class="built_in">log</span>,data,run&#125;</span><br><span class="line">    <span class="built_in">cp</span> redis.conf <span class="variable">$&#123;INSTALL_DIR&#125;</span>/etc/</span><br><span class="line"></span><br><span class="line">    sed -i -e <span class="string">&#x27;s/bind 127.0.0.1/bind 0.0.0.0/&#x27;</span> \</span><br><span class="line">           -e <span class="string">&quot;/# requirepass/a requirepass <span class="variable">$PASSWORD</span>&quot;</span> \</span><br><span class="line">           -e <span class="string">&quot;/^dir .*/c dir <span class="variable">$&#123;INSTALL_DIR&#125;</span>/data/&quot;</span> \</span><br><span class="line">           -e <span class="string">&quot;/logfile .*/c logfile <span class="variable">$&#123;INSTALL_DIR&#125;</span>/log/redis-6379.log&quot;</span> \</span><br><span class="line">           -e <span class="string">&quot;/^pidfile .*/c pidfile <span class="variable">$&#123;INSTALL_DIR&#125;</span>/run/redis_6379.pid&quot;</span> <span class="variable">$&#123;INSTALL_DIR&#125;</span>/etc/redis.conf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_redis_user</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span> redis &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        color <span class="string">&quot;Redis 用户已存在&quot;</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        useradd -r -s /sbin/nologin redis</span><br><span class="line">        color <span class="string">&quot;Redis 用户创建成功&quot;</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">chown</span> -R redis:redis <span class="variable">$&#123;INSTALL_DIR&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configure_system</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.core.somaxconn = 1024</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    sysctl -p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -f /etc/rc.d/rc.local ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27;</span> &gt;&gt; /etc/rc.d/rc.local</span><br><span class="line">        <span class="built_in">chmod</span> +x /etc/rc.d/rc.local</span><br><span class="line">        /etc/rc.d/rc.local</span><br><span class="line">    <span class="keyword">elif</span> [ -f /etc/rc.local ]; <span class="keyword">then</span></span><br><span class="line">        sed -i -e <span class="string">&#x27;$i echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled\n&#x27;</span> /etc/rc.local</span><br><span class="line">        <span class="built_in">chmod</span> +x /etc/rc.local</span><br><span class="line">        /etc/rc.local</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;#!/bin/bash&#x27;</span> &gt; /etc/rc.local</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27;</span> &gt;&gt; /etc/rc.local</span><br><span class="line">        <span class="built_in">chmod</span> +x /etc/rc.local</span><br><span class="line">        /etc/rc.local</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_service_file</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/systemd/system/redis.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Redis persistent key-value database</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=$&#123;INSTALL_DIR&#125;/bin/redis-server $&#123;INSTALL_DIR&#125;/etc/redis.conf --supervised systemd</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT \$MAINPID</span></span><br><span class="line"><span class="string">#Type=notify</span></span><br><span class="line"><span class="string">User=redis</span></span><br><span class="line"><span class="string">Group=redis</span></span><br><span class="line"><span class="string">RuntimeDirectory=redis</span></span><br><span class="line"><span class="string">RuntimeDirectoryMode=0755</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl <span class="built_in">enable</span> --now redis &amp;&gt; /dev/null &amp;&amp; color <span class="string">&quot;Redis 服务启动成功, Redis 信息如下:&quot;</span> 0 || &#123; color <span class="string">&quot;Redis 启动失败&quot;</span> 1; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="built_in">sleep</span> 2</span><br><span class="line">    redis-cli -a <span class="variable">$PASSWORD</span> INFO Server 2&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    install_dependencies</span><br><span class="line">    download_redis</span><br><span class="line">    compile_redis</span><br><span class="line">    create_redis_user</span><br><span class="line">    configure_system</span><br><span class="line">    create_service_file</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install_redis for centos 7/8/stream 8 &amp; ubuntu 18.04/20.04 &amp; Rocky 9</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>push_ssh_key</title>
    <link href="http://example.com/2024/03/20/push_ssh_key/"/>
    <id>http://example.com/2024/03/20/push_ssh_key/</id>
    <published>2024-03-20T01:25:00.000Z</published>
    <updated>2024-03-20T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="机器互信配置（同网段的机器密钥拷贝）"><a href="#机器互信配置（同网段的机器密钥拷贝）" class="headerlink" title="机器互信配置（同网段的机器密钥拷贝）"></a>机器互信配置（同网段的机器密钥拷贝）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment"># Description:   ssh_key for CentOS 7/8 &amp; Ubuntu 18.04/24.04 &amp; Rocky 9</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment"># 基于key验证多主机ssh互相访问</span></span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">PASS=1</span><br><span class="line"><span class="comment"># 设置网段最后的地址，4-255之间，越小扫描越快</span></span><br><span class="line">END=254</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动获取当前机器的网卡名称</span></span><br><span class="line">NIC=$(ip -o -4 a s | awk <span class="string">&#x27;!/ lo| docker0/ &#123;split($2, arr, &quot;\n&quot;); print arr[1]&#125;&#x27;</span> | <span class="built_in">head</span> -n1)</span><br><span class="line">IP=$(ip -o -4 a s <span class="variable">$NIC</span> | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> | <span class="built_in">cut</span> -d/ -f1)</span><br><span class="line">NET=<span class="variable">$&#123;IP%.*&#125;</span>.</span><br><span class="line"></span><br><span class="line">FAILED_IPS=()</span><br><span class="line">ALIVE_IPS=()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>() &#123;</span><br><span class="line">    OS_ID=$(sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_ping</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">command</span> -v ping &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;Rocky&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;安装ping包&quot;</span><span class="variable">$&#123;END&#125;</span>; yum -y install iputils &amp;&gt;/dev/null</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;安装ping包&quot;</span><span class="variable">$&#123;END&#125;</span>; apt -y install iputils-ping &amp;&gt;/dev/null</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ssh_key_push</span></span>() &#123;</span><br><span class="line">    <span class="built_in">rm</span> -f /root/.ssh/id_rsa</span><br><span class="line">    [ -e ./SCANIP.<span class="built_in">log</span> ] &amp;&amp; <span class="built_in">rm</span> -f SCANIP.<span class="built_in">log</span></span><br><span class="line">    <span class="built_in">touch</span> SCANIP.<span class="built_in">log</span> <span class="comment"># 确保文件存在</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Starting to ping IPs...&quot;</span></span><br><span class="line">    <span class="keyword">for</span> ((i = <span class="number">3</span>; i &lt;= END; i++)); <span class="keyword">do</span></span><br><span class="line">        ping -c 1 -w 1 <span class="variable">$&#123;NET&#125;</span><span class="variable">$&#123;i&#125;</span> &amp;&gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NET&#125;</span><span class="variable">$&#123;i&#125;</span>&quot;</span> &gt;&gt;SCANIP.<span class="built_in">log</span> &amp;</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">wait</span> <span class="comment"># 确保所有 ping 命令完成后再继续</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Ping scan completed. Here are the alive IPs:&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> SCANIP.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 确保 .ssh 目录存在</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p /root/.ssh</span><br><span class="line"></span><br><span class="line">    ssh-keygen -f /root/.ssh/id_rsa -P <span class="string">&#x27;&#x27;</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;Rocky&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        rpm -q sshpass &amp;&gt;/dev/null || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;安装sshpass软件包&quot;</span><span class="variable">$&#123;END&#125;</span>; yum -y install sshpass &amp;&gt;/dev/null; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        dpkg -S sshpass &amp;&gt;/dev/null || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;安装sshpass软件包&quot;</span><span class="variable">$&#123;END&#125;</span>; apt -y install sshpass &amp;&gt;/dev/null; &#125;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    ALIVE_IPS=($(<span class="built_in">cat</span> SCANIP.<span class="built_in">log</span>)) <span class="comment"># 读取刚刚创建的 SCANIP.log 文件</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;ALIVE_IPS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> sshpass -p <span class="variable">$PASS</span> ssh-copy-id -o StrictHostKeyChecking=no root@<span class="variable">$&#123;n&#125;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Successfully copied SSH key to <span class="variable">$&#123;n&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Permission denied for <span class="variable">$&#123;n&#125;</span>, skipping.&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            FAILED_IPS+=(<span class="variable">$n</span>)</span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把.ssh/known_hosts拷贝到所有主机，使它们第一次互相访问时不需要输入回车</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;ALIVE_IPS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [[ ! <span class="string">&quot; <span class="variable">$&#123;FAILED_IPS[@]&#125;</span> &quot;</span> =~ <span class="string">&quot; <span class="variable">$&#123;n&#125;</span> &quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> scp -o StrictHostKeyChecking=no /root/.ssh/known_hosts root@<span class="variable">$&#123;n&#125;</span>:.ssh/ &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Successfully copied known_hosts to <span class="variable">$&#123;n&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Permission denied for <span class="variable">$&#123;n&#125;</span>, skipping.&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">                FAILED_IPS+=(<span class="variable">$n</span>)</span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;#FAILED_IPS[@]&#125;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;以下机器因Permission denied而跳过:&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">for</span> ip <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;FAILED_IPS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$ip</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    os</span><br><span class="line">    check_ping</span><br><span class="line">    ssh_key_push</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">push ssh_key for CentOS 7/8 &amp; Ubuntu 18.04/24.04 &amp; Rocky 9</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>initialize_script</title>
    <link href="http://example.com/2024/03/16/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/16/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-16T01:25:00.000Z</published>
    <updated>2024-03-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="服务器初始化脚本"><a href="#服务器初始化脚本" class="headerlink" title="服务器初始化脚本"></a>服务器初始化脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#***************************************************************************************************</span></span><br><span class="line"><span class="comment">#Description:   reset for CentOS 7 &amp; CentOS Stream 8/9 &amp; Ubuntu 18.04/20.04/22.04 &amp; Rocky 8/9</span></span><br><span class="line"><span class="comment">#***************************************************************************************************</span></span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_NAME=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+) (.*)&quot;$@\2@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_RELEASE=`sed -rn <span class="string">&#x27;/^VERSION_ID=/s@.*=&quot;?([0-9.]+)&quot;?@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_RELEASE_VERSION=`sed -rn <span class="string">&#x27;/^VERSION_ID=/s@.*=&quot;?([0-9]+)\.?.*&quot;?@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_rocky_centos_eth</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;7&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        ETHNAME=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^2/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">        <span class="keyword">if</span> grep -Eqi <span class="string">&quot;(net\.ifnames|biosdevname)&quot;</span> /etc/default/grub;<span class="keyword">then</span></span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 网卡名配置文件已修改,不用修改!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># 修改网卡名称配置文件</span></span><br><span class="line">            sed -ri.bak <span class="string">&#x27;/^GRUB_CMDLINE_LINUX=/s@&quot;$@ net.ifnames=0 biosdevname=0&quot;@&#x27;</span> /etc/default/grub</span><br><span class="line">            grub2-mkconfig -o /boot/grub2/grub.cfg &gt;&amp; /dev/null</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 修改网卡文件名</span></span><br><span class="line">            <span class="built_in">mv</span> /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$&#123;ETHNAME&#125;</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 网卡名已修改成功，10秒后，机器会自动重启!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="built_in">sleep</span> 10 &amp;&amp; shutdown -r now</span><br><span class="line">        <span class="keyword">fi</span>   </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 不能修改网卡名!&quot;</span><span class="variable">$&#123;END&#125;</span> </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ubuntu_eth</span></span>()&#123;</span><br><span class="line">    <span class="comment">#修改网卡名称配置文件</span></span><br><span class="line"><span class="keyword">if</span> grep -Eqi <span class="string">&quot;(net\.ifnames|biosdevname)&quot;</span> /etc/default/grub;<span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 网卡名配置文件已修改,不用修改!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sed -ri.bak <span class="string">&#x27;/^GRUB_CMDLINE_LINUX=/s@&quot;$@net.ifnames=0 biosdevname=0&quot;@&#x27;</span> /etc/default/grub</span><br><span class="line">        grub-mkconfig -o /boot/grub/grub.cfg &gt;&amp; /dev/null</span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 网卡名已修改成功,请重新启动系统后才能生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_eth</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        set_rocky_centos_eth</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_ubuntu_eth</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_ip</span></span>()&#123;</span><br><span class="line">    <span class="built_in">local</span> IP=<span class="variable">$1</span></span><br><span class="line">    VALID_CHECK=$(<span class="built_in">echo</span> <span class="variable">$&#123;IP&#125;</span>|awk -F. <span class="string">&#x27;$1&lt;=255&amp;&amp;$2&lt;=255&amp;&amp;$3&lt;=255&amp;&amp;$4&lt;=255&#123;print &quot;yes&quot;&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">echo</span> <span class="variable">$&#123;IP&#125;</span>|grep -E <span class="string">&quot;^[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;$&quot;</span> &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;VALID_CHECK&#125;</span> == <span class="string">&quot;yes&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;IP <span class="variable">$&#123;IP&#125;</span>  available!&quot;</span></span><br><span class="line">            <span class="built_in">return</span> 0</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;IP <span class="variable">$&#123;IP&#125;</span> not available!&quot;</span></span><br><span class="line">            <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;IP format error!&quot;</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_rocky_centos_ip</span></span>()&#123;</span><br><span class="line">    ETHNAME=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^2/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">    CONNECTION_NAME=`nmcli dev | awk <span class="string">&#x27;NR==2&#123;print $4,$5,$6&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入IP地址: &quot;</span> IP</span><br><span class="line">        check_ip <span class="variable">$&#123;IP&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> C_PREFIX</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入网关地址: &quot;</span> GATEWAY</span><br><span class="line">        check_ip <span class="variable">$&#123;GATEWAY&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;7&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        nmcli connection modify <span class="string">&quot;<span class="variable">$&#123;CONNECTION_NAME&#125;</span>&quot;</span> con-name <span class="variable">$&#123;ETHNAME&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/sysconfig/network-scripts/ifcfg-eth0 &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">NAME=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">DEVICE=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BOOTPROTO=none</span></span><br><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">IPADDR=$&#123;IP&#125;</span></span><br><span class="line"><span class="string">PREFIX=$&#123;C_PREFIX&#125;</span></span><br><span class="line"><span class="string">GATEWAY=$&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">DNS1=223.5.5.5</span></span><br><span class="line"><span class="string">DNS2=180.76.76.76</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功，10秒后，机器会自动重启!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="built_in">sleep</span> 10 &amp;&amp; shutdown -r now</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功，请使用新IP重新登录!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/NetworkManager/system-connections/<span class="variable">$&#123;ETHNAME&#125;</span>.nmconnection &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ethernet]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">address1=$&#123;IP&#125;/$&#123;C_PREFIX&#125;,$&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">dns=223.5.5.5;180.76.76.76;</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv6]</span></span><br><span class="line"><span class="string">addr-gen-mode=default</span></span><br><span class="line"><span class="string">method=auto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxy]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    nmcli con reload &amp;&amp; nmcli dev up <span class="variable">$&#123;ETHNAME&#125;</span> &gt;&amp; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ubuntu_ip</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入IP地址: &quot;</span> IP</span><br><span class="line">        check_ip <span class="variable">$&#123;IP&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> U_PREFIX</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入网关地址: &quot;</span> GATEWAY</span><br><span class="line">        check_ip <span class="variable">$&#123;GATEWAY&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;18&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/01-netcfg.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;] </span></span><br><span class="line"><span class="string">      gateway4: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;20&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/00-installer-config.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;] </span></span><br><span class="line"><span class="string">      gateway4: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/00-installer-config.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;]</span></span><br><span class="line"><span class="string">      routes:</span></span><br><span class="line"><span class="string">        - to: default</span></span><br><span class="line"><span class="string">          via: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span>    </span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功,请重新启动系统后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ip</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        set_rocky_centos_ip</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_ubuntu_ip</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_dual_centos_ip</span></span>()&#123;</span><br><span class="line">    ETHNAME=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^2/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">    ETHNAME2=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^3/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">    CONNECTION_NAME1=`nmcli dev | awk <span class="string">&#x27;NR==2&#123;print $4,$5,$6&#125;&#x27;</span>`</span><br><span class="line">    CONNECTION_NAME2=`nmcli dev | awk <span class="string">&#x27;NR==3&#123;print $4,$5,$6&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入第一块网卡IP地址: &quot;</span> IP</span><br><span class="line">        check_ip <span class="variable">$&#123;IP&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> C_PREFIX</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入网关地址: &quot;</span> GATEWAY</span><br><span class="line">        check_ip <span class="variable">$&#123;GATEWAY&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入第二块网卡IP地址: &quot;</span> IP2</span><br><span class="line">        check_ip <span class="variable">$&#123;IP2&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> C_PREFIX2</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;7&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        nmcli connection modify <span class="string">&quot;<span class="variable">$&#123;CONNECTION_NAME&#125;</span>&quot;</span> con-name <span class="variable">$&#123;ETHNAME&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$&#123;ETHNAME&#125;</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">NAME=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">DEVICE=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BOOTPROTO=none</span></span><br><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">IPADDR=$&#123;IP&#125;</span></span><br><span class="line"><span class="string">PREFIX=$&#123;C_PREFIX&#125;</span></span><br><span class="line"><span class="string">GATEWAY=$&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">DNS1=223.5.5.5</span></span><br><span class="line"><span class="string">DNS2=180.76.76.76</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        nmcli connection modify <span class="string">&quot;<span class="variable">$&#123;CONNECTION_NAME2&#125;</span>&quot;</span> con-name <span class="variable">$&#123;ETHNAME2&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$&#123;ETHNAME2&#125;</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">NAME=$&#123;ETHNAME2&#125;</span></span><br><span class="line"><span class="string">DEVICE=$&#123;ETHNAME2&#125;</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BOOTPROTO=none</span></span><br><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">IPADDR=$&#123;IP2&#125;</span></span><br><span class="line"><span class="string">PREFIX=$&#123;C_PREFIX2&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功，10秒后，机器会自动重启!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="built_in">sleep</span> 10 &amp;&amp; shutdown -r now</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功，请使用新IP重新登录!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/NetworkManager/system-connections/<span class="variable">$&#123;ETHNAME&#125;</span>.nmconnection &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$&#123;ETHNAME&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ethernet]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">address1=$&#123;IP&#125;/$&#123;C_PREFIX&#125;,$&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">dns=223.5.5.5;180.76.76.76;</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv6]</span></span><br><span class="line"><span class="string">addr-gen-mode=default</span></span><br><span class="line"><span class="string">method=auto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxy]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        nmcli connection modify <span class="string">&quot;<span class="variable">$&#123;CONNECTION_NAME2&#125;</span>&quot;</span> con-name <span class="variable">$&#123;ETHNAME2&#125;</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/NetworkManager/system-connections/<span class="variable">$&#123;ETHNAME2&#125;</span>.nmconnection &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$&#123;ETHNAME2&#125;</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$&#123;ETHNAME2&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ethernet]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">address1=$&#123;IP2&#125;/$&#123;C_PREFIX2&#125;</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv6]</span></span><br><span class="line"><span class="string">addr-gen-mode=default</span></span><br><span class="line"><span class="string">method=auto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxy]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">chmod</span> 600 /etc/NetworkManager/system-connections/<span class="variable">$&#123;ETHNAME2&#125;</span>.nmconnection</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    nmcli con reload &amp;&amp; nmcli dev up <span class="variable">$&#123;ETHNAME&#125;</span> <span class="variable">$&#123;ETHNAME2&#125;</span> &gt;&amp; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_dual_ubuntu_ip</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入第一块网卡IP地址: &quot;</span> IP</span><br><span class="line">        check_ip <span class="variable">$&#123;IP&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> U_PREFIX</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入网关地址: &quot;</span> GATEWAY</span><br><span class="line">        check_ip <span class="variable">$&#123;GATEWAY&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入第二块网卡IP地址: &quot;</span> IP2</span><br><span class="line">        check_ip <span class="variable">$&#123;IP2&#125;</span></span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入子网掩码位数: &quot;</span> U_PREFIX2</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;18&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/01-netcfg.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;] </span></span><br><span class="line"><span class="string">      gateway4: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">    eth1:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP2&#125;/$&#123;U_PREFIX2&#125;] </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;20&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/00-installer-config.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;] </span></span><br><span class="line"><span class="string">      gateway4: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">    eth1:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP2&#125;/$&#123;U_PREFIX2&#125;] </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/netplan/00-installer-config.yaml &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">network:</span></span><br><span class="line"><span class="string">  version: 2</span></span><br><span class="line"><span class="string">  renderer: networkd</span></span><br><span class="line"><span class="string">  ethernets:</span></span><br><span class="line"><span class="string">    eth0:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP&#125;/$&#123;U_PREFIX&#125;] </span></span><br><span class="line"><span class="string">      routes:</span></span><br><span class="line"><span class="string">        - to: default</span></span><br><span class="line"><span class="string">          via: $&#123;GATEWAY&#125;</span></span><br><span class="line"><span class="string">      nameservers:</span></span><br><span class="line"><span class="string">        addresses: [223.5.5.5, 180.76.76.76]</span></span><br><span class="line"><span class="string">    eth1:</span></span><br><span class="line"><span class="string">      dhcp4: no</span></span><br><span class="line"><span class="string">      dhcp6: no</span></span><br><span class="line"><span class="string">      addresses: [$&#123;IP2&#125;/$&#123;U_PREFIX2&#125;] </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> IP地址、网关地址和DNS已修改成功,请重新启动系统后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_dual_ip</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        set_dual_centos_ip</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_dual_ubuntu_ip </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_hostname</span></span>()&#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入主机名: &quot;</span> HOST</span><br><span class="line">    hostnamectl set-hostname <span class="variable">$&#123;HOST&#125;</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 主机名设置成功,请重新登录生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">aliyun</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.aliyun.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">huawei</span></span>()&#123;</span><br><span class="line">    MIRROR=repo.huaweicloud.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">tencent</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.tencent.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">tuna</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.tuna.tsinghua.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">netease</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.163.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sohu</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.sohu.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nju</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.nju.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ustc</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.ustc.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sjtu</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.sjtug.sjtu.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pku</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.pku.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">xjtu</span></span>()&#123;</span><br><span class="line">    MIRROR=mirrors.xjtu.edu.cn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_yum_rocky9</span></span>()&#123;</span><br><span class="line">    [ -d /etc/yum.repos.d/backup ] || &#123; <span class="built_in">mkdir</span> /etc/yum.repos.d/backup; <span class="built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup; &#125;</span><br><span class="line">    MIRROR_MIRROR=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;aliyun&quot;</span> -o <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;xjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/extras/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/extras/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> YUM源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky9_base_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)网易镜像源</span></span><br><span class="line"><span class="string">3)搜狐镜像源</span></span><br><span class="line"><span class="string">4)南京大学镜像源</span></span><br><span class="line"><span class="string">5)中科大镜像源</span></span><br><span class="line"><span class="string">6)上海交通大学镜像源</span></span><br><span class="line"><span class="string">7)北京大学镜像源</span></span><br><span class="line"><span class="string">8)西安交通大学镜像源</span></span><br><span class="line"><span class="string">9)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-9): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            netease</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            sohu</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            nju</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            ustc</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            sjtu</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            pku</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            xjtu</span><br><span class="line">            set_yum_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-9)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_devel_rocky9</span></span>()&#123;</span><br><span class="line">    MIRROR_MIRROR=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;aliyun&quot;</span> -o <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;xjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/devel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[devel]</span></span><br><span class="line"><span class="string">name=devel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/devel/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/devel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[devel]</span></span><br><span class="line"><span class="string">name=devel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/devel/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> devel源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky9_devel_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)网易镜像源</span></span><br><span class="line"><span class="string">3)搜狐镜像源</span></span><br><span class="line"><span class="string">4)南京大学镜像源</span></span><br><span class="line"><span class="string">5)中科大镜像源</span></span><br><span class="line"><span class="string">6)上海交通大学镜像源</span></span><br><span class="line"><span class="string">7)北京大学镜像源</span></span><br><span class="line"><span class="string">8)西安交通大学镜像源</span></span><br><span class="line"><span class="string">9)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-9): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            netease</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            sohu</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            nju</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            ustc</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            sjtu</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            pku</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            xjtu</span><br><span class="line">            set_devel_rocky9</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-9)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_yum_rocky8</span></span>()&#123;</span><br><span class="line">    [ -d /etc/yum.repos.d/backup ] || &#123; <span class="built_in">mkdir</span> /etc/yum.repos.d/backup; <span class="built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup; &#125;</span><br><span class="line">    MIRROR_MIRROR=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;aliyun&quot;</span> -o <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;xjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/extras/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/extras/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> YUM源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky8_base_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)网易镜像源</span></span><br><span class="line"><span class="string">3)搜狐镜像源</span></span><br><span class="line"><span class="string">4)南京大学镜像源</span></span><br><span class="line"><span class="string">5)中科大镜像源</span></span><br><span class="line"><span class="string">6)上海交通大学镜像源</span></span><br><span class="line"><span class="string">7)北京大学镜像源</span></span><br><span class="line"><span class="string">8)西安交通大学镜像源</span></span><br><span class="line"><span class="string">9)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-9): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            netease</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            sohu</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            nju</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            ustc</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            sjtu</span><br><span class="line">            set_yum_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            pku</span><br><span class="line">            set_yum_rocky8_9</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            xjtu</span><br><span class="line">            set_yum_rocky8_9</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-9)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_powertools_rocky8</span></span>()&#123;</span><br><span class="line">    MIRROR_MIRROR=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;aliyun&quot;</span> -o <span class="variable">$&#123;MIRROR_MIRROR&#125;</span> == <span class="string">&quot;xjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/powertools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rockylinux/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/powertools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/rocky/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> PowerTools源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky8_powertools_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)网易镜像源</span></span><br><span class="line"><span class="string">3)搜狐镜像源</span></span><br><span class="line"><span class="string">4)南京大学镜像源</span></span><br><span class="line"><span class="string">5)中科大镜像源</span></span><br><span class="line"><span class="string">6)上海交通大学镜像源</span></span><br><span class="line"><span class="string">7)北京大学镜像源</span></span><br><span class="line"><span class="string">8)西安交通大学镜像源</span></span><br><span class="line"><span class="string">9)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-9): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            netease</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            sohu</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            nju</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            ustc</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            sjtu</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            pku</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            xjtu</span><br><span class="line">            set_powertools_rocky8</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-9)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_yum_centos_stream9</span></span>()&#123;</span><br><span class="line">    [ -d /etc/yum.repos.d/backup ] || &#123; <span class="built_in">mkdir</span> /etc/yum.repos.d/backup; <span class="built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup; &#125;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos-stream/\$stream/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos-stream/\$stream/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras-common]</span></span><br><span class="line"><span class="string">name=extras-common</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos-stream/SIGs/\$stream/extras/\$basearch/extras-common/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> YUM源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos_stream9_base_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)网易镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)北京大学镜像源</span></span><br><span class="line"><span class="string">9)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-9): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            netease</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            pku</span><br><span class="line">            set_yum_centos_stream9</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-9)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_yum_centos_stream8</span></span>()&#123;</span><br><span class="line">    [ -d /etc/yum.repos.d/backup ] || &#123; <span class="built_in">mkdir</span> /etc/yum.repos.d/backup; <span class="built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup; &#125;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$stream/BaseOS/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$stream/AppStream/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$stream/extras/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> YUM源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos_stream8_base_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)网易镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)北京大学镜像源</span></span><br><span class="line"><span class="string">9)西安交通大学镜像源</span></span><br><span class="line"><span class="string">10)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-10): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            netease</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            pku</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            xjtu</span><br><span class="line">            set_yum_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-10)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_powertools_centos_stream8</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/yum.repos.d/powertools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$stream/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> PowerTools源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos_stream8_powertools_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)网易镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)北京大学镜像源</span></span><br><span class="line"><span class="string">9)西安交通大学镜像源</span></span><br><span class="line"><span class="string">10)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-10): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            netease</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            pku</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            xjtu</span><br><span class="line">            set_powertools_centos_stream8</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-10)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_epel_rocky_centos8_9</span></span>()&#123;</span><br><span class="line">    MIRROR_URL=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_URL&#125;</span> == <span class="string">&quot;sohu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/fedora-epel/\$releasever/Everything/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/fedora-epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;MIRROR_URL&#125;</span> == <span class="string">&quot;sjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/fedora/epel/\$releasever/Everything/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/fedora/epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/epel/\$releasever/Everything/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    dnf clean all &amp;&gt; /dev/null</span><br><span class="line">    dnf makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> EPEL源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky_centos8_9_epel_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)搜狐镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)上海交通大学镜像源</span></span><br><span class="line"><span class="string">9)北京大学镜像源</span></span><br><span class="line"><span class="string">10)西安交通大学镜像源</span></span><br><span class="line"><span class="string">11)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-11): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            sohu</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            sjtu</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            pku</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            xjtu</span><br><span class="line">            set_epel_rocky_centos8_9</span><br><span class="line">            ;;</span><br><span class="line">        11)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-11)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_yum_centos7</span></span>()&#123;    </span><br><span class="line">    [ -d /etc/yum.repos.d/backup ] || &#123; <span class="built_in">mkdir</span> /etc/yum.repos.d/backup; <span class="built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup; &#125;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[base]</span></span><br><span class="line"><span class="string">name=base</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$releasever/os/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$releasever/extras/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-\$releasever</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[updates]</span></span><br><span class="line"><span class="string">name=updates</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/centos/\$releasever/updates/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    yum clean all &amp;&gt; /dev/null</span><br><span class="line">    yum makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> YUM源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos7_base_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)网易镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)北京大学镜像源</span></span><br><span class="line"><span class="string">9)西安交通大学镜像源</span></span><br><span class="line"><span class="string">10)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-10): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            netease</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            pku</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            xjtu</span><br><span class="line">            set_yum_centos7</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-10)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_epel_centos7</span></span>()&#123;</span><br><span class="line">    MIRROR_URL=`<span class="built_in">echo</span> <span class="variable">$&#123;MIRROR&#125;</span> | awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;MIRROR_URL&#125;</span> == <span class="string">&quot;sohu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/fedora-epel/\$releasever/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/fedora-epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;MIRROR_URL&#125;</span> == <span class="string">&quot;sjtu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/fedora/epel/\$releasever/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/fedora/epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;MIRROR&#125;/epel/\$releasever/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://$&#123;MIRROR&#125;/epel/RPM-GPG-KEY-EPEL-\$releasever</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    yum clean all &amp;&gt; /dev/null</span><br><span class="line">    yum makecache &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> EPEL源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos7_epel_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)搜狐镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">8)上海交通大学镜像源</span></span><br><span class="line"><span class="string">9)北京大学镜像源</span></span><br><span class="line"><span class="string">10)西安交通大学镜像源</span></span><br><span class="line"><span class="string">11)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-11): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            sohu</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            sjtu</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            pku</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            xjtu</span><br><span class="line">            set_epel_centos7</span><br><span class="line">            ;;</span><br><span class="line">        11)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-11)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)base仓库</span></span><br><span class="line"><span class="string">2)epel仓库</span></span><br><span class="line"><span class="string">3)Rocky 9 devel仓库</span></span><br><span class="line"><span class="string">4)Rocky 8 PowerTools仓库</span></span><br><span class="line"><span class="string">5)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-5): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                rocky8_base_menu</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                rocky9_base_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            rocky_centos8_9_epel_menu</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;9&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                rocky9_devel_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                rocky8_powertools_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-5)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)base仓库</span></span><br><span class="line"><span class="string">2)epel仓库</span></span><br><span class="line"><span class="string">3)CentOS Stream 8 PowerTools仓库</span></span><br><span class="line"><span class="string">4)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-4): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_NAME&#125;</span> == <span class="string">&quot;Stream&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                    centos_stream8_base_menu</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    centos_stream9_base_menu</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                centos7_base_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;9&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                rocky_centos8_9_epel_menu</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                centos7_epel_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                centos_stream8_powertools_menu</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-4)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_apt</span></span>()&#123;</span><br><span class="line">    <span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/apt/sources.list &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">deb http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs) main restricted universe multiverse</span></span><br><span class="line"><span class="string">deb-src http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs) main restricted universe multiverse</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">deb http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-security main restricted universe multiverse</span></span><br><span class="line"><span class="string">deb-src http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-security main restricted universe multiverse</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">deb http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-updates main restricted universe multiverse</span></span><br><span class="line"><span class="string">deb-src http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-updates main restricted universe multiverse</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">deb http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="string">deb-src http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">deb http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-backports main restricted universe multiverse</span></span><br><span class="line"><span class="string">deb-src http://$&#123;MIRROR&#125;/ubuntu/ $(lsb_release -cs)-backports main restricted universe multiverse</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;更新镜像源中,请稍等...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    apt update &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> APT源设置完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">apt_menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)阿里镜像源</span></span><br><span class="line"><span class="string">2)华为镜像源</span></span><br><span class="line"><span class="string">3)腾讯镜像源</span></span><br><span class="line"><span class="string">4)清华镜像源</span></span><br><span class="line"><span class="string">5)网易镜像源</span></span><br><span class="line"><span class="string">6)南京大学镜像源</span></span><br><span class="line"><span class="string">7)中科大镜像源</span></span><br><span class="line"><span class="string">9)北京大学镜像源</span></span><br><span class="line"><span class="string">10)西安交通大学镜像源</span></span><br><span class="line"><span class="string">11)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入镜像源编号(1-11): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            aliyun</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            huawei</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            tencent</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            tuna</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            netease</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            nju</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            ustc</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            sjtu</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            pku</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            xjtu</span><br><span class="line">            set_apt</span><br><span class="line">            ;;</span><br><span class="line">        11)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-11)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_mirror_repository</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        centos_menu</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        rocky_menu</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        apt_menu</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rocky_centos_minimal_install</span></span>()&#123;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始安装“Minimal安装建议安装软件包”,请稍等......&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    yum -y install gcc make autoconf gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel systemd-devel zlib-devel vim lrzsz tree tmux lsof tcpdump wget net-tools iotop bc bzip2 zip unzip nfs-utils man-pages &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> Minimal安装建议安装软件包已安装完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ubuntu_minimal_install</span></span>()&#123;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始安装“Minimal安装建议安装软件包”,请稍等......&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    apt -y install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev gcc openssh-server iotop unzip zip</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> Minimal安装建议安装软件包已安装完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">minimal_install</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        rocky_centos_minimal_install</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ubuntu_minimal_install</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">disable_firewall</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        rpm -q firewalld &amp;&gt; /dev/null &amp;&amp; &#123; systemctl <span class="built_in">disable</span> --now firewalld &amp;&gt; /dev/null; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> Firewall防火墙已关闭!&quot;</span><span class="variable">$&#123;END&#125;</span>; &#125; || <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> iptables防火墙已关闭!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        dpkg -s ufw &amp;&gt; /dev/null &amp;&amp; &#123; systemctl <span class="built_in">disable</span> --now ufw &amp;&gt; /dev/null; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> ufw防火墙已关闭!&quot;</span><span class="variable">$&#123;END&#125;</span>; &#125; || <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span>  没有ufw防火墙服务,不用关闭！&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">disable_selinux</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ `getenforce` == <span class="string">&quot;Enforcing&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            sed -ri.bak <span class="string">&#x27;s/^(SELINUX=).*/\1disabled/&#x27;</span> /etc/selinux/config</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> SELinux已禁用,请重新启动系统后才能生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> SELinux已被禁用,不用设置!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> SELinux默认没有安装,不用设置!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_swap</span></span>()&#123;</span><br><span class="line">    sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 20 -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 22 ];<span class="keyword">then</span></span><br><span class="line">            SD_NAME=`lsblk|awk -F<span class="string">&quot;[ └─]&quot;</span> <span class="string">&#x27;/SWAP/&#123;printf $3&#125;&#x27;</span>`</span><br><span class="line">            systemctl mask dev-<span class="variable">$&#123;SD_NAME&#125;</span>.swap &amp;&gt; /dev/null</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    swapoff -a</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 禁用swap成功!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_localtime</span></span>()&#123;</span><br><span class="line">    <span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span> &gt;/etc/timezone</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt;&gt; /etc/default/locale &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">LC_TIME=en_DK.UTF-8</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 系统时区已设置成功,请重启系统后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_limits</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">root     soft   core     unlimited</span></span><br><span class="line"><span class="string">root     hard   core     unlimited</span></span><br><span class="line"><span class="string">root     soft   nproc    1000000</span></span><br><span class="line"><span class="string">root     hard   nproc    1000000</span></span><br><span class="line"><span class="string">root     soft   nofile   1000000</span></span><br><span class="line"><span class="string">root     hard   nofile   1000000</span></span><br><span class="line"><span class="string">root     soft   memlock  32000</span></span><br><span class="line"><span class="string">root     hard   memlock  32000</span></span><br><span class="line"><span class="string">root     soft   msgqueue 8192000</span></span><br><span class="line"><span class="string">root     hard   msgqueue 8192000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 优化资源限制参数成功!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_kernel</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/sysctl.conf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string"># Controls source route verification</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_nonlocal_bind = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Do not accept source routing</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the System Request debugging functionality of the kernel</span></span><br><span class="line"><span class="string">kernel.sysrq = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls whether core dumps will append the PID to the core filename.</span></span><br><span class="line"><span class="string"># Useful for debugging multi-threaded applications.</span></span><br><span class="line"><span class="string">kernel.core_uses_pid = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the use of TCP syncookies</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Disable netfilter on bridges.</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 0</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 0</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-arptables = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the default maxmimum size of a mesage queue</span></span><br><span class="line"><span class="string">kernel.msgmnb = 65536</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the maximum size of a message, in bytes</span></span><br><span class="line"><span class="string">kernel.msgmax = 65536</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the maximum shared segment size, in bytes</span></span><br><span class="line"><span class="string">kernel.shmmax = 68719476736</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Controls the maximum number of shared memory segments, in pages</span></span><br><span class="line"><span class="string">kernel.shmall = 4294967296</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># TCP kernel paramater</span></span><br><span class="line"><span class="string">net.ipv4.tcp_mem = 786432 1048576 1572864</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 4096        87380   4194304</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 4096        16384   4194304</span></span><br><span class="line"><span class="string">net.ipv4.tcp_window_scaling = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_sack = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># socket buffer</span></span><br><span class="line"><span class="string">net.core.wmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.wmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 262144</span></span><br><span class="line"><span class="string">net.core.somaxconn = 20480</span></span><br><span class="line"><span class="string">net.core.optmem_max = 81920</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># TCP conn</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 262144</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syn_retries = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries1 = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries2 = 15</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># tcp conn reuse</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_timestamps = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 20000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 3276800</span></span><br><span class="line"><span class="string">net.ipv4.tcp_synack_retries = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># keepalive conn</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 300</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 10001    65000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># swap</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 0</span></span><br><span class="line"><span class="string">vm.swappiness = 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#net.ipv4.conf.eth1.rp_filter = 0</span></span><br><span class="line"><span class="string">#net.ipv4.conf.lo.arp_ignore = 1</span></span><br><span class="line"><span class="string">#net.ipv4.conf.lo.arp_announce = 2</span></span><br><span class="line"><span class="string">#net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="string">#net.ipv4.conf.all.arp_announce = 2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    sysctl -p &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 优化内核参数成功!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">optimization_sshd</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        sed -ri.bak -e <span class="string">&#x27;s/^#(UseDNS).*/\1 no/&#x27;</span> -e <span class="string">&#x27;s/^(GSSAPIAuthentication).*/\1 no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sed -ri.bak -e <span class="string">&#x27;s/^#(UseDNS).*/\1 no/&#x27;</span> -e <span class="string">&#x27;s/^#(GSSAPIAuthentication).*/\1 no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    systemctl restart sshd</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> SSH已优化完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_sshd_port</span></span>()&#123;</span><br><span class="line">    disable_selinux</span><br><span class="line">    disable_firewall</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入端口号: &quot;</span> PORT</span><br><span class="line">    sed -i <span class="string">&#x27;s/#Port 22/Port &#x27;</span><span class="variable">$&#123;PORT&#125;</span><span class="string">&#x27;/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 更改SSH端口号已完成,请重启系统后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_centos_alias</span></span>()&#123;</span><br><span class="line">    ETHNAME=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^2/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">    ETHNAME2=`ip addr | awk -F<span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;/^3/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入网卡数量（例如：1或2）: &quot;</span> IP_NUM</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;IP_NUM&#125;</span> == <span class="string">&quot;1&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;7&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias cdnet=&quot;cd /etc/sysconfig/network-scripts&quot;</span></span><br><span class="line"><span class="string">alias cdrepo=&quot;cd /etc/yum.repos.d&quot;</span></span><br><span class="line"><span class="string">alias vie0=&quot;vim /etc/sysconfig/network-scripts/ifcfg-$&#123;ETHNAME&#125;&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias cdnet=&quot;cd /etc/NetworkManager/system-connections&quot;</span></span><br><span class="line"><span class="string">alias cdrepo=&quot;cd /etc/yum.repos.d&quot;</span></span><br><span class="line"><span class="string">alias vie0=&quot;vim /etc/NetworkManager/system-connections/$&#123;ETHNAME&#125;.nmconnection&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;7&quot;</span> -o <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == <span class="string">&quot;8&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias cdnet=&quot;cd /etc/sysconfig/network-scripts&quot;</span></span><br><span class="line"><span class="string">alias cdrepo=&quot;cd /etc/yum.repos.d&quot;</span></span><br><span class="line"><span class="string">alias vie0=&quot;vim /etc/sysconfig/network-scripts/ifcfg-$&#123;ETHNAME&#125;&quot;</span></span><br><span class="line"><span class="string">alias vie1=&quot;vim /etc/sysconfig/network-scripts/ifcfg-$&#123;ETHNAME2&#125;&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias cdnet=&quot;cd /etc/NetworkManager/system-connections&quot;</span></span><br><span class="line"><span class="string">alias cdrepo=&quot;cd /etc/yum.repos.d&quot;</span></span><br><span class="line"><span class="string">alias vie0=&quot;vim /etc/NetworkManager/system-connections/$&#123;ETHNAME&#125;.nmconnection&quot;</span></span><br><span class="line"><span class="string">alias vie1=&quot;vim /etc/NetworkManager/system-connections/$&#123;ETHNAME2&#125;.nmconnection&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    DISK_NAME=`lsblk|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;/disk/&#123;printf $1&#125;&#x27;</span> | <span class="built_in">cut</span> -c1-4`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;DISK_NAME&#125;</span> == <span class="string">&quot;sda&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias scandisk=&quot;echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host0/scan;echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host1/scan;echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host2/scan&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 系统别名已设置成功,请重新登陆后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ubuntu_alias</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt;~/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">alias cdnet=&quot;cd /etc/netplan&quot;</span></span><br><span class="line"><span class="string">alias cdapt=&quot;cd /etc/apt&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 系统别名已设置成功,请重新登陆后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_alias</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> grep -Eqi <span class="string">&quot;(.*cdnet|.*vie0|.*vie1|.*scandisk)&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">            sed -i -e <span class="string">&#x27;/.*cdnet/d&#x27;</span>  -e <span class="string">&#x27;/.*vie0/d&#x27;</span> -e <span class="string">&#x27;/.*vie1/d&#x27;</span> -e <span class="string">&#x27;/.*scandisk/d&#x27;</span> ~/.bashrc</span><br><span class="line">            set_centos_alias</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            set_centos_alias</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> grep -Eqi <span class="string">&quot;(.*cdnet|.*scandisk)&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">            sed -i -e <span class="string">&#x27;/.*cdnet/d&#x27;</span> -e <span class="string">&#x27;/.*scandisk/d&#x27;</span> ~/.bashrc</span><br><span class="line">            set_ubuntu_alias</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            set_ubuntu_alias</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_vimrc</span></span>()&#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入作者名: &quot;</span> AUTHOR</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入QQ号: &quot;</span> QQ</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入网址: &quot;</span> V_MIRROR</span><br><span class="line">    <span class="built_in">cat</span> &gt;~/.vimrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">set ts=4</span></span><br><span class="line"><span class="string">set expandtab</span></span><br><span class="line"><span class="string">set ignorecase</span></span><br><span class="line"><span class="string">set cursorline</span></span><br><span class="line"><span class="string">set autoindent</span></span><br><span class="line"><span class="string">autocmd BufNewFile *.sh exec &quot;:call SetTitle()&quot;</span></span><br><span class="line"><span class="string">func SetTitle()</span></span><br><span class="line"><span class="string">    if expand(&quot;%:e&quot;) == &#x27;sh&#x27;</span></span><br><span class="line"><span class="string">    call setline(1,&quot;#!/bin/bash&quot;)</span></span><br><span class="line"><span class="string">    call setline(2,&quot;#&quot;)</span></span><br><span class="line"><span class="string">    call setline(3,&quot;#**********************************************************************************************&quot;)</span></span><br><span class="line"><span class="string">    call setline(4,&quot;#Author:        $&#123;AUTHOR&#125;&quot;)</span></span><br><span class="line"><span class="string">    call setline(5,&quot;#QQ:            $&#123;QQ&#125;&quot;)</span></span><br><span class="line"><span class="string">    call setline(6,&quot;#Date:          &quot;.strftime(&quot;%Y-%m-%d&quot;))</span></span><br><span class="line"><span class="string">    call setline(7,&quot;#FileName:      &quot;.expand(&quot;%&quot;))</span></span><br><span class="line"><span class="string">    call setline(8,&quot;#MIRROR:           $&#123;V_MIRROR&#125;&quot;)</span></span><br><span class="line"><span class="string">    call setline(9,&quot;#Description:   The test script&quot;)</span></span><br><span class="line"><span class="string">    call setline(10,&quot;#Copyright (C): &quot;.strftime(&quot;%Y&quot;).&quot; All rights reserved&quot;)</span></span><br><span class="line"><span class="string">    call setline(11,&quot;#*********************************************************************************************&quot;)</span></span><br><span class="line"><span class="string">    call setline(12,&quot;&quot;)</span></span><br><span class="line"><span class="string">    endif</span></span><br><span class="line"><span class="string">endfunc</span></span><br><span class="line"><span class="string">autocmd BufNewFile * normal G</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> vimrc设置完成,请重新系统启动才能生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_mail</span></span>()&#123;                                                                                                 </span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        rpm -q postfix &amp;&gt; /dev/null || &#123; yum -y install postfix &amp;&gt; /dev/null; systemctl <span class="built_in">enable</span> --now postfix &amp;&gt; /dev/null; &#125;</span><br><span class="line">        rpm -q mailx &amp;&gt; /dev/null || yum -y install mailx &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        dpkg -s mailutils &amp;&gt; /dev/null || apt -y install mailutils</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入邮箱地址: &quot;</span> MAIL</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入邮箱授权码: &quot;</span> AUTH</span><br><span class="line">    SMTP=`<span class="built_in">echo</span> <span class="variable">$&#123;MAIL&#125;</span> |awk -F<span class="string">&quot;@&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">    <span class="built_in">cat</span> &gt;~/.mailrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">set from=$&#123;MAIL&#125;</span></span><br><span class="line"><span class="string">set smtp=smtp.$&#123;SMTP&#125;</span></span><br><span class="line"><span class="string">set smtp-auth-user=$&#123;MAIL&#125;</span></span><br><span class="line"><span class="string">set smtp-auth-password=$&#123;AUTH&#125;</span></span><br><span class="line"><span class="string">set smtp-auth=login</span></span><br><span class="line"><span class="string">set ssl-verify=ignore</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 邮件设置完成,请重新登录后才能生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">red</span></span>()&#123;</span><br><span class="line">    P_COLOR=31</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">green</span></span>()&#123;</span><br><span class="line">    P_COLOR=32</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">yellow</span></span>()&#123;</span><br><span class="line">    P_COLOR=33</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">blue</span></span>()&#123;</span><br><span class="line">    P_COLOR=34</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">violet</span></span>()&#123;</span><br><span class="line">    P_COLOR=35</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cyan_blue</span></span>()&#123;</span><br><span class="line">    P_COLOR=36</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">random_color</span></span>()&#123;</span><br><span class="line">    P_COLOR=<span class="string">&quot;$[RANDOM%7+31]&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">centos_ps1</span></span>()&#123;</span><br><span class="line">    C_PS1=$(<span class="built_in">echo</span> <span class="string">&quot;PS1=&#x27;\[\e[1;<span class="variable">$&#123;P_COLOR&#125;</span>m\][\u@\h \W]\\$ \[\e[0m\]&#x27;&quot;</span> &gt;&gt; ~/.bashrc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ubuntu_ps1</span></span>()&#123;</span><br><span class="line">    U_PS1=$(<span class="built_in">echo</span> <span class="string">&#x27;PS1=&quot;\[\e[1;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="variable">$&#123;P_COLOR&#125;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;m\]$&#123;debian_chroot:+($debian_chroot)&#125;\u@\h:\w\\$ \[\e[0m\]&quot;&#x27;</span> &gt;&gt; ~/.bashrc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ps1_env</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> grep -Eqi <span class="string">&quot;^PS1&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">            sed -i <span class="string">&#x27;/^PS1/d&#x27;</span> ~/.bashrc</span><br><span class="line">            centos_ps1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            centos_ps1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> grep -Eqi <span class="string">&quot;^PS1&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">            sed -i <span class="string">&#x27;/^PS1/d&#x27;</span> ~/.bashrc</span><br><span class="line">            ubuntu_ps1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ubuntu_ps1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_ps1</span></span>()&#123;</span><br><span class="line">    TIPS=<span class="string">&quot;<span class="variable">$&#123;COLOR&#125;</span><span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> PS1设置成功,请重新登录生效!<span class="variable">$&#123;END&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">1)31 红色</span></span><br><span class="line"><span class="string">2)32 绿色</span></span><br><span class="line"><span class="string">3)33 黄色</span></span><br><span class="line"><span class="string">4)34 蓝色</span></span><br><span class="line"><span class="string">5)35 紫色</span></span><br><span class="line"><span class="string">6)36 青色</span></span><br><span class="line"><span class="string">7)随机颜色</span></span><br><span class="line"><span class="string">8)退出</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请输入颜色编号(1-8): &quot;</span> NUM</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;NUM&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            red</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            green</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            yellow</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            blue</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            violet</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            cyan_blue</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            random_color</span><br><span class="line">            set_ps1_env</span><br><span class="line">            <span class="variable">$&#123;TIPS&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-8)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_vim</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;export EDITOR=vim&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_vim_env</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> grep -Eqi <span class="string">&quot;.*EDITOR&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">        sed -i <span class="string">&#x27;/.*EDITOR/d&#x27;</span> ~/.bashrc</span><br><span class="line">        set_vim</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_vim</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 默认文本编辑器设置成功,请重新登录生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_history</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;export HISTTIMEFORMAT=&quot;%F %T &quot;&#x27;</span> &gt;&gt; ~/.bashrc </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_history_env</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> grep -Eqi <span class="string">&quot;.*HISTTIMEFORMAT&quot;</span> ~/.bashrc;<span class="keyword">then</span></span><br><span class="line">        sed -i <span class="string">&#x27;/.*HISTTIMEFORMAT/d&#x27;</span> ~/.bashrc</span><br><span class="line">        set_history</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_history</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> history格式设置成功,请重新登录生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">disable_restart</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ -f /usr/lib/systemd/system/ctrl-alt-del.target ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cp</span> /usr/lib/systemd/system/ctrl-alt-del.target&#123;,.bak&#125;</span><br><span class="line">        <span class="built_in">rm</span> -f /usr/lib/systemd/system/ctrl-alt-del.target</span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 禁用ctrl+alt+del重启处理成功!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 禁用ctrl+alt+del已处理!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_root_login</span></span>()&#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入密码: &quot;</span> PASSWORD</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;PASSWORD&#125;</span> |sudo -S sed -ri <span class="string">&#x27;s@#(PermitRootLogin )prohibit-password@\1yes@&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sudo systemctl restart sshd</span><br><span class="line">    sudo -S passwd root &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">$&#123;PASSWORD&#125;</span></span><br><span class="line"><span class="string">$&#123;PASSWORD&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> root用户登录已设置完成,请重新登录后生效!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ubuntu_remove</span></span>()&#123;</span><br><span class="line">    apt purge ufw lxd lxd-client lxcfs liblxc-common</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span> <span class="variable">$&#123;OS_RELEASE&#125;</span> 无用软件包卸载完成!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">menu</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">********************************************************************</span></span><br><span class="line"><span class="string">*                          初始化脚本菜单                          *</span></span><br><span class="line"><span class="string">* 1.修改网卡名                     14.更改SSH端口号                *</span></span><br><span class="line"><span class="string">* 2.修改IP地址和网关地址(单网卡)   15.设置系统别名                 *</span></span><br><span class="line"><span class="string">* 3.修改IP地址和网关地址(双网卡)   16.设置vimrc配置文件            *</span></span><br><span class="line"><span class="string">* 4.设置主机名                     17.安装邮件服务并配置邮件       *</span></span><br><span class="line"><span class="string">* 5.设置镜像仓库                   18.设置PS1(请进入选择颜色)      *</span></span><br><span class="line"><span class="string">* 6.Minimal安装建议安装软件        19.设置默认文本编辑器为vim      *</span></span><br><span class="line"><span class="string">* 7.关闭防火墙                     20.设置history格式              *</span></span><br><span class="line"><span class="string">* 8.禁用SELinux                    21.禁用ctrl+alt+del重启         *</span></span><br><span class="line"><span class="string">* 9.禁用SWAP                       22.Ubuntu设置root用户登录       *</span></span><br><span class="line"><span class="string">* 10.设置系统时区                  23.Ubuntu卸载无用软件包         *</span></span><br><span class="line"><span class="string">* 11.优化资源限制参数              24.重启系统                     *</span></span><br><span class="line"><span class="string">* 12.优化内核参数                  25.关机                         *</span></span><br><span class="line"><span class="string">* 13.优化SSH                       26.退出                         *</span></span><br><span class="line"><span class="string">********************************************************************</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;请选择相应的编号(1-26): &quot;</span> choice</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$&#123;choice&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1)</span><br><span class="line">            set_eth</span><br><span class="line">            ;;</span><br><span class="line">        2)</span><br><span class="line">            set_ip</span><br><span class="line">            ;;</span><br><span class="line">        3)</span><br><span class="line">            set_dual_ip</span><br><span class="line">            ;;</span><br><span class="line">        4)</span><br><span class="line">            set_hostname</span><br><span class="line">            ;;</span><br><span class="line">        5)</span><br><span class="line">            set_mirror_repository</span><br><span class="line">            ;;</span><br><span class="line">        6)</span><br><span class="line">            minimal_install</span><br><span class="line">            ;;</span><br><span class="line">        7)</span><br><span class="line">            disable_firewall</span><br><span class="line">            ;;</span><br><span class="line">        8)</span><br><span class="line">            disable_selinux</span><br><span class="line">            ;;</span><br><span class="line">        9)</span><br><span class="line">            set_swap</span><br><span class="line">            ;;</span><br><span class="line">        10)</span><br><span class="line">            set_localtime</span><br><span class="line">            ;;</span><br><span class="line">        11)</span><br><span class="line">            set_limits</span><br><span class="line">            ;;</span><br><span class="line">        12)</span><br><span class="line">            set_kernel</span><br><span class="line">            ;;</span><br><span class="line">        13)</span><br><span class="line">            optimization_sshd</span><br><span class="line">            ;;</span><br><span class="line">        14)</span><br><span class="line">            set_sshd_port</span><br><span class="line">            ;;</span><br><span class="line">        15)</span><br><span class="line">            set_alias</span><br><span class="line">            ;;</span><br><span class="line">        16)</span><br><span class="line">            set_vimrc</span><br><span class="line">            ;;</span><br><span class="line">        17)</span><br><span class="line">            set_mail</span><br><span class="line">            ;;</span><br><span class="line">        18)</span><br><span class="line">            set_ps1</span><br><span class="line">            ;;</span><br><span class="line">        19)</span><br><span class="line">            set_vim_env</span><br><span class="line">            ;;</span><br><span class="line">        20)</span><br><span class="line">            set_history_env</span><br><span class="line">            ;;</span><br><span class="line">        21)</span><br><span class="line">            disable_restart</span><br><span class="line">            ;;</span><br><span class="line">        22)</span><br><span class="line">            set_root_login</span><br><span class="line">            ;;</span><br><span class="line">        23)</span><br><span class="line">            ubuntu_remove</span><br><span class="line">            ;;</span><br><span class="line">        24)</span><br><span class="line">            reboot</span><br><span class="line">            ;;</span><br><span class="line">        25)</span><br><span class="line">            shutdown -h now</span><br><span class="line">            ;;</span><br><span class="line">        26)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;输入错误,请输入正确的数字(1-26)!&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    menu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">reset for CentOS 7 &amp; CentOS Stream 8/9 &amp; Ubuntu 18.04/20.04/22.04 &amp; Rocky 8/9</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_python3</title>
    <link href="http://example.com/2024/03/13/%E5%AE%89%E8%A3%85Python3%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/13/%E5%AE%89%E8%A3%85Python3%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-13T01:25:00.000Z</published>
    <updated>2024-09-24T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装Python3环境"><a href="#安装Python3环境" class="headerlink" title="安装Python3环境"></a>安装Python3环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 用法: ./install_python.sh &lt;版本号1&gt; [&lt;版本号2&gt; ...],如./install_python.sh 3.7.12 3.8.10 3.9.6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 wget 和 tar</span></span><br><span class="line"><span class="function"><span class="title">install_wget_and_tar</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Checking for wget and tar...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断 wget 和 tar 是否存在</span></span><br><span class="line">    <span class="built_in">command</span> -v wget &amp;&gt;/dev/null</span><br><span class="line">    wget_installed=$?</span><br><span class="line">    <span class="built_in">command</span> -v tar &amp;&gt;/dev/null</span><br><span class="line">    tar_installed=$?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$wget_installed</span> -eq 0 ] &amp;&amp; [ <span class="variable">$tar_installed</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;wget and tar are installed.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Installing wget and tar...&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$wget_installed</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                yum -y install wget</span><br><span class="line">                <span class="keyword">while</span> [ $? -ne 0 ]; <span class="keyword">do</span></span><br><span class="line">                    yum -y install wget</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$tar_installed</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                yum -y install tar</span><br><span class="line">                <span class="keyword">while</span> [ $? -ne 0 ]; <span class="keyword">do</span></span><br><span class="line">                    yum -y install tar</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">command</span> -v apt-get &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            apt-get update</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$wget_installed</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                apt-get -y install wget</span><br><span class="line">                <span class="keyword">while</span> [ $? -ne 0 ]; <span class="keyword">do</span></span><br><span class="line">                    apt-get -y install wget</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$tar_installed</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                apt-get -y install tar</span><br><span class="line">                <span class="keyword">while</span> [ $? -ne 0 ]; <span class="keyword">do</span></span><br><span class="line">                    apt-get -y install tar</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Neither yum nor apt-get is available. Please install wget and tar manually.&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;wget and tar installed successfully.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本的 Python</span></span><br><span class="line"><span class="function"><span class="title">install_python</span></span>() &#123;</span><br><span class="line">  VERSION=<span class="variable">$1</span></span><br><span class="line">  SRC_DIR=/opt/src</span><br><span class="line">  INSTALL_DIR=/opt/app/Python<span class="variable">$VERSION</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$INSTALL_DIR</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$SRC_DIR</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Checking for Python <span class="variable">$VERSION</span>...&quot;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">command</span> -v python<span class="string">&quot;<span class="variable">$&#123;VERSION&#125;</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Python <span class="variable">$&#123;VERSION&#125;</span> is already installed: <span class="subst">$(which python$&#123;VERSION&#125;)</span>&quot;</span></span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Installing Python <span class="variable">$&#123;VERSION&#125;</span>...&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$SRC_DIR</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Downloading Python <span class="variable">$&#123;VERSION&#125;</span>...&quot;</span></span><br><span class="line">  wget <span class="string">&quot;https://repo.huaweicloud.com/python/<span class="variable">$VERSION</span>/Python-<span class="variable">$VERSION</span>.tgz&quot;</span> --no-check-certificate -O <span class="string">&quot;Python-<span class="variable">$VERSION</span>.tgz&quot;</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;=========== Download Failed! ============&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Extracting Python <span class="variable">$&#123;VERSION&#125;</span>...&quot;</span></span><br><span class="line">  tar -xzvf <span class="string">&quot;Python-<span class="variable">$VERSION</span>.tgz&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Installing Python dependencies...&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v dnf &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">    dnf install -y zlib-devel bzip2 bzip2-devel readline-devel sqlite sqlite-devel openssl-devel tk-devel libffi-devel</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v yum &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">    yum install -y gcc patch libffi-devel python-devel zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v apt-get &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">    apt-get update</span><br><span class="line">    apt-get -y install build-essential zlib1g-dev libbz2-dev libncurses5-dev make libncursesw5-dev libreadline-dev libsqlite3-dev tk-dev libgdbm-dev libdb5.3-dev libpcap-dev xz-utils libssl-dev libffi-dev</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Configuring, compiling and installing Python...&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="string">&quot;Python-<span class="variable">$VERSION</span>&quot;</span></span><br><span class="line">  ./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>&quot;</span> <span class="comment">#--enable-optimizations</span></span><br><span class="line">  make -j$(<span class="built_in">nproc</span>) &amp;&amp; make altinstall  <span class="comment">#覆盖就用install，共存最好用altinstall</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#   # 自动查找 python3.x 可执行文件，这个功能和下面的添加环境变量重合，根据自己的需求选择启用哪个</span></span><br><span class="line"><span class="comment">#   PYTHON_EXECUTABLE=$(find &quot;$INSTALL_DIR/bin&quot; -name &quot;python3.*&quot; | head -n 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   # 创建软链接</span></span><br><span class="line"><span class="comment">#   if [[ -n &quot;$PYTHON_EXECUTABLE&quot; ]]; then</span></span><br><span class="line"><span class="comment">#     #ln -s &quot;$PYTHON_EXECUTABLE&quot; &quot;$INSTALL_DIR/bin/python$VERSION&quot;</span></span><br><span class="line"><span class="comment">#     ln -s &quot;$INSTALL_DIR/bin/python$VERSION&quot; &quot;/usr/bin/$PYTHON_EXECUTABLE&quot;</span></span><br><span class="line">      <span class="comment">#echo &quot;export PATH=\$PATH:$INSTALL_DIR/bin&quot; &gt;&gt; /etc/profile</span></span><br><span class="line"><span class="comment">#   else</span></span><br><span class="line"><span class="comment">#     echo &quot;Warning: Could not find python3.x executable in $INSTALL_DIR/bin&quot;</span></span><br><span class="line"><span class="comment">#   fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;export PYTHON_HOME=<span class="variable">$INSTALL_DIR</span>\nexport PATH=\$PYTHON_HOME/bin:\$PATH&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Python <span class="variable">$VERSION</span> installed successfully.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line"><span class="function"><span class="title">verify_installation</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Verifying Python installations...&quot;</span></span><br><span class="line">  <span class="comment"># 加载新的环境变量</span></span><br><span class="line">  <span class="built_in">source</span> /etc/profile</span><br><span class="line">  <span class="keyword">while</span> [ <span class="variable">$#</span> -gt 0 ]; <span class="keyword">do</span></span><br><span class="line">    VERSION=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">command</span> -v python<span class="string">&quot;<span class="variable">$&#123;VERSION&#125;</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Python <span class="variable">$&#123;VERSION&#125;</span> installed successfully:&quot;</span></span><br><span class="line">      python<span class="string">&quot;<span class="variable">$&#123;VERSION&#125;</span>&quot;</span> --version</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Python <span class="variable">$&#123;VERSION&#125;</span> installation failed!&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 安装 wget 和 tar</span></span><br><span class="line">install_wget_and_tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取传入的版本号参数并安装</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> -gt 0 ]; <span class="keyword">do</span></span><br><span class="line">  install_python <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">verify_installation <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installation complete. Please run &#x27;source /etc/profile&#x27; to update your environment.&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">安装Python3环境，可以与系统中的其他版本共存</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_nginx</title>
    <link href="http://example.com/2024/03/12/%E5%AE%89%E8%A3%85nginx%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/12/%E5%AE%89%E8%A3%85nginx%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-12T01:25:00.000Z</published>
    <updated>2024-03-12T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置Nginx版本和安装目录</span></span><br><span class="line">NGINX_VERSION=<span class="string">&quot;1.24.0&quot;</span></span><br><span class="line">INSTALL_DIR=<span class="string">&quot;/opt/app/nginx-<span class="variable">$NGINX_VERSION</span>/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析OS ID</span></span><br><span class="line">OS_ID=$(awk -F= <span class="string">&#x27;/^ID=/&#123;gsub(&quot;\&quot;&quot;, &quot;&quot;, $2); print tolower($2)&#125;&#x27;</span> /etc/os-release)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测并创建文件夹</span></span><br><span class="line"><span class="function"><span class="title">check_and_create_directory</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建文件夹 <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;文件夹 <span class="variable">$1</span> 已存在&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命令是否存在的函数</span></span><br><span class="line"><span class="function"><span class="title">command_exists</span></span>() &#123;</span><br><span class="line">    [ -x <span class="string">&quot;<span class="subst">$(command -v <span class="string">&quot;<span class="variable">$1</span>&quot;</span>)</span>&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装必要的软件</span></span><br><span class="line"><span class="function"><span class="title">install_dependencies</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;centos&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;rocky&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;rhel&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        command_exists wget || yum -y install wget</span><br><span class="line">        command_exists tar || yum -y install tar</span><br><span class="line">        yum install -y gcc pcre-devel openssl-devel zlib-devel make</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;ubuntu&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$OS_ID</span>&quot;</span> = <span class="string">&quot;debian&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        command_exists wget || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install wget &amp;&gt; /dev/null)</span><br><span class="line">        command_exists tar || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install tar &amp;&gt; /dev/null)</span><br><span class="line">        apt-get install -y gcc libpcre3 libpcre3-dev zlib1g-dev libssl-dev make</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;不支持的操作系统: <span class="variable">$OS_ID</span>&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查解析的 OS_ID</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;解析的操作系统 ID 是: <span class="variable">$OS_ID</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Nginx用户</span></span><br><span class="line"><span class="function"><span class="title">create_nginx_user</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span> -u nginx &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx用户已经存在.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建Nginx用户...&quot;</span></span><br><span class="line">        useradd -r -s /sbin/nologin nginx</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;创建Nginx用户成功.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载并编译安装Nginx</span></span><br><span class="line"><span class="function"><span class="title">compile_nginx</span></span>() &#123;</span><br><span class="line">    check_and_create_directory <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>&quot;</span></span><br><span class="line">    check_and_create_directory <span class="string">&quot;/opt/src&quot;</span></span><br><span class="line">    wget http://nginx.org/download/nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz -P /opt/src</span><br><span class="line">    <span class="built_in">cd</span> /opt/src</span><br><span class="line">    tar -zxvf nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz</span><br><span class="line">    <span class="built_in">cd</span> nginx-<span class="variable">$NGINX_VERSION</span></span><br><span class="line">    </span><br><span class="line">    ./configure --prefix=<span class="variable">$INSTALL_DIR</span> \</span><br><span class="line">                --user=nginx \</span><br><span class="line">                --group=nginx \</span><br><span class="line">                --with-http_ssl_module \</span><br><span class="line">                --with-http_v2_module \</span><br><span class="line">                --with-http_realip_module \</span><br><span class="line">                --with-http_stub_status_module \</span><br><span class="line">                --with-http_gzip_static_module \</span><br><span class="line">                --with-pcre \</span><br><span class="line">                --with-stream \</span><br><span class="line">                --with-stream_ssl_module \</span><br><span class="line">                --with-stream_realip_module</span><br><span class="line"></span><br><span class="line">    make</span><br><span class="line">    make install</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清理安装过程中的临时文件</span></span><br><span class="line">    <span class="built_in">cd</span> ..</span><br><span class="line">    <span class="built_in">rm</span> -rf nginx-<span class="variable">$NGINX_VERSION</span></span><br><span class="line">    <span class="built_in">rm</span> nginx-<span class="variable">$NGINX_VERSION</span>.tar.gz</span><br><span class="line"></span><br><span class="line">    <span class="built_in">chown</span> -R nginx:nginx <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Nginx服务启动脚本</span></span><br><span class="line"><span class="function"><span class="title">create_systemd_service</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/systemd/system/nginx.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Nginx HTTP Server</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">ExecStart=$INSTALL_DIR/sbin/nginx</span></span><br><span class="line"><span class="string">ExecReload=$INSTALL_DIR/sbin/nginx -s reload</span></span><br><span class="line"><span class="string">ExecStop=$INSTALL_DIR/sbin/nginx -s stop</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$INSTALL_DIR</span>/sbin/nginx /usr/bin/nginx</span><br><span class="line"></span><br><span class="line">    systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">    systemctl start nginx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证Nginx安装</span></span><br><span class="line"><span class="function"><span class="title">verify_nginx_install</span></span>() &#123;</span><br><span class="line">    nginx -v</span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$INSTALL_DIR</span> /opt/app/nginx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里定义脚本的 main 函数</span></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment"># 临时输出系统路径信息用于调试</span></span><br><span class="line">    <span class="comment">#echo &quot;System PATH: $PATH&quot;</span></span><br><span class="line">    <span class="comment">#which nginx</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改检查逻辑以更可靠地识别 nginx 是否存在</span></span><br><span class="line">    <span class="keyword">if</span> command_exists nginx; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx已经安装，跳过安装步骤&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Nginx未安装，继续安装步骤&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    install_dependencies</span><br><span class="line">    create_nginx_user</span><br><span class="line">    compile_nginx</span><br><span class="line">    create_systemd_service</span><br><span class="line">    verify_nginx_install</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">安装Nginx脚本，已测试ubuntu24和Rocky9.4无问题，其余系统继续测试中</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_mysql5.7</title>
    <link href="http://example.com/2024/03/09/%E5%AE%89%E8%A3%85mysql5.7%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/09/%E5%AE%89%E8%A3%85mysql5.7%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-09T01:25:00.000Z</published>
    <updated>2024-03-09T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装mysql5-7"><a href="#安装mysql5-7" class="headerlink" title="安装mysql5.7"></a>安装mysql5.7</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#*************************************************************************************************</span></span><br><span class="line"><span class="comment">#FileName:      install_mysql5.7.sh</span></span><br><span class="line"><span class="comment">#Description:   install_mysql5.7 for centos 7/8/stream 8 &amp; ubuntu 18.04/20.04 &amp; Rocky 8</span></span><br><span class="line"><span class="comment">#*************************************************************************************************</span></span><br><span class="line">SRC_DIR=/opt/src</span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">MYSQL_URL=https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">MYSQL_VERSION=<span class="string">&#x27;5.7/&#x27;</span></span><br><span class="line">MYSQL_FILE=<span class="string">&#x27;mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz&#x27;</span></span><br><span class="line">MYSQL_ROOT_PASSWORD=123456</span><br><span class="line">MYSQL_INSTALL_DIR=/opt/app/mysql-5.7.43  <span class="comment"># 修改为你想要的安装目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/src</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/app</span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_RELEASE_VERSION=`sed -rn <span class="string">&#x27;/^VERSION_ID=/s@.*=&quot;?([0-9]+)\.?.*&quot;?@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_file</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cd</span>  <span class="variable">$&#123;SRC_DIR&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -e <span class="variable">$&#123;MYSQL_FILE&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;缺少<span class="variable">$&#123;MYSQL_FILE&#125;</span>文件&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始下载MYSQL二进制安装包&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        wget <span class="variable">$&#123;MYSQL_URL&#125;</span> || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;MYSQL二进制安装包下载失败&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;<span class="variable">$&#123;MYSQL_FILE&#125;</span>文件已准备好&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命令是否存在的函数</span></span><br><span class="line"><span class="function"><span class="title">command_exists</span></span>() &#123;</span><br><span class="line">    <span class="built_in">command</span> -v <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> || <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || yum -y install wget &amp;&gt; /dev/null</span><br><span class="line">    command_exists tar || yum -y install tar &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install wget &amp;&gt; /dev/null)</span><br><span class="line">    command_exists tar || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install tar &amp;&gt; /dev/null)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_mysql</span></span>()&#123;</span><br><span class="line">    [ -d <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span> ] &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;MySQL数据库已存在，安装失败&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;开始安装MySQL数据库...&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始安装MYSQL依赖包&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install libaio perl-Data-Dumper ncurses-compat-libs &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 7 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install libaio perl-Data-Dumper &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        apt update &amp;&gt; /dev/null;apt -y install numactl libaio-dev libtinfo5 &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">cd</span>  <span class="variable">$&#123;SRC_DIR&#125;</span></span><br><span class="line">    tar xvf <span class="variable">$&#123;MYSQL_FILE&#125;</span></span><br><span class="line">    <span class="built_in">mv</span> <span class="variable">$&#123;SRC_DIR&#125;</span>/mysql-5.7.43-linux-glibc2.12-x86_64 <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span> /usr/local/mysql</span><br><span class="line">    <span class="built_in">id</span> mysql &amp;&gt; /dev/null || &#123; useradd -s /sbin/nologin -r  mysql ; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;创建mysql用户&quot;</span><span class="variable">$&#123;END&#125;</span>; &#125;</span><br><span class="line">    <span class="built_in">chown</span> -R  mysql.mysql <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;PATH=$&#123;MYSQL_INSTALL_DIR&#125;/bin/:$PATH&#x27;</span> &gt; /etc/profile.d/mysql.sh</span><br><span class="line">    .  /etc/profile.d/mysql.sh</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">server-id=1</span></span><br><span class="line"><span class="string">log-bin</span></span><br><span class="line"><span class="string">datadir=/data/mysql</span></span><br><span class="line"><span class="string">socket=/data/mysql/mysql.sock</span></span><br><span class="line"><span class="string">log-error=/data/mysql/mysql.log</span></span><br><span class="line"><span class="string">pid-file=/data/mysql/mysql.pid</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">socket=/data/mysql/mysql.sock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    [ -d /data/mysql ] || <span class="built_in">mkdir</span> -p /data/mysql &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">chown</span> -R  mysql.mysql /data/mysql</span><br><span class="line">    <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span>/bin/mysqld --initialize --user=mysql --datadir=/data/mysql </span><br><span class="line">    <span class="built_in">cp</span> <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span>/support-files/mysql.server  /etc/init.d/mysqld</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        chkconfig --add mysqld</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        update-rc.d -f mysqld defaults</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">cat</span> &gt; /lib/systemd/system/mysqld.service &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=mysql database server</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">PrivateNetwork=false</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">Restart=no</span></span><br><span class="line"><span class="string">TimeoutSec=5min</span></span><br><span class="line"><span class="string">IgnoreSIGPIPE=no</span></span><br><span class="line"><span class="string">KillMode=process</span></span><br><span class="line"><span class="string">GuessMainPID=no</span></span><br><span class="line"><span class="string">RemainAfterExit=yes</span></span><br><span class="line"><span class="string">SuccessExitStatus=5 6</span></span><br><span class="line"><span class="string">ExecStart=/etc/init.d/mysqld start</span></span><br><span class="line"><span class="string">ExecStop=/etc/init.d//mysqld stop</span></span><br><span class="line"><span class="string">ExecReload=/etc/init.d/mysqld reload</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">Alias=mysqld.service</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl <span class="built_in">enable</span> --now mysqld &amp;&gt; /dev/null</span><br><span class="line">    [ $? -ne 0 ] &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;数据库启动失败，退出!&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    MYSQL_OLDPASSWORD=`awk <span class="string">&#x27;/A temporary password/&#123;print $NF&#125;&#x27;</span> /data/mysql/mysql.log`</span><br><span class="line">    <span class="variable">$&#123;MYSQL_INSTALL_DIR&#125;</span>/bin/mysqladmin  -uroot -p<span class="variable">$&#123;MYSQL_OLDPASSWORD&#125;</span> password <span class="variable">$&#123;MYSQL_ROOT_PASSWORD&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;MySQL数据库安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">ln</span> -s /opt/app/mysql-5.7.43/bin/mysql /usr/local/bin/mysql</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    check_file</span><br><span class="line">    command_exists</span><br><span class="line">    install_mysql</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install_mysql5.7 for centos 7/8/stream 8 &amp; ubuntu 18.04/20.04 &amp; Rocky 8</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_keepalived</title>
    <link href="http://example.com/2024/03/06/%E5%AE%89%E8%A3%85keepalived%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/06/%E5%AE%89%E8%A3%85keepalived%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-06T01:25:00.000Z</published>
    <updated>2024-03-06T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装keepalived-master"><a href="#安装keepalived-master" class="headerlink" title="安装keepalived_master"></a>安装keepalived_master</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment">#FileName:      install_keepalived_master.sh</span></span><br><span class="line"><span class="comment">#Description:   install_keepalived for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8</span></span><br><span class="line"><span class="comment">#*********************************************************************************************</span></span><br><span class="line">SRC_DIR=/usr/local/src</span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">KEEPALIVED_URL=https://keepalived.org/software/</span><br><span class="line">KEEPALIVED_FILE=keepalived-2.2.4.tar.gz</span><br><span class="line">KEEPALIVED_INSTALL_DIR=/apps/keepalived</span><br><span class="line">CPUS=`lscpu |awk <span class="string">&#x27;/^CPU\(s\)/&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">NET_NAME=`ip addr |awk -F<span class="string">&quot;[: ]&quot;</span> <span class="string">&#x27;/^2: e.*/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">STATE=MASTER</span><br><span class="line">PRIORITY=100</span><br><span class="line">VIP=172.31.0.188</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_RELEASE_VERSION=`sed -rn <span class="string">&#x27;/^VERSION_ID=/s@.*=&quot;?([0-9]+)\.?.*&quot;?@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_file</span></span> ()&#123;</span><br><span class="line">    <span class="built_in">cd</span>  <span class="variable">$&#123;SRC_DIR&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ ! -e <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;缺少<span class="variable">$&#123;KEEPALIVED_FILE&#125;</span>文件,如果是离线包,请放到<span class="variable">$&#123;SRC_DIR&#125;</span>目录下&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始下载Keepalived源码包&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        wget <span class="variable">$&#123;KEEPALIVED_URL&#125;</span><span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived源码包下载失败&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;相关文件已准备好&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命令是否存在的函数</span></span><br><span class="line"><span class="function"><span class="title">command_exists</span></span>() &#123;</span><br><span class="line">    <span class="built_in">command</span> -v <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> || <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || yum -y install wget &amp;&gt; /dev/null</span><br><span class="line">    command_exists tar || yum -y install tar &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install wget &amp;&gt; /dev/null)</span><br><span class="line">    command_exists tar || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install tar &amp;&gt; /dev/null)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_keepalived</span></span>()&#123;</span><br><span class="line">    [ -d <span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span> ] &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived已存在，安装失败&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;开始安装Keepalived&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;开始安装Keepalived依赖包&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> -a <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ];<span class="keyword">then</span></span><br><span class="line">        URL=mirrors.sjtug.sjtu.edu.cn</span><br><span class="line">        <span class="keyword">if</span> [ ! `grep -R <span class="string">&quot;\[PowerTools\]&quot;</span> /etc/yum.repos.d/` ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt; /etc/yum.repos.d/PowerTools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;URL&#125;/rocky/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -a <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ];<span class="keyword">then</span></span><br><span class="line">        URL=mirrors.cloud.tencent.com</span><br><span class="line">        <span class="keyword">if</span> [ ! `grep -R <span class="string">&quot;\[PowerTools\]&quot;</span> /etc/yum.repos.d/` ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt; /etc/yum.repos.d/PowerTools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;URL&#125;/centos/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install make gcc ipvsadm autoconf automake openssl-devel libnl3-devel iptables-devel ipset-devel file-devel net-snmp-devel glib2-devel pcre2-devel libnftnl-devel libmnl-devel systemd-devel &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 7 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install make gcc libnfnetlink-devel libnfnetlink ipvsadm libnl libnl-devel libnl3 libnl3-devel lm_sensors-libs net-snmp-agent-libs net-snmp-libs openssh-server openssh-clients openssl openssl-devel automake iproute &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 20 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        apt update &amp;&gt; /dev/null;apt -y install make gcc ipvsadm build-essential pkg-config automake autoconf libipset-dev libnl-3-dev libnl-genl-3-dev libssl-dev libxtables-dev libip4tc-dev libip6tc-dev libipset-dev libmagic-dev libsnmp-dev libglib2.0-dev libpcre2-dev libnftnl-dev libmnl-dev libsystemd-dev</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        apt update &amp;&gt; /dev/null;apt -y install make gcc ipvsadm build-essential pkg-config automake autoconf iptables-dev libipset-dev libnl-3-dev libnl-genl-3-dev libssl-dev libxtables-dev libip4tc-dev libip6tc-dev libipset-dev libmagic-dev libsnmp-dev libglib2.0-dev libpcre2-dev libnftnl-dev libmnl-dev libsystemd-dev &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    tar xf <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span></span><br><span class="line">    KEEPALIVED_DIR=`<span class="built_in">echo</span> <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> | sed -nr <span class="string">&#x27;s/^(.*[0-9]).([[:lower:]]).*/\1/p&#x27;</span>`</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;KEEPALIVED_DIR&#125;</span></span><br><span class="line">    ./configure --prefix=<span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span> --disable-fwmark</span><br><span class="line">    make -j <span class="variable">$CPUS</span> &amp;&amp; make install</span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived编译安装成功&quot;</span><span class="variable">$&#123;END&#125;</span> ||  &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived编译安装失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    [ -d /etc/keepalived ] || <span class="built_in">mkdir</span> -p /etc/keepalived &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/keepalived/keepalived.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">! Configuration File for keepalived</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">   notification_email &#123;</span></span><br><span class="line"><span class="string">     acassen</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   notification_email_from Alexandre.Cassen@firewall.loc</span></span><br><span class="line"><span class="string">   smtp_server 192.168.200.1</span></span><br><span class="line"><span class="string">   smtp_connect_timeout 30</span></span><br><span class="line"><span class="string">   router_id LVS_DEVEL</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">    state $&#123;STATE&#125;</span></span><br><span class="line"><span class="string">    interface $&#123;NET_NAME&#125;</span></span><br><span class="line"><span class="string">    garp_master_delay 10</span></span><br><span class="line"><span class="string">    #smtp_alert</span></span><br><span class="line"><span class="string">    virtual_router_id 51</span></span><br><span class="line"><span class="string">    priority $&#123;PRIORITY&#125;</span></span><br><span class="line"><span class="string">    advert_int 1</span></span><br><span class="line"><span class="string">    authentication &#123;</span></span><br><span class="line"><span class="string">        auth_type PASS</span></span><br><span class="line"><span class="string">        auth_pass 1111</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">        $&#123;VIP&#125; dev $&#123;NET_NAME&#125; label $&#123;NET_NAME&#125;:1</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">cp</span> ./keepalived/keepalived.service /lib/systemd/system/</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;PATH=<span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span>/sbin:<span class="variable">$&#123;PATH&#125;</span>&quot;</span> &gt; /etc/profile.d/keepalived.sh</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl <span class="built_in">enable</span> --now keepalived &amp;&gt; /dev/null </span><br><span class="line">    systemctl is-active keepalived &amp;&gt; /dev/null &amp;&amp; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived 服务启动成功!&quot;</span><span class="variable">$&#123;END&#125;</span> ||  &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived 启动失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span> ; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    check_file</span><br><span class="line">    command_exists</span><br><span class="line">    install_keepalived</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><h2 id="安装keepalived-backup"><a href="#安装keepalived-backup" class="headerlink" title="安装keepalived_backup"></a>安装keepalived_backup</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment">#FileName:      install_keepalived_backup.sh</span></span><br><span class="line"><span class="comment">#Description:   install_keepalived for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8</span></span><br><span class="line"><span class="comment">#*********************************************************************************************</span></span><br><span class="line">SRC_DIR=/usr/local/src</span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">KEEPALIVED_URL=https://keepalived.org/software/</span><br><span class="line">KEEPALIVED_FILE=keepalived-2.2.4.tar.gz</span><br><span class="line">KEEPALIVED_INSTALL_DIR=/apps/keepalived</span><br><span class="line">CPUS=`lscpu |awk <span class="string">&#x27;/^CPU\(s\)/&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">NET_NAME=`ip addr |awk -F<span class="string">&quot;[: ]&quot;</span> <span class="string">&#x27;/^2: e.*/&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">STATE=BACKUP</span><br><span class="line">PRIORITY=80</span><br><span class="line">VIP=172.31.0.188</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    OS_ID_LOWER=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release | <span class="built_in">tr</span> -t <span class="string">&quot;[A-Z]&quot;</span> <span class="string">&quot;[a-z]&quot;</span>`</span><br><span class="line">    OS_RELEASE_VERSION=`sed -rn <span class="string">&#x27;/^VERSION_ID=/s@.*=&quot;?([0-9]+)\.?.*&quot;?@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_file</span></span> ()&#123;</span><br><span class="line">    <span class="built_in">cd</span>  <span class="variable">$&#123;SRC_DIR&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -e <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;缺少<span class="variable">$&#123;KEEPALIVED_FILE&#125;</span>文件,如果是离线包,请把文件放到<span class="variable">$&#123;SRC_DIR&#125;</span>目录下&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&#x27;开始下载Keepalived源码包&#x27;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        wget <span class="variable">$&#123;KEEPALIVED_URL&#125;</span><span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived源码包下载失败&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;相关文件已准备好&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 检查命令是否存在的函数</span></span><br><span class="line"><span class="function"><span class="title">command_exists</span></span>() &#123;</span><br><span class="line">    <span class="built_in">command</span> -v <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> || <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || yum -y install wget &amp;&gt; /dev/null</span><br><span class="line">    command_exists tar || yum -y install tar &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在检查并安装wget和tar，请稍等！&quot;</span></span><br><span class="line">    command_exists wget || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install wget &amp;&gt; /dev/null)</span><br><span class="line">    command_exists tar || (apt-get update &amp;&gt;/dev/null &amp;&amp; apt-get -y install tar &amp;&gt; /dev/null)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_keepalived</span></span>()&#123;</span><br><span class="line">    [ -d <span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span> ] &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived已存在，安装失败&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;开始安装Keepalived&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;开始安装Keepalived依赖包&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> -a <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ];<span class="keyword">then</span></span><br><span class="line">        URL=mirrors.sjtug.sjtu.edu.cn</span><br><span class="line"><span class="keyword">if</span> [ ! `grep -R <span class="string">&quot;\[PowerTools\]&quot;</span> /etc/yum.repos.d/` ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt; /etc/yum.repos.d/PowerTools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;URL&#125;/rocky/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -a <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ];<span class="keyword">then</span></span><br><span class="line">        URL=mirrors.cloud.tencent.com</span><br><span class="line">        <span class="keyword">if</span> [ ! `grep -R <span class="string">&quot;\[PowerTools\]&quot;</span> /etc/yum.repos.d/` ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cat</span> &gt; /etc/yum.repos.d/PowerTools.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[PowerTools]</span></span><br><span class="line"><span class="string">name=PowerTools</span></span><br><span class="line"><span class="string">baseurl=https://$&#123;URL&#125;/centos/\$releasever/PowerTools/\$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 8 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install make gcc ipvsadm autoconf automake openssl-devel libnl3-devel iptables-devel ipset-devel file-devel net-snmp-devel glib2-devel pcre2-devel libnftnl-devel libmnl-devel systemd-devel &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 7 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        yum -y install make gcc libnfnetlink-devel libnfnetlink ipvsadm libnl libnl-devel libnl3 libnl3-devel lm_sensors-libs net-snmp-agent-libs net-snmp-libs openssh-server openssh-clients openssl openssl-devel automake iproute &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$&#123;OS_RELEASE_VERSION&#125;</span> == 20 ]] &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        apt update &amp;&gt; /dev/null;apt -y install make gcc ipvsadm build-essential pkg-config automake autoconf libipset-dev libnl-3-dev libnl-genl-3-dev libssl-dev libxtables-dev libip4tc-dev libip6tc-dev libipset-dev libmagic-dev libsnmp-dev libglib2.0-dev libpcre2-dev libnftnl-dev libmnl-dev libsystemd-dev</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        apt update &amp;&gt; /dev/null;apt -y install make gcc ipvsadm build-essential pkg-config automake autoconf iptables-dev libipset-dev libnl-3-dev libnl-genl-3-dev libssl-dev libxtables-dev libip4tc-dev libip6tc-dev libipset-dev libmagic-dev libsnmp-dev libglib2.0-dev libpcre2-dev libnftnl-dev libmnl-dev libsystemd-dev &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    tar xf <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span></span><br><span class="line">    KEEPALIVED_DIR=`<span class="built_in">echo</span> <span class="variable">$&#123;KEEPALIVED_FILE&#125;</span> | sed -nr <span class="string">&#x27;s/^(.*[0-9]).([[:lower:]]).*/\1/p&#x27;</span>`</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;KEEPALIVED_DIR&#125;</span></span><br><span class="line">    ./configure --prefix=<span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span> --disable-fwmark</span><br><span class="line">    make -j <span class="variable">$CPUS</span> &amp;&amp; make install</span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived编译安装成功&quot;</span><span class="variable">$&#123;END&#125;</span> ||  &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived编译安装失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line">    [ -d /etc/keepalived ] || <span class="built_in">mkdir</span> -p /etc/keepalived &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">cat</span> &gt; /etc/keepalived/keepalived.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">! Configuration File for keepalived</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">   notification_email &#123;</span></span><br><span class="line"><span class="string">     acassen</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   notification_email_from Alexandre.Cassen@firewall.loc</span></span><br><span class="line"><span class="string">   smtp_server 192.168.200.1</span></span><br><span class="line"><span class="string">   smtp_connect_timeout 30</span></span><br><span class="line"><span class="string">   router_id LVS_DEVEL</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">    state $&#123;STATE&#125;</span></span><br><span class="line"><span class="string">    interface $&#123;NET_NAME&#125;</span></span><br><span class="line"><span class="string">    garp_master_delay 10</span></span><br><span class="line"><span class="string">    #smtp_alert</span></span><br><span class="line"><span class="string">    virtual_router_id 51</span></span><br><span class="line"><span class="string">    priority $&#123;PRIORITY&#125;</span></span><br><span class="line"><span class="string">    advert_int 1</span></span><br><span class="line"><span class="string">    authentication &#123;</span></span><br><span class="line"><span class="string">        auth_type PASS</span></span><br><span class="line"><span class="string">        auth_pass 1111</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">        $&#123;VIP&#125; dev $&#123;NET_NAME&#125; label $&#123;NET_NAME&#125;:1</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">cp</span> ./keepalived/keepalived.service /lib/systemd/system/</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;PATH=<span class="variable">$&#123;KEEPALIVED_INSTALL_DIR&#125;</span>/sbin:<span class="variable">$&#123;PATH&#125;</span>&quot;</span> &gt; /etc/profile.d/keepalived.sh</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl <span class="built_in">enable</span> --now keepalived &amp;&gt; /dev/null </span><br><span class="line">    systemctl is-active keepalived &amp;&gt; /dev/null &amp;&amp; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived 服务启动成功!&quot;</span><span class="variable">$&#123;END&#125;</span> ||  &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived 启动失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span> ; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;Keepalived安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    check_file</span><br><span class="line">    command_exists</span><br><span class="line">    install_keepalived</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>这个脚本用于在CentOS 7&#x2F;8、Ubuntu 18.04&#x2F;20.04和Rocky 8上安装和配置Keepalived，具体步骤如下：</p><ol><li><strong>定义必要的变量</strong>：</li></ol><ul><li><code>SRC_DIR</code>: 源码目录。</li><li><code>COLOR</code> 和 <code>END</code>: 用于控制台输出颜色。</li><li><code>KEEPALIVED_URL</code> 和 <code>KEEPALIVED_FILE</code>: Keepalived 的下载链接和文件名。</li><li><code>KEEPALIVED_INSTALL_DIR</code>: Keepalived 安装目录。</li><li><code>CPUS</code>: 获取CPU数量，用于并行编译。</li><li><code>NET_NAME</code>: 获取网络接口名称。</li><li><code>STATE</code>, <code>PRIORITY</code>, 和 <code>VIP</code>: Keepalived 的虚拟路由器配置参数。</li></ul><ol start="2"><li><strong>检测操作系统类型</strong>：</li></ol><ul><li><code>os</code> 函数通过解析 <code>/etc/os-release</code> 文件检测操作系统类型和版本。</li></ul><ol start="3"><li><strong>检查并下载Keepalived源码文件</strong>： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check_file</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数：</span><br><span class="line">  - 确保下载工具 `wget` 已安装。检查指定的Keepalived源码文件是否存在，如果是离线安装，需要手动将下载好的文件放在指定目录。</span><br><span class="line">  - 如果文件不存在，则从远程下载。</span><br></pre></td></tr></table></figure></li><li><strong>安装Keepalived及其依赖</strong>：</li></ol> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install_keepalived</span><br></pre></td></tr></table></figure><pre><code> 函数： - 检查Keepalived是否已经安装，如果是，则退出。 - 安装所需的依赖包。 - 不同的操作系统和版本安装不同的依赖包。 - 解压Keepalived源码包，编译并安装。 - 创建并配置 `keepalived.conf` 配置文件。 - 安装 `keepalived.service` 服务文件。 - 将Keepalived的 `sbin` 目录添加到系统路径中。 - 启动并设置Keepalived服务自启动。如果启动成功，则输出安装完成信息。</code></pre><ol start="5"><li><strong>脚本的主函数</strong>：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main</span><br></pre></td></tr></table></figure><pre><code> 函数： - 依次调用`os`、`check_file` 和 `install_keepalived` 函数，实现Keepalived的安装和配置。</code></pre>]]></content>
    
    
    <summary type="html">安装keepalived的脚本</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_chrony_server</title>
    <link href="http://example.com/2024/03/04/%E5%AE%89%E8%A3%85chrony%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%84%9A%E6%9C%AC%20/"/>
    <id>http://example.com/2024/03/04/%E5%AE%89%E8%A3%85chrony%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%84%9A%E6%9C%AC%20/</id>
    <published>2024-03-04T01:25:00.000Z</published>
    <updated>2024-03-04T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装chrony服务端"><a href="#安装chrony服务端" class="headerlink" title="安装chrony服务端"></a>安装chrony服务端</h2><ul><li>感觉和安装客户端步骤差不多，如果想在内网其他机器中做一台时间服务器可以用这个</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment"># FileName:      install_chrony_server.sh</span></span><br><span class="line"><span class="comment"># Description:   install_chrony_server for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8</span></span><br><span class="line"><span class="comment">#*********************************************************************************************</span></span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=`sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Detected OS: <span class="variable">$&#123;OS_ID&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">is_installed</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">command</span> -v chronyd &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_chrony</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> is_installed; <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony已安装，跳过安装过程&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ] &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;安装 chrony 中...&quot;</span></span><br><span class="line">            yum -y install chrony</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;安装 chrony 中...&quot;</span></span><br><span class="line">            apt -y install chrony</span><br><span class="line">            <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configure_chrony</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="variable">$&#123;OS_ID&#125;</span> == <span class="string">&quot;Rocky&quot;</span> ] &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;配置 chrony 中...&quot;</span></span><br><span class="line">        sed -i -e <span class="string">&#x27;/^pool.*/d&#x27;</span> -e <span class="string">&#x27;/^server.*/d&#x27;</span> -e <span class="string">&#x27;/^# Please consider .*/a\server ntp.aliyun.com iburst\nserver time1.cloud.tencent.com iburst\nserver ntp.tuna.tsinghua.edu.cn iburst&#x27;</span> -e <span class="string">&#x27;s@^#allow.*@allow 0.0.0.0/0@&#x27;</span> -e <span class="string">&#x27;s@^#local.*@local stratum 10@&#x27;</span> /etc/chrony.conf</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;配置 chrony 中...&quot;</span></span><br><span class="line">        sed -i -e <span class="string">&#x27;/^pool.*/d&#x27;</span> -e <span class="string">&#x27;/^# See http:.*/a\server ntp.aliyun.com iburst\nserver time1.cloud.tencent.com iburst\nserver ntp.tuna.tsinghua.edu.cn iburst&#x27;</span> /etc/chrony/chrony.conf</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;allow 0.0.0.0/0&quot;</span> &gt;&gt; /etc/chrony/chrony.conf</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;local stratum 10&quot;</span> &gt;&gt; /etc/chrony/chrony.conf</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;启动并启用 chronyd 服务中...&quot;</span></span><br><span class="line">    systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line">    systemctl is-active chronyd &amp;&gt; /dev/null ||  &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 启动失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span> ; <span class="built_in">exit</span>; &#125;</span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 配置完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">show_status</span></span>()&#123;</span><br><span class="line">    systemctl restart chronyd</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;请耐心等待5秒，时间服务器同步中！&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前使用的时间服务器：&quot;</span></span><br><span class="line">    chronyc sources</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前同步状态：&quot;</span></span><br><span class="line">    chronyc tracking</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    install_chrony</span><br><span class="line">    configure_chrony</span><br><span class="line">    show_status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install_chrony_server for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8,理论上其他版本也可安装</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Linux批量创建用户脚本</title>
    <link href="http://example.com/2024/03/03/Linux%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/03/Linux%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-03T01:25:00.000Z</published>
    <updated>2024-03-03T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux批量创建用户脚本"><a href="#Linux批量创建用户脚本" class="headerlink" title="Linux批量创建用户脚本"></a>Linux批量创建用户脚本</h2><ul><li><code>userlist.txt</code>文件遵循<code>用户名:密码:是否创建家目录(Y/N):是否允许登录(Y/N):组名</code>的格式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">johndoe:password123:Y:Y:IT,marketing</span><br></pre></td></tr></table></figure><blockquote><p>tips:是否允许登录(Y&#x2F;N)这一条不写东西，默认就是允许用户登录</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名单文件位置</span></span><br><span class="line">USERLIST=/root/userlist.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查并确保用户列表文件存在</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$USERLIST</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用户列表文件不存在: <span class="variable">$USERLIST</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组的函数，如果组不存在则创建它</span></span><br><span class="line"><span class="function"><span class="title">ensure_group_exists</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> group_name=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> ! getent group <span class="string">&quot;<span class="variable">$group_name</span>&quot;</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;组 <span class="variable">$group_name</span> 不存在，正在创建...&quot;</span></span><br><span class="line">        groupadd <span class="string">&quot;<span class="variable">$group_name</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;无法创建组: <span class="variable">$group_name</span>&quot;</span> &gt;&amp;2</span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行读取 userlist.txt 文件内容并创建用户</span></span><br><span class="line"><span class="keyword">while</span> IFS=: <span class="built_in">read</span> -r username password create_home allow_login <span class="built_in">groups</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 检查是否创建家目录</span></span><br><span class="line">    home_option=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$create_home</span>&quot;</span> = <span class="string">&quot;Y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        home_option=<span class="string">&quot;-m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据是否允许登录设置shell</span></span><br><span class="line">    shell_option=<span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$allow_login</span>&quot;</span> = <span class="string">&quot;N&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        shell_option=<span class="string">&quot;/usr/sbin/nologin&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分割组名，确保每个组都存在</span></span><br><span class="line">    IFS=<span class="string">&#x27;,&#x27;</span> <span class="built_in">read</span> -ra GROUP_ARRAY &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$groups</span>&quot;</span></span><br><span class="line">    <span class="keyword">for</span> group <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;GROUP_ARRAY[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        ensure_group_exists <span class="string">&quot;<span class="variable">$group</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将分割后的组名数组转换为逗号分隔的字符串</span></span><br><span class="line">    groups_option=$(IFS=,; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;GROUP_ARRAY[*]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建用户，并且将用户添加到指定的多个组</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在添加用户 <span class="variable">$username</span>...&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$groups_option</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        useradd <span class="variable">$home_option</span> -s <span class="variable">$shell_option</span> <span class="string">&quot;<span class="variable">$username</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        useradd <span class="variable">$home_option</span> -s <span class="variable">$shell_option</span> -G <span class="string">&quot;<span class="variable">$groups_option</span>&quot;</span> <span class="string">&quot;<span class="variable">$username</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;添加用户 <span class="variable">$username</span> 失败&quot;</span> &gt;&amp;2</span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置用户密码</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$username</span>:<span class="variable">$password</span>&quot;</span> | chpasswd</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;为用户 <span class="variable">$username</span> 设置密码失败&quot;</span> &gt;&amp;2</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;用户 <span class="variable">$username</span> 添加成功。&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$USERLIST</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;用户创建过程完成。&quot;</span></span><br></pre></td></tr></table></figure><ul><li>赋予权限并执行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /path/to/your/script.sh</span><br><span class="line">bash /path/to/your/script.sh</span><br></pre></td></tr></table></figure><h3 id="指定主组"><a href="#指定主组" class="headerlink" title="指定主组"></a>指定主组</h3><ul><li>确保将第一组名作为主组，并确保其余组名作为附加组。这样就可以准确地控制用户属于的主组和附加组。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">USERLIST=/root/userlist.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$USERLIST</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用户列表文件不存在: <span class="variable">$USERLIST</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ensure_group_exists</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> group_name=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> ! getent group <span class="string">&quot;<span class="variable">$group_name</span>&quot;</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;组 <span class="variable">$group_name</span> 不存在，正在创建...&quot;</span></span><br><span class="line">        groupadd <span class="string">&quot;<span class="variable">$group_name</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;无法创建组: <span class="variable">$group_name</span>&quot;</span> &gt;&amp;2</span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> IFS=: <span class="built_in">read</span> -r username password create_home allow_login <span class="built_in">groups</span>; <span class="keyword">do</span></span><br><span class="line">    home_option=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$create_home</span>&quot;</span> = <span class="string">&quot;Y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        home_option=<span class="string">&quot;-m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    shell_option=<span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$allow_login</span>&quot;</span> = <span class="string">&quot;N&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        shell_option=<span class="string">&quot;/usr/sbin/nologin&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    IFS=<span class="string">&#x27;,&#x27;</span> <span class="built_in">read</span> -ra GROUP_ARRAY &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$groups</span>&quot;</span></span><br><span class="line">    main_group=<span class="variable">$&#123;GROUP_ARRAY[0]&#125;</span></span><br><span class="line">    <span class="keyword">for</span> group <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;GROUP_ARRAY[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        ensure_group_exists <span class="string">&quot;<span class="variable">$group</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    groups_option=$(IFS=,; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;GROUP_ARRAY[*]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在添加用户 <span class="variable">$username</span>...&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$groups_option</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        useradd <span class="variable">$home_option</span> -s <span class="variable">$shell_option</span> <span class="string">&quot;<span class="variable">$username</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        useradd <span class="variable">$home_option</span> -s <span class="variable">$shell_option</span> -g <span class="string">&quot;<span class="variable">$main_group</span>&quot;</span> -G <span class="string">&quot;<span class="variable">$groups_option</span>&quot;</span> <span class="string">&quot;<span class="variable">$username</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;添加用户 <span class="variable">$username</span> 失败&quot;</span> &gt;&amp;2</span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$username</span>:<span class="variable">$password</span>&quot;</span> | chpasswd</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;为用户 <span class="variable">$username</span> 设置密码失败&quot;</span> &gt;&amp;2</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;用户 <span class="variable">$username</span> 添加成功。&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$USERLIST</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;用户创建过程完成。&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以批量创建用户，并且指定密码，属组等信息</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>install_chrony_client</title>
    <link href="http://example.com/2024/03/03/%E5%AE%89%E8%A3%85chrony%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/03/03/%E5%AE%89%E8%A3%85chrony%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC/</id>
    <published>2024-03-03T01:25:00.000Z</published>
    <updated>2024-03-03T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装chrony客户端"><a href="#安装chrony客户端" class="headerlink" title="安装chrony客户端"></a>安装chrony客户端</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#**********************************************************************************************</span></span><br><span class="line"><span class="comment">#FileName:      install_chrony_client.sh</span></span><br><span class="line"><span class="comment">#Description:   install_chrony_client for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8</span></span><br><span class="line"><span class="comment">#*********************************************************************************************</span></span><br><span class="line">COLOR=<span class="string">&quot;echo -e \\033[01;31m&quot;</span></span><br><span class="line">END=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line">SERVERS=(<span class="string">&quot;172.31.1.8&quot;</span> <span class="string">&quot;172.31.1.9&quot;</span> <span class="string">&quot;172.31.1.10&quot;</span>)  <span class="comment"># 这里添加多个服务器地址</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">os</span></span>()&#123;</span><br><span class="line">    OS_ID=$(sed -rn <span class="string">&#x27;/^NAME=/s@.*=&quot;([[:alpha:]]+).*&quot;$@\1@p&#x27;</span> /etc/os-release)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_chrony_installed</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;Rocky&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        rpm -q chrony &amp;&gt; /dev/null &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 已经安装&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span> 0; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        dpkg -l | grep -qw chrony &amp;&amp; &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 已经安装&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span> 0; &#125;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configure_chrony</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;Rocky&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        CHRONY_CONF=<span class="string">&quot;/etc/chrony.conf&quot;</span></span><br><span class="line">        sed -i -e <span class="string">&#x27;/^pool.*/d&#x27;</span> -e <span class="string">&#x27;/^server.*/d&#x27;</span> /etc/chrony.conf</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        CHRONY_CONF=<span class="string">&quot;/etc/chrony/chrony.conf&quot;</span></span><br><span class="line">        sed -i -e <span class="string">&#x27;/^pool.*/d&#x27;</span> /etc/chrony/chrony.conf</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> SERVER <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;SERVERS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;server <span class="variable">$&#123;SERVER&#125;</span> iburst&quot;</span> &gt;&gt; <span class="variable">$&#123;CHRONY_CONF&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_chrony</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Installing chrony on <span class="variable">$&#123;OS_ID&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$&#123;OS_ID&#125;</span>&quot;</span> == <span class="string">&quot;Rocky&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        yum -y install chrony</span><br><span class="line">        configure_chrony</span><br><span class="line">        systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line">        systemctl is-active chronyd || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 启动失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        apt -y install chrony</span><br><span class="line">        configure_chrony</span><br><span class="line">        systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line">        systemctl is-active chronyd || &#123; <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 启动失败,退出!&quot;</span><span class="variable">$&#123;END&#125;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line">        systemctl restart chronyd</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;COLOR&#125;</span><span class="string">&quot;chrony 安装完成&quot;</span><span class="variable">$&#123;END&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">show_status</span></span>()&#123;</span><br><span class="line">    systemctl restart chronyd</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;请耐心等待5秒，时间服务器同步中！&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前使用的时间服务器：&quot;</span></span><br><span class="line">    chronyc sources</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    os</span><br><span class="line">    check_chrony_installed</span><br><span class="line">    install_chrony</span><br><span class="line">    show_status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install_chrony_client for CentOS 7/8 &amp; Ubuntu 18.04/20.04 &amp; Rocky 8，理论上其他版本也可安装</summary>
    
    
    
    <category term="Shell脚本" scheme="http://example.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell脚本" scheme="http://example.com/tags/Shell%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>Linux计划任务</title>
    <link href="http://example.com/2024/03/01/linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/"/>
    <id>http://example.com/2024/03/01/linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/</id>
    <published>2024-03-01T01:25:00.000Z</published>
    <updated>2024-03-01T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux计划任务"><a href="#Linux计划任务" class="headerlink" title="Linux计划任务"></a>Linux计划任务</h2><ul><li>可以预览计划任务的网站</li></ul><p><a href="https://crontab.guru/#5_4_*_*_*">Crontab.guru - The cron schedule expression generator</a></p><h3 id="1、什么是计划任务"><a href="#1、什么是计划任务" class="headerlink" title="1、什么是计划任务"></a>1、什么是计划任务</h3><blockquote><p>简单来说，就是某些我们需要定时执行的任务，可以是某条命令，也可以是某个脚本。</p></blockquote><h3 id="2、计划任务使用场景"><a href="#2、计划任务使用场景" class="headerlink" title="2、计划任务使用场景"></a>2、计划任务使用场景</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.按天进行日志切割</span><br><span class="line">2.定时同步互联网时间</span><br><span class="line">3.每天备份数据库数据</span><br><span class="line">4.定时删除不需要的日志文件或临时文件</span><br><span class="line">5.定时获取系统的状态信息</span><br></pre></td></tr></table></figure><h3 id="3、计划任务设置"><a href="#3、计划任务设置" class="headerlink" title="3、计划任务设置"></a>3、计划任务设置</h3><h4 id="3-1-计划任务配置文件"><a href="#3-1-计划任务配置文件" class="headerlink" title="3.1 计划任务配置文件"></a>3.1 计划任务配置文件</h4><p>Linux中最常用的计划任务服务为crond服务，该服务可以设置计划周期性的定时运行某些命令或脚本。</p><p><strong>计划任务配置文件：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/crontab        //crond计划任务列表配置文件</span><br><span class="line">/etc/cron.deny      //该文件中所写用户无法使用crond计划任务</span><br><span class="line">/var/spool/cron/*   //用户计划任务文件都存放此目录，文件以用户名命名</span><br><span class="line">/var/log/cron       //定时任务执行后的日志文件</span><br></pre></td></tr></table></figure><h4 id="3-2-计划任务配置"><a href="#3-2-计划任务配置" class="headerlink" title="3.2 计划任务配置"></a>3.2 计划任务配置</h4><p>crond计划任务服务提供了crontab命令来创建和管理计划任务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">crontab [选项]</span><br><span class="line"></span><br><span class="line">命令选项：</span><br><span class="line">-e      //编辑当前用户计划任务文件</span><br><span class="line">-l      //查看当前用户计划任务文件内容</span><br><span class="line">-r      //删除当前用户计划任务文件内容</span><br><span class="line">-u      //管理其他用户的计划任务</span><br><span class="line"></span><br><span class="line">注意: crontab命令实际上就是在操作/var/spool/cron/username。</span><br></pre></td></tr></table></figure><p><strong>计划任务书写格式：参考&#x2F;etc&#x2F;crontab配置文件中的格式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.---------------- minute (0 - 59) //分钟</span><br><span class="line">|  .------------- hour (0 - 23)   //小时</span><br><span class="line">|  |  .---------- day of month (1 - 31)   //日期</span><br><span class="line">|  |  |  .------- month (1 - 12) OR jan,feb,mar,apr //月份</span><br><span class="line">|  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat  //星期</span><br><span class="line">|  |  |  |  |</span><br><span class="line">*  *  *  *  *   user-name  <span class="built_in">command</span> to be executed</span><br><span class="line">分 时 日 月 周</span><br><span class="line"></span><br><span class="line">*//表示每，任意(分、时、日、月、周)时间都执行</span><br><span class="line">*///表示每隔；例如：*/10 每隔10分钟</span><br><span class="line">-//表示时间范围段；例如：5-7点 5点到7点</span><br><span class="line">,//表示和, 例如：4,6,0 周四、周六和周日</span><br></pre></td></tr></table></figure><h4 id="3-3-计划任务时间练习"><a href="#3-3-计划任务时间练习" class="headerlink" title="3.3 计划任务时间练习"></a>3.3 计划任务时间练习</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* * * * *//每分钟都执行</span><br><span class="line">0 0 * * *//每天0点执行</span><br><span class="line">30 1 * * *//每天凌晨1点30分执行</span><br><span class="line">0 * * * *//每小时执行</span><br><span class="line">0 */2 * * *//每隔两小时执行</span><br><span class="line">*/30 * * * *//每隔30分钟执行</span><br><span class="line">0 1 15 * *//每月的15号凌晨1点钟执行</span><br><span class="line">0 5 1-14 * *//每月1号-14号凌晨5点钟执行</span><br><span class="line">0 6-8 */5 * *//每隔5天的上午6点-8点整执行</span><br><span class="line">0 20-23/1 * * *//每天晚上8点-11点之间，每隔1小时执行</span><br><span class="line">0 23 * * 1-3//周一到周三每天晚上11点整执行</span><br></pre></td></tr></table></figure><h4 id="3-4-编写计划任务注意事项"><a href="#3-4-编写计划任务注意事项" class="headerlink" title="3.4 编写计划任务注意事项"></a>3.4 编写计划任务注意事项</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//编写计划任务时务必添加该计划任务的注释信息</span><br><span class="line">[root@localhost ~]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#print string &quot;hello world&quot;</span></span><br><span class="line">*/5 * * * * /usr/bin/echo <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">//在计划任务中执行命令，命令最好用绝对路径</span><br><span class="line">//写入计划任务中的命令先拿到命令行执行一遍，看结果是否成功</span><br><span class="line">[root@localhost ~]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#print string &quot;hello world&quot;</span></span><br><span class="line">*/5 * * * * /usr/bin/echo <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">//计划任务输出结果可用<span class="string">&quot;&gt;&quot;</span>重定向到指定文件</span><br><span class="line">[root@localhost ~]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#print string &quot;hello world&quot;</span></span><br><span class="line">*/5 * * * * /usr/bin/echo <span class="string">&quot;hello world&quot;</span> &amp;&gt; /dev/null</span><br></pre></td></tr></table></figure><p><strong>计划任务流程规范：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">流程规范:</span><br><span class="line">1.先在测试环境中实践，千万不要上来就用生产服务器；</span><br><span class="line">2.先理解需求；</span><br><span class="line">3.写入计划任务中的命令先拿到命令行执行一遍；</span><br><span class="line">4.脚本需要先进行测试，测试脚本是否可以正常执行；</span><br><span class="line">5.写入计划任务里的任务，可以先将任务时间间隔缩短，方便测试；</span><br><span class="line">6.执行过程如果需要，强烈建议写进日志。</span><br></pre></td></tr></table></figure><h3 id="4、crontab计划任务示例"><a href="#4、crontab计划任务示例" class="headerlink" title="4、crontab计划任务示例"></a>4、crontab计划任务示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//每天凌晨3点备份系统中配置文件目录</span><br><span class="line">[root@localhost ~]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#directory /etc/ backup</span></span><br><span class="line">0 3 * * * /usr/bin/tar -zcf /root/etc_backup.tar.gz /etc/ &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">//每天隔1小时获取系统负载情况，并将信息存放到日志文件中</span><br><span class="line">[root@localhost ~]<span class="comment"># vim systemload.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/bin/echo <span class="string">&quot;<span class="subst">$(date <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> load average:<span class="subst">$(/usr/bin/top -n 1 -b | /usr/bin/awk -F &#x27;:&#x27; &#x27;NR==1 &#123;print$5&#125;&#x27;)</span>&quot;</span> &amp;&gt;&gt; /root/systemload.log</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># chmod +x systemload.sh</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#get system load information</span></span><br><span class="line">0 */1 * * * /root/systemload.sh</span><br></pre></td></tr></table></figure><h3 id="5、crond计划任务调试"><a href="#5、crond计划任务调试" class="headerlink" title="5、crond计划任务调试"></a>5、crond计划任务调试</h3><blockquote><ol><li>调整任务每分钟执行, 检测是否是否正常, 有些任务不要频繁执行</li><li>调整系统时间然后在检测任务, 生产不建议直接使用此方式</li><li>执行脚本, 将脚本执行输出写入指定日志文件, 观察日志内容是否正常</li><li>注意一些任务命令带来的问题echo “wangqing” &gt;&gt;&#x2F;tmp&#x2F;test.log &amp;&gt;&#x2F;dev&#x2F;null</li><li>命令使用绝对路径, 防止无法找到命令导致定时任务执行故障</li><li>查看&#x2F;var&#x2F;log&#x2F;cron日志进行调试</li></ol></blockquote><p>建议: 将需要定期执行的任务写入脚本中, 建立&#x2F;scripts目录统一存放脚本, 脚本中命令必须使用绝对路径,手动执行脚本检测输出是否正常, 然后将脚本加入计划任务测试, 测试后无问题将脚本输出写入对应的日志文件中即可。</p><p>计划任务添加步骤：</p><ol><li>手动执行保留执行命令的正确结果</li><li>编写脚本<ul><li>脚本需要统一路径&#x2F;scripts</li><li>脚本开头建议填写注释信息, 包括执行时间、周期、任务</li><li>脚本内容复制执行成功的命令至脚本文件中(减少每个环节出错几率)</li><li>脚本内容尽可能的优化, 使用一些变量或使用简单的判断语句</li><li>脚本执行的输出信息不要随意打印, 可以重定向至其他位置保留或丢入黑洞</li></ul></li><li>执行脚本<ul><li>使用bash执行, 防止脚本没有增加执行权限(&#x2F;bin&#x2F;bash)</li><li>执行命令以及脚本成功后并复制该命令</li></ul></li><li>编写计划任务<ul><li>加上必要的注释信息, 人、时间、任务</li><li>设定计划任务执行的周期</li><li>加入执行脚本的命令</li></ul></li><li>调试计划任务<ul><li>增加任务频率测试、调整系统时间测试(不能用于生产)</li><li>检查环境变量问题、检查crond服务产生日志进行排查</li></ul></li></ol>]]></content>
    
    
    <summary type="html">crontab计划任务，定时执行，解放双手</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>yum包管理详解</title>
    <link href="http://example.com/2024/02/26/23.yum%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2024/02/26/23.yum%E7%AE%A1%E7%90%86/</id>
    <published>2024-02-26T01:25:00.000Z</published>
    <updated>2024-02-26T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="yum是什么"><a href="#yum是什么" class="headerlink" title="yum是什么"></a>yum是什么</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yum 是 RedHat 软件包管理器，它能够查询有关可用软件包的信息，从存储库获取软件包，安装和卸载软件包，以及将整个系统更新到最新的可用版本。Yum在更新，安装或删除软件包时执行自动依赖性解析，因此能够自动确定，获取和安装所有可用的依赖软件包。</span><br><span class="line">Yum可以配置新的，额外的存储库或包源，还提供许多增强和扩展其功能的插件。百胜可以执行许多与RPM相同的任务; 此外，许多命令行选项都是类似的。Yum可以在一台计算机或一组计算机上轻松简单地进行包管理。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重要TIP：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Yum通过为所有软件包存储库（软件包源）或单个存储库启用GPG签名软件包上的GPG（Gnu Privacy Guard;也称为GnuPG）签名验证，提供安全的软件包管理。启用签名验证后，yum将拒绝安装任何未使用该存储库的正确密钥进行GPG签名的软件包。这意味着您可以相信您在系统上下载和安装的RPM软件包来自受信任的来源，例如RedHat，并且在传输过程中未进行修改。</span></span><br></pre></td></tr></table></figure><h3 id="软件的类型"><a href="#软件的类型" class="headerlink" title="软件的类型"></a>软件的类型</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">源码包：需要编译</span><br><span class="line">二进制包：已编译</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">常见二进制包</span></span><br><span class="line">RedHat/Centos中：</span><br><span class="line">RPM</span><br><span class="line">工具:rpm、yum(自动解决依赖关系)</span><br><span class="line">--------------------------------</span><br><span class="line">Ubuntu/Debain中：</span><br><span class="line">DPKG</span><br><span class="line">工具：dpkg、apt(在线安装，自动解决依赖关系)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意！不管是源码包，还是二进制包，安装时都可能会有依赖关系</span></span><br></pre></td></tr></table></figure><h3 id="yum官方源"><a href="#yum官方源" class="headerlink" title="yum官方源"></a>yum官方源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">阿里云</span><br><span class="line">https://developer.aliyun.com/mirror/</span><br><span class="line"></span><br><span class="line">中科大</span><br><span class="line">http://centos.ustc.edu.cn/</span><br><span class="line"></span><br><span class="line">网易</span><br><span class="line">http://mirrors.163.com/</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum repolist    #查看默认的源</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.163.com</span><br><span class="line"> * extras: mirrors.163.com</span><br><span class="line"> * updates: mirrors.163.com</span><br><span class="line">源标识                       源名称                     状态</span><br><span class="line">!base/7/x86_64        CentOS-7 - Base                 10,072</span><br><span class="line">!extras/7/x86_64      CentOS-7 - Extras               500</span><br><span class="line">!updates/7/x86_64     CentOS-7 - Updates              3,407</span><br></pre></td></tr></table></figure><h3 id="加入腾讯云软件仓库"><a href="#加入腾讯云软件仓库" class="headerlink" title="加入腾讯云软件仓库"></a>加入腾讯云软件仓库</h3><p>下面以Centos7为例子</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">先将原来的配置文件备份一下，然后删除</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">[root@server1 ~]# \cp  -rp /etc/yum.repos.d/    /etc/yum.repos.d_back</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.cloud.tencent.com/repo/centos7_base.repo</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.cloud.tencent.com/repo/epel-7.repo</span><br><span class="line">[root@server1 ~]# yum clean all</span><br><span class="line">[root@server1 ~]# yum makecache  #重建缓存</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#结果：</span></span></span><br><span class="line">[root@server1 ~]# yum repolist</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">源标识                    源名称                       状态</span><br><span class="line">extras/7/x86_64     Qcloud centos extras - x86_64      515</span><br><span class="line">os/7/x86_64          Qcloud centos os - x86_64       10,072</span><br><span class="line">updates/7/x86_64     Qcloud centos updates - x86_64   4,538</span><br><span class="line">repolist: 15,125</span><br></pre></td></tr></table></figure><h3 id="EPEL源"><a href="#EPEL源" class="headerlink" title="EPEL源"></a>EPEL源</h3><p>EPEL(Extra Packages for Enterprise Linux)为“红帽系”的操作系统提供额外的软件包。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum -y install epel-release</span><br></pre></td></tr></table></figure><h3 id="yum常用命令"><a href="#yum常用命令" class="headerlink" title="yum常用命令"></a>yum常用命令</h3><h4 id="安装操作"><a href="#安装操作" class="headerlink" title="安装操作"></a>安装操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]#yum install PACKAGE          #安装某个包</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum install httpd</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum groupinstall GROUP       #安装某个软件组</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum groupinstall &quot;KDE&quot;       #安装KDE桌面</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum -y install /root/httpd-2.4.6-93.el7.centos.x86_64.rpm  #从本地安装</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">[root@server1 ~]# yum -y install http://centos.ustc.edu.cn/centos/7/os/x86_64/Packages/httpd-2.4.6-93.el7.centos.x86_64.rpm # 从URL安装</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line">[root@server1 ~]# yum grouplist # 安装环境</span><br></pre></td></tr></table></figure><h4 id="升级操作"><a href="#升级操作" class="headerlink" title="升级操作"></a>升级操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]#yum update                     #更新系统中所有需要更新的包</span><br><span class="line">[root@server1 ~]#yum update PACKAGE             #更新某个包</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum update httpd</span><br><span class="line"></span><br><span class="line">----------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum groupupdate GROUP          #更新某个软件组</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum groupupdate &quot;KDE&quot;          #升级KDE桌面</span><br><span class="line">[root@server1 ~]#yum check-update               #检查当前系统中需要更新的包</span><br></pre></td></tr></table></figure><h4 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]#yum list         #显示软件源中所有可用的包，一般不用</span><br><span class="line"></span><br><span class="line">[root@server1 ~]#yum list installed       #显示系统中已经安装过的包</span><br><span class="line"></span><br><span class="line">[root@server1 ~]#yum info PACKAGE         #显示某个包的信息</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum info httpd</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum groupinfo GROUP       #显示某个软件组的信息</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum groupinfo &quot;KDE&quot;    #显示KDE桌面软件的信息</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum grouplist             #显示软件源宏所有的可用软件组</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">[root@server1 ~]# yum list |grep httpd</span><br><span class="line">httpd.x86_64                                2.4.6-97.el7.centos.2      @updates </span><br><span class="line">httpd-tools.x86_64                          2.4.6-97.el7.centos.2      @updates </span><br><span class="line">httpd-devel.x86_64                          2.4.6-97.el7.centos.2      updates  </span><br><span class="line">httpd-manual.noarch                         2.4.6-97.el7.centos.2      updates  </span><br><span class="line">keycloak-httpd-client-install.noarch        0.8-1.el7                  base     </span><br><span class="line">libmicrohttpd.i686                          0.9.33-2.el7               base     </span><br><span class="line">libmicrohttpd.x86_64                        0.9.33-2.el7               base     </span><br><span class="line">libmicrohttpd-devel.i686                    0.9.33-2.el7               base     </span><br><span class="line">libmicrohttpd-devel.x86_64                  0.9.33-2.el7               base     </span><br><span class="line">libmicrohttpd-doc.noarch                    0.9.33-2.el7               base     </span><br><span class="line">python2-keycloak-httpd-client-install.noarch</span><br></pre></td></tr></table></figure><h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]#yum remove PACKAGE            #删除某个包</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum remove httpd              #删除httpd包</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">[root@server1 ~]#yum groupremove GROUP         #删除某个软件组</span><br><span class="line">例：</span><br><span class="line">[root@server1 ~]#yum groupremove &quot;KDE&quot;         #删除KDE桌面</span><br></pre></td></tr></table></figure><h4 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum clean all   #清空缓存及其他文件</span><br><span class="line">[root@server1 ~]# yum makecache   #重建缓存</span><br><span class="line">[root@server1 ~]# yum repolist    #查询可用的仓库</span><br></pre></td></tr></table></figure><h4 id="历史信息"><a href="#历史信息" class="headerlink" title="历史信息"></a>历史信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum history          #安装历史</span><br><span class="line">[root@server1 ~]# yum history info 4   #事务4的安装信息</span><br><span class="line">[root@server1 ~]# yum history undo 4   #撤销事务4进行的安装</span><br></pre></td></tr></table></figure><h3 id="扩展查询"><a href="#扩展查询" class="headerlink" title="扩展查询"></a>扩展查询</h3><h4 id="从包名和包描述中根据关键字查找"><a href="#从包名和包描述中根据关键字查找" class="headerlink" title="从包名和包描述中根据关键字查找"></a>从包名和包描述中根据关键字查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum list |grep locate</span><br><span class="line">mlocate.x86_64       0.26-8.el7             base     </span><br><span class="line">[root@server1 ~]# yum search locate</span><br></pre></td></tr></table></figure><h4 id="根据配置文件查找软件包"><a href="#根据配置文件查找软件包" class="headerlink" title="根据配置文件查找软件包"></a>根据配置文件查找软件包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum provides /etc/ssh/sshd_config</span><br><span class="line">[root@server1 ~]# yum provides */sshd_config</span><br></pre></td></tr></table></figure><h4 id="查找命令-ifconfig-属于哪个包"><a href="#查找命令-ifconfig-属于哪个包" class="headerlink" title="查找命令 ifconfig 属于哪个包"></a>查找命令 ifconfig 属于哪个包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum provides &quot;/*/ifconfig&quot;</span><br></pre></td></tr></table></figure><h2 id="yum自建源"><a href="#yum自建源" class="headerlink" title="yum自建源"></a>yum自建源</h2><ul><li>Base源[centos7光盘文件]</li><li>第三方软件源[yum缓存]</li></ul><ol><li>提供基础软件包Base[光盘]</li><li>提供update软件包[yum缓存]</li><li>提供其他软件包如 nginx , zabbix , docker [yum缓存]</li></ol><h5 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h5><p>（我初始化时已经设置防火墙开机关闭，可跳过）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# firewall-cmd --permanent --add-service=ftp</span><br><span class="line">[root@server1 ~]# firewall-cmd --reload</span><br></pre></td></tr></table></figure><h5 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# setenforce 0</span><br><span class="line">[root@server1 ~]# sed -i &quot;s/=enforcing/=disabled/g&quot; /etc/sysconfig/selinux</span><br></pre></td></tr></table></figure><h5 id="FTP服务"><a href="#FTP服务" class="headerlink" title="FTP服务"></a>FTP服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum -y install vsftpd</span><br><span class="line">[root@server1 ~]# systemctl start vsftpd</span><br><span class="line">[root@server1 ~]# systemctl enable vsftpd  #enable允许开机启动</span><br></pre></td></tr></table></figure><h4 id="替换源的操作"><a href="#替换源的操作" class="headerlink" title="替换源的操作"></a>替换源的操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# cd /etc/yum.repos.d</span><br><span class="line">[root@server1 yum.repos.d]# rm -rf *</span><br><span class="line">[root@server1 yum.repos.d]# curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">[root@server1 yum.repos.d]# yum clean all</span><br><span class="line">[root@server1 yum.repos.d]# yum makecache</span><br></pre></td></tr></table></figure><h3 id="实验目标一：提供update"><a href="#实验目标一：提供update" class="headerlink" title="实验目标一：提供update"></a>实验目标一：提供update</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.因为要给别人做仓库，首先，清理掉我们自己源</span></span><br><span class="line">[root@server1 ~]# yum clean all</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">正在清理软件源： epel extras os updates</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">Other repos take up 36 M of disk space (use --verbose for details)</span><br><span class="line">-------------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.设置仅下载，不安装</span></span><br><span class="line">[root@server1 ~]# yum update --downloadonly</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下</span></span><br><span class="line">[root@server1 ~]# ls /var/cache/yum/x86_64/7/updates/packages/</span><br></pre></td></tr></table></figure><h4 id="好的方法"><a href="#好的方法" class="headerlink" title="好的方法"></a>好的方法</h4><p>从配置文件里面修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.修改配置文件</span><br><span class="line">[root@server1 ~]# vim /etc/yum.conf</span><br><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/$basearch/$releasever</span><br><span class="line">keepcache=1   #开启yum缓存,0表示不开启，1为开启</span><br><span class="line">debuglevel=2</span><br><span class="line">logfile=/var/log/yum.log</span><br><span class="line">exactarch=1</span><br><span class="line">obsoletes=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">plugins=1</span><br><span class="line">installonly_limit=5</span><br><span class="line">bugtracker_url=http://bugs.centos.org/set_project.php?project_id=23&amp;ref=http://bugs.centos.org/bug_report_page.php?category=yum</span><br><span class="line">distroverpkg=centos-release</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">[root@server1 ~]# yum update -y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在此之前，上面的防火墙和ftp等要配置好</span></span><br><span class="line">3.</span><br><span class="line">[root@server1 ~]# mkdir -p /var/ftp/update</span><br><span class="line">[root@server1 ~]# find /var/cache/yum/x86_64/7/ -iname &quot;*.rpm&quot; -exec cp -rf &#123;&#125; /var/ftp/update/ \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">忽略大小写查找在/var/...这个文件夹里面查找名字为.rpm的文件，不提醒执行强制递归复制它们到/var/ftp/update文件夹</span></span><br><span class="line"></span><br><span class="line">----------------------------</span><br><span class="line">接下来在另一台机子上操作</span><br><span class="line">[root@server2 ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@server2 yum.repos.d]# rm -rf /etc/yum.repos.d/*.repo</span><br><span class="line">[root@server2 yum.repos.d]# vi /etc/yum.repos.d/update.repo</span><br><span class="line">[update]</span><br><span class="line">name=centos update</span><br><span class="line">baseurl=ftp://192.168.153.10/update</span><br><span class="line">gpgcheck=0 #关闭软件包校验</span><br><span class="line">enable=1  #启用这个仓库</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">最后，更新，完成</span></span><br><span class="line">[root@server2 yum.repos.d]# yum update -y</span><br></pre></td></tr></table></figure><h3 id="实验目标二：提供特定软件源"><a href="#实验目标二：提供特定软件源" class="headerlink" title="实验目标二：提供特定软件源"></a>实验目标二：提供特定软件源</h3><p>第一个提供update源仅限环境一致的情况下，不同环境更新包不一样，无法完成</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">一、在yum服务器上操作：</span><br><span class="line">[root@server1 ~]# yum clean all</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Repository cr is listed more than once in the configuration</span><br><span class="line">Repository fasttrack is listed more than once in the configuration</span><br><span class="line">正在清理软件源： epel extras os updates</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">Other repos take up 36 M of disk space (use --verbose for details)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建一个目录专门放nginx安装包</span></span><br><span class="line">[root@server1 ~]# mkdir /var/ftp/nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑一个配置文件，让他从官网下就行了</span></span><br><span class="line">[root@server1 ~]# vi /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo </span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enable=1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">仅下载</span></span><br><span class="line">[root@server1 ~]# yum -y install nginx --downloadonly</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查一下看看，下载好没有</span></span><br><span class="line">[root@server1 ~]# find /var/cache/yum/x86_64/7/ -iname &quot;*.rpm&quot;</span><br><span class="line">/var/cache/yum/x86_64/7/os/packages/pcre2-10.23-2.el7.x86_64.rpm</span><br><span class="line">/var/cache/yum/x86_64/7/nginx/packages/nginx-1.22.1-1.el7.ngx.x86_64.rpm</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# find /var/cache/yum/x86_64/7/ -iname &quot;*.rpm&quot; -exec cp -rf &#123;&#125; /var/ftp/nginx \;</span><br><span class="line">[root@server1 ~]# createrepo /var/ftp/nginx/</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">下面是客户机</span><br><span class="line">[root@server1 ~]# vi /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=ftp://192.168.153.10/nginx</span><br><span class="line">gpgcheck=0</span><br><span class="line">enbale=1</span><br><span class="line">[root@server1 ~]# yum -y install nginx</span><br></pre></td></tr></table></figure><h3 id="实验三：搭建本地yum仓库"><a href="#实验三：搭建本地yum仓库" class="headerlink" title="实验三：搭建本地yum仓库"></a>实验三：搭建本地yum仓库</h3><p>本地环境没有光盘，看一条命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/yum.repos.d/local.repo &lt;&lt;EOF</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">重定向到这个文件，交互式输入，直到输入EOF才停止</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">yum包管理详解</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>进程基础</title>
    <link href="http://example.com/2024/02/22/13.%E8%BF%9B%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
    <id>http://example.com/2024/02/22/13.%E8%BF%9B%E7%A8%8B%E5%9F%BA%E7%A1%80/</id>
    <published>2024-02-22T01:25:00.000Z</published>
    <updated>2024-02-22T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="关于进程"><a href="#关于进程" class="headerlink" title="关于进程"></a>关于进程</h2><h3 id="什么是进程"><a href="#什么是进程" class="headerlink" title="什么是进程"></a>什么是进程</h3><p>进程是一个<strong>在系统中运行的程序</strong>。<br>进程是已启动的可执行程序的运行实例，进程有以下组成部分:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.已分配内存的地址空间</span><br><span class="line">2.安全属性，包括所有权凭据和特权</span><br><span class="line">3.进程代码的一个或多个执行线程</span><br><span class="line">4.进程状态</span><br></pre></td></tr></table></figure><h3 id="进程与程序的区别"><a href="#进程与程序的区别" class="headerlink" title="进程与程序的区别"></a>进程与程序的区别</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.程序是静态的，它是一些保存 在磁盘上得指令的有序集合，没有任何执行的概念。如：二进制文件等。</span><br><span class="line">2.进程是一个动态的概念，它是程序执行的过程，动态，有生命周期及运行状态，包括创建、调度和消亡。</span><br></pre></td></tr></table></figure><h3 id="进程类型"><a href="#进程类型" class="headerlink" title="进程类型"></a>进程类型</h3><h4 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">也称监控进程。在系统引导过程中启动的进程，跟终端无关的进程。是Linux系统启动时运行的进程，并常驻后台。例如，httpd是著名的Apache服务器的监控进程。</span><br><span class="line">````</span><br><span class="line">#### 前台进程</span><br></pre></td></tr></table></figure><p>跟终端相关，通过终端启动的进程。是在终端中运行的命令，那么该终端就为进程的控制终端，一旦这个终端关闭，这个进程也随之消失。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 进程的生命周期</span><br><span class="line">#### 图形表示</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;https://img-blog.csdnimg.cn/20190224124520338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTIzNzU5MjQ=,size_16,color_FFFFFF,t_70&quot; alt=&quot;img&quot; style=&quot;zoom: 33%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">#### 过程解释</span><br><span class="line">```shell</span><br><span class="line">一个进程被fork出来后，进入*就绪态*；当被调度到获得CPU执行时，进入*执行态*；如果时间片用完或被强占时，进入*就绪态*；资源得不到满足时，进入*睡眠态*(深度睡眠或浅度睡眠)，比如一个网络程序，在等对方发包，此时不能占着CPU，进入睡眠态，当包发过来时，进程被唤醒，进入就绪态；如果被暂停，进入*停止态*；执行完成后，资源释放，此时父进程wait4还未收到它的信号，进入*僵死态*。即整个周期可能会涉及的状态有：*就绪态，执行态，僵死态，停止态，睡眠态。*</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">父进程复制自己的地址空间(fork)创建一个新的(子)进程结构。每个新进程分配一个唯一的进程ID(PID)，满足跟踪安全性之需。PID和父进程ID(PPID)是子进程环境的元素，任何进程都可以创建子进程，所有进程都是第一个系统进程的后代:</span><br><span class="line">centos5/6：init</span><br><span class="line">centos7： systemd</span><br><span class="line">子进程继承父进程的安全性身份、过去和当前的文件描述符、端口和资源特权、环境变量，以及程序代码。随后，子进程可能exec自己的程序代码。通常，父进程在子进程运行期间处于睡眠(sleeping)状态。当子进程完成时发出(exit)信息请求，在退出时，子进程已经关闭或丢弃了其资源环境，剩余的部分称之为僵尸(zombie)。父进程在子进程退出时收到信号而被唤醒，清理剩余的结构，然后继续执行其自己的程序代码。</span><br></pre></td></tr></table></figure><h3 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h3><p>Linux是一个多用户，多任务的系统，可以同时运行多个用户的多个程序，就必然会产生很多的进程，而每个进程会有不同的状态。在多任务处理操作系统中，每个CPU(或核心)在一个时间点上只能处理一个进程。在进程运行时，它对CPU时间和资源分配的要求会不断变化，从而为进程分配一个状态，它随着环境要求而改变。</p><h4 id="R-可执行状态"><a href="#R-可执行状态" class="headerlink" title="R 可执行状态"></a>R 可执行状态</h4><blockquote><p>Running，表明进程要么在运行中要么在运行队列里，并不意味着进程一定在运行中。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(TASK_RUNNING)，</span><br><span class="line">只有在该状态的进程才可能在CPU上运行。而同一时刻可能有多个进程处于可执行状态，这些进程的task_struct结构（进程控制块）被放入对应CPU的可执行队列中（一个进程最多只能出现在一个CPU的可执行队列中）。进程调度器的任务就是从各个CPU的可执行队列中分别选择一个进程在该CPU上运行。</span><br><span class="line">很多操作系统教科书将正在CPU上执行的进程定义为RUNNING状态、而将可执行但是尚未被调度执行的进程定义为READY状态，这两种状态在linux下统一为 TASK_RUNNING状态。</span><br></pre></td></tr></table></figure><h4 id="S-可中断的睡眠状态"><a href="#S-可中断的睡眠状态" class="headerlink" title="S 可中断的睡眠状态"></a>S 可中断的睡眠状态</h4><blockquote><p>睡眠状态，Sleeping，意味着进程在等待事件的完成（这里的睡眠有时候也叫做可中断睡眠）</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(TASK_INTERRUPTIBLE)，</span><br><span class="line">处于这个状态的进程因为等待某某事件的发生（比如等待socket连接、等待信号量），而被挂起。这些进程的task_struct结构被放入对应事件的等待队列中。当这些事件发生时（由外部中断触发、或由其他进程触发），对应的等待队列中的一个或多个进程将被唤醒。</span><br><span class="line">通过ps命令我们会看到，一般情况下，进程列表中的绝大多数进程都处于TASK_INTERRUPTIBLE状态（除非机器的负载很高）。毕竟CPU就这么一两个，进程动辄几十上百个，如果不是绝大多数进程都在睡眠，CPU又怎么响应得过来。</span><br></pre></td></tr></table></figure><h4 id="D-不可中断的睡眠状态"><a href="#D-不可中断的睡眠状态" class="headerlink" title="D 不可中断的睡眠状态"></a>D 不可中断的睡眠状态</h4><blockquote><p>磁盘睡眠状态，Disk Sleep，有时候也叫做不可中断睡眠，在这个状态的进程通常会等待IO的结束。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(TASK_UNINTERRUPTIBLE)，</span><br><span class="line">与TASK_INTERRUPTIBLE状态类似，进程处于睡眠状态，但是此刻进程是不可中断的。不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号。</span><br><span class="line">绝大多数情况下，进程处在睡眠状态时，总是应该能够响应异步信号的。否则你将惊奇的发现，kill -9竟然杀不死一个正在睡眠的进程了！于是我们也很好理解，为什么ps命令看到的进程几乎不会出现TASK_UNINTERRUPTIBLE状态，而总是TASK_INTERRUPTIBLE状态。</span><br></pre></td></tr></table></figure><h4 id="T-暂停状态或跟踪状态"><a href="#T-暂停状态或跟踪状态" class="headerlink" title="T 暂停状态或跟踪状态"></a>T 暂停状态或跟踪状态</h4><blockquote><p>停止状态（stopped）：可以通过发送SIGSTOP信号给进程来停止(T)进程。这个被暂停的进程可以通过发送SIGCNT信号让进程继续运行。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">T (TASK_STOPPED or TASK_TRACED)，</span><br><span class="line">向进程发送一个SIGSTOP信号，它就会因响应该信号而进入TASK_STOPPED状态（除非该进程本身处于TASK_UNINTERRUPTIBLE状态而不响应信号）。（SIGSTOP与SIGKILL信号一样，是非常强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。）向进程发送一个SIGCONT信号，可以让其从TASK_STOPPED状态恢复到TASK_RUNNING状态。</span><br><span class="line">当进程正在被跟踪时，它处于TASK_TRACED这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。</span><br><span class="line">对于进程本身来说，TASK_STOPPED和TASK_TRACED状态很类似，都是表示进程暂停下来。而TASK_TRACED状态相当于在TASK_STOPPED之上多了一层保护，处于TASK_TRACED状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过ptrace系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复TASK_RUNNING状态。</span><br></pre></td></tr></table></figure><h4 id="Z-退出状态，进程成为僵尸进程。"><a href="#Z-退出状态，进程成为僵尸进程。" class="headerlink" title="Z 退出状态，进程成为僵尸进程。"></a>Z 退出状态，进程成为僵尸进程。</h4><blockquote><p>僵尸状态(zombie)：通知父进程回收所有的资源。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Z (TASK_DEAD - EXIT_ZOMBIE)，</span><br><span class="line">进程在退出的过程中，处于TASK_DEAD状态。</span><br><span class="line">在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。</span><br><span class="line">之所以保留task_struct，是因为task_struct里面保存了进程的退出码、以及一些统计信息。而其父进程很可能会关心这些信息。比如在shell中，$?变量就保存了最后一个退出的前台进程的退出码，而这个退出码往往被作为if语句的判断条件。</span><br></pre></td></tr></table></figure><h5 id="僵尸进程定义"><a href="#僵尸进程定义" class="headerlink" title="僵尸进程定义"></a>僵尸进程定义</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">僵尸进程：当一个进程fork一个子进程之后，如果子进程退出，而父进程没有利用wait,或者waitpid 来获取子进程的状态信息，那么子进程的状态描述符依然保存在系统中。</span><br></pre></td></tr></table></figure><h4 id="X-退出状态，进程即将被销毁。"><a href="#X-退出状态，进程即将被销毁。" class="headerlink" title="X 退出状态，进程即将被销毁。"></a>X 退出状态，进程即将被销毁。</h4><blockquote><p>X死亡状态（dead）：这个状态只是一个返回状态，你不会在任务列表里看到这个状态。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(TASK_DEAD - EXIT_DEAD)，</span><br><span class="line">进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程（进程？线程？参见《linux线程浅析》）。或者父进程通过设置SIGCHLD信号的handler为SIG_IGN，显式的忽略了SIGCHLD信号。（这是posix的规定，尽管子进程的退出信号可以被设置为SIGCHLD以外的其他信号。）</span><br><span class="line">此时，进程将被置于EXIT_DEAD退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。</span><br></pre></td></tr></table></figure><h5 id="孤儿进程定义"><a href="#孤儿进程定义" class="headerlink" title="孤儿进程定义"></a>孤儿进程定义</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当一个父进程fork一个子进程之后，父进程突然被终止了，那么这个子进程就成为了一个孤儿进程，它会被init进程接管</span><br></pre></td></tr></table></figure><h3 id="systemd简介"><a href="#systemd简介" class="headerlink" title="systemd简介"></a>systemd简介</h3><p><code>systemd</code>是Linux操作系统的**<code>系统和服务管理器</code>**。在系统启动时或者正在运行的系统上的一个<code>守护进程</code>,<code>systemd</code>负责<code>激活系统资源、服务器守护程序和其他进程</code>，<code>systemd</code>是<code>RHEL 7</code>之后出现的。</p><h3 id="systemctl-命令管理系统"><a href="#systemctl-命令管理系统" class="headerlink" title="systemctl 命令管理系统"></a>systemctl 命令管理系统</h3><p><strong>systemctl</strong>是 <code>Systemd</code> 的主命令，<code>systemctl</code>命令用于管理不同类型的系统对象,这些对象称之为<code>units</code>。</p><h4 id="systemctl常用命令"><a href="#systemctl常用命令" class="headerlink" title="systemctl常用命令"></a>systemctl常用命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl start name.service     #启动服务</span><br><span class="line">systemctl stop name.service      #停止服务</span><br><span class="line">systemctl restart name.service   #重启服务（没启动的服务会启动）</span><br><span class="line">systemctl enable name.service    #启用开机自启服务</span><br><span class="line">systemctl disable name.service   #停用自启服务</span><br><span class="line">systemctl status name.service    #检查服务状态查看服务是否自启</span><br><span class="line">systemctl list-unit-files --state=enabled #列出所有已启用的服务</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Tip：</strong>当我们修改了服务文件就需要重新加载：systemctl reenable name.service</p><h3 id="units类型"><a href="#units类型" class="headerlink" title="units类型"></a>units类型</h3><p>系统里有很多的units类型，常用的总结一下，<code>Service unit</code>：用于定义<code>系统服务</code>,文件扩展名为<code>.service</code>。其余的了解一下即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Service unit：文件扩展名为.service，用于定义系统服务；</span><br><span class="line">Target unit：文件扩展名为.target，用于模拟实现“运行级别”；</span><br><span class="line">Device unit：文件扩展名为.device，用于定义内核识别的设备；</span><br><span class="line">Mount unit：文件扩展名为.mount，定义文件系统挂载点；</span><br><span class="line">Socket unit：文件扩展名为.socket，用于标识进程间通信用到的socket文件；</span><br><span class="line">Snapshot unit：文件扩展名为.snapshot， 管理系统快照；</span><br><span class="line">Swap unit：文件扩展名为.swap, 用于标识swap设备；</span><br><span class="line">Automount unit：文件扩展名为.automount，文件系统自动点设备；</span><br><span class="line">Path unit：文件扩展名为.path, 用于定义文件系统中的一文件或目录</span><br></pre></td></tr></table></figure><h4 id="unit-文件保存位置"><a href="#unit-文件保存位置" class="headerlink" title="unit 文件保存位置"></a>unit 文件保存位置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/systemd/system/   #RPM 包安装时分发的 unit 文件</span><br><span class="line">/run/systemd/system/        #systemd 运行时创建的文件</span><br><span class="line">/etc/systemd/system/       #systemctl enable 创建的 unit 文件</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">关于进程的一些基础概念</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>SFTP搭建</title>
    <link href="http://example.com/2024/01/31/%E6%90%AD%E5%BB%BASFTP/"/>
    <id>http://example.com/2024/01/31/%E6%90%AD%E5%BB%BASFTP/</id>
    <published>2024-01-31T01:25:00.000Z</published>
    <updated>2024-01-31T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="SFTP搭建流程"><a href="#SFTP搭建流程" class="headerlink" title="SFTP搭建流程"></a>SFTP搭建流程</h3><ul><li>准备工作：检查openssh版本<br>使用系统自带的internal-sftp搭建sftp，因为需要用到chroot，所以openssh 版本不能低于4.8p1<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky2 testftp]<span class="comment"># ssh -V</span></span><br><span class="line">OpenSSH_8.0p1, OpenSSL 1.1.1k  FIPS 25 Mar 2021</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###第一步：创建用户分组sftp</span></span><br><span class="line">groupadd sftp</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第二步：添加用户testftp至分组sftp</span></span><br><span class="line">useradd -g sftp -s /sbin/nologin zjsftp</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第三步：修改zjsftp用户的密码</span></span><br><span class="line">passwd zjsftp</span><br><span class="line">zhangjian@123456</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第四步：创建一个目录，来专门存放sftp相关文件</span></span><br><span class="line"><span class="built_in">mkdir</span> /sftp</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第五步：在第四步创建的目录下，再创建一个与用户名同名的文件夹</span></span><br><span class="line">[root@rocky2 ~]<span class="comment"># cd /sftp</span></span><br><span class="line">[root@rocky2 sftp]<span class="comment"># mkdir testftp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 第六步：修改sshd_config的配置文件</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">Subsystem       sftp    /usr/libexec/openssh/sftp-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#在配置文件最后添加</span></span><br><span class="line">Match Group sftp</span><br><span class="line">ChrootDirectory /sftp/%u</span><br><span class="line">ForceCommand internal-sftp</span><br><span class="line">AllowTcpForwarding no</span><br><span class="line">X11Forwarding no</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第七步：设定Chroot目录权限</span></span><br><span class="line"><span class="built_in">chown</span> root:sftp /sftp</span><br><span class="line"><span class="built_in">chown</span> root:sftp /sftp/testftp</span><br><span class="line"><span class="built_in">chmod</span> 755 /sftp</span><br><span class="line"><span class="built_in">chmod</span> 755 /sftp/testftp</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第八步：在/sftp/testftp目录下，创建一个文件夹files,并设置该文件夹的拥有者为对应的用户，并设置该文件夹的拥有者有7的权限。这样该用户可以在files目录下进行任何操作(上传、下载、删除、创建等操作)</span></span><br><span class="line">[root@rocky2 sftp]<span class="comment"># cd testftp</span></span><br><span class="line">[root@rocky2 testftp]<span class="comment"># ll</span></span><br><span class="line">总用量 0</span><br><span class="line">[root@rocky2 testftp]<span class="comment"># mkdir files</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置权限</span></span><br><span class="line"><span class="built_in">chown</span> zjsftp /sftp/zjsftp/files</span><br><span class="line"><span class="built_in">chmod</span> 755 /sftp/zjsftp/files</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第九步：重启sshd配置</span></span><br><span class="line">systemctl restart sshd</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第十步：连接SFTP，验证一下</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">Linux上最简单的SFTP搭建过程</summary>
    
    
    
    <category term="教程" scheme="http://example.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="SFTP" scheme="http://example.com/tags/SFTP/"/>
    
  </entry>
  
  <entry>
    <title>sed命令详解</title>
    <link href="http://example.com/2024/01/28/sed-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"/>
    <id>http://example.com/2024/01/28/sed-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/</id>
    <published>2024-01-28T01:25:00.000Z</published>
    <updated>2024-01-28T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="sed-命令"><a href="#sed-命令" class="headerlink" title="sed 命令"></a>sed 命令</h1><p>功能强大的流式文本编辑器</p><h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p><strong>sed</strong> 是一种流编辑器，它是文本处理中非常重要的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。</p><h2 id="sed的选项、命令、替换标记"><a href="#sed的选项、命令、替换标记" class="headerlink" title="sed的选项、命令、替换标记"></a>sed的选项、命令、替换标记</h2><p><strong>命令格式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed [options] <span class="string">&#x27;command&#x27;</span> file(s)</span><br><span class="line">sed [options] -f scriptfile file(s)</span><br></pre></td></tr></table></figure><h3 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-e&lt;script&gt;或--expression=&lt;script&gt;：以选项中的指定的script来处理输入的文本文件；</span><br><span class="line">-f&lt;script文件&gt;或--file=&lt;script文件&gt;：以选项中指定的script文件来处理输入的文本文件；</span><br><span class="line">-h或--<span class="built_in">help</span>：显示帮助；</span><br><span class="line">-n或--quiet或——silent：仅显示script处理后的结果；</span><br><span class="line">-V或--version：显示版本信息。</span><br></pre></td></tr></table></figure><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>文件：指定待处理的文本文件列表。</p><h3 id="sed命令"><a href="#sed命令" class="headerlink" title="sed命令"></a>sed命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">a\ <span class="comment"># 在当前行下面插入文本。</span></span><br><span class="line">i\ <span class="comment"># 在当前行上面插入文本。</span></span><br><span class="line">c\ <span class="comment"># 把选定的行改为新的文本。</span></span><br><span class="line">d <span class="comment"># 删除，删除选择的行。</span></span><br><span class="line">D <span class="comment"># 删除模板块的第一行。</span></span><br><span class="line">s <span class="comment"># 替换指定字符</span></span><br><span class="line">h <span class="comment"># 拷贝模板块的内容到内存中的缓冲区。</span></span><br><span class="line">H <span class="comment"># 追加模板块的内容到内存中的缓冲区。</span></span><br><span class="line">g <span class="comment"># 获得内存缓冲区的内容，并替代当前模板块中的文本。</span></span><br><span class="line">G <span class="comment"># 获得内存缓冲区的内容，并追加到当前模板块文本的后面。</span></span><br><span class="line">l <span class="comment"># 列表不能打印字符的清单。</span></span><br><span class="line">n <span class="comment"># 读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。</span></span><br><span class="line">N <span class="comment"># 追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。</span></span><br><span class="line">p <span class="comment"># 打印模板块的行。</span></span><br><span class="line">P <span class="comment"># (大写) 打印模板块的第一行。</span></span><br><span class="line">q <span class="comment"># 退出sed。</span></span><br><span class="line">b lable <span class="comment"># 分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。</span></span><br><span class="line">r file <span class="comment"># 从file中读行。</span></span><br><span class="line">t label <span class="comment"># if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</span></span><br><span class="line">T label <span class="comment"># 错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</span></span><br><span class="line">w file <span class="comment"># 写并追加模板块到file末尾。  </span></span><br><span class="line">W file <span class="comment"># 写并追加模板块的第一行到file末尾。  </span></span><br><span class="line">! <span class="comment"># 表示后面的命令对所有没有被选定的行发生作用。  </span></span><br><span class="line">= <span class="comment"># 打印当前行号码。  </span></span><br><span class="line"><span class="comment"># # 把注释扩展到下一个换行符以前。  </span></span><br></pre></td></tr></table></figure><h3 id="sed替换标记"><a href="#sed替换标记" class="headerlink" title="sed替换标记"></a>sed替换标记</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g <span class="comment"># 表示行内全面替换。  </span></span><br><span class="line">p <span class="comment"># 表示打印行。  </span></span><br><span class="line">w <span class="comment"># 表示把行写入一个文件。  </span></span><br><span class="line">x <span class="comment"># 表示互换模板块中的文本和缓冲区中的文本。  </span></span><br><span class="line">y <span class="comment"># 表示把一个字符翻译为另外的字符（但是不用于正则表达式）</span></span><br><span class="line">\1 <span class="comment"># 子串匹配标记</span></span><br><span class="line">&amp; <span class="comment"># 已匹配字符串标记</span></span><br></pre></td></tr></table></figure><h3 id="sed元字符集"><a href="#sed元字符集" class="headerlink" title="sed元字符集"></a>sed元字符集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">^ <span class="comment"># 匹配行开始，如：/^sed/匹配所有以sed开头的行。</span></span><br><span class="line">$ <span class="comment"># 匹配行结束，如：/sed$/匹配所有以sed结尾的行。</span></span><br><span class="line">. <span class="comment"># 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。</span></span><br><span class="line">* <span class="comment"># 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。</span></span><br><span class="line">[] <span class="comment"># 匹配一个指定范围内的字符，如/[sS]ed/匹配sed和sed。  </span></span><br><span class="line">[^] <span class="comment"># 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。</span></span><br><span class="line">\(..\) <span class="comment"># 匹配子串，保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。</span></span><br><span class="line">&amp; <span class="comment"># 保存搜索字符用来替换其他字符，如s/love/ **&amp;** /，love这成 **love** 。</span></span><br><span class="line">\&lt; <span class="comment"># 匹配单词的开始，如:/\&lt;love/匹配包含以love开头的单词的行。</span></span><br><span class="line">\&gt; <span class="comment"># 匹配单词的结束，如/love\&gt;/匹配包含以love结尾的单词的行。</span></span><br><span class="line">x\&#123;m\&#125; <span class="comment"># 重复字符x，m次，如：/0\&#123;5\&#125;/匹配包含5个0的行。</span></span><br><span class="line">x\&#123;m,\&#125; <span class="comment"># 重复字符x，至少m次，如：/0\&#123;5,\&#125;/匹配至少有5个0的行。</span></span><br><span class="line">x\&#123;m,n\&#125; <span class="comment"># 重复字符x，至少m次，不多于n次，如：/0\&#123;5,10\&#125;/匹配5~10个0的行。  </span></span><br></pre></td></tr></table></figure><h2 id="sed用法实例"><a href="#sed用法实例" class="headerlink" title="sed用法实例"></a>sed用法实例</h2><h3 id="替换操作：s命令"><a href="#替换操作：s命令" class="headerlink" title="替换操作：s命令"></a>替换操作：s命令</h3><p>替换文本中的字符串：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/book/books/&#x27;</span> file</span><br></pre></td></tr></table></figure><p><strong>-n选项</strong> 和 <strong>p命令</strong> 一起使用表示只打印那些发生替换的行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;s/test/TEST/p&#x27;</span> file</span><br></pre></td></tr></table></figure><p>直接编辑文件 <strong>选项-i</strong> ，会匹配file文件中每一行的所有book替换为books：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/book/books/g&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="全面替换标记g"><a href="#全面替换标记g" class="headerlink" title="全面替换标记g"></a>全面替换标记g</h3><p>使用后缀 &#x2F;g 标记会替换每一行中的所有匹配：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/book/books/g&#x27;</span> file</span><br></pre></td></tr></table></figure><p>当需要从第N处匹配开始替换时，可以使用 &#x2F;Ng：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> sksksksksksk | sed <span class="string">&#x27;s/sk/SK/2g&#x27;</span></span><br><span class="line">skSKSKSKSKSK</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> sksksksksksk | sed <span class="string">&#x27;s/sk/SK/3g&#x27;</span></span><br><span class="line">skskSKSKSKSK</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> sksksksksksk | sed <span class="string">&#x27;s/sk/SK/4g&#x27;</span></span><br><span class="line">skskskSKSKSK</span><br></pre></td></tr></table></figure><h3 id="定界符"><a href="#定界符" class="headerlink" title="定界符"></a>定界符</h3><p>以上命令中字符 &#x2F; 在sed中作为定界符使用，也可以使用任意的定界符：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s:test:TEXT:g&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;s|test|TEXT|g&#x27;</span></span><br></pre></td></tr></table></figure><p>定界符出现在样式内部时，需要进行转义：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/\/bin/\/usr\/local\/bin/g&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="删除操作：d命令"><a href="#删除操作：d命令" class="headerlink" title="删除操作：d命令"></a>删除操作：d命令</h3><p>删除空白行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> file</span><br></pre></td></tr></table></figure><p>删除文件的第2行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2d&#x27;</span> file</span><br></pre></td></tr></table></figure><p>删除文件的第2行到末尾所有行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2,$d&#x27;</span> file</span><br></pre></td></tr></table></figure><p>删除文件最后一行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$d&#x27;</span> file</span><br></pre></td></tr></table></figure><p>删除文件中所有开头是test的行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^test/&#x27;</span>d file</span><br></pre></td></tr></table></figure><h3 id="已匹配字符串标记"><a href="#已匹配字符串标记" class="headerlink" title="已匹配字符串标记&amp;"></a>已匹配字符串标记&amp;</h3><p>正则表达式 \w+ 匹配每一个单词，使用 [&amp;] 替换它，&amp; 对应于之前所匹配到的单词：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> this is a <span class="built_in">test</span> line | sed <span class="string">&#x27;s/\w\+/[&amp;]/g&#x27;</span></span><br><span class="line">[this] [is] [a] [<span class="built_in">test</span>] [line]</span><br></pre></td></tr></table></figure><p>所有以192.168.0.1开头的行都会被替换成它自已加localhost：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/^192.168.0.1/&amp;localhost/&#x27;</span> file</span><br><span class="line">192.168.0.1localhost</span><br></pre></td></tr></table></figure><h3 id="子串匹配标记-1"><a href="#子串匹配标记-1" class="headerlink" title="子串匹配标记\1"></a>子串匹配标记\1</h3><p>匹配给定样式的其中一部分：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> this is digit 7 <span class="keyword">in</span> a number | sed <span class="string">&#x27;s/digit \([0-9]\)/\1/&#x27;</span></span><br><span class="line">this is 7 <span class="keyword">in</span> a number</span><br></pre></td></tr></table></figure><p>命令中 digit 7，被替换成了 7。样式匹配到的子串是 7，(..) 用于匹配子串，对于匹配到的第一个子串就标记为 <strong>\1</strong> ，依此类推匹配到的第二个结果就是 <strong>\2</strong> ，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> aaa BBB | sed <span class="string">&#x27;s/\([a-z]\+\) \([A-Z]\+\)/\2 \1/&#x27;</span></span><br><span class="line">BBB aaa</span><br></pre></td></tr></table></figure><p>love被标记为1，所有loveable会被替换成lovers，并打印出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;s/\(love\)able/\1rs/p&#x27;</span> file</span><br></pre></td></tr></table></figure><p>通过替换获取ip：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens32 | sed -n <span class="string">&#x27;/inet /p&#x27;</span> | sed <span class="string">&#x27;s/inet \([0-9.]\+\).*/\1/&#x27;</span></span><br><span class="line">192.168.75.126</span><br></pre></td></tr></table></figure><h3 id="大小写转换U-L"><a href="#大小写转换U-L" class="headerlink" title="大小写转换U&#x2F;L"></a>大小写转换U&#x2F;L</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\u：首字母转换为大写</span><br><span class="line">\U：  全部转换为大写</span><br><span class="line">\l： 首字母转换为小写</span><br><span class="line">\L： 全部转换为小写</span><br></pre></td></tr></table></figure><p>首字母转换为大写：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]<span class="comment"># sed &#x27;s/^[a-z]\+/\u&amp;/&#x27; passwd </span></span><br><span class="line">Root:x:0:0:root:/root:/bin/bash</span><br><span class="line">Bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">Daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">Adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">Lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">Sync:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br></pre></td></tr></table></figure><p>匹配到的字符全部转换为大写：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]<span class="comment"># sed &#x27;s/^[a-z]\+/\U&amp;/&#x27; passwd </span></span><br><span class="line">ROOT:x:0:0:root:/root:/bin/bash</span><br><span class="line">BIN:x:1:1:bin:/bin:/sbin/nologin</span><br></pre></td></tr></table></figure><h3 id="组合多个表达式"><a href="#组合多个表达式" class="headerlink" title="组合多个表达式"></a>组合多个表达式</h3><ol><li>替换文本中的多个字符串：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/old_string/new_string/g&#x27;</span> -e <span class="string">&#x27;s/another_old_string/another_new_string/g&#x27;</span> file.txt</span><br></pre></td></tr></table></figure><ol start="2"><li>删除文本中的多个行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;1d&#x27;</span> -e <span class="string">&#x27;/pattern/d&#x27;</span> file.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>在文本中插入多个行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;1i\inserted_line1&#x27;</span> -e <span class="string">&#x27;2i\inserted_line2&#x27;</span> file.txt</span><br></pre></td></tr></table></figure><p>其中，-e 表示指定一个表达式，多个表达式之间用 -e 分隔。每个表达式可以是一个 sed 命令，例如 s、d、i 等。</p><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>sed表达式可以使用单引号来引用，但是如果表达式内部包含变量字符串，就需要使用双引号。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=hello</span><br><span class="line"><span class="built_in">echo</span> hello WORLD | sed <span class="string">&quot;s/<span class="variable">$test</span>/HELLO&quot;</span></span><br><span class="line">HELLO WORLD</span><br></pre></td></tr></table></figure><h3 id="选定行的范围：-（逗号）"><a href="#选定行的范围：-（逗号）" class="headerlink" title="选定行的范围：,（逗号）"></a>选定行的范围：,（逗号）</h3><p>所有在模板test和check所确定的范围内的行都被打印：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/test/,/check/p&#x27;</span> file</span><br></pre></td></tr></table></figure><p>打印从第5行开始到第一个包含以test开始的行之间的所有行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;5,/^test/p&#x27;</span> file</span><br></pre></td></tr></table></figure><p>对于模板test和west之间的行，每行的末尾用字符串aaa bbb替换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/test/,/west/s/$/aaa bbb/&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="多点编辑：e命令"><a href="#多点编辑：e命令" class="headerlink" title="多点编辑：e命令"></a>多点编辑：e命令</h3><p>-e选项允许在同一行里执行多条命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;1,5d&#x27;</span> -e <span class="string">&#x27;s/test/check/&#x27;</span> file</span><br></pre></td></tr></table></figure><p>上面sed表达式的第一条命令删除1至5行，第二条命令用check替换test。命令的执行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。</p><p>和 -e 等价的命令是 –expression：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed --expression=<span class="string">&#x27;s/test/check/&#x27;</span> --expression=<span class="string">&#x27;/love/d&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="从文件读入：r命令"><a href="#从文件读入：r命令" class="headerlink" title="从文件读入：r命令"></a>从文件读入：r命令</h3><p>file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/test/r file&#x27;</span> filename</span><br></pre></td></tr></table></figure><h3 id="写入文件：w命令"><a href="#写入文件：w命令" class="headerlink" title="写入文件：w命令"></a>写入文件：w命令</h3><p>在example中所有包含test的行都被写入file里：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/test/w file&#x27;</span> example</span><br></pre></td></tr></table></figure><p>追加（行下）：a\命令</p><p>将 this is a test line 追加到 以test 开头的行后面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^test/a\this is a test line&#x27;</span> file</span><br></pre></td></tr></table></figure><p>在 test.conf 文件第2行之后插入 this is a test line：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;2a\this is a test line&#x27;</span> test.conf</span><br></pre></td></tr></table></figure><h3 id="插入（行上）：i-命令"><a href="#插入（行上）：i-命令" class="headerlink" title="插入（行上）：i\命令"></a>插入（行上）：i\命令</h3><p>将 this is a test line 追加到以test开头的行前面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^test/i\this is a test line&#x27;</span> file</span><br></pre></td></tr></table></figure><p>在test.conf文件第5行之前插入this is a test line：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;5i\this is a test line&#x27;</span> test.conf</span><br></pre></td></tr></table></figure><h3 id="替换指定行：c-命令"><a href="#替换指定行：c-命令" class="headerlink" title="替换指定行：c\命令"></a>替换指定行：c\命令</h3><p>把root开头的行替换新内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]<span class="comment"># sed &#x27;/^root/c this is new line!&#x27; passwd </span></span><br><span class="line">this is new line!</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br></pre></td></tr></table></figure><p>如果是指定范围替换，需要注意，sed不是每行进行替换，而是把整个范围作为整体替换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]<span class="comment"># nl passwd | sed &#x27;1,5c\   this is dangerous!&#x27;</span></span><br><span class="line">     this is dangerous!</span><br><span class="line">     6<span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line">     7shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br></pre></td></tr></table></figure><p>如果想实现对第一行到第五行统一替换为相同内容，可以用下面的命令实现：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node5 ~]<span class="comment"># sed &#x27;1&#123;:a;s/.*/lutxixia/;n;6!ba&#125;&#x27; passwd </span></span><br><span class="line">lutxixia</span><br><span class="line">lutxixia</span><br><span class="line">lutxixia</span><br><span class="line">lutxixia</span><br><span class="line">lutxixia</span><br><span class="line"><span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line"></span><br><span class="line">其中：</span><br><span class="line">:a  是设置一个循环标签</span><br><span class="line">s/.*/lutixia/是用lutixia字符替换匹配到的每行内容</span><br><span class="line">n是读取下一行</span><br><span class="line">6!是读到第六行退出循环，终止操作,如果没有，则继续循环。</span><br><span class="line">ba是如果没有到第六行就跳转到a继续循环</span><br></pre></td></tr></table></figure><h3 id="下一个：n命令"><a href="#下一个：n命令" class="headerlink" title="下一个：n命令"></a>下一个：n命令</h3><p>如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/test/&#123; n; s/aa/bb/; &#125;&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="变形：y命令"><a href="#变形：y命令" class="headerlink" title="变形：y命令"></a>变形：y命令</h3><p>把1~10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,10y/abcde/ABCDE/&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="退出：q命令"><a href="#退出：q命令" class="headerlink" title="退出：q命令"></a>退出：q命令</h3><p>打印完前10行后，退出sed:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;10q&#x27;</span> file</span><br></pre></td></tr></table></figure><p>直到找到第一个匹配项，退出sed：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]<span class="comment"># sed  &#x27;/nginx/q&#x27; nginx.yml </span></span><br><span class="line">---</span><br><span class="line">- hosts: nginx</span><br></pre></td></tr></table></figure><h3 id="保持和获取：h命令和G命令"><a href="#保持和获取：h命令和G命令" class="headerlink" title="保持和获取：h命令和G命令"></a>保持和获取：h命令和G命令</h3><p>在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;/test/h&#x27;</span> -e <span class="string">&#x27;$G&#x27;</span> file</span><br></pre></td></tr></table></figure><p>在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。</p><h3 id="保持和互换：h命令和x命令"><a href="#保持和互换：h命令和x命令" class="headerlink" title="保持和互换：h命令和x命令"></a>保持和互换：h命令和x命令</h3><p>互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;/test/h&#x27;</span> -e <span class="string">&#x27;/check/x&#x27;</span> file</span><br></pre></td></tr></table></figure><h3 id="脚本scriptfile"><a href="#脚本scriptfile" class="headerlink" title="脚本scriptfile"></a>脚本scriptfile</h3><p>sed脚本是一个sed的命令清单，启动sed时以-f选项引导脚本文件名。sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed [options] -f scriptfile file(s)</span><br></pre></td></tr></table></figure><h3 id="打印奇数行或偶数行"><a href="#打印奇数行或偶数行" class="headerlink" title="打印奇数行或偶数行"></a>打印奇数行或偶数行</h3><p>方法1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;p;n&#x27;</span> test.txt  <span class="comment">#奇数行</span></span><br><span class="line">sed -n <span class="string">&#x27;n;p&#x27;</span> test.txt  <span class="comment">#偶数行</span></span><br></pre></td></tr></table></figure><p>方法2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;1~2p&#x27;</span> test.txt  <span class="comment">#奇数行</span></span><br><span class="line">sed -n <span class="string">&#x27;2~2p&#x27;</span> test.txt  <span class="comment">#偶数行</span></span><br></pre></td></tr></table></figure><h3 id="打印匹配字符串的下一行"><a href="#打印匹配字符串的下一行" class="headerlink" title="打印匹配字符串的下一行"></a>打印匹配字符串的下一行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -A 1 SCC URFILE</span><br><span class="line">sed -n <span class="string">&#x27;/SCC/&#123;n;p&#125;&#x27;</span> URFILE</span><br><span class="line">awk <span class="string">&#x27;/SCC/&#123;getline; print&#125;&#x27;</span> URFILE</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">文本三剑客的sed命令详解</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="sed" scheme="http://example.com/tags/sed/"/>
    
  </entry>
  
  <entry>
    <title>Linux 文件目录结构</title>
    <link href="http://example.com/2024/01/25/Linux%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/"/>
    <id>http://example.com/2024/01/25/Linux%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/</id>
    <published>2024-01-25T01:25:00.000Z</published>
    <updated>2024-01-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux-文件目录结构"><a href="#Linux-文件目录结构" class="headerlink" title="Linux 文件目录结构"></a>Linux 文件目录结构</h1><p>Linux 文件目录结构是任何 Linux 系统的基本组成部分。它为系统提供了一个标准化的文件和目录组织方式，使得用户和应用程序能够以一致的方式访问和管理文件。与 Windows 系统不同，Linux 的文件系统采用单一的树形结构，从根目录（&#x2F;）开始，所有文件和目录都在其下。理解这一结构不仅对于系统管理员至关重要，对于普通用户也是必不可少的，因为它可以帮助更有效地管理文件和解决问题。</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/image-20240913160903969.png" alt="image-20240913160903969"></p><h2 id="根目录（-）"><a href="#根目录（-）" class="headerlink" title="根目录（&#x2F;）"></a>根目录（&#x2F;）</h2><p>根目录（&#x2F;）是 Linux 文件系统的顶层目录。所有的文件和目录都从这里开始，形成一个树形结构。根目录下的每个子目录都有其特定的功能和用途。</p><ul><li><strong>&#x2F;bin</strong>：存放基本用户命令。</li><li><strong>&#x2F;sbin</strong>：存放系统管理命令。</li><li><strong>&#x2F;etc</strong>：存放系统配置文件。</li><li><strong>&#x2F;dev</strong>：存放设备文件。</li><li><strong>&#x2F;tmp</strong>：存放临时文件。</li><li><strong>&#x2F;home</strong>：存放用户主目录。</li><li><strong>&#x2F;var</strong>：存放可变数据文件。</li><li><strong>&#x2F;usr</strong>：存放用户级应用程序和文件。</li><li><strong>&#x2F;opt</strong>：存放附加软件包。</li><li><strong>&#x2F;mnt</strong>：用于临时挂载文件系统。</li><li><strong>&#x2F;media</strong>：用于自动挂载的可移动设备。</li><li><strong>&#x2F;boot</strong>：存放启动加载程序和内核文件。</li><li><strong>&#x2F;lib</strong>：存放系统库文件和内核模块。</li><li><strong>&#x2F;proc</strong>：存放系统内核和进程信息。</li><li><strong>&#x2F;sys</strong>：存放系统设备和内核信息。</li><li><strong>&#x2F;root</strong>：超级用户的主目录。</li></ul><p>下面，瑞哥带大家逐一详细介绍这些目录及其子目录的具体用途和常见文件。</p><h2 id="bin-目录"><a href="#bin-目录" class="headerlink" title="&#x2F;bin 目录"></a>&#x2F;bin 目录</h2><p>&#x2F;bin（binary）目录包含系统启动和单用户模式下使用的基本命令。这些命令是系统正常运行所必需的，并且在单用户模式或系统紧急修复时也可以使用。</p><p>常见的命令包括：</p><ul><li><strong>ls</strong>：列出目录内容。</li><li><strong>cp</strong>：复制文件或目录。</li><li><strong>mv</strong>：移动或重命名文件或目录。</li><li><strong>rm</strong>：删除文件或目录。</li><li><strong>cat</strong>：连接文件并显示输出。</li><li><strong>echo</strong>：显示消息。</li></ul><p>这些命令通常是静态链接的，确保在系统启动时不依赖于其他库文件。</p><h2 id="sbin-目录"><a href="#sbin-目录" class="headerlink" title="&#x2F;sbin 目录"></a>&#x2F;sbin 目录</h2><p>&#x2F;sbin（system binary）目录包含系统管理命令，这些命令通常需要超级用户权限执行。它们用于系统启动、维护和修复。</p><p>常见的命令包括：</p><ul><li><strong>ifconfig</strong>：配置网络接口。</li><li><strong>reboot</strong>：重启系统。</li><li><strong>shutdown</strong>：关闭系统。</li><li><strong>fdisk</strong>：磁盘分区工具。</li><li><strong>mkfs</strong>：创建文件系统。</li></ul><p>这些命令对于系统管理员来说是至关重要的，因为它们涉及到系统的核心功能和配置。</p><h2 id="etc-目录"><a href="#etc-目录" class="headerlink" title="&#x2F;etc 目录"></a>&#x2F;etc 目录</h2><p>&#x2F;etc 目录包含所有的系统全局配置文件。这些文件定义了系统的各种设置和参数。</p><p>常见的配置文件和目录包括：</p><ul><li><strong>&#x2F;etc&#x2F;passwd</strong>：用户账号信息文件。</li><li><strong>&#x2F;etc&#x2F;fstab</strong>：文件系统挂载表。</li><li><strong>&#x2F;etc&#x2F;hosts</strong>：主机名和 IP 地址对应表。</li><li><strong>&#x2F;etc&#x2F;hostname</strong>：定义系统的主机名。</li><li><strong>&#x2F;etc&#x2F;network&#x2F;interfaces</strong>：网络接口配置文件（在基于 Debian 的系统中）。</li></ul><p>在 &#x2F;etc 目录中，每个服务和应用程序通常都有自己的子目录或配置文件，例如 Apache 的配置文件在 <code>/etc/apache2/</code> 下。</p><h2 id="dev-目录"><a href="#dev-目录" class="headerlink" title="&#x2F;dev 目录"></a>&#x2F;dev 目录</h2><p>&#x2F;dev 目录包含设备文件，这些文件表示系统中的各种硬件设备。Linux 中的一切皆文件，包括硬件设备。</p><p>常见的设备文件包括：</p><ul><li><strong>&#x2F;dev&#x2F;sda</strong>：第一个 SCSI 硬盘。</li><li><strong>&#x2F;dev&#x2F;tty</strong>：终端设备。</li><li><strong>&#x2F;dev&#x2F;null</strong>：空设备，丢弃所有写入其中的数据。</li><li><strong>&#x2F;dev&#x2F;random</strong>：随机数生成器。</li></ul><p>这些设备文件允许用户和应用程序以文件的方式访问硬件设备。</p><h2 id="tmp-目录"><a href="#tmp-目录" class="headerlink" title="&#x2F;tmp 目录"></a>&#x2F;tmp 目录</h2><p>&#x2F;tmp 目录用于存放临时文件。系统和应用程序在运行过程中可能会在此目录下创建临时文件。通常，系统会在每次启动时清理 &#x2F;tmp 目录，以防止磁盘空间被临时文件占用过多。</p><p>&#x2F;tmp 目录中的文件通常对所有用户可读写，但应注意临时文件的权限和安全性。</p><h2 id="home-目录"><a href="#home-目录" class="headerlink" title="&#x2F;home 目录"></a>&#x2F;home 目录</h2><p>&#x2F;home 目录是用户的主目录，每个用户在 &#x2F;home 目录下都有一个以其用户名命名的子目录。用户的所有个人文件和配置文件都存放在这个子目录中。例如，用户 <code>john</code> 的主目录为 <code>/home/john</code>。</p><p>常见的文件和子目录包括：</p><ul><li><strong>~&#x2F;Documents</strong>：用户的文档目录。</li><li><strong>~&#x2F;Downloads</strong>：用户的下载目录。</li><li><strong>~&#x2F;Pictures</strong>：用户的图片目录。</li><li><strong>~&#x2F;.bashrc</strong>：Bash Shell 配置文件。</li><li><strong>~&#x2F;.profile</strong>：用户的环境设置文件。</li></ul><p>用户目录的权限设置通常是这样的，只有该用户和超级用户（root）可以访问和修改其内容。这可以保护用户的隐私和数据安全。</p><h2 id="var-目录"><a href="#var-目录" class="headerlink" title="&#x2F;var 目录"></a>&#x2F;var 目录</h2><p>&#x2F;var 目录用于存放系统运行时产生的可变数据。不同于 &#x2F;etc 目录中的配置文件，&#x2F;var 中的数据是动态变化的。</p><p>常见的子目录和文件包括：</p><ul><li><strong>&#x2F;var&#x2F;log</strong>：系统日志文件目录。常见的日志文件有 <code>/var/log/syslog</code>（系统日志）、<code>/var/log/auth.log</code>（认证日志）、<code>/var/log/kern.log</code>（内核日志）等。</li><li><strong>&#x2F;var&#x2F;mail</strong>：用户邮件存放目录。</li><li><strong>&#x2F;var&#x2F;spool</strong>：队列目录，用于存放打印任务、邮件队列等。</li><li><strong>&#x2F;var&#x2F;cache</strong>：应用程序缓存文件。</li><li><strong>&#x2F;var&#x2F;www</strong>：Web 服务器的根目录，存放网站文件。</li></ul><p>&#x2F;var 目录中的数据可能会迅速增长，因此需要定期清理和维护，以防止磁盘空间不足。</p><h2 id="usr-目录"><a href="#usr-目录" class="headerlink" title="&#x2F;usr 目录"></a>&#x2F;usr 目录</h2><p>&#x2F;usr 目录用于存放用户级应用程序和文件。这是一个非常重要的目录，包含了大量的二进制文件、库文件、文档和其他资源。</p><p>常见的子目录包括：</p><ul><li><strong>&#x2F;usr&#x2F;bin</strong>：用户级命令的二进制文件。常见的命令有 <code>gcc</code>（GNU 编译器）、<code>perl</code>（Perl 解释器）等。</li><li><strong>&#x2F;usr&#x2F;sbin</strong>：系统管理命令的二进制文件。与 &#x2F;sbin 类似，但这些命令不是启动时必须的。</li><li><strong>&#x2F;usr&#x2F;lib</strong>：库文件目录，存放应用程序和系统所需的共享库。</li><li><strong>&#x2F;usr&#x2F;share</strong>：共享数据目录，存放不特定于某个用户或系统的共享数据，如文档、图标、声音等。</li><li><strong>&#x2F;usr&#x2F;local</strong>：本地安装的软件和文件。用户可以在不影响系统其他部分的情况下安装和管理软件。</li></ul><p>&#x2F;usr 目录中的内容通常由系统包管理器管理，如 apt、yum 等。</p><h2 id="opt-目录"><a href="#opt-目录" class="headerlink" title="&#x2F;opt 目录"></a>&#x2F;opt 目录</h2><p>&#x2F;opt 目录用于安装附加软件包。通常，第三方软件或自定义应用程序会安装在此目录下。每个软件通常会在 &#x2F;opt 下有一个独立的子目录，例如 <code>/opt/software</code>。这种方式可以避免与系统的其他部分产生冲突，并便于管理和卸载。</p><h2 id="mnt-目录"><a href="#mnt-目录" class="headerlink" title="&#x2F;mnt 目录"></a>&#x2F;mnt 目录</h2><p>&#x2F;mnt 目录用于临时挂载文件系统。系统管理员可以将外部存储设备（如 USB 驱动器、网络文件系统等）挂载到 &#x2F;mnt 下的某个子目录中。例如，可以使用 <code>mount /dev/sdb1 /mnt/usb</code> 将一个 USB 驱动器挂载到 <code>/mnt/usb</code>。</p><h2 id="media-目录"><a href="#media-目录" class="headerlink" title="&#x2F;media 目录"></a>&#x2F;media 目录</h2><p>&#x2F;media 目录用于自动挂载的可移动设备，如光盘、U 盘等。当这些设备插入时，系统会自动将其挂载到 &#x2F;media 下的一个子目录中。例如，插入一个 U 盘后，系统可能会在 <code>/media/user/USB</code> 下自动创建一个目录并挂载该设备。</p><h2 id="boot-目录"><a href="#boot-目录" class="headerlink" title="&#x2F;boot 目录"></a>&#x2F;boot 目录</h2><p>&#x2F;boot 目录包含启动加载程序和内核文件。系统启动时，启动加载程序（如 GRUB）会从这里加载内核和其他必要文件。</p><p>常见文件包括：</p><ul><li><strong>vmlinuz</strong>：压缩的 Linux 内核镜像文件。</li><li><strong>initrd.img</strong>：初始 RAM 盘，用于启动时加载必要的驱动程序和文件系统。</li><li><strong>grub</strong>：GRUB 启动加载程序的配置文件和模块。</li></ul><p>&#x2F;boot 目录中的文件对于系统启动至关重要，因此应谨慎修改。</p><h2 id="lib-目录"><a href="#lib-目录" class="headerlink" title="&#x2F;lib 目录"></a>&#x2F;lib 目录</h2><p>&#x2F;lib 目录包含系统库文件和内核模块。系统启动时，许多关键程序依赖于这些库文件。常见的库文件包括 C 标准库（libc.so）、动态链接器（ld-linux.so）等。内核模块（如文件系统驱动、硬件驱动）通常位于 <code>/lib/modules</code> 目录中。</p><h2 id="proc-目录"><a href="#proc-目录" class="headerlink" title="&#x2F;proc 目录"></a>&#x2F;proc 目录</h2><p>&#x2F;proc 目录是一个虚拟文件系统，包含系统内核和进程信息。这个目录中的内容并不实际存在于磁盘上，而是由内核在运行时动态生成的。&#x2F;proc 目录提供了一种方便的方式来访问系统信息和进程数据。</p><p>常见的文件和目录包括：</p><ul><li><strong>&#x2F;proc&#x2F;cpuinfo</strong>：显示 CPU 的信息，包括型号、速度和核心数。</li><li><strong>&#x2F;proc&#x2F;meminfo</strong>：显示内存使用情况，包括总内存、可用内存和缓存。</li><li><strong>&#x2F;proc&#x2F;uptime</strong>：显示系统的运行时间和空闲时间。</li><li>**&#x2F;proc&#x2F;[pid]&#x2F;**：每个运行中的进程都有一个以其 PID（进程标识符）命名的子目录，包含该进程的详细信息，如状态、内存映射、打开的文件等。</li></ul><p>&#x2F;proc 目录中的信息对于系统管理员和开发者来说非常重要，因为它提供了对系统运行状态的实时监控和调试工具。</p><h2 id="sys-目录"><a href="#sys-目录" class="headerlink" title="&#x2F;sys 目录"></a>&#x2F;sys 目录</h2><p>&#x2F;sys 目录是另一个虚拟文件系统，提供系统设备和内核信息。与 &#x2F;proc 类似，&#x2F;sys 目录中的内容也是由内核在运行时动态生成的。&#x2F;sys 目录主要用于提供内核与用户空间之间的接口，允许用户查看和配置硬件设备。</p><p>常见的文件和目录包括：</p><ul><li>**&#x2F;sys&#x2F;class&#x2F;**：分类显示不同类型的设备，如网络设备（&#x2F;sys&#x2F;class&#x2F;net）、块设备（&#x2F;sys&#x2F;class&#x2F;block）等。</li><li>**&#x2F;sys&#x2F;devices&#x2F;**：显示系统中的所有设备，以设备树的形式组织。</li><li>**&#x2F;sys&#x2F;module&#x2F;**：显示已加载的内核模块及其参数。</li></ul><p>通过 &#x2F;sys 目录，用户和管理员可以方便地管理和配置系统硬件，进行性能调优和故障排除。</p><h2 id="root-目录"><a href="#root-目录" class="headerlink" title="&#x2F;root 目录"></a>&#x2F;root 目录</h2><p>&#x2F;root 目录是超级用户（root）的主目录。与普通用户的主目录位于 &#x2F;home 下不同，root 用户的主目录直接位于根目录下。这是因为 root 用户需要在单用户模式下进行系统维护和修复，&#x2F;root 目录可以在没有挂载其他文件系统的情况下访问。常见的文件和目录包括：</p><ul><li><strong>&#x2F;root&#x2F;.bashrc</strong>：root 用户的 Bash Shell 配置文件。</li><li><strong>&#x2F;root&#x2F;.profile</strong>：root 用户的环境设置文件。</li></ul><p>root 用户拥有系统的最高权限，因此 &#x2F;root 目录中的文件和配置通常只有 root 用户本身可以访问和修改。</p><h2 id="符号链接（Symbolic-Link）"><a href="#符号链接（Symbolic-Link）" class="headerlink" title="符号链接（Symbolic Link）"></a>符号链接（Symbolic Link）</h2><p>符号链接是一种特殊的文件，它指向另一个文件或目录。符号链接可以简化文件路径访问和管理。创建符号链接的命令是 <code>ln -s</code>，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /path/to/target /path/to/link</span><br></pre></td></tr></table></figure><p>符号链接在文件目录结构中具有重要作用，尤其是在需要在多个位置访问同一文件或目录时。符号链接可以跨文件系统边界，并且可以指向目录或文件。</p><h2 id="run-目录"><a href="#run-目录" class="headerlink" title="&#x2F;run 目录"></a>&#x2F;run 目录</h2><p>&#x2F;run 目录是一个临时文件系统，用于存放系统运行时的状态文件和进程信息。它是在系统启动时动态创建的，并且其内容在每次启动时都会被清空。常见的文件和目录包括：</p><ul><li><strong>&#x2F;run&#x2F;lock</strong>：用于锁文件，防止多个进程同时访问同一个资源。</li><li>**&#x2F;run&#x2F;user&#x2F;**：用于用户相关的运行时数据，每个用户都有一个以其 UID 命名的子目录。</li></ul><p>&#x2F;run 目录中的文件和目录通常由系统服务和守护进程使用，提供了一种轻量级的进程间通信方式。</p><h2 id="srv-目录"><a href="#srv-目录" class="headerlink" title="&#x2F;srv 目录"></a>&#x2F;srv 目录</h2><p>&#x2F;srv 目录用于存放服务相关的数据。srv 是 “service” 的缩写，表示该目录用于存放系统提供的各种服务的数据。例如，Web 服务器的文件可以存放在 &#x2F;srv&#x2F;www 下，FTP 服务器的文件可以存放在 &#x2F;srv&#x2F;ftp 下。&#x2F;srv 目录结构可以根据具体服务的需求进行自定义。</p><h2 id="lost-found-目录"><a href="#lost-found-目录" class="headerlink" title="&#x2F;lost+found 目录"></a>&#x2F;lost+found 目录</h2><p>&#x2F;lost+found 目录存在于每个使用 ext 文件系统（如 ext2、ext3、ext4）的文件系统根目录下。它用于存放文件系统在崩溃或损坏后恢复的文件碎片。当文件系统进行 fsck（文件系统一致性检查）时，找回的孤立文件会被放置在 &#x2F;lost+found 目录中。系统管理员可以在检查后决定如何处理这些文件。</p>]]></content>
    
    
    <summary type="html">Linux 文件目录结构</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>安装Tomcat</title>
    <link href="http://example.com/2024/01/25/%E5%AE%89%E8%A3%85Tomcat/"/>
    <id>http://example.com/2024/01/25/%E5%AE%89%E8%A3%85Tomcat/</id>
    <published>2024-01-25T01:25:00.000Z</published>
    <updated>2024-01-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h2><h3 id="jdk环境"><a href="#jdk环境" class="headerlink" title="jdk环境"></a>jdk环境</h3><p>这里以jdk8环境为例，但是需要账号登陆，wget无法直接使用，需要自行上传安装包到机器中</p><p>下载地址：<code>https://www.oracle.com/java/technologies/downloads/archive/</code></p><ul><li>创建存放目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/src</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/app/java</span><br></pre></td></tr></table></figure><ul><li>解压压缩包文件到软件目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/src</span><br><span class="line">tar -zxvf jdk-8u391-linux-x64.tar.gz -C /opt/app/java</span><br></pre></td></tr></table></figure><ul><li>查看一下是否解压成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ls /opt/app/java</span></span><br><span class="line">jdk1.8.0_391</span><br></pre></td></tr></table></figure><ul><li>添加环境变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/app/java/jdk1.8.0_391</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure><ul><li>验证一下版本信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">&quot;1.8.0_391&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_391-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.391-b13, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="tomcat的安装"><a href="#tomcat的安装" class="headerlink" title="tomcat的安装"></a>tomcat的安装</h3><ul><li>下载解压tomcat</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/app</span><br><span class="line">wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.86/bin/apache-tomcat-9.0.86.tar.gz</span><br><span class="line">tar -zxvf apache-tomcat-9.0.86.tar.gz</span><br></pre></td></tr></table></figure><ul><li>进入bin目录下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/app/apache-tomcat-9.0.86/bin</span><br></pre></td></tr></table></figure><ul><li>启动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh</span><br><span class="line"><span class="comment">#输出如下：</span></span><br><span class="line">Using CATALINA_BASE:   /opt/app/apache-tomcat-9.0.86</span><br><span class="line">Using CATALINA_HOME:   /opt/app/apache-tomcat-9.0.86</span><br><span class="line">Using CATALINA_TMPDIR: /opt/app/apache-tomcat-9.0.86/temp</span><br><span class="line">Using JRE_HOME:        /opt/app/java/jdk1.8.0_391</span><br><span class="line">Using CLASSPATH:       /opt/app/apache-tomcat-9.0.86/bin/bootstrap.jar:/opt/app/apache-tomcat-9.0.86/bin/tomcat-juli.jar</span><br><span class="line">Using CATALINA_OPTS:</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure><ul><li>查看tomcat进程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ps aux |grep tomcat</span></span><br><span class="line">root       4285  0.4 12.1 2999672 226480 pts/0  Sl   21:06   0:11 /opt/app/java/jdk1.8.0_391/bin/java -Djava.util.logging.config.file=/root/apache-tomcat-9.0.86/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /root/apache-tomcat-9.0.86/bin/bootstrap.jar:/root/apache-tomcat-9.0.86/bin/tomcat-juli.jar -Dcatalina.base=/root/apache-tomcat-9.0.86 -Dcatalina.home=/root/apache-tomcat-9.0.86 -Djava.io.tmpdir=/root/apache-tomcat-9.0.86/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root       4396  0.0  0.0 112812   976 pts/0    S+   21:48   0:00 grep --color=auto tomcat</span><br></pre></td></tr></table></figure><ul><li>访问</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 ip:8080访问网页</span><br></pre></td></tr></table></figure><h3 id="tomcat配置"><a href="#tomcat配置" class="headerlink" title="tomcat配置"></a>tomcat配置</h3><p>Tomcat的主要目录结构大致如下：</p><ol><li><code>bin/</code>：此目录包含了用于启动和停止Tomcat的脚本。例如，<code>startup.sh</code>用于在Unix&#x2F;Linux系统上启动Tomcat，而<code>shutdown.sh</code>则用于停止Tomcat。</li><li><code>conf/</code>：此目录包含了Tomcat的配置文件，如<code>server.xml</code>，在这些文件中可以对Tomcat的行为做出具体的配置。</li><li><code>lib/</code>：此目录存储了Tomcat运行所需的Java库文件。</li><li><code>logs/</code>：此目录包含了Tomcat运行时产生的日志文件。</li><li><code>temp/</code>：此目录用于存储Tomcat运行时产生的临时文件。</li><li><code>webapps/</code>：这是Tomcat默认的应用部署目录，把你的应用（一般是WAR文件）放在这里，Tomcat就会自动部署并启动这个应用。</li><li><code>work/</code>：这个目录用于存储Tomcat的工作文件，比如JSP文件编译后产生的Servlet等。</li><li><code>LICENSE</code>, <code>RUNNING.txt</code>, <code>README.md</code>等：这些文件包含了关于Tomcat的版权、运行指南、读我等信息。</li></ol><h4 id="修改端口号"><a href="#修改端口号" class="headerlink" title="修改端口号"></a>修改端口号</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/app/apache-tomcat-9.0.86/conf/server.xml</span><br><span class="line"><span class="comment">#修改如下段，修改成没被占用的端口：</span></span><br><span class="line">  &lt;Connector port=<span class="string">&quot;8088&quot;</span> protocol=<span class="string">&quot;HTTP/1.1&quot;</span></span><br><span class="line">               connectionTimeout=<span class="string">&quot;20000&quot;</span></span><br><span class="line">               redirectPort=<span class="string">&quot;8443&quot;</span></span><br><span class="line">               maxParameterCount=<span class="string">&quot;1000&quot;</span></span><br><span class="line">               /&gt;</span><br><span class="line">               </span><br><span class="line"><span class="comment">#修改完重启tomcat</span></span><br><span class="line"><span class="built_in">cd</span> /opt/app/apache-tomcat-9.0.86/bin</span><br><span class="line">./shutdown.sh</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux上配置Tomcat服务器</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="Tomcat" scheme="http://example.com/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Linux集群系统时间同步</title>
    <link href="http://example.com/2024/01/24/linux%E9%9B%86%E7%BE%A4%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    <id>http://example.com/2024/01/24/linux%E9%9B%86%E7%BE%A4%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/</id>
    <published>2024-01-24T01:25:00.000Z</published>
    <updated>2024-01-24T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux集群系统时间同步"><a href="#Linux集群系统时间同步" class="headerlink" title="Linux集群系统时间同步"></a>Linux集群系统时间同步</h2><p>环境准备：</p><ul><li>服务器集群 我准备了2台虚拟机，主机名分别是server1、server3，操作系统版本为CentOS-7.9</li></ul><h3 id="1-查看系统当前时间和时区"><a href="#1-查看系统当前时间和时区" class="headerlink" title="1.查看系统当前时间和时区"></a>1.查看系统当前时间和时区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看时间</span></span><br><span class="line">[root@server1 ~]<span class="comment"># date</span></span><br><span class="line">Mon Feb 19 10:24:03 CST 2024</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># date -R # 显示时区</span></span><br><span class="line">Mon, 19 Feb 2024 10:24:40 +0800</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># date &#x27;+%Y-%m-%d %H:%M:%S&#x27; # 按照指定格式显示日期时间</span></span><br><span class="line">2024-02-19 10:25:06</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看时区</span></span><br><span class="line">[root@server1 ~]<span class="comment"># timedatectl | grep &quot;Time zone&quot;</span></span><br><span class="line">       Time zone: Asia/Shanghai (CST, +0800)</span><br></pre></td></tr></table></figure><h3 id="2-修改时区"><a href="#2-修改时区" class="headerlink" title="2. 修改时区"></a>2. 修改时区</h3><p>要做到服务器集群的时间同步，集群中各台机器的时区必须相同的，我们在国内就使用中国时区，如果你的机器的时区不是”Asia&#x2F;Shanghai”，需要修改时区</p><p>CentOS 中时区是以文件形式存在，当前正在使用的时区文件位于</p><p><code>/etc/localtime</code>，其他时区文件则位于<code>/usr/share/zoneinfo</code>下，中国时区的文件全路径是<code>/usr/share/zoneinfo/Asia/Shanghai</code></p><h4 id="1-如果系统中有-usr-share-zoneinfo-Asia-Shanghai这个文件"><a href="#1-如果系统中有-usr-share-zoneinfo-Asia-Shanghai这个文件" class="headerlink" title="(1) 如果系统中有/usr/share/zoneinfo/Asia/Shanghai这个文件"></a>(1) 如果系统中有<code>/usr/share/zoneinfo/Asia/Shanghai</code>这个文件</h4><p>要更改时区，直接使用如下命令就OK</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><h4 id="2-如果没有-Asia-Shanghai-时区文件"><a href="#2-如果没有-Asia-Shanghai-时区文件" class="headerlink" title="(2) 如果没有 Asia&#x2F;Shanghai 时区文件"></a>(2) 如果没有 Asia&#x2F;Shanghai 时区文件</h4><p>需要使用 <code>tzselect</code> 命令去生成时区文件，生成好的时区文件就在&#x2F;usr&#x2F;share&#x2F;zoneinfo 目录下，具体步骤去下：</p><ul><li>&lt;1&gt; 执行tzselect命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># tzselect</span></span><br><span class="line">Please identify a location so that time zone rules can be <span class="built_in">set</span> correctly.</span><br><span class="line">Please <span class="keyword">select</span> a continent or ocean.</span><br><span class="line"> 1) Africa</span><br><span class="line"> 2) Americas</span><br><span class="line"> 3) Antarctica</span><br><span class="line"> 4) Arctic Ocean</span><br><span class="line"> 5) Asia</span><br><span class="line"> 6) Atlantic Ocean</span><br><span class="line"> 7) Australia</span><br><span class="line"> 8) Europe</span><br><span class="line"> 9) Indian Ocean</span><br><span class="line">10) Pacific Ocean</span><br><span class="line">11) none - I want to specify the time zone using the Posix TZ format.</span><br><span class="line"><span class="comment">#? 5 # 选亚洲</span></span><br><span class="line">Please <span class="keyword">select</span> a country.</span><br><span class="line"> 1) Afghanistan       18) Israel            35) Palestine</span><br><span class="line"> 2) Armenia       19) Japan         36) Philippines</span><br><span class="line"> 3) Azerbaijan        20) Jordan            37) Qatar</span><br><span class="line"> 4) Bahrain       21) Kazakhstan        38) Russia</span><br><span class="line"> 5) Bangladesh        22) Korea (North)     39) Saudi Arabia</span><br><span class="line"> 6) Bhutan        23) Korea (South)     40) Singapore</span><br><span class="line"> 7) Brunei        24) Kuwait            41) Sri Lanka</span><br><span class="line"> 8) Cambodia          25) Kyrgyzstan        42) Syria</span><br><span class="line"> 9) China         26) Laos          43) Taiwan</span><br><span class="line">10) Cyprus        27) Lebanon           44) Tajikistan</span><br><span class="line">11) East Timor        28) Macau         45) Thailand</span><br><span class="line">12) Georgia       29) Malaysia          46) Turkmenistan</span><br><span class="line">13) Hong Kong         30) Mongolia          47) United Arab Emirates</span><br><span class="line">14) India         31) Myanmar (Burma)       48) Uzbekistan</span><br><span class="line">15) Indonesia         32) Nepal         49) Vietnam</span><br><span class="line">16) Iran          33) Oman          50) Yemen</span><br><span class="line">17) Iraq          34) Pakistan</span><br><span class="line"><span class="comment">#? 9 # 选中国</span></span><br><span class="line">Please <span class="keyword">select</span> one of the following time zone regions.</span><br><span class="line">1) Beijing Time</span><br><span class="line">2) Xinjiang Time</span><br><span class="line"><span class="comment">#? 1 # 只能选择北京时间和新疆时间，但即使选择了北京时间，最后生成的也是上海时区的文件</span></span><br><span class="line"></span><br><span class="line">The following information has been given:</span><br><span class="line"></span><br><span class="line">    China</span><br><span class="line">    Beijing Time</span><br><span class="line"></span><br><span class="line">Therefore TZ=<span class="string">&#x27;Asia/Shanghai&#x27;</span> will be used.</span><br><span class="line">Local time is now:  Thu Nov 23 04:44:37 CST 2017.</span><br><span class="line">Universal Time is now:  Wed Nov 22 20:44:37 UTC 2017.</span><br><span class="line">Is the above information OK?</span><br><span class="line">1) Yes</span><br><span class="line">2) No</span><br><span class="line"><span class="comment">#? 1 # 确认</span></span><br><span class="line"></span><br><span class="line">You can make this change permanent <span class="keyword">for</span> yourself by appending the line</span><br><span class="line">    TZ=<span class="string">&#x27;Asia/Shanghai&#x27;</span>; <span class="built_in">export</span> TZ</span><br><span class="line">to the file <span class="string">&#x27;.profile&#x27;</span> <span class="keyword">in</span> your home directory; <span class="keyword">then</span> <span class="built_in">log</span> out and <span class="built_in">log</span> <span class="keyword">in</span> again.</span><br><span class="line"></span><br><span class="line">Here is that TZ value again, this time on standard output so that you</span><br><span class="line">can use the /usr/bin/tzselect <span class="built_in">command</span> <span class="keyword">in</span> shell scripts:</span><br><span class="line">Asia/Shanghai <span class="comment"># 很无奈，不是北京，但问题不大</span></span><br></pre></td></tr></table></figure><ul><li><p>&lt;2&gt; 执行<code>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code>这个命令</p></li><li><p>&lt;3&gt; 执行<code>cat /etc/sysconfig/clock</code>命令验证，如果ZONE的值不是<code>Asia/Shanghai</code>，手动改为这个值，注意，不执行第&lt;1&gt;步直接手动修改是无效果的</p></li></ul><h3 id="3-集群时间同步方法一：手动修改"><a href="#3-集群时间同步方法一：手动修改" class="headerlink" title="3. 集群时间同步方法一：手动修改"></a>3. 集群时间同步方法一：手动修改</h3><p>使用<code>date -s</code>命令来修改系统时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># date -s 12/25/2016</span></span><br><span class="line">[root@server1 ~]<span class="comment"># date -s 19:57:30</span></span><br><span class="line">[root@server1 ~]<span class="comment"># date -s &quot;2024-02-19 13:50:30&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动修改后，使用以下命令，把系统时间写入主板，这样，即使服务器关机或断电，时间也会更新</span></span><br><span class="line">[root@server1 ~]<span class="comment"># hwclock -w</span></span><br></pre></td></tr></table></figure><p>让集群所有的服务器的时间同步，就用远程连接工具连接所有服务器，然后在所有的服务器中同时执行<code>date -s</code>命令设置时间，然后在所有的服务器中执行<code>hwclock -w</code>命令即可</p><h3 id="4-集群时间同步方法二：自动同步网络时间-需要网络"><a href="#4-集群时间同步方法二：自动同步网络时间-需要网络" class="headerlink" title="4. 集群时间同步方法二：自动同步网络时间(需要网络)"></a>4. 集群时间同步方法二：自动同步网络时间(需要网络)</h3><h4 id="1-通过外网同步时间"><a href="#1-通过外网同步时间" class="headerlink" title="(1) 通过外网同步时间"></a>(1) 通过外网同步时间</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ntpdate ntp.ntsc.ac.cn</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">[root@server1 ~]<span class="comment"># ntpdate 114.118.7.163</span></span><br></pre></td></tr></table></figure><p>上海交通大学网络中心NTP服务器地址：ntp.sjtu.edu.cn（17.253.116.125）</p><p>中国国家授时中心服务器地址：ntp.ntsc.ac.cn（114.118.7.163）</p><p>若以上提供的网络时间服务器不可用，请自行上网寻找可用的网络时间服务器</p><h4 id="2-设置自动执行任务，定时更新时间"><a href="#2-设置自动执行任务，定时更新时间" class="headerlink" title="(2)设置自动执行任务，定时更新时间"></a>(2)设置自动执行任务，定时更新时间</h4><p>&lt;1&gt; 使用命令：<code>crontab -e</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># crontab -e</span></span><br></pre></td></tr></table></figure><p>&lt;2&gt; 然后往里加入一行内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * /usr/sbin/ntpdate ntp.ntsc.ac.cn</span><br></pre></td></tr></table></figure><p>上面的配置表示，每隔十分钟从 <code>ntp.ntsc.ac.cn</code>该时间服务器同步一次时间。</p><p>&lt;3&gt; 保存退出</p><p>&lt;4&gt;确认是否执行成功，查看日志，寻找相关关键字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># cat /var/log/cron |grep ntpdate</span></span><br><span class="line">Feb 19 13:30:01 server1 CROND[12627]: (root) CMD (/usr/sbin/ntpdate ntp.ntsc.ac.cn)</span><br><span class="line">Feb 19 13:40:01 server1 CROND[13120]: (root) CMD (/usr/sbin/ntpdate ntp.ntsc.ac.cn)</span><br><span class="line"></span><br><span class="line">and</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># tail /var/spool/mail/root -n 20</span></span><br><span class="line"><span class="built_in">id</span> 2D1763C2F5; Mon, 19 Feb 2024 13:40:10 +0800 (CST)</span><br><span class="line">From: <span class="string">&quot;(Cron Daemon)&quot;</span> &lt;root@server1.localdomain&gt;</span><br><span class="line">To: root@server1.localdomain</span><br><span class="line">Subject: Cron &lt;root@server1&gt; /usr/sbin/ntpdate ntp.ntsc.ac.cn</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Auto-Submitted: auto-generated</span><br><span class="line">Precedence: bulk</span><br><span class="line">X-Cron-Env: &lt;XDG_SESSION_ID=19&gt;</span><br><span class="line">X-Cron-Env: &lt;XDG_RUNTIME_DIR=/run/user/0&gt;</span><br><span class="line">X-Cron-Env: &lt;LANG=en_US.UTF-8&gt;</span><br><span class="line">X-Cron-Env: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X-Cron-Env: &lt;HOME=/root&gt;</span><br><span class="line">X-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;</span><br><span class="line">X-Cron-Env: &lt;LOGNAME=root&gt;</span><br><span class="line">X-Cron-Env: &lt;USER=root&gt;</span><br><span class="line">Message-Id: &lt;20240219054010.2D1763C2F5@server1.localdomain&gt;</span><br><span class="line">Date: Mon, 19 Feb 2024 13:40:10 +0800 (CST)</span><br><span class="line"></span><br><span class="line">19 Feb 13:40:10 ntpdate[13120]: adjust time server 114.118.7.161 offset 0.084765 sec</span><br></pre></td></tr></table></figure><h4 id="3-说明"><a href="#3-说明" class="headerlink" title="(3) 说明"></a>(3) 说明</h4><p>以上两步操作可以让server1这个服务器每隔10分钟去指定的服务器同步时间，如果需要让集群中的所有服务器时间同步，那么每台服务器都要做以上两步操作。</p><h3 id="5-集群时间同步方法三：局域网内选一台服务器作为时间服务器，其他服务器从局域网内的时间服务器更新时间，同时局域网内的时间服务器向外网时间服务器同步时间"><a href="#5-集群时间同步方法三：局域网内选一台服务器作为时间服务器，其他服务器从局域网内的时间服务器更新时间，同时局域网内的时间服务器向外网时间服务器同步时间" class="headerlink" title="5. 集群时间同步方法三：局域网内选一台服务器作为时间服务器，其他服务器从局域网内的时间服务器更新时间，同时局域网内的时间服务器向外网时间服务器同步时间"></a>5. 集群时间同步方法三：局域网内选一台服务器作为时间服务器，其他服务器从局域网内的时间服务器更新时间，同时局域网内的时间服务器向外网时间服务器同步时间</h3><p>server1的IP为192.168.47.120，让它作为时间服务器，192.168.47.0局域网内的所有服务器都向它同步时间，而server1这台时间服务器本身，向外网时间服务器同步时间(比如中国国家授时中心服务器)</p><h4 id="1-选择一台服务器作为NTP服务器"><a href="#1-选择一台服务器作为NTP服务器" class="headerlink" title="(1) 选择一台服务器作为NTP服务器"></a>(1) 选择一台服务器作为NTP服务器</h4><p>我用server1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># yum install ntp -y</span></span><br></pre></td></tr></table></figure><h4 id="2-给局域网所有需要同步时间的服务器安装ntp服务"><a href="#2-给局域网所有需要同步时间的服务器安装ntp服务" class="headerlink" title="(2) 给局域网所有需要同步时间的服务器安装ntp服务"></a>(2) 给局域网所有需要同步时间的服务器安装ntp服务</h4><h4 id="3-给所有的需要同步时间的机器-包括server1-设置ntp服务开机自启动，但不要启动服务"><a href="#3-给所有的需要同步时间的机器-包括server1-设置ntp服务开机自启动，但不要启动服务" class="headerlink" title="(3) 给所有的需要同步时间的机器(包括server1)设置ntp服务开机自启动，但不要启动服务"></a>(3) 给所有的需要同步时间的机器(包括server1)设置ntp服务开机自启动，但不要启动服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br></pre></td></tr></table></figure><h4 id="4-修改server1的配置文件-etc-ntp-conf"><a href="#4-修改server1的配置文件-etc-ntp-conf" class="headerlink" title="(4) 修改server1的配置文件/etc/ntp.conf"></a>(4) 修改server1的配置文件<code>/etc/ntp.conf</code></h4><p>我去掉了所有的默认注释，对其中的修改写了自己的注释，没有写注释的是默认配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line"></span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br><span class="line"></span><br><span class="line">restrict 127.0.0.1 </span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line"><span class="comment">#注释掉默认的</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line">server 0.asia.pool.ntp.org</span><br><span class="line">server 1.asia.pool.ntp.org</span><br><span class="line">server 2.asia.pool.ntp.org</span><br><span class="line">server 3.asia.pool.ntp.org</span><br><span class="line">或者</span><br><span class="line">server ntp1.aliyun.com</span><br><span class="line">server ntp2.aliyun.com</span><br><span class="line">server ntp3.aliyun.com</span><br><span class="line">server ntp4.aliyun.com</span><br><span class="line">server ntp5.aliyun.com</span><br><span class="line">或者</span><br><span class="line">server ntp.ntsc.ac.cn</span><br><span class="line"></span><br><span class="line">restrict 192.168.47.0 netmask 255.255.255.0 nomodify notrap</span><br><span class="line"></span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line"></span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">disable</span> monitor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步时间后，写到硬件中</span></span><br><span class="line">SYNC_HWCLOCK=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h3 id="5-启动ntpd服务之前，手动同步一下时间"><a href="#5-启动ntpd服务之前，手动同步一下时间" class="headerlink" title="(5) 启动ntpd服务之前，手动同步一下时间"></a>(5) 启动ntpd服务之前，手动同步一下时间</h3><p>因为ntpd服务开启之后，就不能手动同步时间了，那么为什么要先手动同步时间呢？</p><p><strong>当server(中国国家授时中心服务器)与client(server1)之间的时间误差过大时（可能是1000秒），server1去同步时间可能对系统和应用带来不可预知的问题，server1将停止时间同步！所以如果发现server1启动之后时间并不进行同步时，应该考虑到可能是时间差过大引起的，此时需要先手动进行时间同步！</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate ntp.ntsc.ac.cn</span><br></pre></td></tr></table></figure><h3 id="6-启动server1的ntpd服务"><a href="#6-启动server1的ntpd服务" class="headerlink" title="(6) 启动server1的ntpd服务"></a>(6) 启动server1的ntpd服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# systemctl start ntpd.service</span><br></pre></td></tr></table></figure><h3 id="7-检查ntp状态"><a href="#7-检查ntp状态" class="headerlink" title="(7) 检查ntp状态"></a>(7) 检查ntp状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># systemctl status ntpd</span></span><br><span class="line">● ntpd.service - Network Time Service</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2024-02-19 14:02:57 CST; 42s ago</span><br><span class="line">  Process: 1592 ExecStart=/usr/sbin/ntpd -u ntp:ntp <span class="variable">$OPTIONS</span> (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 1593 (ntpd)</span><br><span class="line">   CGroup: /system.slice/ntpd.service</span><br><span class="line">           └─1593 /usr/sbin/ntpd -u ntp:ntp -g</span><br><span class="line"></span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listen and drop on 1 v6wildcard :: UDP 123</span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listen normally on 2 lo 127.0.0.1 UDP 123</span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listen normally on 3 ens33 192.168.47.120 UDP 123</span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listen normally on 4 lo ::1 UDP 123</span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listen normally on 5 ens33 fe80::20c:29ff:fe69:c8a0 UDP 123</span><br><span class="line">Feb 19 14:02:57 server1 ntpd[1593]: Listening on routing socket on fd <span class="comment">#22 for interface updates</span></span><br><span class="line">Feb 19 14:02:57 server1 systemd[1]: Started Network Time Service.</span><br><span class="line">Feb 19 14:03:02 server1 ntpd[1593]: 0.0.0.0 c016 06 restart</span><br><span class="line">Feb 19 14:03:02 server1 ntpd[1593]: 0.0.0.0 c012 02 freq_set kernel 0.000 PPM</span><br><span class="line">Feb 19 14:03:02 server1 ntpd[1593]: 0.0.0.0 c011 01 freq_not_set</span><br></pre></td></tr></table></figure><h3 id="7-查看网络中的NTP服务器，显示客户端和每个服务器的关系"><a href="#7-查看网络中的NTP服务器，显示客户端和每个服务器的关系" class="headerlink" title="(7) 查看网络中的NTP服务器，显示客户端和每个服务器的关系"></a>(7) 查看网络中的NTP服务器，显示客户端和每个服务器的关系</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># ntpq -p</span></span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line"> 236.99.217.185. 192.114.63.250   3 u   53   64    3  329.852   16.259   3.229</span><br><span class="line"> ntp.xtom.com.hk 118.143.17.83    2 u   54   64    1   65.072   11.479   0.000</span><br><span class="line"> ntp5.mum-in.hos 36.224.68.195    2 u   54   64    3  236.350  -31.003 114.595</span><br><span class="line"> ns2.ads.net.id  203.4.241.5      2 u   55   64    3  416.763  -20.510   2.412</span><br></pre></td></tr></table></figure><p>这里的前4行就是我们配置的4个时间服务器的信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 授时中心服务器地址</span><br><span class="line">server 0.asia.pool.ntp.org</span><br><span class="line">server 1.asia.pool.ntp.org</span><br><span class="line">server 2.asia.pool.ntp.org</span><br><span class="line">server 3.asia.pool.ntp.org</span><br></pre></td></tr></table></figure><p>最后一行就是本地时间服务的信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 外部时间服务器不可用时，以本地时间作为时间服务</span><br><span class="line">server  127.127.1.0</span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure><p>下面对每个列的意义进行说明：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#remote地址前的符号：</span></span><br><span class="line">`*`：响应的NTP服务器和最精确的服务器；</span><br><span class="line">`+`：响应这个查询请求的NTP服务器；</span><br><span class="line">`blank(什么都没有)`：没有响应的NTP服务器 </span><br><span class="line"><span class="comment">#说明： </span></span><br><span class="line">ntp服务启动后，一般需要5-10分钟左右的时候才能与外部时间服务器开始同步时间，所以需要等待几分钟才能看到正常的现象，否则你看到的是响应的NTP服务器和最精确的服务器是LOCAL(0)，最后一行前面是`*`符号，其他都是空白</span><br><span class="line"></span><br><span class="line">-remote 响应这个请求的NTP服务器的名称</span><br><span class="line">-refid NTP服务器使用的更高一级服务器的名称</span><br><span class="line">-st 正在响应请求的NTP服务器的级别</span><br><span class="line">-when 上一次成功请求之后到现在的秒数</span><br><span class="line">-poll 本地和远程服务器多少时间进行一次同步，单位秒，在一开始运行NTP的时候这个poll值会比较小，服务器同步的频率大，可以尽快调整到正确的时间范围，之后poll值会逐渐增大，同步的频率也就会相应减小</span><br><span class="line">-reach 用来测试能否和服务器连接，是一个八进制值，每成功连接一次它的值就会增加</span><br><span class="line">-delay 从本地机发送同步要求到ntp服务器的往返时间</span><br><span class="line">-offset 主机通过NTP时钟同步与所同步时间源的时间偏移量，单位为毫秒，offset越接近于0，主机和ntp服务器的时间越接近 </span><br><span class="line">-jitter 统计了在特定个连续的连接数里offset的分布情况。简单地说这个数值的绝对值越小，主机的时间就越精确</span><br></pre></td></tr></table></figure><h3 id="8-查看server1的ntp服务状态"><a href="#8-查看server1的ntp服务状态" class="headerlink" title="(8) 查看server1的ntp服务状态"></a>(8) 查看server1的ntp服务状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# ntpstat</span><br><span class="line">synchronised to NTP server (116.12.47.30) at stratum 3</span><br><span class="line">   time correct to within 483 ms</span><br><span class="line">   polling server every 64 s</span><br></pre></td></tr></table></figure><p>同样，服务启动后需要等待5-10分钟才能看到这个正常的信息</p><p>到这里，我们局域网内的时间服务器server1就已经配置完毕了</p><h3 id="9-配置客户端向server1同步时间"><a href="#9-配置客户端向server1同步时间" class="headerlink" title="(9) 配置客户端向server1同步时间"></a>(9) 配置客户端向server1同步时间</h3><h4 id="修改每台客户端的-etc-ntp-conf配置文件"><a href="#修改每台客户端的-etc-ntp-conf配置文件" class="headerlink" title="&lt;1&gt; 修改每台客户端的/etc/ntp.conf配置文件"></a>&lt;1&gt; 修改每台客户端的<code>/etc/ntp.conf</code>配置文件</h4><p>文件内容如下：</p><p>同样，没有写注释的都是默认的配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line"></span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br><span class="line"></span><br><span class="line">restrict 127.0.0.1 </span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line"><span class="comment">#注释掉默认的</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从server1中同步时间</span></span><br><span class="line">server 192.168.47.120</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许server1修改本地时间</span></span><br><span class="line">restrict 192.168.47.120 nomodify notrap noquery</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果server1不可用，用本地的时间服务</span></span><br><span class="line">server 127.127.1.0</span><br><span class="line">fudge 127.127.1.0 stratum 10</span><br><span class="line"></span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line"></span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line"><span class="built_in">disable</span> monitor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步时间后，写到硬件中</span></span><br><span class="line">SYNC_HWCLOCK=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h4 id="每台客户端在启动ntpd服务之前，手动同步一下时间"><a href="#每台客户端在启动ntpd服务之前，手动同步一下时间" class="headerlink" title="&lt;2&gt; 每台客户端在启动ntpd服务之前，手动同步一下时间"></a>&lt;2&gt; 每台客户端在启动ntpd服务之前，手动同步一下时间</h4><p>原因同(5)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]# ntpdate ntp.ntsc.ac.cn</span><br></pre></td></tr></table></figure><h4 id="启动每台客户端的ntpd服务"><a href="#启动每台客户端的ntpd服务" class="headerlink" title="&lt;3&gt; 启动每台客户端的ntpd服务"></a>&lt;3&gt; 启动每台客户端的ntpd服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]# systemctl start ntpd</span><br></pre></td></tr></table></figure><h4 id="等待5-10分钟后，查看每个客户端的状态"><a href="#等待5-10分钟后，查看每个客户端的状态" class="headerlink" title="&lt;4&gt; 等待5-10分钟后，查看每个客户端的状态"></a>&lt;4&gt; 等待5-10分钟后，查看每个客户端的状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server3 ~]<span class="comment"># ntpq -p</span></span><br></pre></td></tr></table></figure><p>到这里，利用局域网内一台时间服务器来同步整个集群时间的全部配置就已经完成</p><h3 id="10-测试-在几台服务器同时执性date命令"><a href="#10-测试-在几台服务器同时执性date命令" class="headerlink" title="(10) 测试,在几台服务器同时执性date命令"></a>(10) 测试,在几台服务器同时执性date命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# date &#x27;+%Y-%m-%d %H:%M:%S&#x27;</span><br><span class="line">2024-02-19 14:27:57</span><br><span class="line">[root@server3 ~]# date &#x27;+%Y-%m-%d %H:%M:%S&#x27;</span><br><span class="line">2024-02-19 14:27:51</span><br></pre></td></tr></table></figure><p>说明：若以上提供的网络时间服务器不可用，请自行上网寻找可用的网络时间服务器，另外需要关闭各服务器的防火墙，才能进行时间同步</p><h3 id="附：常见的时间服务器"><a href="#附：常见的时间服务器" class="headerlink" title="附：常见的时间服务器"></a>附：常见的时间服务器</h3><table><thead><tr><th align="center">名称</th><th align="center">公共NTP服务器地址</th></tr></thead><tbody><tr><td align="center">国家授时中心 NTP 服务器 NTSC NTP Server</td><td align="center">ntp.ntsc.ac.cn</td></tr><tr><td align="center">中国 NTP 快速授时服务 NTP ORG CN</td><td align="center">cn.ntp.org.cn</td></tr><tr><td align="center">上海交大NTP 服务器</td><td align="center">ntp.sjtu.edu.cn</td></tr><tr><td align="center">清华大学NTP服务器</td><td align="center">ntp.tuna.tsinghua.edu.cn</td></tr><tr><td align="center">国际 NTP 快速授时服务 中国片区</td><td align="center">cn.pool.ntp.org</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">Linux的集群时间同步配置，包括单台的做法</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="进阶教程" scheme="http://example.com/categories/Linux/%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="进阶教程" scheme="http://example.com/tags/%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7升级内核方案</title>
    <link href="http://example.com/2024/01/23/centos-7%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%E6%96%B9%E6%A1%88/"/>
    <id>http://example.com/2024/01/23/centos-7%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%E6%96%B9%E6%A1%88/</id>
    <published>2024-01-23T01:25:00.000Z</published>
    <updated>2024-01-23T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CentOS7升级内核方案"><a href="#CentOS7升级内核方案" class="headerlink" title="CentOS7升级内核方案"></a>CentOS7升级内核方案</h2><p>CentOS 7自带的内核版本还停留在<code>3.x</code>，如果某些软件对Linux内核版本有要求，就不得不升级内核来支持。</p><h4 id="内核版本选择"><a href="#内核版本选择" class="headerlink" title="内核版本选择"></a>内核版本选择</h4><p>我们可以从<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.xgss.net/wp-content/themes/xgssv1/go.php?url=aHR0cHM6Ly93d3cua2VybmVsLm9yZy8=&source=article&objectId=2072001">https://www.kernel.org/</a>官网下载指定内核源码并进行编译升级，但是此步骤较为繁琐，不在此次讨论范围。</p><p>如果我们采用<code>rpm</code>包进行升级，可以使用别人编译好的包，其中<code>elrepo</code>提供的内核升级包是比较值得信赖的，内核地址如下：<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.xgss.net/wp-content/themes/xgssv1/go.php?url=aHR0cHM6Ly9lbHJlcG8ub3JnL2xpbnV4L2tlcm5lbC9lbDcveDg2XzY0L1JQTVMv&source=article&objectId=2072001">https://elrepo.org/linux/kernel/el7/x86_64&#x2F;RPMS&#x2F;</a></p><p>但是打开elrepo的网站我们只能看到<code>5.15.x</code>和<code>5.4.x</code>（随着时间的推移可能会有变化）两个版本，标识了<code>ml</code>和<code>lt</code></p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/be969f09d089a98dbf368791f368f7db.png" style="zoom:80%;" /><ul><li><code>ml</code>代表主线版本，总是保持主线最新的内核</li><li><code>lt</code>代表长期支持版本，支持周期更长</li></ul><p>再通过<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.xgss.net/wp-content/themes/xgssv1/go.php?url=aHR0cHM6Ly93d3cua2VybmVsLm9yZy9jYXRlZ29yeS9yZWxlYXNlcy5odG1s&source=article&objectId=2072001">https://www.kernel.org</a>官网对照下上面两个版本的生命周期，可以看到<code>5.15</code>支持到2023年，而<code>5.4</code>支持到2025年。</p><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/60f7e4a2ad8b6ae79118f8284fa2181f.png"></p><p>如果你要追求最新的版本，直接选择带<code>ml</code>的rpm包即可，如果你要追求稳定且更长的支持周期，直接选择<code>lt</code>版本即可。</p><h4 id="在线升级"><a href="#在线升级" class="headerlink" title="在线升级"></a>在线升级</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入ELRepo 公钥</span></span><br><span class="line">wget https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">rpm --import RPM-GPG-KEY-elrepo.org</span><br><span class="line"><span class="comment">#安装ELRepo</span></span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br><span class="line"><span class="comment">#升级最新内核</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-ml -y</span><br><span class="line"><span class="comment">#升级长期支持的lt内核（二选一即可）</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt -y</span><br></pre></td></tr></table></figure><h4 id="离线升级"><a href="#离线升级" class="headerlink" title="离线升级"></a>离线升级</h4><p>也可以手动下载<code>rpm</code>的内核进行离线升级，以升级<code>lt</code>内核为例，方法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载内核(随着时间推移，链接可能失效)</span></span><br><span class="line">wget https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-lt-5.4.267-1.el7.elrepo.x86_64.rpm</span><br><span class="line"><span class="comment">#升级内核</span></span><br><span class="line">rpm -ivh kernel-lt-5.4.267-1.el7.elrepo.x86_64.rpm</span><br></pre></td></tr></table></figure><h4 id="切换内核"><a href="#切换内核" class="headerlink" title="切换内核"></a>切换内核</h4><p>输入命令<code>awk -F\&#39; &#39;$1==&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#39; /boot/grub2/grub.cfg</code>查看grub2引导序号。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># awk -F\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#x27; /boot/grub2/grub.cfg</span></span><br><span class="line">0 : CentOS Linux (5.4.267-1.el7.elrepo.x86_64) 7 (Core)</span><br><span class="line">1 : CentOS Linux (3.10.0-1160.105.1.el7.x86_64) 7 (Core)</span><br><span class="line">2 : CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)</span><br><span class="line">3 : CentOS Linux (0-rescue-6f0ded4d6b374b868728677046097a9c) 7 (Core)</span><br></pre></td></tr></table></figure><p>可以看到序号<code>0</code>是我们刚刚安装的内核，我们将其设置为默认启动内核：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置默认启动内核</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line"><span class="comment">#重启服务器生效</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>某些服务商可能会遇到设置不生效的问题，我们可采取删除旧内核，保留新内核的做法。需要重启<a href="https://cloud.tencent.com/act/pro/promotion-cvm?from_column=20065&from=20065">服务器</a>并通过VNC连接（请咨询服务商）并在开机的启动界面选择新内核（5.4）进入，通过以下方法删除旧内核：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前内核，确保是以新内核启动</span></span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"><span class="comment">#查看系统中全部内核</span></span><br><span class="line">rpm -qa | grep kernel</span><br><span class="line"><span class="comment">#移出不需要的内核</span></span><br><span class="line">yum remove kernel-3.10.0-229.4.2.el7.x86_64</span><br></pre></td></tr></table></figure><p>如果系统中只有一个内核，在下次启动的时候就会默认选择该内核启动。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p><a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.xgss.net/tag/%25e5%258d%2587%25e7%25ba%25a7%25e5%2586%2585%25e6%25a0%25b8&source=article&objectId=2072001">升级内核</a>有分险，以上方法不保障升级内核一定成功，生产环境请谨慎操作，如果升级后内核无法启动，可通过VNC连接服务器（咨询服务商），然后选择正常的内核启动，并删除异常的内核进行恢复。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li><code>ml</code>代表主线版本，总是保持主线最新的内核</li><li><code>lt</code>代表长期支持版本，支持周期更长</li><li>内核升级失败，可通过VNC连接选择正常的内核进入系统</li><li>elrepo会经常删除旧的内核，建议定期从elrepo网站将内核下载进行保存，以便后续使用</li></ul>]]></content>
    
    
    <summary type="html">Centos7太老了，有些时候部分业务场景需要更新的内核</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="教程" scheme="http://example.com/categories/Linux/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="教程" scheme="http://example.com/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>常见环境依赖安装</title>
    <link href="http://example.com/2024/01/22/%E5%90%84%E7%A7%8D%E7%8E%AF%E5%A2%83%E7%BC%96%E8%AF%91/"/>
    <id>http://example.com/2024/01/22/%E5%90%84%E7%A7%8D%E7%8E%AF%E5%A2%83%E7%BC%96%E8%AF%91/</id>
    <published>2024-01-22T01:25:00.000Z</published>
    <updated>2024-01-22T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常见环境依赖安装"><a href="#常见环境依赖安装" class="headerlink" title="常见环境依赖安装"></a>常见环境依赖安装</h2><h3 id="1-Python3环境"><a href="#1-Python3环境" class="headerlink" title="1.Python3环境"></a>1.Python3环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum -y install yum-utils wget</span><br><span class="line"></span><br><span class="line">yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum groupinstall <span class="string">&quot;Development Tools&quot;</span> -y</span><br><span class="line"></span><br><span class="line">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel</span><br><span class="line"></span><br><span class="line">wget https://www.python.org/ftp/python/3.10.9/Python-3.10.9.tar.xz</span><br><span class="line"></span><br><span class="line">tar xJf Python-3.10.9.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> Python-3.10.9</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line">make -j4 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">python3.10 --version</span><br></pre></td></tr></table></figure><h3 id="2-gcc11-环境"><a href="#2-gcc11-环境" class="headerlink" title="2.gcc11+环境"></a>2.gcc11+环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bzip2 gcc gcc-c++ kernel-devel bzip2</span><br><span class="line">wget http://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz</span><br><span class="line">tar -zxvf gcc-11.2.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> gcc-11.2.0</span><br><span class="line">./contrib/download_prerequisites</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build/</span><br><span class="line">../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib</span><br><span class="line">make -j4 &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="3-make4-3环境"><a href="#3-make4-3环境" class="headerlink" title="3.make4.3环境"></a>3.make4.3环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install make gcc -y</span><br><span class="line">wget https://mirrors.aliyun.com/gnu/make/make-4.3.tar.gz</span><br><span class="line">tar -zxf make-4.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> make-4.3/</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure --prefix=/usr &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="4-bison环境"><a href="#4-bison环境" class="headerlink" title="4.bison环境"></a>4.bison环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum install m4 -y</span><br><span class="line">wget https://ftp.gnu.org/gnu/bison/bison-3.8.2.tar.gz</span><br><span class="line">tar xvf bison-3.8.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> bison-3.8.2</span><br><span class="line">./configure --prefix=/usr/local/bison</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">export PATH=/usr/local/bison/bin:$PATH</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">. /etc/profile</span><br></pre></td></tr></table></figure><h3 id="5-glibc2-31"><a href="#5-glibc2-31" class="headerlink" title="5.glibc2.31"></a>5.glibc2.31</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这个要依赖上面的环境</span></span><br><span class="line">wget https://mirrors.aliyun.com/gnu/glibc/glibc-2.31.tar.gz</span><br><span class="line">tar -zxf glibc-2.31.tar.gz</span><br><span class="line"><span class="built_in">cd</span> glibc-2.31/</span><br><span class="line"><span class="built_in">cat</span> INSTALL | grep -E <span class="string">&quot;newer|later&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure  --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin --disable-sanity-checks --disable-werror</span><br><span class="line">make -j2</span><br><span class="line">make install</span><br><span class="line">strings /lib64/libc.so.6 | grep ^GLIBC</span><br><span class="line">make localedata/install-locales</span><br></pre></td></tr></table></figure><h3 id="6-修复rpm数据库"><a href="#6-修复rpm数据库" class="headerlink" title="6.修复rpm数据库"></a>6.修复rpm数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /var/lib/rpm/__db*</span><br><span class="line">rpm --rebuilddb</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个视情况而定</span></span><br><span class="line">sudo <span class="built_in">ln</span> -s /lib64/libtinfo.so.5 /lib64/libtinfo.so.6</span><br></pre></td></tr></table></figure><h3 id="7-java8环境"><a href="#7-java8环境" class="headerlink" title="7.java8环境"></a>7.java8环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#去官网下载安装包</span></span><br><span class="line">https://www.oracle.com/java/technologies/downloads/<span class="comment">#java8</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/src</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/app/java</span><br><span class="line"><span class="built_in">cd</span> /opt/src</span><br><span class="line">tar -zxvf jdk-8u391-linux-x64.tar.gz -C /opt/app/java</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/app/java/jdk1.8.0_391</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure><h3 id="8-Ruby环境"><a href="#8-Ruby环境" class="headerlink" title="8.Ruby环境"></a>8.Ruby环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式一：yum安装，可以设置特定版本</span></span><br><span class="line">yum install -y centos-release-scl-rh</span><br><span class="line">yum install -y rh-ruby30</span><br><span class="line">scl <span class="built_in">enable</span> rh-ruby30 bash</span><br><span class="line">ruby -v</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式二：二进制包安装</span></span><br><span class="line">wget https://cache.ruby-lang.org/pub/ruby/3.0/ruby-3.0.6.tar.gz</span><br><span class="line">tar -zxvf  ruby-3.0.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> ruby-3.0.6</span><br><span class="line">./configure --prefix=/opt/ruby</span><br><span class="line">make -j4 &amp;&amp; make install</span><br><span class="line"><span class="built_in">ln</span> -s /opt/ruby/bin/ruby /usr/bin/ruby</span><br><span class="line"><span class="built_in">ln</span> -s /opt/ruby/bin/gem /usr/bin/gem</span><br></pre></td></tr></table></figure><h3 id="9-lua环境"><a href="#9-lua环境" class="headerlink" title="9.lua环境"></a>9.lua环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install libtermcap-devel ncurses-devel libevent-devel readline-devel -y</span><br><span class="line">wget https://www.lua.org/ftp/lua-5.4.6.tar.gz</span><br><span class="line">tar zxvf lua-5.4.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lua-5.4.6</span><br><span class="line"></span><br><span class="line">make linux <span class="built_in">test</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个看情况而定</span></span><br><span class="line"><span class="comment">#ln -s /usr/local/bin/lua /usr/bin/lua</span></span><br><span class="line"><span class="comment">#ln -s /usr/local/bin/luac /usr/bin/luac</span></span><br><span class="line"></span><br><span class="line">lua -v</span><br></pre></td></tr></table></figure><h3 id="10-node-js环境"><a href="#10-node-js环境" class="headerlink" title="10.node.js环境"></a>10.node.js环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#官网地址：https://nodejs.org/en</span></span><br><span class="line">wget https://nodejs.org/dist/v20.11.1/node-v20.11.1-linux-x64.tar.xz</span><br><span class="line">tar -xJf node-v20.11.1-linux-x64.tar.xz</span><br><span class="line"><span class="built_in">mv</span> node-v20.11.1-linux-x64 /usr/local/nodejs</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=/usr/local/nodejs/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure><h3 id="11-gcc依赖的四个包"><a href="#11-gcc依赖的四个包" class="headerlink" title="11.gcc依赖的四个包"></a>11.gcc依赖的四个包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#也可以全部手动编译所需四个包</span></span><br><span class="line"><span class="comment">#1.GMP编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz</span><br><span class="line">tar xvf gmp-6.3.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> gmp-6.3.0</span><br><span class="line">./configure --prefix=/usr/local/gmp-6.3</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.MPFR编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/mpfr/mpfr-4.2.1.tar.gz</span><br><span class="line">tar xzvf mpfr-4.2.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mpfr-4.2.1</span><br><span class="line">./configure --prefix=/usr/local/mpfr-4.2.1 --with-gmp=/usr/local/gmp-6.3</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.MPC编译安装（gcc的依赖包）</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz</span><br><span class="line">tar xzvf mpc-1.3.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mpc-1.3.1</span><br><span class="line">./configure --prefix=/usr/local/mpc-1.3.1 --with-gmp=/usr/local/gmp-6.3 --with-mpfr=/usr/local/mpfr-4.2.1</span><br><span class="line">make -j 2 &amp;&amp; make install</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">export LD_LIBRARY_PATH=/usr/local/mpc-1.3.1/lib:/usr/local/gmp-6.3/lib:/usr/local/mpfr-4.2.1/lib</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.ISL编译安装</span></span><br><span class="line">wget http://isl.gforge.inria.fr/isl-0.18.tar.xz</span><br><span class="line">tar -xjvf isl-0.18.tar.xz</span><br><span class="line"><span class="built_in">cd</span> isl-0.18</span><br><span class="line">./configure --prefix=/usr/local/isl-0.18  --with-gmp=/usr/local/gmp-6.3.0</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加动态链接库,编辑如下</span></span><br><span class="line">vim /etc/ld.so.conf</span><br><span class="line">include ld.so.conf.d/*.conf</span><br><span class="line">/lib</span><br><span class="line">/lib64</span><br><span class="line">/usr/lib</span><br><span class="line">/usr/lib64</span><br><span class="line">/usr/local/lib</span><br><span class="line">/usr/local/lib64</span><br><span class="line">/usr/local/gmp-6.1.0/lib</span><br><span class="line">/usr/local/mpc-1.0.3/lib</span><br><span class="line">/usr/local/mpfr-3.1.4/lib</span><br><span class="line"></span><br><span class="line"><span class="comment">#备注： 重新搜索当前系统上所有库文件搜索路径下的库文件,并生成缓存</span></span><br><span class="line">ldconfig -v</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">常见的一些依赖环境编译安装</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="环境依赖" scheme="http://example.com/tags/%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96/"/>
    
  </entry>
  
  <entry>
    <title>编译Zabbix6.0.5</title>
    <link href="http://example.com/2024/01/20/%E7%BC%96%E8%AF%91zabbix6.0.5/"/>
    <id>http://example.com/2024/01/20/%E7%BC%96%E8%AF%91zabbix6.0.5/</id>
    <published>2024-01-20T01:25:00.000Z</published>
    <updated>2024-01-20T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="编译Zabbix6-0-5"><a href="#编译Zabbix6-0-5" class="headerlink" title="编译Zabbix6.0.5"></a>编译Zabbix6.0.5</h1><h3 id="pgsql数据库配置"><a href="#pgsql数据库配置" class="headerlink" title="pgsql数据库配置"></a>pgsql数据库配置</h3><p>环境为Nginx1.24+PHP7.4+PGSQL13.7+Zabbix6.0.5</p><ul><li>1.安装编译工具和依赖项，有跳过这步骤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y gcc make wget openssl-devel libevent-devel libxml2-devel libcurl-devel libevent-devel pcre-devel libuuid-devel libtool-ltdl-devel postgresql-devel</span><br><span class="line"></span><br><span class="line">dnf install php-bcmath -y</span><br><span class="line">dnf install php-sockets -y</span><br></pre></td></tr></table></figure><ul><li>2.下载和解压 Zabbix 源代码</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://cdn.zabbix.com/zabbix/sources/stable/6.0/zabbix-6.0.5.tar.gz</span><br><span class="line">tar -zxvf zabbix-6.0.5.tar.gz &amp;&amp; <span class="built_in">cd</span> zabbix-6.0.5</span><br></pre></td></tr></table></figure><ul><li>3.登录到postgres，创建Zabbix数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE zabbix;</span><br><span class="line">CREATE USER zabbix;</span><br><span class="line">ALTER USER zabbix WITH ENCRYPTED PASSWORD <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON DATABASE zabbix TO zabbix;</span><br></pre></td></tr></table></figure><ul><li>4.给Zabbix配置时序数据库timescaledb</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># \c zabbix</span></span><br><span class="line">You are now connected to database <span class="string">&quot;zabbix&quot;</span> as user <span class="string">&quot;postgres&quot;</span>.</span><br><span class="line">zabbix=<span class="comment"># CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;</span></span><br><span class="line">WARNING:</span><br><span class="line">WELCOME TO</span><br><span class="line"> _____ _                               _     ____________</span><br><span class="line">|_   _(_)                             | |    |  _  \ ___ \</span><br><span class="line">  | |  _ _ __ ___   ___  ___  ___ __ _| | ___| | | | |_/ /</span><br><span class="line">  | | | |  _ ` _ \ / _ \/ __|/ __/ _` | |/ _ \ | | | ___ \</span><br><span class="line">  | | | | | | | | |  __/\__ \ (_| (_| | |  __/ |/ /| |_/ /</span><br><span class="line">  |_| |_|_| |_| |_|\___||___/\___\__,_|_|\___|___/ \____/</span><br><span class="line">               Running version 2.11.1</span><br><span class="line">For more information on TimescaleDB, please visit the following links:</span><br><span class="line"></span><br><span class="line"> 1. Getting started: https://docs.timescale.com/timescaledb/latest/getting-started</span><br><span class="line"> 2. API reference documentation: https://docs.timescale.com/api/latest</span><br><span class="line"> 3. How TimescaleDB is designed: https://docs.timescale.com/timescaledb/latest/overview/core-concepts</span><br><span class="line"></span><br><span class="line">Note: TimescaleDB collects anonymous reports to better understand and assist our <span class="built_in">users</span>.</span><br><span class="line">For more information and how to <span class="built_in">disable</span>, please see our docs https://docs.timescale.com/timescaledb/latest/how-to-guides/configuration/telemetry.</span><br><span class="line"></span><br><span class="line">CREATE EXTENSION</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看插件</span></span><br><span class="line">zabbix=<span class="comment"># \dx</span></span><br><span class="line">                                                List of installed extensions</span><br><span class="line">    Name     | Version |   Schema   |                                      Description</span><br><span class="line">-------------+---------+------------+---------------------------------------------------------------------------------------</span><br><span class="line"> plpgsql     | 1.0     | pg_catalog | PL/pgSQL procedural language</span><br><span class="line"> timescaledb | 2.11.1  | public     | Enables scalable inserts and complex queries <span class="keyword">for</span> time-series data (Community Edition)</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure><ul><li>5.还是postgres用户状态下，把源码包复制到家目录，导入 Zabbix 数据库模式和数据</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#表在源码包里面，依次导入三个表，不然可能会出错</span></span><br><span class="line"><span class="built_in">cd</span> database/postgresql</span><br><span class="line">psql -d zabbix -U zabbix -f schema.sql</span><br><span class="line">psql -d zabbix -U zabbix -f images.sql</span><br><span class="line">psql -d zabbix -U zabbix -f data.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#导入时序表，成功会出现下面信息</span></span><br><span class="line">bash-4.4$ psql -d zabbix -U zabbix -f timescaledb.sql</span><br><span class="line">psql:timescaledb.sql:69: NOTICE:  PostgreSQL version 13.7 is valid</span><br><span class="line">psql:timescaledb.sql:69: NOTICE:  TimescaleDB extension is detected</span><br><span class="line">psql:timescaledb.sql:69: NOTICE:  TimescaleDB version 2.11.1 is valid</span><br><span class="line">psql:timescaledb.sql:69: WARNING:  column <span class="built_in">type</span> <span class="string">&quot;character varying&quot;</span> used <span class="keyword">for</span> <span class="string">&quot;source&quot;</span> does not follow best practices</span><br><span class="line">HINT:  Use datatype TEXT instead.</span><br><span class="line">psql:timescaledb.sql:69: WARNING:  column <span class="built_in">type</span> <span class="string">&quot;character varying&quot;</span> used <span class="keyword">for</span> <span class="string">&quot;value&quot;</span> does not follow best practices</span><br><span class="line">HINT:  Use datatype TEXT instead.</span><br><span class="line">psql:timescaledb.sql:69: NOTICE:  TimescaleDB is configured successfully</span><br><span class="line">DO</span><br></pre></td></tr></table></figure><h3 id="Zabbix安装与配置"><a href="#Zabbix安装与配置" class="headerlink" title="Zabbix安装与配置"></a>Zabbix安装与配置</h3><ul><li>安装依赖</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf --enablerepo=powertools install OpenIPMI-devel -y </span><br><span class="line">dnf install make wget chrony gcc curl-devel net-snmp-devel libxml2-devel.i686 libevent-devel pcre-devel -y</span><br></pre></td></tr></table></figure><ul><li>创建zabbix用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin -M zabbix</span><br></pre></td></tr></table></figure><ul><li>.配置编译参数并编译安装，在刚刚解压好的源码包中执行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure -prefix=/usr/local/zabbix --enable-server --enable-agent --with-postgresql --with-openssl --with-libxml2 --with-libcurl --with-uuid --with-libevent</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">chown</span> -R zabbix.zabbix /usr/local/zabbix</span><br></pre></td></tr></table></figure><ul><li>配置Zabbix-server数据库连接</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky1 zabbix]<span class="comment"># cd /usr/local/zabbix/etc/</span></span><br><span class="line">[root@rocky1 etc]<span class="comment"># vim zabbix_server.conf</span></span><br><span class="line">DBPassword=123456</span><br><span class="line">DBPort=5432</span><br><span class="line">DBHost=192.168.80.10</span><br><span class="line">LogFile=/var/log/zabbix_server.log  <span class="comment">#指定日志位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#去创建一下这个</span></span><br><span class="line"><span class="built_in">touch</span> /var/log/zabbix_server.log  </span><br><span class="line"><span class="built_in">chown</span> zabbix.zabbix /var/log/zabbix_server.log</span><br></pre></td></tr></table></figure><ul><li>创建Zabbix Server的systemctl 服务管理文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/zabbix-server.service</span><br><span class="line">[Unit]  </span><br><span class="line">Description=Zabbix Server with PostgreSQL DB  </span><br><span class="line">After=syslog.target network.target postgresql-13.service</span><br><span class="line"></span><br><span class="line">[Service]  </span><br><span class="line">Type=simple  </span><br><span class="line">ExecStart=/usr/local/zabbix/sbin/zabbix_server -f  </span><br><span class="line">User=zabbix</span><br><span class="line"></span><br><span class="line">[Install]  </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><ul><li>创建Zabbix Agent启动脚本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/zabbix-agent.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Agent</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;CONFFILE=/usr/local/zabbix/etc/zabbix_agentd.conf&quot;</span> EnvironmentFile=-/etc/sysconfig/zabbix-agent</span><br><span class="line">Type=forking</span><br><span class="line">Restart=on-failure</span><br><span class="line">PIDFile=/tmp/zabbix_agentd.pid</span><br><span class="line">KillMode=control-group</span><br><span class="line">ExecStart=/usr/local/zabbix/sbin/zabbix_agentd</span><br><span class="line">ExecStop=/bin/kill -SIGTERM <span class="variable">$MAINPID</span></span><br><span class="line">RestartSec=10s</span><br><span class="line">User=zabbix</span><br><span class="line">Group=zabbix</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><ul><li>使用以下命令启动Zabbix Server及Zabbix Agent</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now zabbix-server</span><br><span class="line">systemctl <span class="built_in">enable</span> --now zabbix-agent</span><br></pre></td></tr></table></figure><h3 id="修改-nginx-配置"><a href="#修改-nginx-配置" class="headerlink" title="修改 nginx 配置"></a>修改 nginx 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#要注意一下，主配置有没有包含到子配置文件，忘了包含踩坑了</span></span><br><span class="line">vim /apps/nginx/conf.d/zabbix.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name test.zabbix.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root /var/www/zabbix;</span><br><span class="line">    index index.php;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    fastcgi_param SCRIPT_FILENAME /var/www/zabbix<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    include fastcgi_params;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改-php-配置"><a href="#修改-php-配置" class="headerlink" title="修改 php 配置"></a>修改 php 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /apps/php/etc/php-fpm.d/www.conf</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line"></span><br><span class="line">vim /apps/php/lib/php.ini</span><br><span class="line">memory_limit = 128M</span><br><span class="line">post_max_size = 16M</span><br><span class="line">upload_max_filesize = 2M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">session.auto_start = 0</span><br><span class="line">mbstring.func_overload = 0</span><br><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="创建目录和测试文件"><a href="#创建目录和测试文件" class="headerlink" title="创建目录和测试文件"></a>创建目录和测试文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/www/zabbix</span><br><span class="line"><span class="built_in">chown</span> -R nginx.nginx /var/www/zabbix</span><br><span class="line">vim /var/www/zabbix/index.php</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now nginx php-fpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#浏览器访问这个，电脑hosts修改一下,有时候得多等一下或者强制重启nginx，不然好像访问不通</span></span><br><span class="line">http://test.zabbix.com/index.php</span><br></pre></td></tr></table></figure><h3 id="最终web相关配置"><a href="#最终web相关配置" class="headerlink" title="最终web相关配置"></a>最终web相关配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#把源码包里ui目录下所有文件复制到指定的文件夹里</span></span><br><span class="line">[root@rocky1 www]<span class="comment"># cp -r -a /root/zabbix-6.0.5/ui/* /var/www/zabbix</span></span><br></pre></td></tr></table></figure><h4 id="小坑"><a href="#小坑" class="headerlink" title="小坑"></a>小坑</h4><p>重启后不知道为啥，Zabbix显示未设置数据库类型<br>排查以后发现，zabbix.conf.php文件变成了空白的，从源码里复制一份模板进去根据自己需求修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /apps/packages/zabbix-6.0.5/ui/conf/zabbix.conf.php.example /var/www/zabbix/conf/zabbix.conf.php</span><br><span class="line"></span><br><span class="line">vim /var/www/zabbix/conf/zabbix.conf.php</span><br><span class="line"></span><br><span class="line">systemctl restart zabbix-server</span><br></pre></td></tr></table></figure><ul><li>安装中文语言包、检查PHP模块，主要注意一定不能在php.ini中禁用proc_open函数，否则会导致pdo_pgsql()函数不可用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum reinstall glibc-common -y</span><br><span class="line">yum install langpacks-zh_CN.noarch -y</span><br><span class="line"></span><br><span class="line">[root@rocky1 ~]<span class="comment"># cd /apps/packages/zabbix-6.0.5/ui/</span></span><br><span class="line">[root@rocky1 ui]<span class="comment"># locale -a</span></span><br></pre></td></tr></table></figure><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/zabbix.png"></p>]]></content>
    
    
    <summary type="html">编译安装Zabbix6.0.5，实验机器为Rocky,其余机器自行尝试</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="Zabbix" scheme="http://example.com/categories/Linux/Zabbix/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="Zabbix" scheme="http://example.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>编译安装Postgresql13.7</title>
    <link href="http://example.com/2024/01/20/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85postgresql13.7/"/>
    <id>http://example.com/2024/01/20/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85postgresql13.7/</id>
    <published>2024-01-20T01:25:00.000Z</published>
    <updated>2024-01-20T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="编译安装Postgresql13-7"><a href="#编译安装Postgresql13-7" class="headerlink" title="编译安装Postgresql13.7"></a>编译安装Postgresql13.7</h1><h3 id="创建postgres用户及安装目录"><a href="#创建postgres用户及安装目录" class="headerlink" title="创建postgres用户及安装目录"></a>创建postgres用户及安装目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd postgres</span></span><br><span class="line"><span class="comment"># mkdir -p /apps/postgresql</span></span><br></pre></td></tr></table></figure><h3 id="安装PostgreSQL依赖包"><a href="#安装PostgreSQL依赖包" class="headerlink" title="安装PostgreSQL依赖包"></a>安装PostgreSQL依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install perl-ExtUtils-Embed -y</span><br><span class="line">yum install readline-devel -y</span><br><span class="line">yum install python-devel -y</span><br><span class="line">yum install python3 -y</span><br><span class="line">yum install python3-devel -y&amp;nbsp;</span><br><span class="line">yum install gcc-c++ -y</span><br><span class="line">yum install cmake -y</span><br><span class="line">yum install libarchive -y</span><br><span class="line">yum install openssl-devel -y</span><br></pre></td></tr></table></figure><h3 id="部署PostgreSQL"><a href="#部署PostgreSQL" class="headerlink" title="部署PostgreSQL"></a>部署PostgreSQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##下载安装包</span></span><br><span class="line">wget https://ftp.postgresql.org/pub/source/v13.7/postgresql-13.7.tar.gz  </span><br><span class="line">tar -zxvf postgresql-13.7.tar.gz  <span class="comment">##解压安装包</span></span><br><span class="line"><span class="built_in">cd</span> postgresql-13.7/</span><br><span class="line">./configure --prefix=/apps/postgresql --with-python --with-perl --with-openssl</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">##查看已经安装成功</span></span><br><span class="line">[root@rocky1 postgresql-13.7]<span class="comment"># /apps/postgresql/bin/pg_ctl --version</span></span><br><span class="line">pg_ctl (PostgreSQL) 13.7</span><br></pre></td></tr></table></figure><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /apps/postgresql/pgdata <span class="comment">##创建数据库的数据目录</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">### postgres ###</span></span><br><span class="line"><span class="string">export PATH=/apps/postgresql/bin:$PATH</span></span><br><span class="line"><span class="string">export LD_LIBRARY_PATH=/apps/postgresql/lib</span></span><br><span class="line"><span class="string">export PGDATA=/apps/postgresql/pgdata</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">pg_ctl --version  <span class="comment">##环境变量配置成功</span></span><br></pre></td></tr></table></figure><p>给用户目录赋权并创建数据库簇</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R postgres.postgres /apps/postgresql  <span class="comment">##修改postgresql所属组和所属用户</span></span><br><span class="line">su - postgres</span><br><span class="line">initdb  <span class="comment">##初始化数据库</span></span><br></pre></td></tr></table></figure><h3 id="后续配置"><a href="#后续配置" class="headerlink" title="后续配置"></a>后续配置</h3><h4 id="自定义开放访问的IP-修改data目录下的pg-hba-conf文件"><a href="#自定义开放访问的IP-修改data目录下的pg-hba-conf文件" class="headerlink" title="自定义开放访问的IP ,修改data目录下的pg_hba.conf文件"></a>自定义开放访问的IP ,修改data目录下的pg_hba.conf文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /apps/postgresql/pgdata</span><br><span class="line">[root@rocky1 pgdata]<span class="comment"># vim pg_hba.conf</span></span><br><span class="line"><span class="comment"># IPv4 out connections:</span></span><br><span class="line">host    all             all             0.0.0.0/0                md5</span><br></pre></td></tr></table></figure><h4 id="添加主机ip和主机名"><a href="#添加主机ip和主机名" class="headerlink" title="添加主机ip和主机名"></a>添加主机ip和主机名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky1 pgdata]<span class="comment"># vim postgresql.conf</span></span><br><span class="line">listen_addresses = <span class="string">&#x27;*&#x27;</span>          <span class="comment"># what IP address(es) to listen on;</span></span><br><span class="line">port = 5432 </span><br></pre></td></tr></table></figure><ul><li>切换到root用户，并到postgresql源码包的解压目录下(&#x2F;root&#x2F;postgresql-13.7&#x2F;)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /apps/postgresql/log</span><br><span class="line"><span class="built_in">cd</span> /apps/postgresql/log</span><br><span class="line"><span class="built_in">touch</span> server.log</span><br><span class="line"><span class="built_in">chown</span> -R postgres.postgres <span class="built_in">log</span></span><br><span class="line"><span class="comment">#在/root/postgresql-13.7/contrib/start-scripts里面</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">将 PostgreSQL 的启动脚本从源码包的 contrib/start-scripts/linux 目录复制到 /etc/init.d 目录中。这个脚本是用于启动、停止和管理 PostgreSQL 服务器的脚本。</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">[root@rocky1 start-scripts]<span class="comment"># cp linux /etc/init.d/postgresql</span></span><br><span class="line">vim /etc/init.d/postgresql</span><br><span class="line">prefix=/apps/postgresql</span><br><span class="line">PGDATA=<span class="string">&quot;/apps/postgresql/pgdata&quot;</span></span><br><span class="line">PGLOG=<span class="string">&quot;/apps/postgresql/log/server.log&quot;</span></span><br></pre></td></tr></table></figure><ul><li>赋予该文件执行权限</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/postgresql</span><br><span class="line"><span class="comment">#设置服务开机自启</span></span><br><span class="line">chkconfig --add postgresql</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /home/postgres</span><br><span class="line"><span class="built_in">chown</span> -R postgres.postgres /home/postgres</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动数据库</span></span><br><span class="line">service postgresql restart</span><br></pre></td></tr></table></figure><h3 id="源码安装timesacledb"><a href="#源码安装timesacledb" class="headerlink" title="源码安装timesacledb"></a>源码安装timesacledb</h3><h5 id="cmake需要3-0以上版本"><a href="#cmake需要3-0以上版本" class="headerlink" title="cmake需要3.0以上版本"></a>cmake需要3.0以上版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget&amp;nbsp;https://github.com/Kitware/CMake/releases/download/v3.27.4/cmake-3.27.4.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf cmake-3.27.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> cmake-3.27.4</span><br><span class="line">./bootstrap --prefix=/usr/local</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">vi ~/.bash_profile</span><br></pre></td></tr></table></figure><ul><li>下载源码，或者直接下载包，传上去</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/timescale/timescaledb/archive/refs/tags/2.11.2.tar.gz</span><br><span class="line">tar zxvf timescaledb-2.11.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> timescaledb-2.11.1</span><br></pre></td></tr></table></figure><ul><li>安装和编译</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./bootstrap <span class="comment">#如果有需要openssl就安装重新构建pgsql</span></span><br><span class="line"><span class="built_in">cd</span> ./build &amp;&amp; make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#加在最后一行</span></span><br><span class="line"><span class="built_in">cd</span> /apps/postgresql/pgdata</span><br><span class="line">[root@rocky1 pgdata]<span class="comment"># vim postgresql.conf</span></span><br><span class="line">shared_preload_libraries = <span class="string">&#x27;timescaledb&#x27;</span></span><br><span class="line"></span><br><span class="line">service postgresql restart</span><br><span class="line"></span><br><span class="line">CREATE DATABASE example;</span><br><span class="line">\c example</span><br><span class="line">CREATE EXTENSION IF NOT EXISTS timescaledb;</span><br><span class="line">SELECT * FROM pg_extension WHERE extname=<span class="string">&#x27;timescaledb&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">红帽系列的机器应该都大同小异</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="Postgresql" scheme="http://example.com/categories/Linux/Postgresql/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="Postgresql" scheme="http://example.com/tags/Postgresql/"/>
    
  </entry>
  
  <entry>
    <title>FTP安装并配置虚拟用户</title>
    <link href="http://example.com/2024/01/19/ftp%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/"/>
    <id>http://example.com/2024/01/19/ftp%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/</id>
    <published>2024-01-19T01:25:00.000Z</published>
    <updated>2024-01-19T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="FTP安装并配置虚拟用户"><a href="#FTP安装并配置虚拟用户" class="headerlink" title="FTP安装并配置虚拟用户"></a>FTP安装并配置虚拟用户</h2><h3 id="1-安装软件"><a href="#1-安装软件" class="headerlink" title="1.安装软件"></a>1.安装软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd</span><br></pre></td></tr></table></figure><h3 id="2-创建相应的ftp数据目录"><a href="#2-创建相应的ftp数据目录" class="headerlink" title="2.创建相应的ftp数据目录"></a>2.创建相应的ftp数据目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/ftp/zhang</span><br></pre></td></tr></table></figure><h3 id="3-创建一个用户提供给虚拟用户使用"><a href="#3-创建一个用户提供给虚拟用户使用" class="headerlink" title="3.创建一个用户提供给虚拟用户使用"></a>3.创建一个用户提供给虚拟用户使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin virtual</span><br></pre></td></tr></table></figure><h3 id="4-将ftp数据目录设置成virtual用户"><a href="#4-将ftp数据目录设置成virtual用户" class="headerlink" title="4.将ftp数据目录设置成virtual用户"></a>4.将ftp数据目录设置成virtual用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> virtual. /data/ftp/zhang -R</span><br><span class="line">ll /data/ftp/</span><br></pre></td></tr></table></figure><ul><li><strong>创建虚拟帐号与密码的文本文件(一行账号，一行密码, 注意不要有多余的空格)</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/logins.txt</span><br><span class="line">testzhang</span><br><span class="line">zhang@123</span><br></pre></td></tr></table></figure><h3 id="5-将创建好的密码文件txt格式转换db格式"><a href="#5-将创建好的密码文件txt格式转换db格式" class="headerlink" title="5.将创建好的密码文件txt格式转换db格式"></a>5.<strong>将创建好的密码文件txt格式转换db格式</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_load -T -t <span class="built_in">hash</span> -f /etc/vsftpd/logins.txt /etc/vsftpd/login.db</span><br></pre></td></tr></table></figure><h3 id="6-定义db文件的权限"><a href="#6-定义db文件的权限" class="headerlink" title="6.定义db文件的权限"></a>6.<strong>定义db文件的权限</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /etc/vsftpd/login.db</span><br></pre></td></tr></table></figure><ul><li><strong>定义pam认证文件（注意：db&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;login 文件就是上面生成的login.db文件；省略后缀.db）</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pam.d/ftp</span><br><span class="line">auth  required  /lib64/security/pam_userdb.so  db=/etc/vsftpd/login</span><br><span class="line">account  required  /lib64/security/pam_userdb.so  db=/etc/vsftpd/login</span><br></pre></td></tr></table></figure><ul><li><strong>配置vsftpd主配置文件 （guest_username&#x3D;virtual 对应上面创建的用户）</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak</span><br><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br><span class="line"><span class="comment">#禁止匿名登录FTP服务器</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="comment">#允许本地用户登录FTP服务器</span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="comment">#可以上传(全局控制) </span></span><br><span class="line">write_enable=NO</span><br><span class="line"><span class="comment">#匿名用户可以上传</span></span><br><span class="line">anon_upload_enable=NO</span><br><span class="line"><span class="comment">#匿名用户可以建目录</span></span><br><span class="line">anon_mkdir_write_enable=NO</span><br><span class="line"><span class="comment">#匿名用户修改删除</span></span><br><span class="line">anon_other_write_enable=NO</span><br><span class="line"><span class="comment">#全部用户被限制在主目录</span></span><br><span class="line">chroot_local_user=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.3.5版本之后，如果用户被限定在了其主目录下，则该用户的主目录不能再具有写权限了，需新增加下面这条配置</span></span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">#将所有用户看成虚拟用户guest</span></span><br><span class="line">guest_enable=YES</span><br><span class="line"><span class="comment">#指定虚拟用户，也就是将guest用户映射到virtual用户</span></span><br><span class="line">guest_username=virtual</span><br><span class="line"><span class="comment">#指定为独立服务</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="comment">#指定监听的端口</span></span><br><span class="line">listen_port=21</span><br><span class="line"><span class="comment">#开启被动模式</span></span><br><span class="line">pasv_enable=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">#FTP服务器公网IP</span></span><br><span class="line"><span class="comment">#pasv_address=&lt;FTP服务器公网IP&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置被动模式下，建立数据传输可使用port范围的最小值</span></span><br><span class="line">pasv_min_port=10000</span><br><span class="line"><span class="comment">#设置被动模式下，建立数据传输可使用port范围的最大值</span></span><br><span class="line">pasv_max_port=10088</span><br><span class="line"><span class="comment">#是否允许匿名用户下载全局可读的文件</span></span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line"><span class="comment">#指定虚拟用户配置文件的路径</span></span><br><span class="line">user_config_dir=/etc/vsftpd/user_conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">anonymous_enable=NO</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">write_enable=NO</span></span><br><span class="line"><span class="string">anon_upload_enable=NO</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable=NO</span></span><br><span class="line"><span class="string">anon_other_write_enable=NO</span></span><br><span class="line"><span class="string">chroot_local_user=YES</span></span><br><span class="line"><span class="string">allow_writeable_chroot=YES</span></span><br><span class="line"><span class="string">guest_enable=YES</span></span><br><span class="line"><span class="string">guest_username=virtual</span></span><br><span class="line"><span class="string">listen=YES</span></span><br><span class="line"><span class="string">listen_port=21</span></span><br><span class="line"><span class="string">pasv_enable=YES</span></span><br><span class="line"><span class="string">pasv_min_port=10000</span></span><br><span class="line"><span class="string">pasv_max_port=10088</span></span><br><span class="line"><span class="string">anon_world_readable_only=NO</span></span><br><span class="line"><span class="string">user_config_dir=/etc/vsftpd/user_conf</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><strong>创建上面配置文件中指定的子配置文件目录 user_conf</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/vsftpd/user_conf</span><br></pre></td></tr></table></figure><ul><li><strong>定义testzhang用户的配置文件(注意：这里创建配置用户配置文件的文件名必须与上面创建的用户名一致)</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/user_conf/testzhang</span><br><span class="line">write_enable=YES</span><br><span class="line">anon_world_readable_only=no</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YESanon_umask=022</span><br><span class="line">local_root=/data/ftp/zhang</span><br></pre></td></tr></table></figure><h4 id="启动vsftpd"><a href="#启动vsftpd" class="headerlink" title="启动vsftpd"></a><strong>启动vsftpd</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux配置FTP的一部分，主要针对虚拟用户，其余部分见详细文章</summary>
    
    
    
    <category term="运维" scheme="http://example.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="Linux" scheme="http://example.com/categories/%E8%BF%90%E7%BB%B4/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="FTP" scheme="http://example.com/tags/FTP/"/>
    
  </entry>
  
  <entry>
    <title>LVM服务器根目录扩容</title>
    <link href="http://example.com/2024/01/18/lvm%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%89%A9%E5%AE%B9/"/>
    <id>http://example.com/2024/01/18/lvm%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%89%A9%E5%AE%B9/</id>
    <published>2024-01-18T01:25:00.000Z</published>
    <updated>2024-01-18T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LVM服务器根目录扩容"><a href="#LVM服务器根目录扩容" class="headerlink" title="LVM服务器根目录扩容"></a>LVM服务器根目录扩容</h1><h2 id="新增加一块硬盘的情况"><a href="#新增加一块硬盘的情况" class="headerlink" title="新增加一块硬盘的情况"></a>新增加一块硬盘的情况</h2><h3 id="1-给根分区扩展容量"><a href="#1-给根分区扩展容量" class="headerlink" title="1.给根分区扩展容量"></a>1.给根分区扩展容量</h3><ul><li>使用<code>fdisk-l</code> 查看磁盘分区路径<br>先在虚拟机里增加一块磁盘</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000a0ffa</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    41943039    19921920   8e  Linux LVM</span><br><span class="line"></span><br><span class="line"><span class="comment">#这一个是新加的</span></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个是原来的/目录</span></span><br><span class="line">磁盘 /dev/mapper/centos-root：18.2 GB, 18249416704 字节，35643392 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-swap：2147 MB, 2147483648 字节，4194304 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br></pre></td></tr></table></figure><h3 id="2-使用fdisk-dev-sdb-给新增硬盘进行分区"><a href="#2-使用fdisk-dev-sdb-给新增硬盘进行分区" class="headerlink" title="2.使用fdisk &#x2F;dev&#x2F;sdb 给新增硬盘进行分区"></a>2.使用fdisk &#x2F;dev&#x2F;sdb 给新增硬盘进行分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">使用磁盘标识符 0x5371ec78 创建新的 DOS 磁盘标签。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (1-4，默认 1)：</span><br><span class="line">起始 扇区 (2048-41943039，默认为 2048)：</span><br><span class="line">将使用默认值 2048</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-41943039，默认为 41943039)：</span><br><span class="line">将使用默认值 41943039</span><br><span class="line">分区 1 已设置为 Linux 类型，大小设为 20 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x5371ec78</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    41943039    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br></pre></td></tr></table></figure><h3 id="3-确定新增成功"><a href="#3-确定新增成功" class="headerlink" title="3.确定新增成功"></a>3.确定新增成功</h3><p><code>fdisk -l</code> 确定&#x2F;dev&#x2F;sdb&#x2F;新增分区成功 新分区为&#x2F;dev&#x2F;sdb1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000a0ffa</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    41943039    19921920   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x5371ec78</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    41943039    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-root：18.2 GB, 18249416704 字节，35643392 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br></pre></td></tr></table></figure><h3 id="4-使用LVM-给根分区扩展空间"><a href="#4-使用LVM-给根分区扩展空间" class="headerlink" title="4.使用LVM 给根分区扩展空间"></a>4.使用LVM 给根分区扩展空间</h3><ul><li>使用vgdisplay 命令查看VG 组名</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               centos</span><br></pre></td></tr></table></figure><h3 id="5-使用vgextend-命令把新增磁盘追加到centos-VG组"><a href="#5-使用vgextend-命令把新增磁盘追加到centos-VG组" class="headerlink" title="5.使用vgextend 命令把新增磁盘追加到centos VG组"></a>5.使用vgextend 命令把新增磁盘追加到centos VG组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgextend centos /dev/sdb1</span></span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb1&quot;</span> successfully created.</span><br><span class="line">  Volume group <span class="string">&quot;centos&quot;</span> successfully extended</span><br></pre></td></tr></table></figure><h3 id="6-添加完成之后使用vgdisplay-查看是否扩容成功"><a href="#6-添加完成之后使用vgdisplay-查看是否扩容成功" class="headerlink" title="6.添加完成之后使用vgdisplay 查看是否扩容成功"></a>6.添加完成之后使用vgdisplay 查看是否扩容成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               centos</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        2</span><br><span class="line">  Metadata Sequence No  4</span><br><span class="line">  VG Access             <span class="built_in">read</span>/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                2</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                2</span><br><span class="line">  Act PV                2</span><br><span class="line">  VG Size               38.99 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              9982</span><br><span class="line">  Alloc PE / Size       4863 / &lt;19.00 GiB</span><br><span class="line">  Free  PE / Size       5119 / &lt;20.00 GiB   <span class="comment">#看这个</span></span><br><span class="line">  VG UUID               uIB4kO-ywhz-ee5U-DzS7-Kja6-sPvZ-rbi3Bl</span><br></pre></td></tr></table></figure><h3 id="7-使用lvdisplay确定根分区路径"><a href="#7-使用lvdisplay确定根分区路径" class="headerlink" title="7.使用lvdisplay确定根分区路径"></a>7.使用lvdisplay确定根分区路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/centos/root  <span class="comment">#这里</span></span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                centos</span><br><span class="line">  LV UUID                VrUURF-GOCQ-TvkL-Yd4O-OYJk-ZMBo-gqMEaI</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time localhost, 2023-09-14 13:18:10 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                &lt;17.00 GiB</span><br><span class="line">  Current LE             4351</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure><h3 id="8-使用lvresize-给根分区扩展空间"><a href="#8-使用lvresize-给根分区扩展空间" class="headerlink" title="8.使用lvresize 给根分区扩展空间"></a>8.使用lvresize 给根分区扩展空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lvresize  -L +20G  /dev/centos/root</span></span><br><span class="line"><span class="comment">#分区增加必须得加-L +20G,如果不写+号会改变原磁盘空间</span></span><br><span class="line">  Size of logical volume centos/root changed from &lt;17.00 GiB (4351 extents) to &lt;36.00 GiB (9215 extents).</span><br><span class="line">  Logical volume centos/root successfully resized.</span><br></pre></td></tr></table></figure><h3 id="9-根分区磁盘增加成功之后使用xfs-growfs-dev-centos-root-格式化磁盘空间"><a href="#9-根分区磁盘增加成功之后使用xfs-growfs-dev-centos-root-格式化磁盘空间" class="headerlink" title="9.根分区磁盘增加成功之后使用xfs_growfs &#x2F;dev&#x2F;centos&#x2F;root 格式化磁盘空间"></a>9.根分区磁盘增加成功之后使用xfs_growfs &#x2F;dev&#x2F;centos&#x2F;root 格式化磁盘空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># xfs_growfs /dev/centos/root</span></span><br><span class="line">meta-data=/dev/mapper/centos-root isize=512    agcount=4, agsize=1113856 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=4455424, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =bash                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 4455424 to 9436160</span><br></pre></td></tr></table></figure><h3 id="10-确认一下"><a href="#10-确认一下" class="headerlink" title="10.确认一下"></a>10.确认一下</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                 898M     0  898M    0% /dev</span><br><span class="line">tmpfs                    910M     0  910M    0% /dev/shm</span><br><span class="line">tmpfs                    910M  9.6M  901M    2% /run</span><br><span class="line">tmpfs                    910M     0  910M    0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   36G  1.3G   35G    4% /  <span class="comment">#增加了</span></span><br><span class="line">/dev/sda1               1014M  151M  864M   15% /boot</span><br><span class="line">tmpfs                    182M     0  182M    0% /run/user/0</span><br></pre></td></tr></table></figure><h2 id="在原有空间上修改磁盘大小的情况"><a href="#在原有空间上修改磁盘大小的情况" class="headerlink" title="在原有空间上修改磁盘大小的情况"></a>在原有空间上修改磁盘大小的情况</h2><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/xunihua.png"></p><ul><li>比如从50G,直接修改成100G，新增加的磁盘是不识别的</li></ul><h3 id="1-新建分区"><a href="#1-新建分区" class="headerlink" title="1.新建分区"></a>1.新建分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w</span><br><span class="line"><span class="comment">#使用lvm方式的话，是下面的操作，上面是基于传统的分区</span></span><br><span class="line">fdisk /dev/sda</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t</span><br><span class="line"></span><br><span class="line">L</span><br><span class="line">8e</span><br><span class="line">w</span><br></pre></td></tr></table></figure><h3 id="2-对新增的磁盘处理"><a href="#2-对新增的磁盘处理" class="headerlink" title="2.对新增的磁盘处理"></a>2.对新增的磁盘处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">partprobe <span class="comment">#识别新增分区</span></span><br><span class="line"></span><br><span class="line">pvcreate /dev/sda3  <span class="comment">#使用 pvcreate 创建物理卷</span></span><br><span class="line"></span><br><span class="line">pvdisplay <span class="comment">#显示物理卷的属性 查看卷组信息</span></span><br><span class="line"></span><br><span class="line">vgextend centos /dev/sda3  <span class="comment">#使用vgextend命令动态扩展</span></span><br><span class="line"></span><br><span class="line">lvresize -L +100%FREE /dev/mapper/centos-root  <span class="comment">#扩招到/目录</span></span><br><span class="line"></span><br><span class="line">xfs_growfs /dev/mapper/centos-root <span class="comment">#重新识别/分区</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">服务器根目录扩容，两种情况</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="运维" scheme="http://example.com/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="LVM" scheme="http://example.com/tags/LVM/"/>
    
  </entry>
  
  <entry>
    <title>Clash配置负载</title>
    <link href="http://example.com/2024/01/16/clash%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD/"/>
    <id>http://example.com/2024/01/16/clash%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD/</id>
    <published>2024-01-16T01:25:00.000Z</published>
    <updated>2024-01-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Clash配置负载"><a href="#Clash配置负载" class="headerlink" title="Clash配置负载"></a>Clash配置负载</h1><h2 id="实现负载，下载拉满带宽"><a href="#实现负载，下载拉满带宽" class="headerlink" title="实现负载，下载拉满带宽"></a>实现负载，下载拉满带宽</h2><ul><li>找到settings—–&gt;Profiles——-&gt;Parsers——&gt;Edit，然后添加下面代码</li></ul><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/clash.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">parsers:</span><br><span class="line">  - reg: &#x27;slbable$&#x27;</span><br><span class="line">    yaml:</span><br><span class="line">      append-proxy-groups:</span><br><span class="line">        - name:  负载均衡-散列</span><br><span class="line">          type: load-balance</span><br><span class="line">          url: &#x27;http://www.google.com/generate_204&#x27;</span><br><span class="line">          interval: 300</span><br><span class="line">          strategy: consistent-hashing</span><br><span class="line">        - name:  负载均衡-轮询</span><br><span class="line">          type: load-balance</span><br><span class="line">          url: &#x27;http://www.google.com/generate_204&#x27;</span><br><span class="line">          interval: 300</span><br><span class="line">          strategy: round-robin</span><br><span class="line">      commands:</span><br><span class="line">        - proxy-groups. 负载均衡-散列.proxies=[]proxyNames</span><br><span class="line">        - proxy-groups.0.proxies.0+ 负载均衡-散列</span><br><span class="line">        - proxy-groups. 负载均衡-轮询.proxies=[]proxyNames</span><br><span class="line">        - proxy-groups.0.proxies.0+ 负载均衡-轮询</span><br></pre></td></tr></table></figure><ul><li>然后在订阅链接后面添加触发条件，点击更新</li><li>会出现一个轮询，一个散列，下载建议用轮询，正常用就用散列</li></ul>]]></content>
    
    
    <summary type="html">Clash设置负载的脚本，可以让节点满速下载</summary>
    
    
    
    <category term="教程" scheme="http://example.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Clash" scheme="http://example.com/tags/Clash/"/>
    
    <category term="小教程" scheme="http://example.com/tags/%E5%B0%8F%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>编译安装PHP7.4</title>
    <link href="http://example.com/2024/01/16/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php7.4/"/>
    <id>http://example.com/2024/01/16/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php7.4/</id>
    <published>2024-01-16T01:25:00.000Z</published>
    <updated>2024-01-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="编译安装PHP7-4"><a href="#编译安装PHP7-4" class="headerlink" title="编译安装PHP7.4"></a>编译安装PHP7.4</h1><h2 id="依赖环境准备"><a href="#依赖环境准备" class="headerlink" title="依赖环境准备"></a>依赖环境准备</h2><ul><li>下载安装编译工具</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&#x27;Development Tools&#x27;</span> -y</span><br></pre></td></tr></table></figure><ul><li>安装依赖包，否则可能会报错</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br><span class="line">yum install zlib-devel -y</span><br><span class="line">yum install libxml2-devel -y</span><br><span class="line">yum install libcurl-devel -y</span><br><span class="line">yum install openssl-devel -y</span><br><span class="line">yum install libjpeg-devel -y</span><br><span class="line">yum install libpng-devel -y</span><br><span class="line">yum install freetype-devel -y</span><br><span class="line">yum install libpq-devel -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install bzip2-devel -y</span><br><span class="line">yum install sqlite-devel -y</span><br><span class="line">yum install libcurl-devel -y</span><br><span class="line">yum install libpng-devel -y</span><br><span class="line">yum install automake -y</span><br><span class="line">yum install autoconf -y</span><br><span class="line">yum install libtool -y</span><br><span class="line">yum install libicu-devel -y</span><br><span class="line">yum install gmp-devel -y</span><br><span class="line">yum install libzip-devel -y</span><br><span class="line">yum -y install postgresql-devel</span><br><span class="line"></span><br><span class="line"><span class="comment">#报错：configure: error: Cannot find ldap.h </span></span><br><span class="line">yum install openldap.i686 -y</span><br><span class="line">yum install openldap-devel.i686 -y</span><br><span class="line">yum install openldap-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#遇到oniguruma的报错，要安装6.9以上版本的才行</span></span><br><span class="line">wget https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz</span><br><span class="line">tar -xzvf oniguruma-6.9.4.tar.gz &amp;&amp; <span class="built_in">cd</span> oniguruma-6.9.4</span><br><span class="line">./autogen.sh &amp;&amp; ./configure --prefix=/usr</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">##较低版本的系统，libzip是低版本的，要安装高版本libzip</span></span><br><span class="line">yum install bzip2-devel</span><br><span class="line">wget https://libzip.org/download/libzip-1.7.3.tar.gz</span><br><span class="line">tar -xvzf libzip-1.7.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> libzip-1.7.3</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr/libs</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=/usr/libs/lib64/pkgconfig:<span class="variable">$PKG_CONFIG_PATH</span></span><br></pre></td></tr></table></figure><h2 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h2><ul><li>下载php7.4源码与安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky1 src]<span class="comment"># cd /usr/local/src &amp;&amp; wget https://www.php.net/distributions/php-7.4.30.tar.gz</span></span><br><span class="line">[root@rocky1 src]<span class="comment"># tar xzvf php-7.4.30.tar.gz &amp;&amp; cd php-7.4.30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">useradd -r php -s /sbin/nologin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在php-7.4.30目录下预编译</span></span><br><span class="line">./configure --prefix=/apps/php --with-fpm-user=php --with-fpm-group=php  --with-curl --enable-gd --enable-sockets --enable-bcmath --with-ldap --enable-gettext --enable-mbstring --with-openssl --with-zip --with-zlib  --enable-fpm --with pgsql=/apps/postgresql --with-pdo-pgsql=/apps/postgresql/bin/pg_config --with-gd --with-jpeg --with-freetype</span><br><span class="line"></span><br><span class="line"><span class="comment">#不指定路径</span></span><br><span class="line">./configure --with-fpm-user=php --with-fpm-group=php  --with-curl --enable-gd --enable-sockets --enable-bcmath --with-ldap --enable-gettext --enable-mbstring --with-openssl --with-zip --with-zlib  --enable-fpm --with-pgsql --with-pdo-pgsql --with-gd --with-jpeg --with-freetype --with-mysqli --with-pdo-mysql</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=/usr/lib/pkgconfig:/usr/libzip/lib64/pkgconfig ONIG_CFLAGS=<span class="string">&quot;-I/usr/include&quot;</span> ONIG_LIBS=<span class="string">&quot;-L/usr/lib -lonig&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#8.29版本的</span></span><br><span class="line">./configure --prefix=/apps/php --with-fpm-user=php --with-fpm-group=php --with-curl --with-gd --with-jpeg --with-freetype --enable-sockets --enable-bcmath --with-ldap --enable-gettext --enable-mbstring --with-openssl --with-zip --with-zlib --enable-fpm --with-pgsql=/apps/postgresql --with-pdo-pgsql=/apps/postgresql/bin/pg_config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编译</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">chown</span> -R php.php /apps/php</span><br></pre></td></tr></table></figure><ul><li>复制PHP配置文件模板</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/src/php-7.4.30/php.ini-development /apps/php/lib/php.ini</span><br></pre></td></tr></table></figure><h3 id="添加全局变量"><a href="#添加全局变量" class="headerlink" title="添加全局变量"></a>添加全局变量</h3><ul><li>1.打开终端，并以root权限登录</li><li>2.编辑&#x2F;etc&#x2F;profile文件，可以使用文本编辑器（如vi或nano）进行编辑：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#最后一行添加</span></span><br><span class="line">[root@rocky1 src]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/apps/php/bin:<span class="variable">$PATH</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>3.重启配置生效</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><ul><li>4.确认PHP命令是否可以全局使用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky1 php]<span class="comment"># php -v</span></span><br><span class="line">PHP 7.4.30 (cli) (built: Aug 14 2023 09:37:56) ( NTS )</span><br><span class="line">Copyright (c) The PHP Group</span><br><span class="line">Zend Engine v3.4.0, Copyright (c) Zend Technologies</span><br></pre></td></tr></table></figure><h3 id="systemctl管理PHP"><a href="#systemctl管理PHP" class="headerlink" title="systemctl管理PHP"></a>systemctl管理PHP</h3><ul><li>创建一个名为php-fpm.service的服务单元文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky1~]<span class="comment"># vim /etc/systemd/system/php-fpm.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=PHP-FPM FastCGI Process Manager</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/apps/php/sbin/php-fpm --nodaemonize --fpm-config /apps/php/etc/php-fpm.conf</span><br><span class="line">ExecReload=/bin/kill -USR2 <span class="variable">$MAINPID</span></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">几个小坑：</span><br><span class="line">1./apps/php/etc/php-fpm.conf配置文件名字必须为conf结尾的，默认的是php-fpm.conf.default，需要手动修改</span><br><span class="line">2./apps/php/etc/php-fpm.d目录下的www.conf.default文件也需要修改成www.conf</span><br></pre></td></tr></table></figure><ul><li>启用并启动PHP-FPM服务</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> php-fpm</span><br><span class="line">systemctl start php-fpm</span><br></pre></td></tr></table></figure><ul><li>在&#x2F;apps&#x2F;php&#x2F;etc&#x2F;php-fpm.d目录下的<a href="http://www.conf里添加以下行/">www.conf里添加以下行</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_admin_value[php.ini] = /apps/php/lib/php.ini</span><br></pre></td></tr></table></figure><ul><li>重启生效</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure><ul><li><code>www.conf</code>文件中的参数优化</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">pm = dynamic</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">十分详细的PHP编译安装过程，红帽系列机器，亲测无坑</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="PHP" scheme="http://example.com/categories/Linux/PHP/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="PHP" scheme="http://example.com/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>监控Mysql脚本</title>
    <link href="http://example.com/2024/01/15/%E7%9B%91%E6%8E%A7mysql%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2024/01/15/%E7%9B%91%E6%8E%A7mysql%E8%84%9A%E6%9C%AC/</id>
    <published>2024-01-15T01:25:00.000Z</published>
    <updated>2024-01-15T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="监控Mysql脚本"><a href="#监控Mysql脚本" class="headerlink" title="监控Mysql脚本"></a>监控Mysql脚本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义MySQL用户名、密码和主机</span></span><br><span class="line">MYSQL_USER=<span class="string">&quot;root&quot;</span></span><br><span class="line">MYSQL_PASSWORD=<span class="string">&quot;123456&quot;</span></span><br><span class="line">MYSQL_HOST=<span class="string">&quot;localhost&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测MySQL服务是否运行</span></span><br><span class="line"><span class="keyword">if</span> ! pgrep mysqld &gt;/dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果MySQL服务未运行，则尝试启动服务</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MySQL is not running, attempting to start...&quot;</span></span><br><span class="line">    systemctl start mysqld</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="comment"># 再次检查MySQL服务是否已经运行</span></span><br><span class="line">    <span class="keyword">if</span> ! pgrep mysqld &gt;/dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Failed to start MySQL.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;MySQL started successfully.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查能否连接到MySQL服务器</span></span><br><span class="line"><span class="keyword">if</span> ! mysqladmin ping -h <span class="string">&quot;<span class="variable">$MYSQL_HOST</span>&quot;</span> -u <span class="string">&quot;<span class="variable">$MYSQL_USER</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$MYSQL_PASSWORD</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Could not connect to MySQL server. Attempting to restart MySQL.&quot;</span></span><br><span class="line">    /etc/init.d/mysql restart</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="keyword">if</span> ! mysqladmin ping -h <span class="string">&quot;<span class="variable">$MYSQL_HOST</span>&quot;</span> -u <span class="string">&quot;<span class="variable">$MYSQL_USER</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$MYSQL_PASSWORD</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Failed to restart MySQL.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;MySQL restarted successfully.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MySQL is running.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">可以配合Zabbix使用的Mysql监控脚本</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="Mysql" scheme="http://example.com/categories/Linux/Mysql/"/>
    
    
    <category term="监控" scheme="http://example.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Mysql" scheme="http://example.com/tags/Mysql/"/>
    
    <category term="shell" scheme="http://example.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>team绑定双网卡</title>
    <link href="http://example.com/2024/01/13/team%E7%BB%91%E5%AE%9A%E5%8F%8C%E7%BD%91%E5%8D%A1/"/>
    <id>http://example.com/2024/01/13/team%E7%BB%91%E5%AE%9A%E5%8F%8C%E7%BD%91%E5%8D%A1/</id>
    <published>2024-01-13T01:25:00.000Z</published>
    <updated>2024-01-13T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="team绑定双网卡"><a href="#team绑定双网卡" class="headerlink" title="team绑定双网卡"></a>team绑定双网卡</h1><p>注意：虚拟机里做，一定要额外添加两块网卡才行，总共三块网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有的网络连接</span></span><br><span class="line">nmcli con show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 team 接口及其配置，并将 ens38、ens37 加入 ifcfg-team0</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> team con-name team0 ifname ifcfg-team0 config <span class="string">&#x27;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&#x27;</span></span><br><span class="line">nmcli con mod team0 ipv4.addresses <span class="string">&quot;192.168.147.100/24&quot;</span> ipv4.gateway <span class="string">&quot;192.168.147.2&quot;</span> ipv4.dns <span class="string">&quot;192.168.147.2&quot;</span> ipv4.method manual</span><br><span class="line"></span><br><span class="line">nmcli con add <span class="built_in">type</span> team-slave con-name team0-port1 ifname ens224 master ifcfg-team0</span><br><span class="line">nmcli con add <span class="built_in">type</span> team-slave con-name team0-port2 ifname ens256 master ifcfg-team0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活 team0 及其端口</span></span><br><span class="line">nmcli con up team0</span><br><span class="line">nmcli con up team0-port1</span><br><span class="line">nmcli con up team0-port2</span><br><span class="line"><span class="comment"># 查看 ifcfg-team0 网卡绑定的信息</span></span><br><span class="line">teamdctl ifcfg-team0 state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试网络连通性并停用端口，物理机直接轮流拔掉网口测试</span></span><br><span class="line">ping -c 4 192.168.147.2 &amp;  <span class="comment"># 在后台持续 ping DNS</span></span><br><span class="line">nmcli con down team0-port1  <span class="comment"># 停用端口1</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">服务器绑定双网卡，做负载</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="team" scheme="http://example.com/categories/Linux/team/"/>
    
    
    <category term="双网卡绑定" scheme="http://example.com/tags/%E5%8F%8C%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9A/"/>
    
    <category term="team" scheme="http://example.com/tags/team/"/>
    
  </entry>
  
  <entry>
    <title>mount镜像挂载</title>
    <link href="http://example.com/2024/01/12/mount%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F/"/>
    <id>http://example.com/2024/01/12/mount%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F/</id>
    <published>2024-01-12T01:25:00.000Z</published>
    <updated>2024-01-12T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mount小知识：挂载镜像"><a href="#mount小知识：挂载镜像" class="headerlink" title="mount小知识：挂载镜像"></a>mount小知识：挂载镜像</h1><h2 id="简单挂载"><a href="#简单挂载" class="headerlink" title="简单挂载"></a>简单挂载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看一下镜像有没有连接，这里是sr0</span></span><br><span class="line">[root@server2 ~]<span class="comment"># lsblk -l</span></span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda           8:0    0   20G  0 disk </span><br><span class="line">sda1          8:1    0    1G  0 part /boot</span><br><span class="line">sda2          8:2    0   19G  0 part </span><br><span class="line">centos-root 253:0    0   17G  0 lvm  /</span><br><span class="line">centos-swap 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sr0          11:0    1  988M  0 rom  </span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个挂载目录</span></span><br><span class="line">[root@server2 ~]<span class="comment"># mkdir /mnt/centos7.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将镜像文件挂载到目录里，-t指定一下文件系统</span></span><br><span class="line">[root@server2 ~]<span class="comment"># mount -t iso9660 /dev/sr0 /mnt/centos7.9</span></span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以将配置写进配置文件，开机自动挂载</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/sr0  /mnt/centos7.9  iso9660 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果开机有错误，将配置文件里自己添加的删除了就行</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">mount挂载本地镜像</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="mount" scheme="http://example.com/categories/Linux/mount/"/>
    
    
    <category term="挂载" scheme="http://example.com/tags/%E6%8C%82%E8%BD%BD/"/>
    
    <category term="mount" scheme="http://example.com/tags/mount/"/>
    
  </entry>
  
  <entry>
    <title>iops查看</title>
    <link href="http://example.com/2024/01/11/iops%E6%9F%A5%E7%9C%8B/"/>
    <id>http://example.com/2024/01/11/iops%E6%9F%A5%E7%9C%8B/</id>
    <published>2024-01-11T01:25:00.000Z</published>
    <updated>2024-01-11T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IOPS查看"><a href="#IOPS查看" class="headerlink" title="IOPS查看"></a>IOPS查看</h1><h3 id="iostat命令"><a href="#iostat命令" class="headerlink" title="iostat命令"></a>iostat命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#每隔5秒执行一次iostat，连续执行3次</span></span><br><span class="line">iostat -xmtc 5 3</span><br><span class="line">Linux 3.10.0-1160.92.1.el7.x86_64 (zhang)       10/17/2023      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">10/17/2023 08:19:03 PM</span><br><span class="line">avg-cpu:  %user   %<span class="built_in">nice</span> %system %iowait  %steal   %idle</span><br><span class="line">           0.62    0.00    0.24    0.05    0.00   99.09</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">vda               0.00     1.65    0.10    4.11     0.00     0.04    19.24     0.00    0.61    2.36    0.57   0.63   0.27</span><br><span class="line"></span><br><span class="line">– 设备（设备的名称）</span><br><span class="line">– rrqm/s（每秒钟进行的读操作的合并请求数）</span><br><span class="line">– wrqm/s（每秒钟进行的写操作的合并请求数）</span><br><span class="line">– r/s（每秒钟的读请求次数）</span><br><span class="line">– w/s（每秒钟的写请求次数）</span><br><span class="line">– rkB/s（每秒钟的读取数据量，单位KB）</span><br><span class="line">– wkB/s（每秒钟的写入数据量，单位KB）</span><br><span class="line">– avgrq-sz（每个请求的平均扇区数）</span><br><span class="line">– avgqu-sz（平均I / O请求数量）</span><br><span class="line">– awt（平均处理时间）</span><br><span class="line">– svctm（平均服务时间）</span><br><span class="line">– %util（每秒已使用磁盘时间的百分比）</span><br></pre></td></tr></table></figure><h3 id="dstat命令"><a href="#dstat命令" class="headerlink" title="dstat命令"></a>dstat命令</h3><p>dstat是一个系统资源统计工具，它能轻松监视系统的IOPS。它还可以报告CPU使用率、内存和磁盘使用率等更多指标。想要使用dstat，请使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@zhang ~]<span class="comment"># dstat -cdD total --disk-util --disk-tps --top-io-adv</span></span><br><span class="line">Module dstat_disk_util failed to load. (No counter objects to monitor)</span><br><span class="line">----total-cpu-usage---- -dsk/total- -dsk/total- -------most-expensive-i/o-process-------</span><br><span class="line">usr sys idl wai hiq siq| <span class="built_in">read</span>  writ|reads writs|process              pid  <span class="built_in">read</span> write cpu</span><br><span class="line">  1   0  99   0   0   0|2341B   38k|   0     4 |php-fpm: master proce31398  69k 199B0.0%</span><br><span class="line">  1   1  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0    12k|   0     3 |postgres: zabbix zabb18747   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    32k|   0     4 |postgres: zabbix zabb18736   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0    12k|   0     3 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    24k|   0     4 |postgres: zabbix zabb18735   0   16k  0%</span><br><span class="line">  1   1  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18736   0 8192B  0%</span><br><span class="line">  1   1  99   0   0   0|   0    16k|   0     3 |postgres: zabbix zabb18747   0 8192B  0%</span><br><span class="line">  1   0  98   0   0   0|   0    56k|   0     4 |postgres: zabbix zabb18738   0 8192B  0%</span><br><span class="line">  1   1  98   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18735   0 8192B  0%</span><br><span class="line">  1   0  99   0   0   0|   0  8192B|   0     2 |postgres: zabbix zabb18671   0 8192B  0%</span><br><span class="line">  2   1  98   0   0   0|   0   396k|   0     7 |postmaster           1314  550k   0   0%</span><br><span class="line">  1   1  99   0   0   0|   0    76k|   0    15 |node                 4925   11k  24k1.0%</span><br><span class="line">  2   0  98   0   0   0|   0    84k|   0     2 |zabbix_agentd: collec130521258B   0   0%</span><br><span class="line"> 15   2  82   2   0   0|7280k  144k| 223     8 |containerd-shim-runc-4875  105k  47k  0%^C</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">查看磁盘的性能的一些命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    <category term="iops" scheme="http://example.com/categories/Linux/iops/"/>
    
    
    <category term="磁盘读写" scheme="http://example.com/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99/"/>
    
    <category term="iops" scheme="http://example.com/tags/iops/"/>
    
  </entry>
  
  <entry>
    <title>JDK8安装</title>
    <link href="http://example.com/2024/01/05/java8%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"/>
    <id>http://example.com/2024/01/05/java8%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</id>
    <published>2024-01-05T01:25:00.000Z</published>
    <updated>2024-01-05T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JDK8安装"><a href="#JDK8安装" class="headerlink" title="JDK8安装"></a>JDK8安装</h2><h3 id="rpm包下载"><a href="#rpm包下载" class="headerlink" title="rpm包下载"></a>rpm包下载</h3><p>有Oracle jdk和openjdk两个版本，代码基本相同，但是推荐使用Oracle jdk<br>去官网下载：<br><a href="https://www.oracle.com/java/technologies/downloads/#java8">https://www.oracle.com/java/technologies/downloads/#java8</a><br>或者其他正规渠道</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh jdk-8u202-linux-x64</span></span><br><span class="line">警告：jdk-8u202-linux-x64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID ec551f03: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:jdk1.8-2000:1.8.0_202-fcs        <span class="comment">################################# [100%]</span></span><br><span class="line">Unpacking JAR files...</span><br><span class="line">        tools.jar...</span><br><span class="line">        plugin.jar...</span><br><span class="line">        javaws.jar...</span><br><span class="line">        deploy.jar...</span><br><span class="line">        rt.jar...</span><br><span class="line">        jsse.jar...</span><br><span class="line">        charsets.jar...</span><br><span class="line">        localedata.jar...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证版本"><a href="#验证版本" class="headerlink" title="验证版本"></a>验证版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">&quot;1.8.0_202&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_202-b08)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="修改profile文件"><a href="#修改profile文件" class="headerlink" title="修改profile文件"></a><strong>修改profile文件</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_202-amd64</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure><h3 id="没有特殊需求的时候"><a href="#没有特殊需求的时候" class="headerlink" title="没有特殊需求的时候"></a>没有特殊需求的时候</h3><p>没有特殊需求也可以yum安装openjdk</p><h4 id="检查是否安装"><a href="#检查是否安装" class="headerlink" title="检查是否安装"></a>检查是否安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -qa|grep jdk </span></span><br><span class="line">或者 </span><br><span class="line">[root@localhost ~]<span class="comment"># yum list installed | grep jdk</span></span><br></pre></td></tr></table></figure><h4 id="检测可用版本"><a href="#检测可用版本" class="headerlink" title="检测可用版本"></a>检测可用版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum search java | grep -i --color jdk</span></span><br><span class="line">ldapjdk-javadoc.noarch : Javadoc <span class="keyword">for</span> ldapjdk</span><br><span class="line">openjdk-asmtools-javadoc.noarch : Javadoc <span class="keyword">for</span> openjdk-asmtools</span><br><span class="line">icedtea-web.x86_64 : Additional Java components <span class="keyword">for</span> OpenJDK - Java browser</span><br><span class="line">java-1.6.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class="line">java-1.6.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class="line">java-1.6.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class="line">java-1.6.0-openjdk-javadoc.x86_64 : OpenJDK API Documentation</span><br><span class="line">java-1.6.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class="line">java-1.7.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class="line">java-1.7.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class="line">java-1.7.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class="line">java-1.7.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class="line">java-1.7.0-openjdk-headless.x86_64 : The OpenJDK runtime environment without</span><br><span class="line">java-1.7.0-openjdk-javadoc.noarch : OpenJDK API Documentation</span><br><span class="line">java-1.7.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class="line">java-1.8.0-openjdk.i686 : OpenJDK Runtime Environment 8</span><br><span class="line">java-1.8.0-openjdk.x86_64 : OpenJDK 8 Runtime Environment</span><br><span class="line">java-1.8.0-openjdk-accessibility.i686 : OpenJDK accessibility connector</span><br><span class="line">java-1.8.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class="line">java-1.8.0-openjdk-demo.i686 : OpenJDK Demos 8</span><br><span class="line">java-1.8.0-openjdk-demo.x86_64 : OpenJDK 8 Demos</span><br><span class="line">java-1.8.0-openjdk-devel.i686 : OpenJDK Development Environment 8</span><br><span class="line">java-1.8.0-openjdk-devel.x86_64 : OpenJDK 8 Development Environment</span><br><span class="line">java-1.8.0-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 8</span><br><span class="line">java-1.8.0-openjdk-headless.x86_64 : OpenJDK 8 Headless Runtime Environment</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="安装jdk1-8"><a href="#安装jdk1-8" class="headerlink" title="安装jdk1.8"></a><strong>安装jdk1.8</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install -y java-1.8.0-openjdk.x86_64</span></span><br><span class="line">[root@localhost ~]<span class="comment"># java -version</span></span><br><span class="line">openjdk version <span class="string">&quot;1.8.0_392&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_392-b08)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.392-b08, mixed mode)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux上jdk8的简单配置方法</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="JDK8" scheme="http://example.com/tags/JDK8/"/>
    
  </entry>
  
  <entry>
    <title>文件权限管理</title>
    <link href="http://example.com/2023/12/26/12.%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2023/12/26/12.%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</id>
    <published>2023-12-26T01:25:00.000Z</published>
    <updated>2023-12-26T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基本权限-U-G-O"><a href="#基本权限-U-G-O" class="headerlink" title="基本权限 U G O"></a>基本权限 U G O</h3><p>文件权限设置：可以赋予某个用户或组，能够以何种方式，访问某个文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">u的权限：r w x</span><br><span class="line">g的权限：r w x</span><br><span class="line">o的权限：r w x</span><br></pre></td></tr></table></figure><h4 id="UGO设置基本权限"><a href="#UGO设置基本权限" class="headerlink" title="UGO设置基本权限"></a>UGO设置基本权限</h4><h5 id="权限对象"><a href="#权限对象" class="headerlink" title="权限对象"></a>权限对象</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属主：u</span><br><span class="line">属组：g</span><br><span class="line">其他人：o</span><br></pre></td></tr></table></figure><h5 id="权限类型"><a href="#权限类型" class="headerlink" title="权限类型"></a>权限类型</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">读：r 4</span><br><span class="line">写：w 2</span><br><span class="line">执行：x 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rwx 7     rw- 6      r-- 4</span></span><br></pre></td></tr></table></figure><h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><h4 id="更改文件的属主、属组-chown-chgrp"><a href="#更改文件的属主、属组-chown-chgrp" class="headerlink" title="更改文件的属主、属组 chown chgrp"></a>更改文件的属主、属组 chown chgrp</h4><p>chmod是更改文件的权限 chown是改改文件的属主与属组 chgrp只是更改文件的属组。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法：chown 【选项】【所属主】【所属组】文件</span><br><span class="line">[root@server1 ~]# chown centos:hr file1 # 改属主、属组</span><br><span class="line">[root@server1 ~]# chown centos file1 # 只改属主</span><br><span class="line">[root@server1 ~]# chown :hr file1 # 只改属组</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：chgrp [OPTION]... GROUP FILE</span><br><span class="line">[root@server1 ~]# chgrp it file1 # 改文件属性组</span><br><span class="line">[root@server1 ~]# chgrp -R it dir1 # 改文件属性组，-R是递归</span><br></pre></td></tr></table></figure><h4 id="更改文件权限-chmod"><a href="#更改文件权限-chmod" class="headerlink" title="更改文件权限 chmod"></a>更改文件权限 chmod</h4><h5 id="使用符号更改"><a href="#使用符号更改" class="headerlink" title="使用符号更改"></a>使用符号更改</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">语法：chmod ［who］ ［+ | – | =］ ［mode］ 文件名</span><br><span class="line">命令中各选项的含义为：</span><br><span class="line">操作对象who可是下述字母中的任一个或者它们的组合：</span><br><span class="line">u 表示“用户（user）”，即文件或目录的所有者。</span><br><span class="line">g 表示“同组（group）用户”，即与文件属主有相同组ID的所有用户。</span><br><span class="line">o 表示“其他（others）用户”。</span><br><span class="line">a 表示“所有（all）用户”。它是系统默认值。</span><br><span class="line">---------------------------------------------</span><br><span class="line">操作符号可以是：</span><br><span class="line">+ 添加某个权限。</span><br><span class="line">– 取消某个权限。</span><br><span class="line">= 赋予给定权限并取消其他所有权限（如果有的话）。</span><br><span class="line">设置mode所表示的权限可用下述字母的任意组合：</span><br><span class="line">r 可读。</span><br><span class="line">w 可写。</span><br><span class="line">x 可执行。</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# chmod u+x file1 # 属主增加执行</span><br><span class="line">[root@server1 ~]# chmod a=rwx file1 # 所有人等于读写执行</span><br><span class="line">[root@server1 ~]# chmod a=- file1 # 所有人没有权限</span><br><span class="line">[root@server1 ~]# chmod ug=rw,o=r file1 # 属主属组等于读写，其他人只读</span><br><span class="line">[root@server1 ~]# ll file1 # 显示结果</span><br></pre></td></tr></table></figure><h5 id="使用数字更改"><a href="#使用数字更改" class="headerlink" title="使用数字更改"></a>使用数字更改</h5><p>数字表示的属性的含义：0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限，然后将其相加。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# chmod 644 file1</span><br><span class="line">[root@server1 ~]# ll file1</span><br></pre></td></tr></table></figure><h4 id="r、w、x权限对文件和目录的意义"><a href="#r、w、x权限对文件和目录的意义" class="headerlink" title="r、w、x权限对文件和目录的意义"></a>r、w、x权限对文件和目录的意义</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">权限               对文件的影响                      对目录的影响</span><br><span class="line">r(读取)          可以读取文件的内容        可以列出目录的内容(文件名)，可以使用ls命令</span><br><span class="line">w(写入)          可以更改文件的内容        可以创建或删除目录中的任一文件，可以使用touch、rm命令</span><br><span class="line">x(可执行)        可以作为命令执行文件      可以访问目录的内容(取决于目录中文件的权限)，可以使用cd命令</span><br></pre></td></tr></table></figure><p>对目录有w权限,可以在目录中创建新文件，可以删除文件夹中的文件(跟文件权限无关)，对文件x权限小心给予。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# chmod 777 /dir10/</span><br><span class="line">[root@server1 ~]# chmod 000 /dir10/file1</span><br><span class="line">[root@server1 ~]# ll -d /dir10/</span><br><span class="line">drwxrwxrwx. 2 root root 19 9月  4 11:44 /dir10/</span><br><span class="line">[root@server1 ~]# ll /dir10/file1</span><br><span class="line">----------. 1 root root 0 9月  4 11:44 /dir10/file1</span><br><span class="line">[root@server1 ~]# su centos</span><br><span class="line">[centos@server1 root]$ cat /dir10/file1</span><br><span class="line">cat: /dir10/file1: 权限不够</span><br><span class="line">[centos@server1 root]$ rm -rf /dir10/file1</span><br></pre></td></tr></table></figure><h3 id="ACL设置基本权限-r-w-x"><a href="#ACL设置基本权限-r-w-x" class="headerlink" title="ACL设置基本权限 (r,w,x)"></a>ACL设置基本权限 (r,w,x)</h3><p>ACL主要是针对单一用户、单一文件或目录来进行r、w、x的特殊权限，实现灵活的权限管理，除了文件的所有者，所有组和其他人，可以对更多用户设置权限。centos7默认创建的xfs和ext4文件系统具有ACL功能。</p><h4 id="ACL基本用法-setfacl"><a href="#ACL基本用法-setfacl" class="headerlink" title="ACL基本用法 setfacl"></a>ACL基本用法 setfacl</h4><p>setfacl命令可以用来细分linux下的文件权限。chmod命令可以把文件权限分为u,g,o三个组，而setfacl可以对每一个文件或目录设置更精确的文件权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setfacl</span><br><span class="line">常用选项：</span><br><span class="line">-m ：添加acl设定参数</span><br><span class="line">-x ：删除acl设定参数</span><br><span class="line">-b ：移除所有的ACL设定参数</span><br><span class="line">-R ：递归添加acl设定参数</span><br><span class="line">-d ：添加默认acl设定参数（目录）</span><br><span class="line">删除用户权限：setacl -x u:username filename</span><br><span class="line">删除组权限：setacl -x g:groupname filename</span><br><span class="line">删除整个acl权限：setacl -b filename</span><br></pre></td></tr></table></figure><p>看一个实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# getfacl test   #查看一个test文件的acl</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file: <span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">owner: root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">group: root</span></span><br><span class="line">user::r-x</span><br><span class="line">user:tank:rwx #effective:---</span><br><span class="line">group::r-x #effective:---</span><br><span class="line">mask::---</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><p>修改之后再查看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# setfacl -m u:zhangy:rw- test #修改文件的acl权限，添加一个用户权限</span><br><span class="line">[root@server1 ~]# getfacl test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file: <span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">owner: root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">group: root</span></span><br><span class="line">user::r-x</span><br><span class="line">user:zhangy:rw- #多出来一个用户</span><br><span class="line">user:tank:rwx</span><br><span class="line">group::r-x</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br><span class="line">[root@server1 ~]# setfacl -m g:zhangying:r-w test #添加一个组</span><br><span class="line">[root@server1 ~]# getfacl test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file: <span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">owner: root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">group: root</span></span><br><span class="line">user::r-x</span><br><span class="line">user:zhangy:rw-</span><br><span class="line">user:tank:rwx</span><br><span class="line">group::r-x</span><br><span class="line">group:zhangying:rw-</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# setfacl -m u:centos:rw file1 # 增加用户权限</span><br><span class="line">[root@server1 ~]# setfacl -m u:user05:- file1 # 增加用户权限</span><br><span class="line">[root@server1 ~]# setfacl -m o::rw file1 # 修改其他人权限</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# setfacl -m g:hr:r file1 # 增加组权限</span><br><span class="line">[root@server1 ~]# setfacl -x g:hr file1 # 删除组权限</span><br><span class="line">[root@server1 ~]# setfacl -b file1 # 删除所有acl权限</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# man setfacl</span><br><span class="line">[root@server1 ~]# getfacl file1 |setfacl --set-file=- file2 # 复制file1的acl给file2</span><br></pre></td></tr></table></figure><h4 id="mask权限"><a href="#mask权限" class="headerlink" title="mask权限"></a>mask权限</h4><p>ACL权限一般与<strong>最大有效权限</strong>mask结合使用，ACL权限与mask权限相与的值相与后的权限，为设定的真实权限。mask用于临时降低用户或组(除属主和其他人)的权限。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果设定ACL权限为 r-- ,mask的权限为r-x，那么真实权限为r--。</span><br><span class="line">如果设定ACL权限为 rwx ,mask的权限为r-x，那么真实权限为r-x。</span><br><span class="line">意思就是ACL与mask两者同时具有某一权限时，真实权限才具备该权限，若有一方不具备该权限，则真实权限不具备此权限。</span><br><span class="line">mask权限默认为rwx，相当于没有意义，因为相当于我们设定的acl权限为acl权限本身。我们可以通过调整mask权限来完成指定权限的更改。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# setfacl -m o::- file1</span><br><span class="line">[root@server1 ~]# setfacl -m m::--- file1</span><br><span class="line">[root@server1 ~]# getfacl file1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file: file1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">owner: centos</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">group: it</span></span><br><span class="line">user::rw-</span><br><span class="line">group::r-- #effective:---</span><br><span class="line">mask::---</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><h4 id="default"><a href="#default" class="headerlink" title="default"></a>default</h4><p>一般针对目录，默认权限独立于该目录本身的权限，规定了在该目录中创建的文件的默认ACL权限。<br>要求：希望centos能够对 &#x2F;home 以及以后在 &#x2F;home 下新建的文件有读、写、执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# setfacl -m u:centos:rwx /home</span><br><span class="line">[root@server1 ~]# setfacl -m d:u:centos:rwx /home</span><br><span class="line">[root@server1 ~]# getfacl /home</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file: home</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">owner: root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">group: root</span></span><br><span class="line">user::rwx</span><br><span class="line">user:centos:rwx</span><br><span class="line">group::r-x</span><br><span class="line">mask::rwx</span><br><span class="line">other::r-x</span><br><span class="line">default:user::rwx</span><br><span class="line">default:user:centos:rwx</span><br><span class="line">default:group::r-x</span><br><span class="line">default:mask::rwx</span><br><span class="line">default:other::r-x</span><br></pre></td></tr></table></figure><p>设置后，该目录下的所有文件创建时都会拥有其规定的ACL权限</p><h4 id="删除权限"><a href="#删除权限" class="headerlink" title="删除权限"></a>删除权限</h4><p>删除特定用户，将选项-m改为-x，参数最后一段舍去即可，例如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setfacl -x u:test a</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除了赋予<span class="built_in">test</span>用户的ACL权限</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除所有ACL权限，选项改为-d ，参数不加</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除默认ACL权限，选项改为-k ，参数不加</span></span><br></pre></td></tr></table></figure><h3 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h3><p>文件的特殊权限包括：SUID 4、SGID 2、SBIT 1</p><h4 id="SUID-Set-UID"><a href="#SUID-Set-UID" class="headerlink" title="SUID(Set UID)"></a>SUID(Set UID)</h4><p>suid：借出程序所有者的权限<br>s：程序所属主有x权限<br>S：程序所属主没有x权限<br>SUID权限仅对二进制程序有效<br>仅在本程序中拥有改权限<br>属主拥有s权限，即可将自己的权限暂时借给其他人使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# ll /root/file2</span><br><span class="line">-rw-r--rw-. 1 root root 0 9月  4 13:48 /root/file2</span><br><span class="line">[root@server1 ~]# su - centos</span><br><span class="line">上一次登录：日 9月  8 18:31:49 CST 2019pts/1 上</span><br><span class="line">[centos@server1 ~]$ cat /root/file2</span><br><span class="line">cat: /root/file2: 权限不够</span><br><span class="line">[centos@server1 ~]$ ll /root/file2</span><br><span class="line">ls: 无法访问/root/file2: 权限不够</span><br></pre></td></tr></table></figure><p>系统会检查进程的所有者，根据所有者设置的权限来确定是否对文件有权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# ll /etc/shadow</span><br><span class="line">----------. 1 root root 1760 9月  5 11:12 /etc/shadow</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">普通用户依旧是可以修改密码</span></span><br><span class="line">[root@server1 ~]# ll /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x. 1 root root 27832 6月  10 2014 /usr/bin/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">密码文件/etc/shadow只有root用户拥有修改权限，那其他用户是如何修改自身密码的呢，那就是由于命令passwd拥有SUID权限</span><br><span class="line">  a、vbird 对於 /usr/bin/passwd 这个程序来说是具有 x 权限的，表示 vbird 能运行 passwd；</span><br><span class="line">  b、passwd 的拥有者是 root 这个帐号；</span><br><span class="line">  c、vbird 运行 passwd 的过程中，会『暂时』获得 root 的权限；</span><br><span class="line">  d、/etc/shadow 就可以被 vbird 所运行的 passwd 所修改。</span><br><span class="line">但如果vbird使用cat去读取/etc/shadow时，他能够读取吗？因为cat不具有SUID的权限，所以vbird运行『cat/etc/shadow』时，是不能读取/etc/shadow的。</span><br></pre></td></tr></table></figure><h4 id="SGID权限"><a href="#SGID权限" class="headerlink" title="SGID权限"></a>SGID权限</h4><p>1.针对用户组权限位修改，用户创建的目录或文件所属组和该目录的所属组一致。（比如给一个文件路径设置了特殊权限为 ，假设这个路径数组为hr，那么user1在此目录下创建的文件数组将不是user1组，而是hr组）<br>二进制程序有效<br>执行者拥有x权限<br>执行过程中暂时拥有用户组权限<br>高级权限的类型<br>s：程序所属主有x权限<br>S：程序所属主没有x权限</p><h4 id="SBIT权限"><a href="#SBIT权限" class="headerlink" title="SBIT权限"></a>SBIT权限</h4><p><strong>用来做共享目录</strong><br><strong>当属主拥有x权限时，用小写的字母t表示，当属主没有x权限时，用大写字母T权限表示1</strong><br>只针对目录有效<br><strong>用户在此目录中创建文件时，只有root用户和自己可以删除该文件，其他用户是不可以修改此文件</strong><br>典型例子&#x2F;tmp这个目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zhangsan@server1 tmp]$ ll -d /tmp/</span><br><span class="line">drwxrwxrwt. 9 root root 4096 9月 13 16:08 /tmp/</span><br><span class="line">suid 4 # 使用文件所有者身份执行文件&lt;针对文件&gt;</span><br><span class="line">sgid 2 # 新建文件继承目录属组&lt;针对目录&gt;</span><br><span class="line">sticky 1 # 文件只能由文件拥有者，root,文件夹拥有者删除&lt;针对目录&gt;</span><br></pre></td></tr></table></figure><h4 id="SUID，SGID，Sticky-Bit-权限设置"><a href="#SUID，SGID，Sticky-Bit-权限设置" class="headerlink" title="SUID，SGID，Sticky Bit 权限设置"></a>SUID，SGID，Sticky Bit 权限设置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.以符号进行赋权</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SUID赋权</span></span><br><span class="line">chmod u+s filename</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SGID赋权</span></span><br><span class="line">chmod g+s filename/dirname</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBIT赋权</span></span><br><span class="line">chmod o+t filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.以数字进行赋权</span></span><br><span class="line">SUID SGID SBIT</span><br><span class="line"> 4    2    1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">举例</span></span><br><span class="line">chmod 1777 filename 等效与chmod o+t filename</span><br><span class="line">chmod 7777 filename 等效于同时为赋权SUID、SGID、SBIT权限</span><br></pre></td></tr></table></figure><p>&#x2F;tmp 文件夹是1777权限，否则会导致程序不能正常运行</p><h4 id="chattr权限"><a href="#chattr权限" class="headerlink" title="chattr权限"></a>chattr权限</h4><p>可以改变文件的属性，对root有限制</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">语法：chattr 【+-=】【选项】 +文件名或目录名</span><br><span class="line">+：增加权限</span><br><span class="line">-：删除权限</span><br><span class="line">=：等于某权限</span><br><span class="line">选项：</span><br><span class="line">i：对于文件，不允许对文件进行删除，改名，添加和修改数据，但可以看。</span><br><span class="line">对于目录，只能修改目录下的文件数据，但不允许建立和删除文件。（相当于把文件或目录锁起来）</span><br><span class="line">a：对于文件，只能在文件中增加数据，但是不能删除也不能修改数据。（不能用vim来添加或删除数据，只能用echo，如：echo 内</span><br><span class="line">容&gt;&gt;文件名）</span><br><span class="line">对于目录，只允许在目录中建立和修改文件，但是不允许删除。（相当于把已经有的数据锁起来）</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# lsattr file2</span><br><span class="line">---------------- file2</span><br><span class="line">[root@server1 ~]# chattr +a file2</span><br><span class="line">[root@server1 ~]# lsattr file2</span><br><span class="line">-----a---------- file2</span><br><span class="line">[root@server1 ~]# man chattr</span><br><span class="line">----------</span><br><span class="line">ATTRIBUTES(属性)</span><br><span class="line">当修改设置了&#x27;A&#x27;属性的文件时,它的atime记录不会改变.</span><br><span class="line">这可以在笔记本电脑系统中避免某些磁盘I/O处理.</span><br><span class="line">设置了`a&#x27;属性的文件只能在添加模式下打开用于写入. 只有超级用户可以设置或清除该属性.</span><br><span class="line">设置了`c&#x27;属性的文件在磁盘上由内核自动进行压缩处理.</span><br><span class="line">从该文件读取时返回的是未压缩的数据.</span><br><span class="line">对该文件的一次写入会在保存它们到磁盘之前进行数据压缩.</span><br><span class="line">设置了`d&#x27;属性的文件不能对其运行 dump(8) 程序进行备份.</span><br><span class="line">设置了`i&#x27;属性的文件不能进行修改:你既不能删除它,也不能给它重新命名,你不能对该文件创建链接, 而且也不能对该文件写入任何数据.</span><br><span class="line">只有超级用户可以设置或清除该属性.</span><br><span class="line">当删除设置了`s&#x27;属性的文件时,将对其数据块清零 并写回到磁盘上.</span><br><span class="line">当修改设置了`S&#x27;属性的文件时,修改会同步写入到磁盘上;</span><br><span class="line">这与应用到文件子系统上的`sync&#x27;挂载选项有相同的效果.</span><br><span class="line">当删除设置了`u&#x27;属性的文件时, 将会保存其内容. 这使得用户可以请求恢复被删除的文件.</span><br></pre></td></tr></table></figure><h4 id="umask-进程的文件权限掩码"><a href="#umask-进程的文件权限掩码" class="headerlink" title="umask 进程的文件权限掩码"></a>umask 进程的文件权限掩码</h4><p>umask概述：登录系统之后在当前登录shell进程l中，创建一个文件总是有一个默认权限的，默认权限的由来就是umask干的事情，umask设置了用户创建文件的默认权限，它与chmod的效果刚好相反，umask设置的是权限“补码”，而chmod设置的是文件权限码。umask表示要减掉得到权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">shell (vim,touch) 新文件或目录权限</span><br><span class="line">vsftpd 新文件或目录权限</span><br><span class="line">samba 新文件或目录权限</span><br><span class="line">useradd 用户HOME</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# type -a umask</span><br><span class="line">umask 是 shell 内嵌</span><br><span class="line">umask 是 /usr/bin/umask</span><br><span class="line">[root@server1 ~]# help umask</span><br><span class="line">umask: umask [-p] [-S] [模式]</span><br><span class="line"> 显示或设定文件模式掩码。</span><br><span class="line"> </span><br><span class="line"> 设定用户文件创建掩码为 MODE 模式。如果省略了 MODE，则打印当前掩码的值。</span><br><span class="line"> </span><br><span class="line"> 如果MODE 模式以数字开头，则被当作八进制数解析；否则是一个chmod(1) 可接收的符号模式串。</span><br><span class="line"> 选项：</span><br><span class="line">   -p 如果省略 MDOE 模式，以可重用为输入的格式输入</span><br><span class="line">   -S 以符号形式输出，否则以八进制数格式输出</span><br><span class="line">   </span><br><span class="line"> 退出状态：</span><br><span class="line"> 返回成功，除非使用了无效的 MODE 模式或者选项。</span><br></pre></td></tr></table></figure><p>实例1：在shell进程中创建文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# umask # 查看当前用户的umask权限</span><br><span class="line">0022</span><br><span class="line">[root@server1 ~]# umask -S # 查看最终有的权限</span><br><span class="line">u=rwx,g=rx,o=rx</span><br><span class="line">[root@server1 ~]# touch file1</span><br><span class="line">[root@server1 ~]# mkdir dir1</span><br><span class="line">[root@server1 ~]# ll -d dir1/ file1</span><br><span class="line">drwxr-xr-x. 2 root root 6 9月  9 09:29 dir1/</span><br><span class="line">-rw-r--r--. 1 root root 0 9月  9 09:29 file1</span><br></pre></td></tr></table></figure><p>实例2：修改shell umask值(临时)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# umask 0000</span><br><span class="line">[root@server1 ~]# mkdir dir2</span><br><span class="line">[root@server1 ~]# touch file2</span><br><span class="line">[root@server1 ~]# ll -d file2 dir2</span><br><span class="line">drwxrwxrwx. 2 root root 6 9月  9 09:31 dir2</span><br><span class="line">-rw-rw-rw-. 1 root root 0 9月  9 09:31 file2</span><br></pre></td></tr></table></figure><p>示例3:修改shell umask值(永久 建议别改)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# vim /etc/profile</span><br><span class="line">--------------</span><br><span class="line">59 if [ $UID -gt 199 ] &amp;&amp; [ &quot;`/usr/bin/id -gn`&quot; = &quot;`/usr/bin/id -un`&quot; ];</span><br><span class="line">then</span><br><span class="line">60   umask 002</span><br><span class="line">61 else</span><br><span class="line">62   umask 022</span><br><span class="line">63 fi</span><br><span class="line">---------------</span><br><span class="line">[root@server1 ~]# source /etc/profile # 立即在当前shell中生效</span><br></pre></td></tr></table></figure><p>示例4:通过umask决定新建用户 HOME 目录的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# vim /etc/login.defs</span><br><span class="line">-----------------</span><br><span class="line">61 # The permission mask is initialized to this value. If not specified,</span><br><span class="line">62 # the permission mask will be initialized to 022.</span><br><span class="line">63 UMASK      077</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux文件权限管理</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>用户管理</title>
    <link href="http://example.com/2023/12/25/11.%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2023/12/25/11.%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</id>
    <published>2023-12-25T01:25:00.000Z</published>
    <updated>2023-12-25T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="用户分类"><a href="#用户分类" class="headerlink" title="用户分类"></a>用户分类</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户UID                              含义</span><br><span class="line">  0                              超级用户管理员</span><br><span class="line">1-200                  系统用户，用来运行系统自带的进程，默认已创建</span><br><span class="line">201-1000           系统用户，用来运行用户安装的程序，所以此类用户无需登录系统</span><br><span class="line">1000+              普通用户，正常可以登陆系统的用户权限比较小能执行的任务有限</span><br></pre></td></tr></table></figure><h3 id="添加用户：useradd"><a href="#添加用户：useradd" class="headerlink" title="添加用户：useradd"></a>添加用户：useradd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">useradd 选项 用户名</span><br><span class="line">-u 用户号：指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。</span><br><span class="line">-g：表示指定用户的用户主组，选项的值可以是用户组的id，也可以是组名</span><br><span class="line">-G：表示指定用户的用户附加组，选项的值可以是用户组的id，也可以是组名</span><br><span class="line">-d 目录：指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。</span><br><span class="line">-m：创建用户的主目录</span><br><span class="line">-c ：注释与说明</span><br><span class="line">-s Shell文件：指定用户的登录Shell。</span><br></pre></td></tr></table></figure><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.创建指定用户组的用户</span></span><br><span class="line">[root@server1 ~]# useradd -g test user1</span><br><span class="line">[root@server1 ~]# find / -name user1 -ls</span><br><span class="line">17275456    0 drwx------   2 user1    test           62 1月  5 20:27 /home/user1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.为新添加的用户指定home目录</span></span><br><span class="line">[root@server1 ~]# useradd -d /home/test user3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3.创建一个不给登录的用户</span></span><br><span class="line">[root@server1 ~]# useradd -s /sbin/nologin user4</span><br></pre></td></tr></table></figure><h3 id="修改用户：usermod"><a href="#修改用户：usermod" class="headerlink" title="修改用户：usermod"></a>修改用户：usermod</h3><p>usermod命令用于修改用户的基本信息。但是不允许修改正在线上的使用者帐号名称。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">usermod(选项)(登录名称)</span><br><span class="line">-c&lt;备注&gt;：修改用户帐号的备注文字;</span><br><span class="line">-d&lt;登入目录&gt;：修改用户登入时的目录；</span><br><span class="line">-e&lt;有效期限&gt;：修改帐号的有效期限；</span><br><span class="line">-f&lt;缓冲天数&gt;： 修改在密码过期后多少天即关闭该帐号；</span><br><span class="line">-g&lt;群组&gt;：修改用户所属的群组；</span><br><span class="line">-G&lt;群组&gt;：修改用户所属的附加群组；</span><br><span class="line">-l&lt;帐号名称&gt;： 修改用户帐号名称；</span><br><span class="line">-L： 锁定用户密码，使密码无效；</span><br><span class="line">-s&lt;shell&gt;：修改用户登入后所使用的shell；</span><br><span class="line">-u&lt;uid&gt;：修改用户ID；</span><br><span class="line">-U: 解除密码锁定。</span><br><span class="line">-a：追加，默认的修改是覆盖</span><br></pre></td></tr></table></figure><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改newuser的用户名为newuser1</span></span><br><span class="line">usermod -l newuser1 newuser</span><br><span class="line">------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把<span class="built_in">test</span>用户加入usertest组</span></span><br><span class="line">usermod -aG usertest test</span><br><span class="line">------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">改变用户的uid</span></span><br><span class="line">usermod -u 6666 user02</span><br></pre></td></tr></table></figure><h3 id="删除用户：userdel"><a href="#删除用户：userdel" class="headerlink" title="删除用户：userdel"></a>删除用户：userdel</h3><p>删除用户，不加参数，不删除用户相关文件，俗称没删干净，后续可能会出现问题。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userdel [-r][用户帐号] </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">加r连着文件夹一起删除</span></span><br></pre></td></tr></table></figure><h3 id="passwd文件中的shell"><a href="#passwd文件中的shell" class="headerlink" title="passwd文件中的shell"></a>passwd文件中的shell</h3><p>&#x2F;etc&#x2F;passwd 文件会发现在每行的最后是登录成功之后执行的命令，大家可以把这个字段理解为登陆以后拥有的权限。如果这里使用的是 bash 命令解释器，就代表这个用户拥有权限范围内的所有权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> [root@server1 ~]# vim /etc/passwd  </span><br><span class="line">lamp:x:502:502::/home/lamp:/bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加了 lamp 用户，它使用的是 bash 命令解释器，那么这个用户就可以使用普通用户的所有权限。</span></span><br><span class="line">---------------------------------------------------------</span><br><span class="line">[root@server1 ~]# vi /etc/passwd  </span><br><span class="line">lamp:x:502:502::/home/lamp:/sbin/nologin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改为 /sbin/nologin，那么，这个用户就不能登录</span></span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[root@server1 ~]#vi /etc/passwd  </span><br><span class="line">lamp:x:502:502::/home/lamp:/usr/bin/passwd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用户可以登录，但登录之后就只能修改自己的密码，不能有其他操作</span></span><br></pre></td></tr></table></figure><h2 id="用户密码管理"><a href="#用户密码管理" class="headerlink" title="用户密码管理"></a>用户密码管理</h2><h3 id="passwd命令"><a href="#passwd命令" class="headerlink" title="passwd命令"></a>passwd命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">passwd [选项...] &lt;帐号名称&gt; </span><br><span class="line">-k：保持身份验证令牌不过期</span><br><span class="line">-d：删除已命名帐号的密码(只有根用户才能进行此操作)</span><br><span class="line">-l：锁定指名帐户的密码(仅限 root 用户)</span><br><span class="line">-u：解锁指名账户的密码(仅限 root 用户)</span><br><span class="line">-x：密码的最长有效时限(只有根用户才能进行此操作)</span><br><span class="line">-n：密码的最短有效时限(只有根用户才能进行此操作)</span><br><span class="line">-w：在密码过期前多少天开始提醒用户(只有根用户才能进行此操作)</span><br><span class="line">-i：当密码过期后经过多少天该帐号会被禁用(只有根用户才能进行此操作)</span><br><span class="line">-S：报告已命名帐号的密码状态(只有根用户才能进行此操作)</span><br><span class="line">--stdin：从标准输入读取令牌(只有根用户才能进行此操作，批量可用)</span><br></pre></td></tr></table></figure><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改<span class="built_in">test</span>用户密码</span></span><br><span class="line">[root@server1 ~]# passwd test</span><br><span class="line">更改用户test的密码 。</span><br><span class="line">新的 密码：</span><br><span class="line">重新输入新的 密码：</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用管道符设置用户密码(批量)</span></span><br><span class="line">[root@server1 ~]# echo 123456 | passwd --stdin test</span><br><span class="line">更改用户 test的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br></pre></td></tr></table></figure><h3 id="login-defs文件"><a href="#login-defs文件" class="headerlink" title="login.defs文件"></a>login.defs文件</h3><p>&#x2F;etc&#x2F;login.defs 文件用于在创建用户时，对用户的一些基本属性做默认设置，例如指定用户 UID 和 GID 的范围，用户的过期时间，密码的最大长度等。需要注意的是，该文件的用户默认配置对 root 用户无效。并且，当此文件中的配置与 &#x2F;etc&#x2F;passwd 和 &#x2F;etc&#x2F;shadow 文件中的用户信息有冲突时，系统会以&#x2F;etc&#x2F;passwd 和 &#x2F;etc&#x2F;shadow 为准。</p><h3 id="chage命令"><a href="#chage命令" class="headerlink" title="chage命令"></a>chage命令</h3><p>作用：chage用于密码的实效管理，用来修改帐号和密码的有效期。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chage [选项] 登录</span><br><span class="line">-l：列出用户的以及密码的有效期限</span><br><span class="line">-m:修改密码的最小天数</span><br><span class="line">-M：修改密码的最大天数</span><br><span class="line">-I：密码过期后，锁定帐号的天数</span><br><span class="line">-d：指定密码最后修改的日期</span><br><span class="line">-E：有效期，0表示立即过期，-1表示永不过期</span><br><span class="line">-W：密码过期前，开始警告天数</span><br></pre></td></tr></table></figure><h4 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.强制用户在下次登录的时候换密码</span></span><br><span class="line">[root@server1 ~]# chage -d 0 test1</span><br><span class="line">---------------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.创建用于切换的用户</span></span><br><span class="line">[root@server1 ~]# useradd test2</span><br><span class="line">[root@server1 ~]# passwd test2</span><br><span class="line">更改用户 test2 的密码 。</span><br><span class="line">新的 密码：</span><br><span class="line">重新输入新的 密码：</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置密码过期时间为立即过期（0）:</span></span><br><span class="line">[root@server1 ~]# chage -E 0 test1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试过程：</span></span><br><span class="line">[root@server1 ~]# su - test2</span><br><span class="line">[test2@server1 ~]$ pwd</span><br><span class="line">/home/test2</span><br><span class="line">[test2@server1 ~]$ su - test1</span><br><span class="line">密码：</span><br><span class="line">您的帐户已失效；请与系统管理员取得联系</span><br><span class="line">su: 用户帐户已失效</span><br></pre></td></tr></table></figure><h2 id="用户提权"><a href="#用户提权" class="headerlink" title="用户提权"></a>用户提权</h2><h3 id="sudoers文件"><a href="#sudoers文件" class="headerlink" title="sudoers文件"></a>sudoers文件</h3><p>&#x2F;etc&#x2F;sudoers是sudo的配置文件，可配置某个普通用户可以使用的sudo命令，这样普通用户不需要知道root的密码也可以使用部分root权限，提高了系统安全性。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下配置文件最后</span></span><br><span class="line">root ALL=(ALL:ALL) ALL</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">wheel ALL=(ALL) ALL</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">sudo ALL=(ALL:ALL) ALL</span></span><br><span class="line"></span><br><span class="line">编辑公式：</span><br><span class="line">授权用户/组 主机 =[(切换到哪些用户或组)] [是否需要输入密码验证] 命令1,命令2,...</span><br><span class="line">字段1 字段2 =[(字段3)] [字段4] 字段5</span><br><span class="line">字段3、字段4，是可以省略的。</span><br></pre></td></tr></table></figure><h4 id="字段详解"><a href="#字段详解" class="headerlink" title="字段详解"></a>字段详解</h4><ul><li>“字段1”不以%号开头的表示”将要授权的用户”, 比如例子中的root；以%号开头的表示”将要授权的组”, 比如例子中的%wheel组和 %sudo组。</li><li>“字段2”表示允许登录的主机, ALL表示所有; 如果该字段不为ALL,表示授权用户只能在某些机器上登录本服务器来执行sudo命令。如：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user1 mycomputer=/usr/sbin/reboot,/usr/sbin/shutdown</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">表示: 普通用户user1在主机(或主机组)mycomputer上, 可以通过sudo执行reboot和shutdown两个命令。<span class="string">&quot;字段3&quot;</span>和<span class="string">&quot;字段4&quot;</span>省略。</span></span><br></pre></td></tr></table></figure></li><li>“字段3”如果省略, 相当于(root:root)，表示可以通过sudo提权到root; 如果为(ALL)或者(ALL:ALL), 表示能够提权到(任意用户:任意用户组)。请注意，”字段3”如果没省略,必须使用( )双括号包含起来。这样才能区分是省略了”字段3”还是省略了”字段4”。</li><li>“字段4”的可能取值是NOPASSWD:。请注意NOPASSWD后面带有冒号:。表示执行sudo时可以不需要输入密码。比如:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user1 ALL=(ALL) NOPASSWD: /bin/useradd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">表示: 普通用户user1可以在任何主机上, 通过sudo执行/bin/useradd命令, 并且不需要输入密码</span></span><br><span class="line">---------------------------------------</span><br><span class="line">user1 ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">表示: 普通用户user1可以在任何主机上, 通过sudo执行任何命令, 并且不需要输入密码</span></span><br><span class="line">---------------------------------------</span><br><span class="line">touhid ALL = (root) NOPASSWD: /usr/bin/find</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用户可以从任何终端运行，以root用户身份运行命令find 而无需密码</span></span><br></pre></td></tr></table></figure></li><li>“字段5”是使用逗号分开一系列命令,这些命令就是授权给用户的操作; ALL表示允许所有操作。</li></ul><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>命令都是要使用绝对路径, 这是为了避免目录下有用户自己创建的同名命令被执行。</p><h4 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h4><p>一般可以通过visudo命令来修改该文件，通过visudo修改，如果配置出错，会有提示，可以减少风险。一般不要直接修改源文件，而是将修改写在&#x2F;etc&#x2F;sudoers.d&#x2F;目录下的文件中。这样的话，要在最后一行加上#includedir &#x2F;etc&#x2F;sudoers.d。一般默认会有。<br>TIP：#在这一行里不是表示注释，不能删除。也不能在#号后有空格。</p><h3 id="sudo命令"><a href="#sudo命令" class="headerlink" title="sudo命令"></a>sudo命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-u username：以指定用户的身份执行命令，而不是默认的root用户。</span><br><span class="line">-i：以登录shell的方式执行命令，即为用户启动一个新的shell，并加载该用户的配置文件。</span><br><span class="line">-v：更新用户的sudo时间戳，而无需执行任何命令。这通常用于延长sudo会话的过期时间。</span><br><span class="line">-l：列出用户可以在sudo时执行的命令及其对应的权限。</span><br></pre></td></tr></table></figure><blockquote><ol><li>当用户执行sudo时，系统会主动寻找 &#x2F;etc&#x2F;sudoers 文件，判断该用户是否有执行sudo的权限</li><li>确认用户具有可执行sudo的权限后，让用户输入用户自己的密码确认</li><li>若密码输入成功，则开始执行sudo后续的命令</li></ol></blockquote><h4 id="赋予用户sudo权限"><a href="#赋予用户sudo权限" class="headerlink" title="赋予用户sudo权限"></a>赋予用户sudo权限</h4><p>用useradd添加的用户没有提权权限。以root用户身份执行如下命令, 将用户加入wheel&#x2F;admin&#x2F;sudo组。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usermod -a -G wheel &lt;用户名&gt; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">提示没有对应组就创建groupadd</span></span><br></pre></td></tr></table></figure><h4 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将用户追加到wheel组</span></span><br><span class="line">[root@server1 ~]# usermod -a -G wheel user</span><br><span class="line">[root@server1 ~]# su - user</span><br><span class="line">[user@server1 ~]$ cat /etc/shadow</span><br><span class="line">cat: /etc/shadow: 权限不够</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">提权</span></span><br><span class="line">[user@server1 ~]$ sudo -u root cat /etc/shadow</span><br><span class="line">[sudo] user 的密码：</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可精简为</span></span><br><span class="line">[user@server1 ~]$ sudo cat /etc/shadow</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sudo -u root用的比较多，可以被精简为sudo</span></span><br></pre></td></tr></table></figure><h3 id="sudo时间戳"><a href="#sudo时间戳" class="headerlink" title="sudo时间戳"></a>sudo时间戳</h3><p>sudo命令在执行时会检查用户最近一次使用sudo的时间戳。如果时间戳过期（默认时间为5分钟），则需要用户重新输入密码。这个时间戳保存在<code>/var/db/sudo</code>目录下，文件名以用户名为基础。</p><p>可以通过修改sudo配置文件中的<code>timestamp_timeout</code>选项来调整时间戳的过期时间。例如，将<code>timestamp_timeout</code>设置为0可以禁用时间戳功能，每次执行sudo命令时都需要输入密码。</p><h3 id="sudo日志记录"><a href="#sudo日志记录" class="headerlink" title="sudo日志记录"></a>sudo日志记录</h3><p>sudo命令的执行记录会保存在系统日志中，通常可以通过查看<code>/var/log/secure</code>或<code>/var/log/auth.log</code>文件来检索这些记录。</p>]]></content>
    
    
    <summary type="html">Linux用户管理</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>用户组管理</title>
    <link href="http://example.com/2023/12/24/10.%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2023/12/24/10.%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/</id>
    <published>2023-12-24T01:25:00.000Z</published>
    <updated>2023-12-24T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="用户-组基本概念"><a href="#用户-组基本概念" class="headerlink" title="用户&#x2F;组基本概念"></a>用户&#x2F;组基本概念</h2><h4 id="用户和组"><a href="#用户和组" class="headerlink" title="用户和组"></a>用户和组</h4><ul><li>系统上的每个进程(运行的程序)都是作为特定用户运行</li><li>每个文件是由一个特定的用户拥有</li><li>访问文件和目录受到用户的限制</li><li>与正在运行的进程相关联的用户确定该进程可访问的文件和目录</li></ul><h4 id="查看当前的登录的用户信息-id命令"><a href="#查看当前的登录的用户信息-id命令" class="headerlink" title="查看当前的登录的用户信息  id命令"></a>查看当前的登录的用户信息  id命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# id   //有其他用户时可以用id  xxx来查看其信息</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure><h4 id="查看文件的拥有者-ls命令"><a href="#查看文件的拥有者-ls命令" class="headerlink" title="查看文件的拥有者  ls命令"></a>查看文件的拥有者  ls命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ll anaconda-ks.cfg</span><br><span class="line">-rw-------. 1 root root 1257 10月 29 06:08 anaconda-ks.cfg</span><br><span class="line">“rwx” 表示文件所有者的权限:r是读，w是写，x是执行</span><br><span class="line">第一个“root” 表示文件的所有者       第二个“root” 表示为文件的所在群组  </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls命令参数：ls -[alrtAFR]</span><br><span class="line">-a 显示所有文件及目录 (ls内定将文件名或目录名称开头为&quot;.&quot;的视为隐藏档，不会列出)</span><br><span class="line">-l 除文件名称外，亦将文件型态、权限、拥有者、文件大小等资讯详细列出</span><br><span class="line">-r 将文件以相反次序显示(原定依英文字母次序)</span><br><span class="line">-t 将文件依建立时间之先后次序列出</span><br><span class="line">-A 同 -a ，但不列出 &quot;.&quot; (目前目录) 及 &quot;..&quot; (父目录)</span><br><span class="line">-F 在列出的文件名称后加一符号；例如可执行档则加 &quot;*&quot;, 目录则加 &quot;/&quot;</span><br><span class="line">-R 若目录下有文件，则以下之文件亦皆依序列出</span><br></pre></td></tr></table></figure><h4 id="查看运行进程的用户名-ps命令"><a href="#查看运行进程的用户名-ps命令" class="headerlink" title="查看运行进程的用户名  ps命令"></a>查看运行进程的用户名  ps命令</h4><p>ps命令，要对进程进行监测和控制,首先必须要了解当前进程的情况,也就是需要查看当前进程, 而ps命令（Process Status）就是最基本同时也是非常强大的进程查看命令。使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵尸、哪些进程占用了过多的资源等等。总之大部分信息都是可以通过执行该命令得到的。ps提供的进程查看是一次性的，如果想要动态结果，可以使用top命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# ps aux |less      //ps aux是显示所有进程和其状态</span><br><span class="line">一般配合grep命令使用</span><br><span class="line">[root@server1 ~]#ps aux |grep httpd</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.1  0.6 128000  6548 ?        Ss   07:17   0:01 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    07:17   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        S    07:17   0:00 [ksoftirqd/0]</span><br><span class="line">root          5  0.0  0.0      0     0 ?        S&lt;   07:17   0:00 [kworker/0:0H]</span><br><span class="line">root          6  0.0  0.0      0     0 ?        S    07:17   0:00 [kworker/u256:0]</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    07:17   0:00 [migration/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    07:17   0:00 [rcu_bh]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        R    07:17   0:00 [rcu_sched]</span><br><span class="line">root         10  0.0  0.0      0     0 ?        S&lt;   07:17   0:00 [lru-add-drain]</span><br><span class="line">root         11  0.0  0.0      0     0 ?        S    07:17   0:00 [watchdog/0]</span><br><span class="line">root         13  0.0  0.0      0     0 ?        S    07:17   0:00 [kdevtmpfs]</span><br><span class="line">root         14  0.0  0.0      0     0 ?        S&lt;   07:17   0:00 [netns]</span><br></pre></td></tr></table></figure><p>ps aux输出格式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br></pre></td></tr></table></figure><p>格式说明：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">USER: 行程拥有者</span><br><span class="line">PID: pid</span><br><span class="line">%CPU: 占用的 CPU 使用率</span><br><span class="line">%MEM: 占用的记忆体使用率</span><br><span class="line">VSZ: 占用的虚拟记忆体大小</span><br><span class="line">RSS: 占用的记忆体大小</span><br><span class="line">TTY: 终端的次要装置号码 (minor device number of tty)</span><br><span class="line">STAT: 该行程的状态，linux的进程有5种状态：</span><br><span class="line">D 不可中断 uninterruptible sleep (usually IO)</span><br><span class="line">R 运行 runnable (on run queue)</span><br><span class="line">S 中断 sleeping</span><br><span class="line">T 停止 traced or stopped</span><br><span class="line">Z 僵死 a defunct (”zombie”) process</span><br><span class="line">注: 其它状态还包括W(无驻留页), &lt;(高优先级进程), N(低优先级进程), L(内存锁页).</span><br><span class="line">START: 行程开始时间</span><br><span class="line">TIME: 执行的时间</span><br><span class="line">COMMAND:所执行的指令</span><br></pre></td></tr></table></figure><h4 id="和用户组相关的一些文件"><a href="#和用户组相关的一些文件" class="headerlink" title="和用户组相关的一些文件"></a>和用户组相关的一些文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash # 用户信息</span><br><span class="line">用户名:x:uid:gid:描述:HOME:shell # x密码占位符</span><br><span class="line"></span><br><span class="line">/etc/shadow</span><br><span class="line">root:$6$j3YZCHCXpIiDho7x$v4/j6b0zGgyTcfP6jOa1ZY.q.sHvqQp/nsmEowjrtmo/iFKdo4X</span><br><span class="line">piWZm5OpDKqhZEw8OSXTpdAM2JyIgBI.Mz0::0:99999:7:::</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="built_in">id</span>$salt<span class="variable">$encrypted</span> <span class="comment"># 密码信息，用户的密码和有效期都在这个文件中</span></span></span><br><span class="line"></span><br><span class="line">/etc/group </span><br><span class="line">root:x:0: # 组的信息</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">格式是  组名:口令:组标识号:组内用户列表</span></span><br></pre></td></tr></table></figure><h4 id="系统约定"><a href="#系统约定" class="headerlink" title="系统约定"></a>系统约定</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uid:0 特权用户</span><br><span class="line">uid:1~999 系统用户</span><br><span class="line">uid:1000+ 普通用户</span><br></pre></td></tr></table></figure><h4 id="root用户的权力"><a href="#root用户的权力" class="headerlink" title="root用户的权力"></a>root用户的权力</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uid是0</span><br><span class="line">所有权力</span><br><span class="line">该用户有权力覆盖文件系统上的普通权限</span><br><span class="line">安装或删除软件并管理系统文件和目录</span><br><span class="line">大多数设备只能由root控制</span><br></pre></td></tr></table></figure><h2 id="用户组管理"><a href="#用户组管理" class="headerlink" title="用户组管理"></a>用户组管理</h2><h3 id="添加用户组：groupadd"><a href="#添加用户组：groupadd" class="headerlink" title="添加用户组：groupadd"></a>添加用户组：groupadd</h3><p>用于将新组加入系统。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupadd [选项] 组 </span><br><span class="line">-g &lt;gid&gt;：指定组ID号。  </span><br><span class="line">-o：允许组ID号，不必惟一。  </span><br><span class="line">-r：加入组ID号，系统组id号必须低于500  </span><br><span class="line">-f：加入已经有的组时，程序退出。</span><br><span class="line">-K：覆盖配置文件 /etc/login.defs</span><br></pre></td></tr></table></figure><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# groupadd hr -g 1000</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下是否添加成功</span></span><br><span class="line">[root@server1 ~]# tail -n 1 /etc/group</span><br><span class="line">hr:x:1000:</span><br></pre></td></tr></table></figure><h3 id="修改用户组：groupmod"><a href="#修改用户组：groupmod" class="headerlink" title="修改用户组：groupmod"></a>修改用户组：groupmod</h3><p>用于更改群组识别码或名称</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupmod [选项] 组 </span><br><span class="line">-g：将组 ID 改为 GID</span><br><span class="line">-n：改名为 NEW_GROUP</span><br><span class="line">-o：允许使用重复的 GID</span><br></pre></td></tr></table></figure><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改hr为hr1</span></span><br><span class="line">[root@server1 ~]# groupmod -n hr1 hr</span><br><span class="line">[root@server1 ~]# tail -n 1 /etc/group</span><br><span class="line">hr1:x:1000:</span><br></pre></td></tr></table></figure><h3 id="删除用户组：groupdel"><a href="#删除用户组：groupdel" class="headerlink" title="删除用户组：groupdel"></a>删除用户组：groupdel</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# groupdel hr1</span><br></pre></td></tr></table></figure><h3 id="用户组成员管理：gpasswd"><a href="#用户组成员管理：gpasswd" class="headerlink" title="用户组成员管理：gpasswd"></a>用户组成员管理：gpasswd</h3><p>该命令用于将用户添加到组里或者从组里删除‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> 用法：gpasswd[-a user][-d user][-A user,...][-M user,...][-r][-R]groupname</span><br><span class="line"> 参数：</span><br><span class="line">-a：添加用户到组</span><br><span class="line">-d：从组删除用户</span><br><span class="line">-A：指定管理员</span><br><span class="line">-M：指定组成员和-A的用途差不多</span><br><span class="line">-r：删除密码</span><br><span class="line">-R：限制用户登入组，只有组中的成员才可以用newgrp加入该组 </span><br></pre></td></tr></table></figure><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# useradd user1</span><br><span class="line">[root@server1 ~]# groupadd test</span><br><span class="line">[root@server1 ~]# gpasswd -a user1 test</span><br><span class="line">正在将用户“user1”加入到“test”组中</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux中的组管理方式</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>find命令</title>
    <link href="http://example.com/2023/12/23/9.find%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"/>
    <id>http://example.com/2023/12/23/9.find%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/</id>
    <published>2023-12-23T01:25:00.000Z</published>
    <updated>2023-12-23T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="find详解"><a href="#find详解" class="headerlink" title="find详解"></a>find详解</h2><h3 id="命令基础格式"><a href="#命令基础格式" class="headerlink" title="命令基础格式"></a>命令基础格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name <span class="string">&quot;passwd&quot;</span></span><br><span class="line">第一段find命令。第二段，要搜索的路径，可以写多个。第三段，表达式。</span><br></pre></td></tr></table></figure><h3 id="查找条件"><a href="#查找条件" class="headerlink" title="查找条件"></a>查找条件</h3><h4 id="条件组合"><a href="#条件组合" class="headerlink" title="条件组合"></a>条件组合</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-a：多个条件and并列</span><br><span class="line">-o：多个条件or并列</span><br><span class="line">-not：条件取反</span><br></pre></td></tr></table></figure><h4 id="1-按照时间查找"><a href="#1-按照时间查找" class="headerlink" title="1.按照时间查找"></a>1.按照时间查找</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-mtime n：查找文件修改时间，单位是天，就是n*24小时</span></span><br><span class="line">[root@server1 ~]<span class="comment"># find / -mtime 7 -ls</span></span><br><span class="line"></span><br><span class="line">**总结：数字n的写法有三种**</span><br><span class="line">+n：表示大于n。</span><br><span class="line">-n：表示小于n。</span><br><span class="line">n：表示等于n。</span><br></pre></td></tr></table></figure><h4 id="2-根据文件名查找"><a href="#2-根据文件名查找" class="headerlink" title="2.根据文件名查找"></a>2.根据文件名查找</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># find / -name 1.txt</span></span><br><span class="line">/root/test/1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#加i可以忽略大小写</span></span><br><span class="line">[root@server1 ~]<span class="comment"># find /etc -iname &quot;ifcfg-ens33&quot;</span></span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line"></span><br><span class="line"><span class="comment">#记不得名字也可以用通配符模糊匹配</span></span><br><span class="line">[root@server1 ~]<span class="comment"># find /etc -iname &quot;ifcfg-ens*&quot;</span></span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure><h4 id="3-按文件大小查找"><a href="#3-按文件大小查找" class="headerlink" title="3.按文件大小查找"></a>3.按文件大小查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查找大小大于5M的普通文件</span></span><br><span class="line">[root@server1 ~]# find /etc/ -type f -size +5M -ls</span><br><span class="line">17274742 7760 -r--r--r--   1 root     root      7942570 1月  1 19:42 /etc/udev/hwdb.bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">等于5M</span></span><br><span class="line">[root@server1 ~]# find /etc/ -type f -size 5M -ls </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">小于5M</span></span><br><span class="line">[root@server1 ~]# find /etc/ -type f -size -5M -ls</span><br></pre></td></tr></table></figure><h4 id="4-按文件类型查找"><a href="#4-按文件类型查找" class="headerlink" title="4.按文件类型查找"></a>4.按文件类型查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# find /etc -type d</span><br><span class="line">/etc</span><br><span class="line">/etc/grub.d</span><br><span class="line">/etc/terminfo</span><br><span class="line">/etc/skel</span><br><span class="line">/etc/alternatives</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更多类型上面已经总结p,b,c,s等</span></span><br></pre></td></tr></table></figure><h4 id="5-按文件权限查找"><a href="#5-按文件权限查找" class="headerlink" title="5.按文件权限查找"></a>5.按文件权限查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">r 读权限   4</span><br><span class="line">w 写权限   2</span><br><span class="line">x 执行权限 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查找根目录下权限为444的文件（r--r--r--）</span></span><br><span class="line">[root@server1 ~]# find / -perm 444</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查找权限至少为444的文件</span></span><br><span class="line">[root@server1 ~]# find / -perm -444</span><br></pre></td></tr></table></figure><p><strong>重要TIP：-444表示至少为444（大于等于），不是小于</strong></p><h4 id="6-按查找的目录深度"><a href="#6-按查找的目录深度" class="headerlink" title="6.按查找的目录深度"></a>6.按查找的目录深度</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># find / -maxdepth 3 -a -name &quot;ifcfg-ens33&quot;  #最大深度为3</span></span><br><span class="line">[root@server1 ~]<span class="comment"># find / -mindepth 3 -a -name &quot;ifcfg-ens33&quot;  #最小深度为3</span></span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure><h4 id="7-按文件属主、属组"><a href="#7-按文件属主、属组" class="headerlink" title="7.按文件属主、属组"></a>7.按文件属主、属组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find /home -user root -a -group root  #属主和属组都是root的</span><br><span class="line">find /home -user root -o -group root  #属主或属组是root的</span><br><span class="line">find /home -nouser -a -nogroup   #没有属主和属组</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="8-按正则表达式"><a href="#8-按正则表达式" class="headerlink" title="8.按正则表达式"></a>8.按正则表达式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /etc -regex &#x27;.*ifcfg-ens[0-9][0-9]&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.*  任意多个字符</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">[0-9]  任意一个数字</span></span><br></pre></td></tr></table></figure><h3 id="查后处理动作"><a href="#查后处理动作" class="headerlink" title="查后处理动作"></a>查后处理动作</h3><p>‐ls：类型于对查找到的文件执行 ls -l 命令<br>‐delete：删除查找到的文件<br>‐fls &#x2F;path&#x2F;to&#x2F;somefile：查找到的所有文件的长格式信息保存至指定文件中<br><strong>下面两个重要的常用的：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">‐ok COMMAND &#123;&#125; \;：对查找到的每个文件执行由COMMAND指定的命令，需要确认</span><br><span class="line"></span><br><span class="line">‐exec COMMAND &#123;&#125; \;：对查找到的每个文件执行由COMMAND指定的命令，不需要确认</span><br><span class="line">find /etc -type f -name &quot;*.c&quot; -exec cat &#123;&#125; \; &gt; file.txt  #将所有c程序拼接起来写入单个文件file.txt中</span><br><span class="line"></span><br><span class="line">注：&#123;&#125;表示匹配到的文件。</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><blockquote><p>1.查找&#x2F;var目录下属主为root，且属组为mail的所有文件或目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var -user root -a -group mail</span><br></pre></td></tr></table></figure><blockquote><p>2.查找&#x2F;usr目录下不属于root，bin或Hadoop的所有文件或目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /user -not -user root -a -not -user bin -o -not user Hadoop</span><br></pre></td></tr></table></figure><blockquote><p>3.查找&#x2F;etc目录下最近一周内容曾被修改过的文件或目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mtime -7</span><br></pre></td></tr></table></figure><blockquote><p>4.查找当前系统上没有属主或属组，且最近一周内曾被访问过的文件或目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -nouser -o -nogroup -a -atime -7</span><br></pre></td></tr></table></figure><blockquote><p>5.查找&#x2F;etc目录下大于1M且类型为普通文件的所有文件或目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -size +1M -a -type f</span><br></pre></td></tr></table></figure><blockquote><p>6.查找&#x2F;etc目录下所有用户都没有写权限的文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -not -perm /222  #严格匹配权限222</span><br></pre></td></tr></table></figure><blockquote><p>7.查找&#x2F;etc目录下至少一类用户没有执行权限的文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -not -perm -111</span><br></pre></td></tr></table></figure><blockquote><p>8.查找&#x2F;etc&#x2F;init.d目录下，所有用户都执行权限，且其它用户有写权限的文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc/init.d  -perm -111 -a -perm -003 -ls</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux中find命令的应用详解</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>文件类型/时间与locate查找</title>
    <link href="http://example.com/2023/12/22/8.%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E4%B8%8Elocate%E6%9F%A5%E6%89%BE/"/>
    <id>http://example.com/2023/12/22/8.%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E4%B8%8Elocate%E6%9F%A5%E6%89%BE/</id>
    <published>2023-12-22T01:25:00.000Z</published>
    <updated>2023-12-22T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="文件时间"><a href="#文件时间" class="headerlink" title="文件时间"></a>文件时间</h2><h3 id="stat命令与三个时间"><a href="#stat命令与三个时间" class="headerlink" title="stat命令与三个时间"></a>stat命令与三个时间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# stat 1.txt</span><br><span class="line">  File: ‘1.txt’</span><br><span class="line">  Size: 236       Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: fd00h/64768dInode: 33590009    Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Context: unconfined_u:object_r:admin_home_t:s0</span><br><span class="line">Access: 2023-01-04 14:26:09.988384770 +0800</span><br><span class="line">Modify: 2023-01-04 14:26:09.988384770 +0800</span><br><span class="line">Change: 2023-01-04 14:26:09.989384782 +0800</span><br></pre></td></tr></table></figure><h4 id="atime访问时间"><a href="#atime访问时间" class="headerlink" title="atime访问时间"></a>atime访问时间</h4><blockquote><p>Access Time的简写，当文件的内容被访问时，就会更新这个时间，例如我们使用cat、more、less等<a href="https://www.linuxcool.com/">命令</a>查看文件的内容时，文件的访问时间就会被更新</p></blockquote><h4 id="mtime修改时间"><a href="#mtime修改时间" class="headerlink" title="mtime修改时间"></a>mtime修改时间</h4><blockquote><p>Modification Time的简写，它指的是当“内容数据”被修改时，系统会去更新这个时间，例如：我们用echo,vim等指令向文件写数据</p></blockquote><h4 id="ctime状态时间"><a href="#ctime状态时间" class="headerlink" title="ctime状态时间"></a>ctime状态时间</h4><blockquote><p>status time，即状态时间，当文件的状态即文件的属性被改变是就会更改这个时间，例如文件系统中的links(链接数)，size(文件的大小)、文件的权限、blocks(文件的block数)；当这些参数被改变时，Linux就会更改该文件所对应的这个时间参数。</p></blockquote><p><strong>Tips：文件的mtime被修改，该文件的ctime也会被改变。</strong></p><h2 id="文件类型查看"><a href="#文件类型查看" class="headerlink" title="文件类型查看"></a>文件类型查看</h2><h3 id="方法一-ls-l"><a href="#方法一-ls-l" class="headerlink" title="方法一 ls -l"></a>方法一 ls -l</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# ll</span><br><span class="line">总用量 4</span><br><span class="line">-rw-r--r--. 1 root root 236 1月   4 14:26 1.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据最前面的字母判断是什么类型的文件</span></span><br></pre></td></tr></table></figure><h4 id="对应的文件类型"><a href="#对应的文件类型" class="headerlink" title="对应的文件类型"></a>对应的文件类型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据-rw-r--r--最前面一位判断</span></span><br><span class="line">- 普通文件(文本文档，二进制文件，压缩文件，电影，图片。。。)</span><br><span class="line">d 目录文件(蓝色)</span><br><span class="line">b 块设备文件(块设备)存储设备硬盘，U盘 /dev/sda,/dev/sda1</span><br><span class="line">c 字符设备文件(字符设备)打印机，终端 /dev/tty1,/dev/zero</span><br><span class="line">s 套接字文件</span><br><span class="line">p 管道文件</span><br><span class="line">l 链接文件(淡蓝色)</span><br></pre></td></tr></table></figure><h3 id="方法二：file命令"><a href="#方法二：file命令" class="headerlink" title="方法二：file命令"></a>方法二：file命令</h3><p><strong>file命令</strong>用来探测给定文件的类型。</p><h4 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-b只显示文件格式以及编码，不显示文件名称</span><br><span class="line">-i  输出文件的类型字符串</span><br><span class="line">-c详细显示指令执行过程，便于排错或分析程序执行的情形</span><br><span class="line">-f  &lt;名称文件&gt;指定名称文件，其内容有一个或多个文件名称时，让file依序辨识这些文件，格式为每列一个文件名称</span><br></pre></td></tr></table></figure><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# file 1.txt</span><br><span class="line">1.txt: ASCII text</span><br><span class="line">-----------------------------------------------</span><br><span class="line">[root@server1 test]# file -c 1.txt</span><br><span class="line">contoffsettypeopcodemaskvaluedesc</span><br><span class="line">-----------------------------------------------</span><br><span class="line">[root@server1 test]# file -b 1.txt</span><br><span class="line">ASCII text</span><br><span class="line">-----------------------------------------------</span><br><span class="line">[root@server1 test]# file -i 1.txt</span><br><span class="line">1.txt: text/plain; charset=us-ascii</span><br></pre></td></tr></table></figure><h2 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h2><h3 id="which命令"><a href="#which命令" class="headerlink" title="which命令"></a>which命令</h3><p>which命令是有局限性的，只会在环境变量$PATH设置的目录里查找符合条件的文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">which [文件名字]</span><br></pre></td></tr></table></figure><h4 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# which bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上面是在查找bash的所在目录</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">还可以查找<span class="built_in">ls</span>命令所在目录</span></span><br><span class="line">[root@server1 test]# which ls</span><br><span class="line">alias ls=&#x27;ls --color=auto&#x27;</span><br><span class="line">/usr/bin/ls</span><br><span class="line">结果表示，ls是系统变量中默认设置的别名，本体是ls --color=auto</span><br></pre></td></tr></table></figure><h3 id="补充知识：环境变量"><a href="#补充知识：环境变量" class="headerlink" title="补充知识：环境变量"></a>补充知识：环境变量</h3><p><strong>总结：</strong>环境变量（environment variables）一般是指在操作系统中用来指定操作系统运行环境的一些参数，如：临时文件夹位置和系统文件夹位置等。环境变量里面有很多的系统默认设置，这个变量中也有很多的目录地址，当我们执行命令的时候，操作系统就会到这些目录中查找，是否存在你所输入的命令。这样我们可以在任何目录中使用这些命令，而没有必要每次都去查找命令所在的目录。与Windows的系统环境变量原理相同，可以自定义。</p><h3 id="locate查找"><a href="#locate查找" class="headerlink" title="locate查找"></a>locate查找</h3><h4 id="locate工作原理"><a href="#locate工作原理" class="headerlink" title="locate工作原理"></a>locate工作原理</h4><blockquote><p>locate<strong>不搜索具体目录</strong>，而是搜索一个<strong>数据库文件</strong>，这个数据库中含有本地所有文件信息。Linux系统自动创建这个数据库，并且每天自动更新一次，所以使用locate命令<strong>查不到最新变动过的文件。</strong>为了避免这种情况，可以在使用locate之前，先使用updatedb命令，手动更新数据库。配置文件在&#x2F;etc&#x2F;updatedb.conf</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装命令</span></span><br><span class="line">[root@localhost ~]# yum -y install mlocate</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">locate [选择参数] [样式]</span><br></pre></td></tr></table></figure><h4 id="常用参数-1"><a href="#常用参数-1" class="headerlink" title="常用参数"></a>常用参数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-c, --count     # 只输出找到的数量      </span><br><span class="line">-n                    # 至多显示 n个输出。  </span><br><span class="line">-r, --regexp REGEXP   # 使用基本正则表达式  </span><br><span class="line">    --regex           # 使用扩展正则表达式  </span><br><span class="line">-i, --ignore-case     # 忽略大小写</span><br><span class="line">-d   #DBPATH：使用 DBPATH 指定的数据库，而不是默认数据库 /var/lib/mlocate/mlocate.db</span><br></pre></td></tr></table></figure><h4 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">没有更新数据库之前：</span></span><br><span class="line">[root@server1 ~]# locate passwd</span><br><span class="line">locate: 无法执行 stat () `/var/lib/mlocate/mlocate.db&#x27;: 没有那个文件或目录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新数据库</span></span><br><span class="line">[root@server1 ~]# updatedb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新以后</span></span><br><span class="line">[root@server1 ~]# locate passwd</span><br><span class="line">/etc/passwd</span><br><span class="line">/etc/passwd-</span><br><span class="line">/etc/pam.d/passwd</span><br></pre></td></tr></table></figure><p>查找以&#x2F;etc&#x2F;sysconfig开头的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># locate /etc/sysconfig</span></span><br></pre></td></tr></table></figure><p>查找以ens33结尾的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]<span class="comment"># locate -r ens33$</span></span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">文件时间和类型的一些命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>无网设置multipath多路径</title>
    <link href="http://example.com/2023/12/16/%E6%97%A0%E7%BD%91%E8%AE%BE%E7%BD%AEmultipath%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    <id>http://example.com/2023/12/16/%E6%97%A0%E7%BD%91%E8%AE%BE%E7%BD%AEmultipath%E5%B0%8F%E7%9F%A5%E8%AF%86/</id>
    <published>2023-12-16T01:25:00.000Z</published>
    <updated>2023-12-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="无网设置multipath小知识"><a href="#无网设置multipath小知识" class="headerlink" title="无网设置multipath小知识"></a>无网设置multipath小知识</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看一下镜像有没有连接，这里是sr0</span></span><br><span class="line">lsblk -l</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /mnt/redhat</span><br><span class="line">mount -t iso9660 /dev/sr0 /mnt/redhat</span><br><span class="line"></span><br><span class="line">vim /etc/yum.repos.d/local.repo</span><br><span class="line">[<span class="built_in">local</span>]</span><br><span class="line">name=Local Repository </span><br><span class="line">baseurl=file:///mnt/redhat</span><br><span class="line">enabled=1 </span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install device-mapper-multipath -y</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">机房服务器无网的情况下，设置多路径</summary>
    
    
    
    <category term="教程" scheme="http://example.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="http://example.com/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="运维" scheme="http://example.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>Vim编辑器</title>
    <link href="http://example.com/2023/11/20/7.vim%E7%BC%96%E8%BE%91%E5%99%A8/"/>
    <id>http://example.com/2023/11/20/7.vim%E7%BC%96%E8%BE%91%E5%99%A8/</id>
    <published>2023-11-20T01:25:00.000Z</published>
    <updated>2023-11-20T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vim编辑器"><a href="#Vim编辑器" class="headerlink" title="Vim编辑器"></a>Vim编辑器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi编辑器是所有Unix及Linux系统下标准的编辑器，他就相当于windows系统中的记事本一样，它的强大不逊色于任何最新的文本编辑器。他是我们使用Linux系统不能缺少的工具。由于对Unix及linux系统的任何版本，vi编辑器是完全相同的，学会它后，您将在Linux的世界里畅行无阻。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- vim 具有程序编辑的能力，可以以字体颜色辨别语法的正确性，方便程序设计。</span><br><span class="line">- vim可以当作vi的升级版本，他可以用多种颜色的方式来显示一些特殊的信息。</span><br><span class="line">- vim会依据文件扩展名或者是文件内的开头信息， 判断该文件的内容而自动的执行该程序的语法判断式，再以颜色来显示程序代码与一般信息。</span><br><span class="line">- vim里面加入了很多额外的功能，例如支持正则表达式的搜索、多文件编辑、块复制等等。</span><br></pre></td></tr></table></figure><h5 id="Vim的工作模式"><a href="#Vim的工作模式" class="headerlink" title="Vim的工作模式"></a>Vim的工作模式</h5><p><img data-src="https://img-130165.oss-cn-shanghai.aliyuncs.com/img/vim.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim 是模块化的编辑器</span><br><span class="line">vim 的基本模式包括：</span><br><span class="line">1、编辑模式：Nromal，默认模式，移动光标，剪切/粘贴文本</span><br><span class="line">2、输入模式：Insert，插入模式，用于修改文本</span><br><span class="line">3、末行模式：内置的命令行接口（extended command），用于保存、退出等</span><br></pre></td></tr></table></figure><h5 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# yum install vim -y</span><br></pre></td></tr></table></figure><h5 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim [options] [file ..] +</span><br><span class="line">+#：打开文件后，直接让光标处于第#行的行首</span><br><span class="line">+/PATTERN：打开文件后，直接让光标处于第一个被PATTERN匹配到的行的行首</span><br></pre></td></tr></table></figure><h5 id="模式转换"><a href="#模式转换" class="headerlink" title="模式转换"></a>模式转换</h5><p>打开文件时，默认模式是处于编辑模式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">编辑模式 --&gt; 输入模式：</span><br><span class="line">i：insert, 在光标所在处输入</span><br><span class="line">a: append，在光标在处后方输入</span><br><span class="line">o：在光标所在处的下方打开一个新行</span><br><span class="line">I：在光标所在行的行首输入</span><br><span class="line">A：在光标所在行的行尾输入</span><br><span class="line">O：在光标所在处的上方打开一个新行</span><br><span class="line">----------------------------------------------------</span><br><span class="line">输入模式 --&gt; 编辑模式</span><br><span class="line">ESC</span><br><span class="line">----------------------------------------------------</span><br><span class="line">编辑模式 --&gt; 末行模式</span><br><span class="line">:</span><br><span class="line">----------------------------------------------------</span><br><span class="line">末行模式 --&gt; 编辑模式</span><br><span class="line">ESC，Enter </span><br></pre></td></tr></table></figure><h5 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- 编辑模式:</span><br><span class="line">ZZ                        # 保存并退出</span><br><span class="line">ZQ                        # 不保存退出</span><br><span class="line">- 末行模式：</span><br><span class="line">:q                        # 退出</span><br><span class="line">:q!                       # 强制退出，不保存此前的编辑操作</span><br><span class="line">:wq                       # 保存并退出</span><br><span class="line">:w, :q                    # 保存并退出</span><br><span class="line">:x                        # 保存并退出</span><br><span class="line">:w /PATH/TO/SOMEFILE      # 保存文件至指定的路径</span><br></pre></td></tr></table></figure><h3 id="编辑模式"><a href="#编辑模式" class="headerlink" title="编辑模式"></a>编辑模式</h3><h4 id="编辑模式：光标跳转"><a href="#编辑模式：光标跳转" class="headerlink" title="编辑模式：光标跳转"></a>编辑模式：光标跳转</h4><h5 id="字符间跳转"><a href="#字符间跳转" class="headerlink" title="字符间跳转"></a>字符间跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">h                          # 左</span><br><span class="line">j                          # 下</span><br><span class="line">k                          # 上</span><br><span class="line">l                          # 右</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND                   <span class="comment"># 跳转由#指定的个数的字符</span></span></span><br><span class="line">5k                         # 向上跳转5个字符</span><br><span class="line">3l                         # 向右跳转3个字符</span><br></pre></td></tr></table></figure><h5 id="单词间跳转"><a href="#单词间跳转" class="headerlink" title="单词间跳转"></a>单词间跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">w                          # 下一个单词的词首</span><br><span class="line">e                          # 当前或后一个单词的词尾</span><br><span class="line">b                          # 当前或前一个单词的词首</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND                   <span class="comment"># 跳转由#指定的个数的单词</span></span></span><br><span class="line">3w                         # 跳转到下三个单词的词首</span><br></pre></td></tr></table></figure><h5 id="行首行尾跳转"><a href="#行首行尾跳转" class="headerlink" title="行首行尾跳转"></a>行首行尾跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^                          # 跳转至行首的第一个非空白字符</span><br><span class="line">0                          # 跳转至行首，数字0，字母O和o是由编辑模式进入到输入模式</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">                         <span class="comment"># 跳转至行尾</span></span></span><br></pre></td></tr></table></figure><h5 id="当前页跳转"><a href="#当前页跳转" class="headerlink" title="当前页跳转"></a>当前页跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">H                          # 页首</span><br><span class="line">M                          # 页中间行</span><br><span class="line">L                          # 页底</span><br><span class="line">zt                         # 将光标所在当前行移到屏幕顶端</span><br><span class="line">zz                         # 将光标所在当前行移到屏幕中间</span><br><span class="line">zb                         # 将光标所在当前行移到屏幕底端</span><br></pre></td></tr></table></figure><h5 id="行间跳转"><a href="#行间跳转" class="headerlink" title="行间跳转"></a>行间跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">G                         <span class="comment"># 跳转至由#指定的行</span></span></span><br><span class="line">1G, gg                     # 第一行</span><br><span class="line">G                          # 最后一行</span><br><span class="line">5G                         # 跳转至第5行</span><br></pre></td></tr></table></figure><h5 id="句间跳转"><a href="#句间跳转" class="headerlink" title="句间跳转"></a>句间跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">)                          # 下一句</span><br><span class="line">(                          # 上一句</span><br></pre></td></tr></table></figure><h5 id="段间跳转"><a href="#段间跳转" class="headerlink" title="段间跳转"></a>段间跳转</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#125;                          # 下一段</span><br><span class="line">&#123;                          # 上一段</span><br></pre></td></tr></table></figure><h4 id="编辑模式：翻屏"><a href="#编辑模式：翻屏" class="headerlink" title="编辑模式：翻屏"></a>编辑模式：翻屏</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+f                     # 向文件尾翻一屏</span><br><span class="line">Ctrl+b                     # 向文件首部翻一屏</span><br><span class="line">Ctrl+d                     # 向文件尾部翻半屏</span><br><span class="line">Ctrl+u                     # 向文件首部翻半屏</span><br><span class="line">Enter                      # 按行向后翻</span><br></pre></td></tr></table></figure><h4 id="编辑模式：编辑命令"><a href="#编辑模式：编辑命令" class="headerlink" title="编辑模式：编辑命令"></a>编辑模式：编辑命令</h4><h5 id="字符编辑"><a href="#字符编辑" class="headerlink" title="字符编辑"></a>字符编辑</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x                          # 删除光标所在处的字符</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">x                         <span class="comment"># 删除光标所在处起始的#个字符</span></span></span><br><span class="line">xp                         # 交换光标所在处的字符与其后面的字符的位置</span><br><span class="line">~                          # 转换大小写</span><br><span class="line">J                          # 删除当前行后的换行符</span><br></pre></td></tr></table></figure><h5 id="替换命令"><a href="#替换命令" class="headerlink" title="替换命令"></a>替换命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r                          # 替换光标所在处的字符</span><br><span class="line">R                          # 切换成 REPLACE 模式，可以输入任意字符进行更换</span><br></pre></td></tr></table></figure><h5 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">d                          # 删除命令，可结合光标跳转字符，实现范围删除</span><br><span class="line"><span class="meta prompt_">d$ </span><span class="language-bash">                        <span class="comment"># 删除到行尾</span></span></span><br><span class="line">d^                         # 删除到非空行首 </span><br><span class="line">d0                         # 删除到行首</span><br><span class="line">dw                         # 删除光标所在处的单词或符号</span><br><span class="line">d3w                        # 删除光标所在处的三个单词</span><br><span class="line">de                         # 删除当前或下一个单词</span><br><span class="line">db                         # 删除当前或前一个单词</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND                   <span class="comment"># 支持使用数字</span></span></span><br><span class="line">dd                         # 删除光标所在处的行</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">dd</span>                        <span class="comment"># 删除光标所处的行起始的共#行</span></span></span><br><span class="line">3dd                        # 删除光标所处的行起始的3行</span><br></pre></td></tr></table></figure><h5 id="粘贴命令"><a href="#粘贴命令" class="headerlink" title="粘贴命令"></a>粘贴命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p                         # 缓冲区中的内容如果为整行，则粘贴在当前光标所在行的下方。否则，则粘贴至当前光标所在处的后方</span><br><span class="line">P                         # 缓冲区中的内容如果为整行，则粘贴在当前光标所在行的上方。否则，则粘贴至当前光标所在处的前方</span><br></pre></td></tr></table></figure><h5 id="复制命令"><a href="#复制命令" class="headerlink" title="复制命令"></a>复制命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">y                          # 复制，工作行为相似于d命令</span><br><span class="line"><span class="meta prompt_">y$ </span><span class="language-bash">                        <span class="comment"># 复制当前光标处到行尾</span></span></span><br><span class="line">y^                         # 复制当前光标处到非空行首</span><br><span class="line">y0                         # 复制当前光标处到行首</span><br><span class="line">ye                         # 复制当前或下一个单词</span><br><span class="line">yw                         # 复制光标所在处的单词</span><br><span class="line">yb                         # 复制当前或前一个单词</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND</span></span><br><span class="line">yy                         # 复制一整行</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">yy                        <span class="comment"># 复制#行</span></span></span><br></pre></td></tr></table></figure><h5 id="改变命令"><a href="#改变命令" class="headerlink" title="改变命令"></a>改变命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">c$ </span><span class="language-bash">                        <span class="comment"># 删除光标所在处至行尾，并切换到输入模式</span></span> </span><br><span class="line">c^                         # 非空行首</span><br><span class="line">c0                         # 行首</span><br><span class="line">cb                         # 当前或前一个单词</span><br><span class="line">ce                         # 当前或下一个单词</span><br><span class="line">cw                         # 当前单词</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND</span></span><br><span class="line">cc                         # 删除光标所在的行，并转换为输入模式</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">cc                        <span class="comment"># 删除光标所在行为起始行3行，并转换为输入模式</span></span></span><br></pre></td></tr></table></figure><h5 id="撤销命令"><a href="#撤销命令" class="headerlink" title="撤销命令"></a>撤销命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u                          # 撤销此前的操作；</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">u                         <span class="comment"># 撤销此前的#个操作；</span></span></span><br><span class="line">Ctrl+r                   # 撤销此前的撤销</span><br><span class="line">.                          # 重复执行前一个编辑操作</span><br></pre></td></tr></table></figure><h5 id="可视化模式"><a href="#可视化模式" class="headerlink" title="可视化模式"></a>可视化模式</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v                          # 按字符选定</span><br><span class="line">V                          # 按行选定</span><br><span class="line">                           # 结合编辑命令使用：d, c, y</span><br></pre></td></tr></table></figure><h3 id="末行模式"><a href="#末行模式" class="headerlink" title="末行模式"></a>末行模式</h3><h4 id="末行模式：地址定界"><a href="#末行模式：地址定界" class="headerlink" title="末行模式：地址定界"></a>末行模式：地址定界</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">命令格式：</span><br><span class="line">:start_pos[,end_pos]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                          <span class="comment"># 特定的第#行，例如5即第5行</span></span></span><br><span class="line">.                           # 当前行</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">                          <span class="comment"># 最后一行</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">,<span class="comment">#                         # 指定行范围，左侧为起始行，右侧为结束行</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">,+<span class="comment">#                        # 指定行范围，左侧为超始行绝对编号，右侧为相对左侧行号的偏移量；例如：3,+7</span></span></span><br><span class="line">.,$-1</span><br><span class="line">1,$</span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">                          <span class="comment"># 全文</span></span> </span><br><span class="line">/pattern/                   # 从光标所在处起始向文件尾部第一次被模式所匹配到的行</span><br><span class="line">/first/,$</span><br><span class="line">/pat1/,/pat2/               # 从光标所在处起始，第一次由pat1匹配到的行开始，至第一次由pat2匹配到的行结束之间的所有行</span><br><span class="line"></span><br><span class="line">可同编辑命令一同使用，实现编辑操作：</span><br><span class="line">d</span><br><span class="line">y</span><br><span class="line">c</span><br><span class="line">w/PATH/TO/SOMEFILE          # 将范围内的文本保存至指定的文件中；</span><br><span class="line">r  /PATH/FROM/SOMEFILE      # 将指定的文件中的文本读取并插入至指定位置；</span><br></pre></td></tr></table></figure><h4 id="末行模式：查找"><a href="#末行模式：查找" class="headerlink" title="末行模式：查找"></a>末行模式：查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/PATTERN：从当前光标所在处向文件尾部查找能够被当前模式匹配到的所有字符串；</span><br><span class="line">?PATTERN：从当前光标所在处向文件首部查找能够被当前模式匹配到的所有字符串；</span><br><span class="line">n：下一个，与命令方向相同；</span><br><span class="line">N：上一个，与命令方向相反；</span><br></pre></td></tr></table></figure><h4 id="末行模式：查找并替换"><a href="#末行模式：查找并替换" class="headerlink" title="末行模式：查找并替换"></a>末行模式：查找并替换</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s：末行模式的命令；使用格式：</span><br><span class="line">s/要查找的内容/替换为的内容/修饰符</span><br><span class="line">要查找的内容：可使用正则表达式；</span><br><span class="line">替换为的内容：不能使用下则表达式，但可以引用；</span><br><span class="line">如果“要查找的内容”部分在模式中使用分组符号：在“替换为的内容”中使用后向引用；</span><br><span class="line">直接引用查找模式匹配到的全部文本，要使用&amp;符号；</span><br><span class="line">修饰符：</span><br><span class="line">i：忽略大小写；</span><br><span class="line">g：全局替换，意味着一行中如果匹配到多次，则均替换；</span><br><span class="line">可把分隔符替换为其它非常用字符：</span><br><span class="line">s@@@</span><br><span class="line"><span class="meta prompt_">s#</span><span class="language-bash"><span class="comment">##</span></span></span><br></pre></td></tr></table></figure><h4 id="末行模式：示例"><a href="#末行模式：示例" class="headerlink" title="末行模式：示例"></a>末行模式：示例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">s@\&lt;t\([[:alpha:]]\+\)\&gt;@T\1@g</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">s@\&lt;t[[:alpha:]]\+\&gt;@&amp;er@g</span></span><br></pre></td></tr></table></figure><h3 id="vim的多文件功能"><a href="#vim的多文件功能" class="headerlink" title="vim的多文件功能"></a>vim的多文件功能</h3><h4 id="多文件"><a href="#多文件" class="headerlink" title="多文件"></a>多文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">多文件命令格式：</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim FILE1 FILE2 ...</span></span><br><span class="line">在文件间切换：</span><br><span class="line">:next  下一个</span><br><span class="line">:prev  上一个</span><br><span class="line">:first   第一个 </span><br><span class="line">:last   最后一个</span><br><span class="line">退出所有文件：</span><br><span class="line">:wqall 保存所有文件并退出；</span><br><span class="line">:wall</span><br><span class="line">:qall</span><br></pre></td></tr></table></figure><h4 id="多窗口"><a href="#多窗口" class="headerlink" title="多窗口"></a>多窗口</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-o：水平分割窗口</span><br><span class="line">-O：垂直分割窗口</span><br><span class="line">在窗口间切换：Ctrl+w, ARROW</span><br><span class="line">注意：单个文件也可以分割为多个窗口进行查看：</span><br><span class="line">Ctrl+w, s：水平分割窗口</span><br><span class="line">Ctrl+w, v：垂直分割窗口</span><br></pre></td></tr></table></figure><h3 id="定制的vim的工作特性"><a href="#定制的vim的工作特性" class="headerlink" title="定制的vim的工作特性"></a>定制的vim的工作特性</h3><p><strong>有效性说明：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、临时有效：在末行模式下的设定，仅对当前vim进程有效</span><br><span class="line">2、永久有效：需要修改相应的配置文件，全局配置文件（/etc/vimrc）；用户个人配置文件（～/.vimrc，需要首先创建此文件）</span><br></pre></td></tr></table></figure><p><strong>常用的命令选项：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1、行号</span><br><span class="line">显示：set number, 简写为set nu</span><br><span class="line">取消显示：set nomber, set nonu</span><br><span class="line">2、括号匹配高亮</span><br><span class="line">匹配：set showmatch, set sm</span><br><span class="line">取消：set nosm</span><br><span class="line">3、自动缩进</span><br><span class="line">启用：set ai</span><br><span class="line">禁用：set noai</span><br><span class="line">4、高亮搜索</span><br><span class="line">启用：set  hlsearch</span><br><span class="line">禁用：set nohlsearch</span><br><span class="line">5、语法高亮</span><br><span class="line">启用：syntax on</span><br><span class="line">禁用：syntax off </span><br><span class="line">6、忽略字符大小写</span><br><span class="line">启用：set ic</span><br><span class="line">禁用：set noic</span><br><span class="line">7、获取帮助</span><br><span class="line">:help</span><br><span class="line">:help subject</span><br><span class="line">8、按TAB产生4个空格</span><br><span class="line">set ts=4        # 注：ts是tabstop的缩写，设TAB宽4个空格</span><br><span class="line">set expandtab</span><br><span class="line">对于已保存的文件，可以使用下面的方法进行空格和TAB的替换：</span><br><span class="line">TAB替换为空格：</span><br><span class="line">:set ts=4</span><br><span class="line">:set expandtab</span><br><span class="line">:%retab!</span><br><span class="line"></span><br><span class="line">空格替换为TAB：</span><br><span class="line">:set ts=4</span><br><span class="line">:set noexpandtab</span><br><span class="line">:%retab!</span><br><span class="line">加!是用于处理非空白字符之后的TAB，即所有的TAB，若不加!，则只处理行首的TAB。</span><br></pre></td></tr></table></figure><h3 id="定制个人的-vimrc-文件"><a href="#定制个人的-vimrc-文件" class="headerlink" title="定制个人的 .vimrc 文件"></a>定制个人的 .vimrc 文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# pwd</span><br><span class="line">/root</span><br><span class="line">[root@server1 ~]# cat .vimrc </span><br><span class="line">set nu</span><br><span class="line">set nohlsearch</span><br><span class="line">syntax on</span><br><span class="line">set history=3000</span><br><span class="line">set ts=4</span><br><span class="line">set noexpandtab</span><br><span class="line">set autoindent</span><br><span class="line">filetype plugin indent on</span><br></pre></td></tr></table></figure><h3 id="vim小练习"><a href="#vim小练习" class="headerlink" title="vim小练习"></a>vim小练习</h3><p>1.请在&#x2F;tmp这个目录下建立一个名为vitest的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# cd /tmp</span><br><span class="line">[root@server1 tmp]# mkdir vitest</span><br></pre></td></tr></table></figure><p>2.进入vitest这个目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 tmp]# cd vitest</span><br></pre></td></tr></table></figure><p>3.将&#x2F;etc&#x2F;man.config复制到本目录底下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 tmp]# cp /etc/man.config .</span><br></pre></td></tr></table></figure><p>4.使用vim开启本目录下的man.config</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 tmp]# vim man.config</span><br></pre></td></tr></table></figure><p>5.在vi中设定一下行号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">末行模式下</span></span><br><span class="line">:set nu</span><br></pre></td></tr></table></figure><p>6.移动到第58行，向右移动40个字符,请问你看到的双引号内是什么目录?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">58G  #先按下『58G』</span><br><span class="line">40l  #再按下『40l』会看到『/dir/bin/foo』这个字样在双引号内；;</span><br></pre></td></tr></table></figure><p>7.移动到第一行，并且向下搜寻一下某个字符串（以bzip2为例），问该字符串在第几行？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1G       #先执行『1G』或『gg』后，</span><br><span class="line">/bzip2        #直接输入『/bzip2』即可;</span><br></pre></td></tr></table></figure><p>8.接着下来，我要将 50 到 100 行之间的『小写 man 字符串』改为『大写MAN字符串』，并且一个一个挑选是否需要修改，如何下达指令？如果在挑选过程中一直按[y],结果会在最后一行出现改为了几个man呢?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:50,100s/man/MAN/gc     #直接下达『 :50,100s/man/MAN/gc 』即可！</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">最下行显示23行内置换25个字符串的说明</span></span><br></pre></td></tr></table></figure><p>9.修改完之后，突然反悔了，要全部复原，有哪些方法?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u      #(1)简单的方法可以一直按『 u 』回复到原始状态</span><br><span class="line">:q!    #(2)使用不储存离开『 :q! 』之后，再重新读取一次该档案；;</span><br></pre></td></tr></table></figure><p>10.我要复制65到73这9行内容(含有MANPATH_MAP),并且贴到最后一行之后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">65G </span><br><span class="line">然后再 9yy #之后最后一行会出现『复制九行』之类的说明字样。 </span><br><span class="line">按下 G  #最后一行</span><br><span class="line"> p     #贴上九行！;</span><br></pre></td></tr></table></figure><p>11.21 到 42 行之间的开头为 # 符号的批注数据我不要了，要如何删除？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先到21行 【21G】,然后删除22行 【22dd】</span><br><span class="line">此时你会发现游标所在21行的地方变成MANPATH开头了，注释#符号那几行都被删除了</span><br></pre></td></tr></table></figure><p>12.将这个档案另存成一个man.test.config的档名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:w man.test.config #你会发现最后一行出现 &quot;man.test.config&quot; [New].. 的字样</span><br></pre></td></tr></table></figure><p>13.去到第 27 行，并且删除 15 个字符，结果出现的第一个单字是什么？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">27G</span><br><span class="line">15x   #即可删除 15 个字符，出现『 you 』的字样</span><br></pre></td></tr></table></figure><p>14.在第一行新增一行，该行内容输入[I am a student…]</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1G#先『 1G 』去到第一行</span><br><span class="line">O#然后按下大写的『 O 』便新增一行且在插入模式，开始输入所要插入的内容</span><br><span class="line">Esc#按下[Esc]回到一般模式等待后续工作；;</span><br></pre></td></tr></table></figure><p>15.存储后离开</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:wq!</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Vim编辑器的详细使用方法</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>文件查看</title>
    <link href="http://example.com/2023/11/17/6.%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B/"/>
    <id>http://example.com/2023/11/17/6.%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B/</id>
    <published>2023-11-17T01:25:00.000Z</published>
    <updated>2023-11-17T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="文件查看"><a href="#文件查看" class="headerlink" title="文件查看"></a>文件查看</h3><p><strong>各种系统文件：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/bin/date</span><br><span class="line">/etc/hostname</span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">/etc/passwd</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/group</span><br><span class="line">/etc/grub2.cfg</span><br><span class="line">/etc/resolv.conf</span><br><span class="line">/etc/profile # 设置系统环境变量</span><br><span class="line">/etc/bashrc # 影响bash shell环境</span><br><span class="line">/var/log/messages # 系统主日志文件</span><br><span class="line">/var/log/secure # 跟安全相关的日志如ssh登录，本地登录......</span><br></pre></td></tr></table></figure><h4 id="文本文件-cat与tac"><a href="#文本文件-cat与tac" class="headerlink" title="文本文件  cat与tac"></a>文本文件  cat与tac</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat命令的用途是连接文件或标准输入并打印。这个命令常用来显示文件内容，或者将几个文件连接起来显示，或者从标准输入读取内容并显示，它常与重定向符号配合使用。 </span><br><span class="line">1.命令格式：</span><br><span class="line">cat [选项] [文件]...</span><br><span class="line">2.命令功能：</span><br><span class="line">(1)一次显示整个文件:cat filename</span><br><span class="line">(2)从键盘创建一个文件:cat &gt; filename 只能创建新文件,不能编辑已有文件.</span><br><span class="line">(3)将几个文件合并为一个文件:cat file1 file2 &gt; file</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">命令参数：</span><br><span class="line">-A, --show-all           等价于 -vET</span><br><span class="line">-b, --number-nonblank    对非空输出行编号</span><br><span class="line">-e                       等价于 -vE</span><br><span class="line">-E, --show-ends          在每行结束处显示 $</span><br><span class="line">-n, --number             对输出的所有行编号,由1开始对所有输出的行数编号</span><br><span class="line">-s, --squeeze-blank      有连续两行以上的空白行，就代换为一行的空白行 </span><br><span class="line">-t                       与 -vT 等价</span><br><span class="line">-T, --show-tabs          将跳格字符显示为 ^I</span><br><span class="line">-u                       (被忽略)</span><br><span class="line">-v, --show-nonprinting   使用 ^ 和 M- 引用，除了 LFD 和 TAB 之外</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line">[root@server1 test]# cat -n log2012.log log2013.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把log2012.log的文件内容加上行号后输入log2013.log这个文件里</span></span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat -b log2012.log log2013.log log.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把log2012.log和log2013.log的文件内容加上行号（空白行不加）之后将内容附加到log.log里。</span></span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat -n log2012.log &gt; log.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把log2012.log的文件内容加上行号后输入log.log这个文件里</span> </span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat &gt;log.txt &lt;&lt;EOF</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用here doc来生成文件  EOF是终止符</span></span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# tac log.txt </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">tac</span>是将<span class="built_in">cat</span>反写过来，所以他的功能就跟<span class="built_in">cat</span>相反，<span class="built_in">cat</span>是由第一行到最后一行连续显示在萤幕上，而<span class="built_in">tac</span>则是由最后一行到第一行反向在萤幕上显示出来！</span></span><br></pre></td></tr></table></figure><h4 id="less命令"><a href="#less命令" class="headerlink" title="less命令"></a>less命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less工具也是对文件或其它输出进行分页显示的工具，应该说是linux正统查看文件内容的工具， 功能极其强大。less的用法比起more更加的有弹性。在more的时候，我们并没有办法向前面翻， 只能往后面看，但若使用了 less 时，就可以使用 [pageup] [pagedown] 等按键的功能来往前往后翻看文件，更容易用来查看一个文件的内容！除此之外，在less里头可以拥有更多的搜索功能，不止可以向下搜，也可以向上搜。</span><br></pre></td></tr></table></figure><p><strong>命令参数：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">less [参数]  文件</span><br><span class="line">-b &lt;缓冲区大小&gt; 设置缓冲区的大小</span><br><span class="line">-e  当文件显示结束后，自动离开</span><br><span class="line">-f  强迫打开特殊文件，例如外围设备代号、目录和二进制文件</span><br><span class="line">-g  只标志最后搜索的关键词</span><br><span class="line">-i  忽略搜索时的大小写</span><br><span class="line">-m  显示类似more命令的百分比</span><br><span class="line">-N  显示每行的行号</span><br><span class="line">-o &lt;文件名&gt; 将less 输出的内容在指定文件中保存起来</span><br><span class="line">-Q  不使用警告音</span><br><span class="line">-s  显示连续空行为一行</span><br><span class="line">-S  行过长时间将超出部分舍弃</span><br><span class="line">-x &lt;数字&gt; 将“tab”键显示为规定的数字空格</span><br></pre></td></tr></table></figure><p><strong>快捷使用：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/字符串：向下搜索“字符串”的功能</span><br><span class="line">?字符串：向上搜索“字符串”的功能</span><br><span class="line">n：重复前一个搜索（与 / 或 ? 有关）</span><br><span class="line">N：反向重复前一个搜索（与 / 或 ? 有关）</span><br><span class="line">b  向后翻一页</span><br><span class="line">d  向后翻半页</span><br><span class="line">h  显示帮助界面</span><br><span class="line">Q  退出less 命令</span><br><span class="line">u  向前滚动半页</span><br><span class="line">y  向前滚动一行</span><br><span class="line">空格键 滚动一行</span><br><span class="line">回车键 滚动一页</span><br><span class="line">[pagedown]： 向下翻动一页</span><br><span class="line">[pageup]：   向上翻动一页</span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]#less log2013.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看文件</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]#ps -ef |less</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ps查看进程信息并通过less分页显示</span> </span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]#Less log2013.log log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入：n后，切换到log2014.log     输入：p后，切换到log2013.log</span></span><br></pre></td></tr></table></figure><p><strong>附加备注：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.全屏导航</span><br><span class="line">ctrl + F - 向前移动一屏</span><br><span class="line">ctrl + B - 向后移动一屏</span><br><span class="line">ctrl + D - 向前移动半屏</span><br><span class="line">ctrl + U - 向后移动半屏</span><br><span class="line">2.单行导航</span><br><span class="line">j - 向前移动一行</span><br><span class="line">k - 向后移动一行</span><br><span class="line">3.其它导航</span><br><span class="line">G - 移动到最后一行</span><br><span class="line">g - 移动到第一行</span><br><span class="line">q / ZZ - 退出 less 命令</span><br></pre></td></tr></table></figure><h4 id="more命令"><a href="#more命令" class="headerlink" title="more命令"></a>more命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more命令，功能类似 cat，cat命令是整个文件的内容从上到下显示在屏幕上。more会以一页一页的显示方便使用者逐页阅读，而最基本的指令就是按空白键（space）就往下一页显示，按b键就会往回（back）一页显示，而且还有搜寻字串的功能 。more命令从前向后读取文件，因此在启动时就加载整个文件。</span><br></pre></td></tr></table></figure><p><strong>参数选项：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">more [-dlfpcsu ] [-num ] [+/ pattern] [+ linenum] [file ... ] </span><br><span class="line">+n        从笫n行开始显示</span><br><span class="line">-n        定义屏幕大小为n行</span><br><span class="line">+/pattern 在每个档案显示前搜寻该字串（pattern），然后从该字串前两行之后开始显示  </span><br><span class="line">-c        从顶部清屏，然后显示</span><br><span class="line">-d        提示“Press space to continue，’q’ to quit，禁用响铃功能</span><br><span class="line">-l        忽略Ctrl+l（换页）字符</span><br><span class="line">-p        通过清除窗口而不是滚屏来对文件进行换页，与-c选项相似</span><br><span class="line">-s        把连续的多个空行显示为一行</span><br><span class="line">-u        把文件内容中的下画线去掉</span><br></pre></td></tr></table></figure><p><strong>常见操作：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Enter    向下n行，需要定义。默认为1行</span><br><span class="line">Ctrl+F   向下滚动一屏</span><br><span class="line">空格键    向下滚动一屏</span><br><span class="line">Ctrl+B   返回上一屏</span><br><span class="line">=        输出当前行的行号</span><br><span class="line">：f      输出文件名和当前行的行号</span><br><span class="line">V       调用vi编辑器</span><br><span class="line">!命令    调用Shell，并执行命令 </span><br><span class="line">q       退出more</span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# more +3 log2012.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示文件中从第3行起的内容</span></span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[root@server1 test]# more +/day3 log2012.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从文件中查找第一个出现<span class="string">&quot;day3&quot;</span>字符串的行，并从该处前两行开始显示输出</span> </span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[root@server1 test]# more -5 log2012.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定每屏显示行数</span> </span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[root@server1 test]#  ls -l  | more -5</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列一个目录下的文件，由于内容太多，我们应该学会用more来分页显示。这得和管道 | 结合起来</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">每页显示5个文件信息，按Ctrl+F或者空格键将会显示下5条文件信息。</span></span><br></pre></td></tr></table></figure><h4 id="head命令"><a href="#head命令" class="headerlink" title="head命令"></a>head命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head与tail就像它的名字一样的浅显易懂，它是用来显示开头或结尾某个数量的文字区块，head 用来显示档案的开头至标准输出中，而tail想当然尔就是看档案的结尾。 </span><br></pre></td></tr></table></figure><p><strong>参数选项：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">head [参数]... [文件]...  </span><br><span class="line">-q 隐藏文件名</span><br><span class="line">-v 显示文件名</span><br><span class="line">-c&lt;字节&gt; 显示字节数</span><br><span class="line">-n&lt;行数&gt; 显示的行数</span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# head -n 5 log2014.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示文件的前n行</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]# head -c 20 log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示文件前n个字节</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]# head -c -32 log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件的除了最后n个字节以外的内容</span> </span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]# head -n -6 log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出文件除了最后n行的全部内容</span></span><br></pre></td></tr></table></figure><h4 id="tail命令"><a href="#tail命令" class="headerlink" title="tail命令"></a>tail命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail命令从指定点开始将文件写到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件,tail -f filename会把filename里最尾部的内容显示在屏幕上,并且不但刷新,使你看到最新的文件内容。默认一次10h</span><br></pre></td></tr></table></figure><p><strong>参数选项：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tail[必要参数][选择参数][文件]</span><br><span class="line">-f 循环读取</span><br><span class="line">-q 不显示处理信息</span><br><span class="line">-v 显示详细的处理信息</span><br><span class="line">-c&lt;数目&gt; 显示的字节数</span><br><span class="line">-n&lt;行数&gt; 显示行数</span><br><span class="line">--pid=PID 与-f合用,表示在进程ID,PID死掉之后结束. </span><br><span class="line">-q, --quiet, --silent 从不输出给出文件名的首部 </span><br><span class="line">-s, --sleep-interval=S 与-f合用,表示在每次反复的间隔休眠S秒 </span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 test]# tail -n 5 log2014.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示文件末尾内容,显示文件最后5行内容</span></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line">[root@server1 ~]# tail -f test.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">循环查询文件</span></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line">[root@server1 test]# tail -n +5 log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从第5行开始显示文件</span></span><br></pre></td></tr></table></figure><h4 id="tailf命令"><a href="#tailf命令" class="headerlink" title="tailf命令"></a>tailf命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tailf命令几乎等同于tail -f，严格说来应该与tail --follow=name更相似些。当文件改名之后它也能继续跟踪，特别适合于日志文件的跟踪（follow the growth of a log file）。与tail -f不同的是，如果文件不增长，它不会去访问磁盘文件。tailf特别适合那些便携机上跟踪日志文件，因为它能省电，因为减少了磁盘访问。</span><br><span class="line">tailf命令不是个脚本，而是一个用C代码编译后的二进制执行文件，某些Linux安装之后没有这个命令。</span><br></pre></td></tr></table></figure><p><strong>参数选项：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tailf [参数] [文件]</span><br><span class="line">-n输出最后数行</span><br><span class="line">-NUMBER与NUMBER相同</span><br><span class="line">-V输出版本信息并退出</span><br><span class="line">-h显示帮助并退出</span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# tailf -n 5 log2014.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示最后5行的信息</span></span><br><span class="line">[root@server1 ~]# tailf log/WEB.LOG </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示文件内容</span></span><br></pre></td></tr></table></figure><h4 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Linux系统中grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</span><br><span class="line">grep的工作方式是这样的，它在一个或多个文件中搜索字符串模板。如果模板包括空格，则必须被引用，模板后的所有字符串被看作文件名。搜索的结果被送到标准输出，不影响原文件内容。</span><br><span class="line">grep可用于shell脚本，因为grep通过返回一个状态值来说明搜索的状态，如果模板搜索成功，则返回0，如果搜索不成功，则返回1，如果搜索的文件不存在，则返回2。我们利用这些返回值就可进行一些自动化的文本处理工作。</span><br></pre></td></tr></table></figure><p><strong>命令参数：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">grep [option] pattern file</span><br><span class="line">-a   --text</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">不要忽略二进制的数据。</span>   </span><br><span class="line">-A&lt;显示行数&gt;   --after-context=&lt;显示行数&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">除了显示符合范本样式的那一列之外，并显示该行之后的内容。</span>   </span><br><span class="line">-b   --byte-offset   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在显示符合样式的那一行之前，标示出该行第一个字符的编号。</span>   </span><br><span class="line">-B&lt;显示行数&gt;   --before-context=&lt;显示行数&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">除了显示符合样式的那一行之外，并显示该行之前的内容。</span>   </span><br><span class="line">-c    --count   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">计算符合样式的列数。</span>   </span><br><span class="line">-C&lt;显示行数&gt;    --context=&lt;显示行数&gt;或-&lt;显示行数&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">除了显示符合样式的那一行之外，并显示该行之前后的内容。</span>   </span><br><span class="line">-d &lt;动作&gt;      --directories=&lt;动作&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当指定要查找的是目录而非文件时，必须使用这项参数，否则grep指令将回报信息并停止动作。</span> </span><br><span class="line">-e&lt;范本样式&gt;  --regexp=&lt;范本样式&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定字符串做为查找文件内容的样式。</span>   </span><br><span class="line">-E      --extended-regexp   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将样式为延伸的普通表示法来使用。</span>   </span><br><span class="line">-f&lt;规则文件&gt;  --file=&lt;规则文件&gt;   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定规则文件，其内容含有一个或多个规则样式，让grep查找符合规则条件的文件内容，格式为每行一个规则样式。</span>   </span><br><span class="line">-F   --fixed-regexp   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将样式视为固定字符串的列表。</span>   </span><br><span class="line">-G   --basic-regexp   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将样式视为普通的表示法来使用。</span>   </span><br><span class="line">-h   --no-filename   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在显示符合样式的那一行之前，不标示该行所属的文件名称。</span>   </span><br><span class="line">-H   --with-filename   #在显示符合样式的那一行之前，表示该行所属的文件名称。   </span><br><span class="line">-i    --ignore-case   #忽略字符大小写的差别。   </span><br><span class="line">-l    --file-with-matches   #列出文件内容符合指定的样式的文件名称。   </span><br><span class="line">-L   --files-without-match   #列出文件内容不符合指定的样式的文件名称。   </span><br><span class="line">-n   --line-number   #在显示符合样式的那一行之前，标示出该行的列数编号。   </span><br><span class="line">-q   --quiet或--silent   #不显示任何信息。   </span><br><span class="line">-r   --recursive   #此参数的效果和指定“-d recurse”参数相同。   </span><br><span class="line">-s   --no-messages   #不显示错误信息。   </span><br><span class="line">-v   --revert-match   #显示不包含匹配文本的所有行。   </span><br><span class="line">-V   --version   #显示版本信息。   </span><br><span class="line">-w   --word-regexp   #只显示全字符合的列。   </span><br><span class="line">-x    --line-regexp   #只显示全列符合的列。   </span><br><span class="line">-y   #此参数的效果和指定“-i”参数相同。</span><br></pre></td></tr></table></figure><p><strong>规则表达式：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">^    #锚定行的开始 如：&#x27;^grep&#x27;匹配所有以grep开头的行。    </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">   <span class="comment">#锚定行的结束 如：&#x27;grep$&#x27;匹配所有以grep结尾的行。</span></span>    </span><br><span class="line">.    #匹配一个非换行符的字符 如：&#x27;gr.p&#x27;匹配gr后接一个任意字符，然后是p。    </span><br><span class="line">*    #匹配零个或多个先前字符 如：&#x27;*grep&#x27;匹配所有一个或多个空格后紧跟grep的行。    </span><br><span class="line">.*   #一起用代表任意字符。   </span><br><span class="line">[]   #匹配一个指定范围内的字符，如&#x27;[Gg]rep&#x27;匹配Grep和grep。</span><br><span class="line">[^]  #匹配一个不在指定范围内的字符，如：&#x27;[^A-FH-Z]rep&#x27;匹配不包含A-R和T-Z的一个字母开头，紧跟rep的行。</span><br><span class="line">\(..\)     #标记匹配字符，如&#x27;\(love\)&#x27;，love被标记为1。    </span><br><span class="line">\&lt;         #锚定单词的开始，如:&#x27;\&lt;grep&#x27;匹配包含以grep开头的单词的行。    </span><br><span class="line">\&gt;         #锚定单词的结束，如&#x27;grep\&gt;&#x27;匹配包含以grep结尾的单词的行。    </span><br><span class="line">x\&#123;m\&#125;     #重复字符x，m次，如：&#x27;0\&#123;5\&#125;&#x27;匹配包含5个o的行。    </span><br><span class="line">x\&#123;m,\&#125;    #重复字符x,至少m次，如：&#x27;o\&#123;5,\&#125;&#x27;匹配至少有5个o的行。    </span><br><span class="line">x\&#123;m,n\&#125;   #重复字符x，至少m次，不多于n次，如：&#x27;o\&#123;5,10\&#125;&#x27;匹配5--10个o的行。   </span><br><span class="line">\w         #匹配文字和数字字符，也就是[A-Za-z0-9]，如：&#x27;G\w*p&#x27;匹配以G后跟零个或多个文字或数字字符，然后是p。   </span><br><span class="line">\W         #\w的反置形式，匹配一个或多个非单词字符，如点号句号等。   </span><br><span class="line">\b         #单词锁定符，如: &#x27;\bgrep\b&#x27;只匹配grep。</span><br><span class="line">\d       #匹配一个数字字符。等价于[0-9]。</span><br></pre></td></tr></table></figure><p><strong>常用的正则表达式：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">用户名        /^[a-z0-9_-]&#123;3,16&#125;$/</span><br><span class="line">密码        /^[a-z0-9_-]&#123;6,18&#125;$/</span><br><span class="line">十六进制值  /^#?([a-f0-9]&#123;6&#125;|[a-f0-9]&#123;3&#125;)$/</span><br><span class="line">URL    /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]&#123;2,6&#125;)([\/\w \.-]*)*\/?$/</span><br></pre></td></tr></table></figure><p><strong>使用实例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# ps -ef|grep svn</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第一条记录是查找出的进程；第二条结果是grep进程本身，并非真正要找的进程。</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt | grep -f test2.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出test.txt文件中含有从test2.txt文件中读取出的关键词的内容行</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt | grep -nf test2.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出test.txt文件中含有从test2.txt文件中读取出的关键词的内容行，并显示每一行的行号</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# grep -n &#x27;linux&#x27; test.txt </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从文件中查找关键词,并显示行号</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# grep -n &#x27;linux&#x27; test.txt test2.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从多个文件中查找关键词，多文件时，输出查询到的信息内容行时，会把文件的命名在行最前面输出并且加上<span class="string">&quot;:&quot;</span>作为标示符。</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt |grep ^u</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">找出已u开头的行内容</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt |grep ^[^u]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出非u开头的行内容</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt |grep hat$</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出以hat结尾的行内容</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# cat test.txt |grep -E &quot;ed|at&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示包含ed或者at字符的内容行</span></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# grep &#x27;[a-z]\&#123;7\&#125;&#x27; *.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示当前目录下面以.txt 结尾的文件中的所有包含每个字符串至少有7个连续小写字符的字符串的行</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">cat,less,more,grep,tail,head等文件查看命令</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>文件管理</title>
    <link href="http://example.com/2023/11/16/5.%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2023/11/16/5.%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/</id>
    <published>2023-11-16T01:25:00.000Z</published>
    <updated>2023-11-16T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h2><h3 id="文件定位-路径"><a href="#文件定位-路径" class="headerlink" title="文件定位 路径"></a>文件定位 路径</h3><p><strong>绝对路径</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从根目录开始，依次将各级子目录的名字组合起来，形成的路径就称为某个文件的绝对路径。例如，根目录（/）下有目录usr，usr目录下有子目录bin，bin目录下有文件chsh，则chsh文件的绝对路径就是：/usr/bin/chsh</span><br></pre></td></tr></table></figure><p><strong>相对路径</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相对当前所在路径的位置，例如当前所在的位置为/usr，也就是在根目录的usr子目录下，则chsh文件相对当前位置的路径为：bin/chsh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# pwd   //显示当前目录</span><br><span class="line">/root</span><br><span class="line">[root@server1 ~]# cd - # 返回上次目录</span><br><span class="line">/home/aaron</span><br><span class="line">[root@server1 aaron]# cd ~ # 直接回家</span><br><span class="line">[root@server1 aaron]# cd # 直接回家</span><br></pre></td></tr></table></figure><h3 id="文件管理：创建-复制-移动-删除"><a href="#文件管理：创建-复制-移动-删除" class="headerlink" title="文件管理：创建&#x2F;复制&#x2F;移动&#x2F;删除"></a>文件管理：创建&#x2F;复制&#x2F;移动&#x2F;删除</h3><h4 id="创建-touch-mkdir"><a href="#创建-touch-mkdir" class="headerlink" title="创建 touch| mkdir"></a>创建 touch| mkdir</h4><p><strong>文件创建：touch命令</strong><br>touch命令有两个作用：一个是修改文件的时间，一个是建立新的空文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">无选项状态下：若文件不存在，则创建新的空文件，access time，modify time和change time均为当前时间；若文件存在，则将三个时间戳均修改为当前时间。</span><br><span class="line">-a：只修改文件的access time</span><br><span class="line">注意：access time修改后，change time也被修改（因为状态发生了改变）</span><br><span class="line">-m：只修改文件的modify time</span><br><span class="line">注意：modify time修改后，change time也被修改（因为状态发生了改变）</span><br><span class="line">-c：不创建不存在的文件（当touch后操作多个文件时，不存在的文件将不会被创建）</span><br><span class="line">-d：使用指定的日期时间，而非现在的时间，可以使用各种不同的格式</span><br><span class="line">-t：将时间修改为参数指定的日期，如：07081556代表7月8号15点56分</span><br><span class="line">注意：change time发生了变化，变成了当前时间</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">CC   表示世纪</span><br><span class="line">YY   表示年</span><br><span class="line">MM   表示月</span><br><span class="line">DD   表示日</span><br><span class="line">hh   表示小时</span><br><span class="line">mm   表示分钟</span><br><span class="line">ss   表示秒</span><br><span class="line">其中世纪，年，秒是可选的！</span><br><span class="line">比如：202111062307.30    表示2021年11月6日23点07分30秒</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">touch也可以批量创建文件</span><br><span class="line">[root@server1 ~]#touch file&#123;1..10&#125; //创建file1—file10共10个文件，..表示连续值</span><br><span class="line">[root@server1 ~]#touch dir/student_&#123;zhangsan,lisi&#125;  #z</span><br><span class="line">[root@server1 ~]#touch -r目标文件  源文件   //修改两个文件的时间相同</span><br><span class="line">[root@server1 ~]#touch -t 201810121230 hh.sh 【-t用十进制数】 //设置时间戳</span><br></pre></td></tr></table></figure><p><strong>目录创建：mkdir命令</strong><br>mkdir 命令用来创建指定的名称的目录，要求创建目录的用户在当前目录中具有写权限，并且指定的目录名不能是当前目录中已有的目录。（区分大小写）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-m, --mode=模式，设定权限&lt;模式&gt; (类似 chmod)，而不是 rwxrwxrwx 减 umask</span><br><span class="line">-p, --parents  可以是一个路径名称。此时若路径中的某些目录尚不存在,加上此选项后,系统将自动建立好那些尚不存在的目录,即一次可以建立多个目录; </span><br><span class="line">-v, --verbose  每次创建新目录都显示信息（显示操作消息）</span><br><span class="line">    --help   显示此帮助信息并退出</span><br><span class="line">    --version  输出版本信息并退出</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mkdir test1  //创建一个空目录</span><br><span class="line">[root@server1 ~]# ll</span><br><span class="line">drwxr-xr-x. 2 root root    6 11月  7 09:52 test1</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test1]# mkdir -p test2/test22   //递归创建两个文件夹</span><br><span class="line">[root@server1 test1]# ll  //在test1下查看test2</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x. 3 root root 20 11月  5 08:37 test2</span><br><span class="line">[root@server1 test1]# cd test2     //test22是在test2下面的，这就是递归</span><br><span class="line">[root@server1 test2]# ll</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  5 08:37 test22</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 ~]# mkdir -m 777 test3 //创建权限为777的目录</span><br><span class="line">说明：目录的权限为rwxrwxrwx</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test2]# mkdir test4 -v  //每次创建都显示操作信息</span><br><span class="line">mkdir: 已创建目录 &quot;test4&quot;</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">[root@server1 test]#mkdir -vp    scf/&#123;lib/,bin/,doc/&#123;info,product&#125;,logs/&#123;info,product&#125;,service/deploy/&#123;info,product&#125;&#125;  //递归创建目录结构</span><br><span class="line">mkdir: 已创建目录 “scf”</span><br><span class="line">mkdir: 已创建目录 “scf/lib”</span><br><span class="line">mkdir: 已创建目录 “scf/bin”</span><br><span class="line">mkdir: 已创建目录 “scf/doc”</span><br><span class="line">mkdir: 已创建目录 “scf/doc/info”</span><br><span class="line">mkdir: 已创建目录 “scf/doc/product”</span><br><span class="line">mkdir: 已创建目录 “scf/logs”</span><br><span class="line">mkdir: 已创建目录 “scf/logs/info”</span><br><span class="line">mkdir: 已创建目录 “scf/logs/product”</span><br><span class="line">mkdir: 已创建目录 “scf/service”</span><br><span class="line">mkdir: 已创建目录 “scf/service/deploy”</span><br><span class="line">mkdir: 已创建目录 “scf/service/deploy/info”</span><br><span class="line">mkdir: 已创建目录 “scf/service/deploy/product”</span><br><span class="line">````</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 复制 cp</span></span></span><br><span class="line"></span><br><span class="line">cp命令用来将一个或多个源文件或者目录复制到指定的目的文件或目录。它可以将单个源文件复制成一个指定文件名的具体的文件或一个已经存在的目录下。cp命令还支持同时复制多个文件，当一次复制多个文件时，目标文件参数必须是一个已经存在的目录，否则将出现错误。</span><br><span class="line">```shell</span><br><span class="line">cp(选项)(参数)</span><br><span class="line">-a：此参数的效果和同时指定&quot;-dpR&quot;参数相同；</span><br><span class="line">-d：当复制符号连接时，把目标文件或目录也建立为符号连接，并指向与源文件或目录连接的原始文件或目录；</span><br><span class="line">-f：强行复制文件或目录，不论目标文件或目录是否已存在；</span><br><span class="line">-i：覆盖既有文件之前先询问用户；</span><br><span class="line">-l：对源文件建立硬连接，而非复制文件；</span><br><span class="line">-p：保留源文件或目录的属性；</span><br><span class="line">-R/r：递归处理，将指定目录下的所有文件与子目录一并处理；</span><br><span class="line">-s：对源文件建立符号连接，而非复制文件；</span><br><span class="line">-u：使用这项参数后只会在源文件的更改时间较目标文件更新时或是名称相互对应的目标文件并不存在时，才复制文件；</span><br><span class="line">-S：在备份文件时，用指定的后缀“SUFFIX”代替文件的默认后缀；</span><br><span class="line">-b：覆盖已存在的文件目标前将目标文件备份；</span><br><span class="line">-v：详细显示命令执行的操作。</span><br></pre></td></tr></table></figure><p><strong>参数要求：</strong></p><ul><li>源文件：制定源文件列表。默认情况下，cp命令不能复制目录，如果要复制目录，则必须使用-R选项；</li><li>目标文件：指定目标文件。当“源文件”为多个文件时，要求“目标文件”为指定的目录。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line">如果把一个文件复制到一个目标文件中，而目标文件已经存在，那么，该目标文件的内容将被破坏。此命令中所有参数既可以是绝对路径名，也可以是相对路径名。通常会用到点.或点点..的形式。</span><br><span class="line">[root@server1 ~]# cp ../mary/homework/assign .  #将指定文件复制到当前目录下</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">所有目标文件指定的目录必须是己经存在的，cp命令不能创建目录。如果没有文件复制的权限，则系统会显示出错信息。</span><br><span class="line">[root@server1 ~]# cp file /usr/men/tmp/file1  //将文件file复制到目录/usr/men/tmp下，并改名为file1</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">将**目录**/usr/men下的所有文件及其子目录复制到目录/usr/zh中，用-R/r选项：</span><br><span class="line">[root@server1 ~]# cp -r /usr/men /usr/zh</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">递归强制复制目录到指定目录中覆盖已存在文件：</span><br><span class="line">[root@server1 ~]# cp -rfb ./* ../backup</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将当前目录下所有文件，复制到当前目录的兄弟目录 backup 文件夹中</span></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">拷贝目录下的隐藏文件如 .babelrc：</span><br><span class="line">[root@server1 ~]# cp -r aaa/.* ./bbb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 aaa 目录下的，所有`.`开头的文件，复制到 bbb 目录中</span></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">复制到当前目录:</span><br><span class="line">[root@server1 ~]# cp aaa.conf ./</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 aaa.conf 复制到当前目录</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="移动-mv"><a href="#移动-mv" class="headerlink" title="移动   mv"></a>移动   mv</h4><p>命令格式：mv  [-选项]      源文件或目录      目标文件或目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">视mv命令中第二个参数类型的不同（是目标文件还是目标目录），mv命令将文件重命名或将其移至一个新的目录中。当第二个参数类型是文件时，mv命令完成文件重命名，此时，源文件只能有一个（也可以是源目录名），它将所给的源文件或目录重命名为给定的目标文件名。当第二个参数是已存在的目录名称时，源文件或目录参数可以有多个，mv命令将各参数指定的源文件均移至目标目录中。在跨文件系统移动文件时，mv先拷贝，再将原有文件删除，而链至该文件的链接也将丢失。</span><br><span class="line">-b ：若需覆盖文件，则覆盖前先行备份。 </span><br><span class="line">-f ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</span><br><span class="line">-i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！</span><br><span class="line">-u ：若目标文件已经存在，且 source 比较新，才会更新(update)</span><br><span class="line">-t ：即指定mv的目标目录，该选项适用于移动多个源文件到一个目录的情况，此时目标目录在前，源文件在后。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line">[root@server1 test]# ll</span><br><span class="line">-rw-r--r-- 1 root root   16 10-28 06:04 test.log</span><br><span class="line">[root@server1 test]#mv test.log test1.txt  //文件改名,将文件test.log重命名为test1.txt</span><br><span class="line">[root@server1 test]# ll</span><br><span class="line">-rw-r--r-- 1 root root   16 10-28 06:04 test1.txt</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test]# mv test1.txt test3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将text1.txt移动到test3文件夹中</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test]# mv log1.txt log2.txt log3.txt test3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将log1.txt ，log2.txt， log3.txt 三个文件移到 test3目录中</span></span><br><span class="line">[root@server1 test3]# mv -t /opt/soft/test/test4/ log1.txt log2.txt  log3.txt   //-t命令时文件夹和文件位置互换</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将三个文件移到test4目录中</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test4]# mv -i log1.txt log2.txt </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将文件file1改名为file2，如果file2已经存在，则询问是否覆盖。文件1内容与文件2不同的时候，覆盖以后，这个文件里的内容会变成文件里的。</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test4]# mv -f log3.txt log2.txt </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log3.txt的内容直接覆盖了log2.txt内容，-f这是个危险的选项，使用的时候一定要保持头脑清晰，一般情况下最好不用加上它。</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test]# mv test4 test3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果目录dir2不存在，将目录dir1改名为dir2；否则，将dir1移动到dir2中。</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test4]# mv * ../</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">移动当前文件夹下的所有文件到上一级目录</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test]# mv test3/*.txt test5</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把当前目录的一个子目录里的文件移动到另一个子目录里</span></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">[root@server1 test5]# mv log1.txt -b log2.txt</span><br><span class="line">mv：是否覆盖“log2.txt”? y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件被覆盖前做简单备份，前面加参数-b</span></span><br></pre></td></tr></table></figure><h4 id="删除-rm"><a href="#删除-rm" class="headerlink" title="删除  rm"></a>删除  rm</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm是常用的命令，该命令的功能为删除一个目录中的一个或多个文件或目录，它也可以将某个目录及其下的所有文件及子目录均删除。对于链接文件，只是删除了链接，原有文件均保持不变。</span><br><span class="line">rm是一个危险的命令，使用的时候要特别当心，尤其对于新手，否则整个系统就会毁在这个命令（比如在/下执行rm * -rf）。所以，我们在执行rm之前最好先确认一下在哪个目录，到底要删除什么东西，操作时保持高度清醒的头脑。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式：rm [选项] 文件… </span><br></pre></td></tr></table></figure><p><strong>命令参数：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-f, --force    忽略不存在的文件，从不给出提示。</span><br><span class="line">-i, --interactive 进行交互式删除</span><br><span class="line">-r, -R, --recursive   指示rm将参数中列出的全部目录和子目录均递归地删除。</span><br><span class="line">-v, --verbose    详细显示进行的步骤</span><br><span class="line">    --help     显示此帮助信息并退出</span><br><span class="line">    --version  输出版本信息并退出</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line">[root@server1 test1]# rm log.log </span><br><span class="line">rm：是否删除 一般文件 “log.log”? y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入<span class="built_in">rm</span> log.log命令后，系统会询问是否删除，输入y后就会删除文件，不想删除则数据n。</span></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">[root@server1 test1]# rm -f log1.log </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">强行删除file，系统不再提示。</span> </span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">[root@server1 test1]# rm -i *.log</span><br><span class="line">rm：是否删除 一般文件 “log1.log”? y</span><br><span class="line">rm：是否删除 一般文件 “log2.log”? y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除任何.<span class="built_in">log</span>文件；删除前逐一询问确认</span> </span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# rm -r test1</span><br><span class="line">rm：是否进入目录 “test1”? y</span><br><span class="line">rm：是否删除 一般文件 “test1/log3.log”? y</span><br><span class="line">rm：是否删除 目录 “test1”? y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将test1子目录及子目录中所有档案删除</span></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">[root@server1 test]# rm -rf test2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将test2子目录及子目录中所有档案删除,并且不用一一确认</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Linux基础的文件管理</summary>
    
    
    
    <category term="Linux" scheme="http://example.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
</feed>
